import{d as S,X as k,r as $,o as x,Y as L,R as M,h as v,m as B,w as l,a as T,e as c,i as a,z as P,k as f,P as h,H as w,G as R,$ as g,n as j,p as q,b as H,f as V,g as z,u as A,x as G,j as J,J as K}from"./index-0165ef2a.js";import{u as X}from"./reference-3a204a36.js";import{_ as Y}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-0f36646d.js";import{u as O}from"./customers-7ea2bdbb.js";const D=d=>(q("data-v-a7e7693a"),d=d(),H(),d),Q={class:"flex flex-wrap align-items-center justify-content-between gap-2"},W={class:"datatable-filter"},Z={class:"filter-field"},ee=D(()=>c("label",null,"Codi",-1)),te={class:"filter-field"},se=D(()=>c("label",null,"Client",-1)),oe={class:"datatable-buttons"},ae=["onClick"],ne=S({__name:"TableReferences",props:{references:{}},emits:["add","edit","delete"],setup(d,{emit:i}){const p=d,u=k(),y=O(),e=$({code:"",customerId:""});x(()=>{const t=u.getFilter("References","");t&&(t.code&&(e.value.code=t.code),t.customerId&&(e.value.customerId=t.customerId))}),L(async()=>{await u.addFilter("References","",e.value)});const b=()=>{e.value.code="",e.value.customerId=""},C=M(()=>{if(!p.references)return[];let t=p.references;return e.value.customerId&&e.value.customerId.length>0&&(t=t.filter(s=>s.customerId===e.value.customerId)),e.value.code&&e.value.code.length>0&&(t=t.filter(s=>s.code.toLowerCase().includes(e.value.code.toLowerCase()))),t}),I=()=>{i("add")},r=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||i("edit",t.data)},_=(t,s)=>{i("delete",s)},F=t=>{var m;const s=(m=y.customers)==null?void 0:m.find(n=>n.id===t);return s?s.comercialName:""};return(t,s)=>{const m=v("Button"),n=v("Column"),E=v("BooleanColumn"),N=v("DataTable");return T(),B(N,{value:C.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:r},{header:l(()=>[c("div",Q,[c("div",W,[c("div",Z,[ee,a(P,{modelValue:e.value.code,"onUpdate:modelValue":s[0]||(s[0]=o=>e.value.code=o)},null,8,["modelValue"])]),c("div",te,[se,a(Y,{label:"",modelValue:e.value.customerId,"onUpdate:modelValue":s[1]||(s[1]=o=>e.value.customerId=o)},null,8,["modelValue"])])]),c("div",oe,[a(m,{class:"datatable-button mr-2",icon:f(h).FILTER_SLASH,rounded:"",raised:"",onClick:b},null,8,["icon"]),a(m,{class:"datatable-button mr-2",icon:f(h).PLUS,rounded:"",raised:"",onClick:I},null,8,["icon"])])])]),default:l(()=>[a(n,{field:"code",header:"Codi",style:{width:"15%"}}),a(n,{field:"description",header:"Descripció",style:{width:"35%"}}),a(n,{field:"version",header:"Versió",style:{width:"10%"}}),a(n,{field:"customerId",header:"Client",style:{width:"20%"}},{body:l(o=>[c("span",null,w(F(o.data.customerId)),1)]),_:1}),a(n,{field:"price",header:"Preu",style:{width:"10%"}},{body:l(o=>[R(w(f(g)(o.data.price)),1)]),_:1}),a(n,{field:"cost",header:"Cost",style:{width:"10%"}},{body:l(o=>[R(w(f(g)(o.data.workMasterCost)),1)]),_:1}),a(n,{header:"Servei",style:{width:"10%"}},{body:l(o=>[a(E,{value:o.data.isService},null,8,["value"])]),_:1}),a(n,{style:{width:"10%"}},{body:l(o=>[c("i",{class:j([f(h).TIMES,"grid_delete_column_button"]),onClick:U=>_(U,o.data)},null,10,ae)]),_:1})]),_:1},8,["value"])}}});const re=V(ne,[["__scopeId","data-v-a7e7693a"]]),ce=S({__name:"References",setup(d){const i=z(),p=A();k();const u=X(),y=G(),e=J();x(async()=>{let r="Referencies de venta";p.setMenuItem({icon:h.TICKET,title:r}),await u.fetchReferencesByModule("sales")});const b=()=>{i.push({path:`/sales/reference/${K()}`})},C=r=>{i.push({path:`/sales/reference/${r.id}`})},I=r=>{y.require({message:`Está segur que vol eliminar la refèrencia ${r.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const _=await u.deleteReference(r.id);_.result?e.add({severity:"success",summary:"Referencia eliminada correctament",life:5e3}):e.add({severity:"warn",summary:_.errors[0],life:5e3,closable:!0})}})};return(r,_)=>(T(),B(re,{references:f(u).references,onAdd:b,onEdit:C,onDelete:I},null,8,["references"]))}});const fe=V(ce,[["__scopeId","data-v-a47fed42"]]);export{fe as default};
