import{_ as L}from"./DropdownReference.vue_vue_type_script_setup_true_lang-9e7acd0e.js";import{c as j,d as z,a as A,F as Q}from"./form-validator-e18d88f5.js";import{d as W,j as E,T as G,r as x,h as v,c as D,e as t,i as l,G as $,k as i,z as H,H as y,l as S,a as V,s as J,R as I,K,x as X,w as h,L as R,P,n as Y,m as B,J as Z,v as ee,g as te,u as se,C as ae,o as oe,f as re}from"./index-d4f01faf.js";import{u as N}from"./workmaster-3649af81.js";import{u as q}from"./plantmodel-8bfb9a3a.js";import{_ as le}from"./FormWorkmasterPhase.vue_vue_type_script_setup_true_lang-55bb11ed.js";import{u as ne}from"./reference-1f2c96f9.js";import"./index-402f70f9.js";import"./index-7cbe1881.js";const ie={key:0},ce={class:"grid_add_row_button"},de=t("br",null,null,-1),ue={class:"five-columns"},me=t("label",{class:"block text-900 mb-2"},"Mode",-1),pe=t("label",{class:"block text-900 mb-2"},"Desactivat",-1),_e={class:"five-columns"},fe={class:"mt-1"},ke=t("label",{class:"block text-900 mb-2"},"Cost Operari:",-1),we={class:"summary-field"},be={class:"mt-1"},he=t("label",{class:"block text-900 mb-2"},"Cost Màquina:",-1),ve={class:"summary-field"},ye={class:"mt-1"},Ce=t("label",{class:"block text-900 mb-2"},"Cost Material:",-1),ge={class:"summary-field"},Te={class:"mt-1"},Ie=t("label",{class:"block text-900 mb-2"},"Cost Extern:",-1),Ve={class:"summary-field"},Me={class:"mt-1"},$e=t("label",{class:"block text-900 mb-2"},"Cost Total:",-1),Se={class:"summary-field"},Pe=W({__name:"FormWorkmaster",props:{workmaster:{}},emits:["submit","calculateCost","cancel"],setup(M,{emit:b}){const c=M,p=N(),C=E(),_=G(()=>c.workmaster.operatorCost+c.workmaster.machineCost+c.workmaster.materialCost+c.workmaster.externalCost),m=j().shape({baseQuantity:z().min(1,"La quantitat base ha de ser superior a 0").required("La quanitat base és obligatoria"),referenceId:A().required("La referència és obligatoria")}),w=x({result:!1,errors:{}}),d=()=>{const s=new Q(m);w.value=s.validate(c.workmaster)},u=async()=>{if(d(),w.value.result)b("submit",c.workmaster);else{let s="";Object.entries(w.value.errors).forEach(n=>{s+=`${n[1].map(k=>k)}.   `}),C.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}},g=()=>{if(d(),w.value.result)b("calculateCost",c.workmaster);else{let s="";Object.entries(w.value.errors).forEach(n=>{s+=`${n[1].map(k=>k)}.   `}),C.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,n)=>{const k=v("Button"),a=v("Dropdown"),r=v("Checkbox");return s.workmaster?(V(),D("form",ie,[t("div",ce,[l(k,{label:"Calcular Cost",size:"small",onClick:g}),$("   "),l(k,{label:"Guardar",size:"small",onClick:u}),de]),t("section",ue,[t("div",null,[l(L,{label:"Referència",modelValue:s.workmaster.referenceId,"onUpdate:modelValue":n[0]||(n[0]=e=>s.workmaster.referenceId=e),fullName:!0},null,8,["modelValue"])]),t("div",null,[l(H,{type:i(J).NUMERIC,label:"Quantitat Base",decimals:2,modelValue:s.workmaster.baseQuantity,"onUpdate:modelValue":n[1]||(n[1]=e=>s.workmaster.baseQuantity=e)},null,8,["type","modelValue"])]),t("div",null,[me,l(a,{modelValue:s.workmaster.mode,"onUpdate:modelValue":n[2]||(n[2]=e=>s.workmaster.mode=e),options:i(p).workmasterModes,optionLabel:"value",optionValue:"id",placeholder:"Seleccione el modo",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[pe,l(r,{modelValue:s.workmaster.disabled,"onUpdate:modelValue":n[3]||(n[3]=e=>s.workmaster.disabled=e),class:"w-full",binary:!0},null,8,["modelValue"])])]),t("section",_e,[t("div",fe,[ke,t("span",we,y(i(I)(s.workmaster.operatorCost)),1)]),t("div",be,[he,t("span",ve,y(i(I)(s.workmaster.machineCost)),1)]),t("div",ye,[Ce,t("span",ge,y(i(I)(s.workmaster.materialCost)),1)]),t("div",Te,[Ie,t("span",Ve,y(i(I)(s.workmaster.externalCost)),1)]),t("div",Me,[$e,t("span",Se,y(i(I)(_.value)),1)])])])):S("",!0)}}}),Be={class:"flex flex-wrap align-items-center justify-content-between gap-2"},We=t("span",{class:"text-xl text-900 font-bold"},"Fases de la ruta",-1),xe=["onClick"],De=W({__name:"TableWorkmasterPhases",props:{workmaster:{},workmasterPhases:{}},emits:["add","edit","delete"],setup(M,{emit:b}){const c=M,p=K({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),C=X(),_=q(),m=a=>{var e;if(!_.workcenterTypes)return"";const r=(e=_.workcenterTypes)==null?void 0:e.find(o=>a===o.id);return r?r.name:""},w=a=>{var e;if(!_.workcenters)return"";const r=(e=_.workcenters)==null?void 0:e.find(o=>a===o.id);return r?r.name:""},d=a=>{var e;if(!_.operatorTypes)return"";const r=(e=_.operatorTypes)==null?void 0:e.find(o=>a===o.id);return r?r.name:""},u=x({}),g=()=>{u.value={id:Z(),workMasterId:c.workmaster.id,disabled:!1,code:((c.workmaster.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,transportCost:0,serviceReferenceId:null,profitPercentage:0,workmasterPhaseDetails:[],workmasterPhaseBillOfMaterials:[]},p.visible=!0},s=a=>{p.visible=!1,b("add",a)},n=a=>{a.originalEvent.target.className.includes("grid_delete_column_button")||b("edit",a.data)},k=(a,r)=>{C.require({target:a.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",r)}})};return(a,r)=>{const e=v("Button"),o=v("Column"),T=v("BooleanColumn"),F=v("DataTable"),U=v("Dialog");return V(),D(R,null,[l(F,{onRowClick:n,value:a.workmasterPhases,tableStyle:"min-width: 100%","sort-field":"code","sort-order":1},{header:h(()=>[t("div",Be,[We,l(e,{icon:i(P).PLUS,rounded:"",raised:"",onClick:g},null,8,["icon"])])]),default:h(()=>[l(o,{field:"code",header:"Codi",sortable:"",style:{width:"10%"}}),l(o,{field:"description",header:"Descripció",style:{width:"20%"}}),l(o,{header:"Tipus de màquina",style:{width:"15%"}},{body:h(f=>[$(y(m(f.data.workcenterTypeId)),1)]),_:1}),l(o,{header:"Màquina preferida",style:{width:"15%"}},{body:h(f=>[$(y(w(f.data.preferredWorkcenterId)),1)]),_:1}),l(o,{header:"Tipus d'operari",style:{width:"15%"}},{body:h(f=>[$(y(d(f.data.operatorTypeId)),1)]),_:1}),l(o,{header:"Extern",style:{width:"10%"}},{body:h(f=>[l(T,{value:f.data.isExternalWork},null,8,["value"])]),_:1}),l(o,{style:{width:"10%"}},{body:h(f=>[t("i",{class:Y([i(P).TIMES,"grid_delete_column_button"]),onClick:O=>k(O,f.data)},null,10,xe)]),_:1})]),_:1},8,["value"]),l(U,{visible:p.visible,"onUpdate:visible":r[0]||(r[0]=f=>p.visible=f),header:p.title,closable:p.closable,modal:p.modal},{default:h(()=>[u.value?(V(),B(le,{key:0,workmaster:a.workmaster,phase:u.value,onSubmit:s},null,8,["workmaster","phase"])):S("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),Ee={class:"main"},Re=W({__name:"Workmaster",setup(M){const b=ee(),c=te(),p=se(),C=E(),_=ne(),m=N(),w=q(),{workmaster:d}=ae(m),u=x("");oe(async()=>{u.value=b.params.id,await g();let e="";e="Ruta de fabricació",d.value&&(e=`${e} ${_.getFullName(d.value.reference)}`),p.setMenuItem({icon:P.BUILDING,backButtonVisible:!0,title:e})});const g=async()=>{await _.fetchReferencesByModule("sales"),await m.fetchOne(u.value),w.fetchActiveModel()},s=async e=>{await m.update(u.value,e)&&await g()},n=async e=>{const o=await m.update(u.value,e),T=await m.calculate(e.id);o&&T.result?(C.add({severity:"success",summary:"Cálcul de cost",detail:`${I(T.content)}`,life:1e4}),await m.fetchOne(u.value)):C.add({severity:"warn",summary:"Cálcul de cost",detail:T.errors.length>0?T.errors[0]:"Errors detectats durant el cálcul",life:1e4})},k=async e=>{await m.createPhase(e)&&c.push({path:`/workmaster/${u.value}/phase/${e.id}`})},a=e=>{c.push({path:`/workmaster/${u.value}/phase/${e.id}`})},r=async e=>{await m.deletePhase(e.id)};return(e,o)=>(V(),D(R,null,[t("header",null,[i(d)?(V(),B(Pe,{key:0,workmaster:i(d),onCalculateCost:n,onSubmit:s},null,8,["workmaster"])):S("",!0)]),t("main",Ee,[i(d)&&i(d).phases?(V(),B(De,{key:0,workmaster:i(d),workmasterPhases:i(d).phases,onAdd:k,onEdit:a,onDelete:r},null,8,["workmaster","workmasterPhases"])):S("",!0)])],64))}});const Qe=re(Re,[["__scopeId","data-v-18fd07fe"]]);export{Qe as default};
