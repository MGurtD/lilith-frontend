import{_ as k}from"./TableSupplierReferences.vue_vue_type_script_setup_true_lang-c31189e1.js";import{d as C,r as p,F as c,v as I,g as T,u as A,C as h,o as B,P as $,j as b,c as v,k as s,i as N,l as y,e as V,m as x,L as D,a as m}from"./index-d6370003.js";import{u as F}from"./reference-350638b3.js";import{u as P}from"./suppliers-e4e00d13.js";import{_ as j}from"./FormMaterial.vue_vue_type_script_setup_true_lang-3e081322.js";import"./DropdownReference.vue_vue_type_script_setup_true_lang-aecf6c90.js";import"./form-validator-76860c5e.js";import"./suppliers.service-e0a4aeb3.js";import"./DropdownReferenceType.vue_vue_type_script_setup_true_lang-fe181237.js";import"./referenceType-a20938e8.js";import"./tax-fc3b08e2.js";import"./plantmodel-07cd1012.js";import"./index-882a7cd4.js";import"./index-7cbe1881.js";const z={key:0},L={class:"mt-4"},ae=C({__name:"Material",setup(U){const o=p(c.EDIT),f=I(),_=T(),S=A(),R=P(),t=F(),{reference:a}=h(t),i=p(""),n=p({});B(async()=>{i.value=f.params.id,n.value=t.referenceCategories.find(e=>e.code===f.params.category),await d()});const d=async()=>{R.fetchSuppliers(),t.fetchReferenceSuppliers(i.value),await t.fetchReference(i.value);let e="";a.value?(o.value=c.EDIT,e=`${n.value.description} ${a.value.code} - ${a.value.description}`):(o.value=c.CREATE,t.setNewReference(i.value,n.value.code),e=`Alta ${n.value.description}`),S.setMenuItem({icon:$.BUILDING,backButtonVisible:!0,title:e})},l=b(),w=async()=>{const e=a.value;let r=!1,u="";o.value===c.CREATE?(r=await t.createReference(e),r?u="Material creat correctament":u="El material ja existeix"):(r=await t.updateReference(e.id,e),u="Material actualizada correctament"),l.add({severity:r?"success":"warn",summary:u,life:5e3}),r&&(o.value===c.CREATE?d():_.back())},E=async e=>{await t.addSupplier(e)&&l.add({severity:"success",summary:"Referència afegida",life:5e3})},M=async e=>{await t.updateSupplier(e)&&l.add({severity:"success",summary:"Referència actualizada",life:5e3})},g=async e=>{await t.deleteSupplier(e)&&l.add({severity:"success",summary:"Referència eliminada",life:5e3})};return(e,r)=>(m(),v(D,null,[s(a)?(m(),v("section",z,[N(j,{reference:s(a),onSubmit:w},null,8,["reference"])])):y("",!0),V("section",L,[s(a)&&s(t).referenceSuppliers?(m(),x(k,{key:0,title:"Proveïdors",referenceId:s(a).id,"supplier-references":s(t).referenceSuppliers,formActionMode:o.value,onCreate:E,onUpdate:M,onDelete:g},null,8,["referenceId","supplier-references","formActionMode"])):y("",!0)])],64))}});export{ae as default};
