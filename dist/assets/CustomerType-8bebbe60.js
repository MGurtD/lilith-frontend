import{d as C,j as V,r as _,h as T,c as k,i as d,n as f,e as w,l as B,a as E,F as u,g as F,v as I,u as N,z as g,o as h,k as v,m as R,P as $}from"./index-53820b8d.js";import{u as A}from"./customers-f737ba72.js";import{c as D,a as b,F as M}from"./form-validator-f8953ae6.js";import"./base.service-80f81d45.js";import"./_commonjsHelpers-725317a4.js";const S={key:0},z={class:"mt-2"},L=C({__name:"FormCustomerType",props:{customerType:{}},emits:["submit","cancel"],setup(y,{emit:n}){const i=y,l=V(),m=D().shape({name:b().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),description:b().required("La descripció és obligatori").max(250,"La descripció no pot superar els 250 carácters")}),e=_({result:!1,errors:{}}),c=()=>{const t=new M(m);e.value=t.validate(i.customerType)},p=async()=>{if(c(),e.value.result)n("submit",i.customerType);else{let t="";Object.entries(e.value.errors).forEach(a=>{t+=`${a[1].map(s=>s)}.   `}),l.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,a)=>{const s=T("BaseInput"),r=T("Button");return t.customerType?(E(),k("form",S,[d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.name}]),label:"Nom",id:"name",modelValue:t.customerType.name,"onUpdate:modelValue":a[0]||(a[0]=o=>t.customerType.name=o)},null,8,["modelValue","class"]),d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.description}]),label:"Descripció",id:"description",modelValue:t.customerType.description,"onUpdate:modelValue":a[1]||(a[1]=o=>t.customerType.description=o)},null,8,["modelValue","class"]),w("div",z,[d(r,{label:"Guardar",class:"mr-2",onClick:p})])])):B("",!0)}}}),O=C({__name:"CustomerType",setup(y){const n=_(u.EDIT),i=F(),l=I(),m=N(),e=A(),{customerType:c}=g(e),p=async()=>{await e.fetchCustomerType(l.params.id);let s="";c.value?(n.value=u.EDIT,s=`Tipus de client ${c.value.name}`):(n.value=u.CREATE,e.setNewCustomerType(l.params.id),s="Alta de tipus de client"),m.setMenuItem({icon:$.BUILDING,backButtonVisible:!0,title:s})};h(async()=>{await p()});const t=V(),a=async()=>{const s=c.value;let r=!1,o="";n.value===u.CREATE?(r=await e.createCustomerType(s),o="Tipus de client creat correctament"):(r=await e.updateCustomerType(s.id,s),o="Tipus de client actualizat correctament"),r&&(t.add({severity:"success",summary:o,life:5e3}),i.back())};return(s,r)=>v(e).customerType?(E(),R(L,{key:0,customerType:v(e).customerType,onSubmit:a},null,8,["customerType"])):B("",!0)}});export{O as default};
