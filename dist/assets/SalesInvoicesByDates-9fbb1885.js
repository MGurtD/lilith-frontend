import{d as z,j as G,u as O,r as S,o as L,P as I,h as p,c as P,i as o,w as r,k as u,a as R,e as d,G as g,H as y,n as x,I as D,R as U,O as N,p as $,b as A,f as H}from"./index-aa781fed.js";import{u as j}from"./invoice-d865c4b0.js";import{u as q}from"./lifecycle-727a59bd.js";import{u as K}from"./customers-cddcd1f1.js";import"./index-c39ba2d8.js";import"./report.service-25608734.js";const B=b=>($("data-v-c2bd4419"),b=b(),A(),b),Q={class:"flex flex-wrap align-items-center justify-content-between gap-2"},W={class:"datatable-filter"},J={class:"filter-field"},X=B(()=>d("label",{class:"block text-900 mb-2"},"Període",-1)),Y={class:"filter-field"},Z=B(()=>d("label",{class:"block text-900 mb-2 mr-3"},"Gestionades",-1)),ee={class:"flex flex-wrap gap-3"},te={class:"flex align-items-center"},ae={class:"datatable-buttons"},se=["onClick"],oe="SalesInvoice",ne=z({__name:"SalesInvoicesByDates",setup(b){const h=G(),M=O(),w=K(),m=q(),f=j(),c=S({dates:void 0,showManaged:!1}),v=S([]);L(async()=>{f.invoices=[],w.customers||w.fetchCustomers(),m.fetchOneByName(oe),M.setMenuItem({icon:I.SERVER,title:"Comptabilització de factures de venta"})});const k=e=>{var s,n;const t=(n=(s=m.lifecycle)==null?void 0:s.statuses)==null?void 0:n.find(i=>i.id===e);return t?t.name:""},V=e=>e.salesInvoiceDueDates?e.salesInvoiceDueDates.length===0?D(e.invoiceDate):D(e.salesInvoiceDueDates[e.salesInvoiceDueDates.length-1].dueDate):"",T=e=>{var s,n;const t=(n=(s=m.lifecycle)==null?void 0:s.statuses)==null?void 0:n.find(i=>i.name==="Gestionada");return t&&t.id===e},C=async()=>{var e,t;if(c.value.dates){let s;c.value.showManaged||(s=(t=(e=m.lifecycle)==null?void 0:e.statuses)==null?void 0:t.find(_=>_.name==="Gestionada"));const n=N(c.value.dates[0]),i=N(c.value.dates[1]),l=s?s.id:void 0;await f.GetFiltered(n,i,void 0,void 0,l)}else h.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},E=async()=>{var t,s;const e=(s=(t=m.lifecycle)==null?void 0:t.statuses)==null?void 0:s.find(n=>n.name==="Gestionada");if(e){const i={ids:v.value.map(_=>_.id),statusToId:e.id};await f.UpdateInvoicesStatuses(i)&&(h.add({severity:"success",summary:"Comptabilització de factures de venta",detail:`Factures comptabilitzades: ${v.value.length}`,life:5e3}),await C())}},F=async e=>{console.log("Download invoice",e),await f.PrintInvoice(e.id,e.invoiceNumber)?h.add({severity:"success",summary:"Comptabilització de factures de venta",detail:`Factura ${e.invoiceNumber} descarregada`,life:5e3}):h.add({severity:"error",summary:"Comptabilització de factures de venta",detail:`Error al descarregar la factura ${e.invoiceNumber}`,life:5e3})};return(e,t)=>{const s=p("Calendar"),n=p("Checkbox"),i=p("Button"),l=p("Column"),_=p("DataTable");return R(),P("div",null,[o(_,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",value:u(f).invoices,selection:v.value,"onUpdate:selection":t[2]||(t[2]=a=>v.value=a)},{header:r(()=>[d("div",Q,[d("div",W,[d("div",J,[X,o(s,{modelValue:c.value.dates,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value.dates=a),numberOfMonths:2,selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),d("div",Y,[Z,d("div",ee,[d("div",te,[o(n,{modelValue:c.value.showManaged,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value.showManaged=a),binary:!0,onChange:C},null,8,["modelValue"])])])])]),d("div",ae,[o(i,{class:"datatable-button",icon:u(I).FILTER,rounded:"",raised:"",onClick:C},null,8,["icon"]),o(i,{icon:u(I).CHECK,disabled:v.value.length===0,rounded:"",raised:"",severity:"success",onClick:E},null,8,["icon","disabled"])])])]),default:r(()=>[o(l,{selectionMode:"multiple",style:{width:"2%"}}),o(l,{field:"invoiceNumber",header:"Número",sortable:"",style:{width:"10%"}}),o(l,{header:"Client",style:{width:"15%"}},{body:r(a=>[g(y(u(w).getCustomerNameById(a.data.customerId)),1)]),_:1}),o(l,{header:"Estat",style:{width:"15%"}},{body:r(a=>[d("span",{class:x({"managed-status":T(a.data.statusId)})},y(k(a.data.statusId)),3)]),_:1}),o(l,{header:"Data",field:"invoiceDate",sortable:"",style:{width:"15%"}},{body:r(a=>[g(y(u(D)(a.data.invoiceDate)),1)]),_:1}),o(l,{header:"Venciment",style:{width:"15%"}},{body:r(a=>[g(y(V(a.data)),1)]),_:1}),o(l,{field:"baseAmount",header:"Import Base",style:{width:"15%"}},{body:r(a=>[g(y(u(U)(a.data.baseAmount)),1)]),_:1}),o(l,{style:{width:"2%"}},{body:r(a=>[d("i",{class:x([u(I).DOWNLOAD,"download_column"]),onClick:le=>F(a.data)},null,10,se)]),_:1})]),_:1},8,["value","selection"])])}}});const fe=H(ne,[["__scopeId","data-v-c2bd4419"]]);export{fe as default};
