import{_ as M}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-e703da99.js";import{_ as $}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-c191897b.js";import{_ as A}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-d1c8e21b.js";import{_ as L}from"./FormCreateWorkorder.vue_vue_type_script_setup_true_lang-91dbccf4.js";import{d as Q,g as U,u as j,j as q,x as H,r as C,E as Y,o as z,P as f,h as p,c as G,i as e,w as c,k as r,G as J,a as K,e as l,C as _,D as v,n as X}from"./index-b3037d03.js";import{u as Z}from"./reference-d9578a1e.js";import{a as S,f as ee}from"./functions-2e154ea4.js";import{u as te}from"./exercise-1a54981c.js";import{u as ae}from"./lifecycle-3493c90c.js";import{u as oe}from"./workorder-3ad6d9f8.js";import{u as se}from"./workmaster-e19a01d9.js";import{u as re}from"./customers-276bcf09.js";import"./form-validator-f8953ae6.js";import"./_commonjsHelpers-725317a4.js";import"./reference.service-4095c410.js";import"./base.service-acac5ea4.js";import"./v4-a960c1f4.js";import"./index-f24c0f74.js";import"./index-864ed38e.js";const ie={class:"flex flex-wrap align-items-center justify-content-between gap-2"},le={class:"datatable-filter-3"},ne={class:"filter-field"},ce={class:"filter-field"},de=l("label",{class:"block text-900"},"Client",-1),ue={class:"filter-field"},me=l("label",{class:"block text-900"},"Estat",-1),fe={class:"datatable-buttons"},pe=["onClick"],Re=Q({__name:"Workorders",setup(_e){const y=U(),n=j(),w=q(),g=H(),D=se(),u=oe(),I=Z(),E=re(),b=te(),x=ae(),P=()=>{var d;const s=new Date().getFullYear().toString(),a=(d=b.exercises)==null?void 0:d.find(i=>i.name===s);a&&(n.exercisePicker.exercise=a,n.exercisePicker.dates=[new Date(n.exercisePicker.exercise.startDate),new Date(n.exercisePicker.exercise.endDate)])},o=C({referenceId:void 0,statusId:void 0,customerId:void 0}),B=()=>{o.value.referenceId=void 0,o.value.statusId=void 0,o.value.customerId=void 0},k=async()=>{if(n.exercisePicker.dates){const s=S(n.exercisePicker.dates[0]),a=S(n.exercisePicker.dates[1]);await u.fetchFiltered(s,a,o.value.statusId,o.value.referenceId,o.value.customerId)}else w.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},m=Y({visible:!1,title:"Crear ordre",closable:!0,position:"center",modal:!0}),h=C({workMasterId:"",plannedDate:"",plannedQuantity:0,comment:""});z(async()=>{await I.fetchReferencesByModule("sales"),await b.fetchActive(),x.fetchOneByName("WorkOrder"),D.fetchAllActives(),n.setMenuItem({icon:f.CALENDAR,title:"Ordres de fabricació"}),P(),k()});const O=()=>{m.visible=!0},T=s=>{s.originalEvent.target.className.includes("grid_delete_column_button")||y.push({path:`/workorder/${s.data.id}`})},F=async()=>{if(!h.value)return;await u.create(h.value)&&u.workorder&&y.push({path:`/workorder/${u.workorder.id}`})},N=(s,a)=>{g.require({target:s.currentTarget,message:`Está segur que vol eliminar la ordre ${a.code}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await u.delete(a.id)&&(w.add({severity:"success",summary:"Eliminada",life:3e3}),k())}})};return(s,a)=>{const d=p("Button"),i=p("Column"),R=p("DataTable"),V=p("Dialog");return K(),G(J,null,[e(R,{value:r(u).workorders,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh","sort-mode":"multiple",onRowClick:T},{header:c(()=>[l("div",ie,[l("div",le,[l("div",ne,[e($,{exercises:r(b).exercises},null,8,["exercises"])]),l("div",ce,[de,e(M,{label:"",modelValue:o.value.customerId,"onUpdate:modelValue":a[0]||(a[0]=t=>o.value.customerId=t)},null,8,["modelValue"])]),l("div",ue,[me,e(A,{label:"",modelValue:o.value.statusId,"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.statusId=t)},null,8,["modelValue"])])]),l("div",fe,[e(d,{class:"datatable-button mr-2",icon:r(f).FILTER,rounded:"",raised:"",onClick:k},null,8,["icon"]),e(d,{class:"datatable-button mr-2",icon:r(f).FILTER_SLASH,rounded:"",raised:"",onClick:B},null,8,["icon"]),e(d,{icon:r(f).PLUS,rounded:"",raised:"",onClick:O},null,8,["icon"])])])]),default:c(()=>[e(i,{field:"code",header:"Codi",style:{width:"15%"}}),e(i,{header:"Referencia",style:{width:"40%"}},{body:c(t=>[_(v(r(I).getFullNameById(t.data.referenceId)),1)]),_:1}),e(i,{header:"Client",style:{width:"15%"}},{body:c(t=>[_(v(r(E).getCustomerNameById(t.data.reference.customerId)),1)]),_:1}),e(i,{field:"statusId",header:"Estat",style:{width:"10%"}},{body:c(t=>[_(v(r(x).getStatusName(t.data.statusId)),1)]),_:1}),e(i,{field:"plannedDate",header:"Data Prevista",sortable:"",style:{width:"12%"}},{body:c(t=>[_(v(r(ee)(t.data.plannedDate)),1)]),_:1}),e(i,{field:"plannedQuantity",header:"Quantitat",style:{width:"10%"}}),e(i,null,{body:c(t=>[l("i",{class:X([r(f).TIMES,"grid_delete_column_button"]),onClick:W=>N(W,t.data)},null,10,pe)]),_:1})]),_:1},8,["value"]),e(V,{visible:m.visible,"onUpdate:visible":a[2]||(a[2]=t=>m.visible=t),header:m.title,closable:m.closable,modal:m.modal},{default:c(()=>[e(L,{createWorkOrderDto:h.value,onSubmit:F},null,8,["createWorkOrderDto"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Re as default};
