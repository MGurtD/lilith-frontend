import{_ as v}from"./DropdownReference.vue_vue_type_script_setup_true_lang-897cb77b.js";import{d as L,g as O,u as P,j as $,x as j,r as q,H as G,E as k,o as Q,P as p,h as c,c as W,i as r,w as n,G as z,a as Y,e as t,k as s,C as J,D as h,n as g}from"./index-53820b8d.js";import{u as K}from"./workmaster-b78e0c53.js";import{u as X}from"./reference-4195502c.js";import{g as Z}from"./functions-4d7ada1d.js";import"./index-a03cc526.js";import"./base.service-80f81d45.js";import"./reference.service-f83d13c3.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";const ee={class:"flex flex-wrap align-items-center justify-content-between gap-2"},te={class:"datatable-filter"},oe={class:"filter-field"},le=t("label",{class:"block text-900 mb-2"},"Referència",-1),re={class:"datatable-buttons"},ae=["onClick"],se=["onClick"],ne=t("br",null,null,-1),ie=t("section",{class:"two-columns"},[t("div",null,[t("h3",null,"Origen")]),t("div",null,[t("h3",null,"Destí")])],-1),ce={class:"two-columns"},ke=L({__name:"Workmasters",setup(de){const y=O(),I=P(),b=$(),T=j(),e=K(),C=X(),d=q({referenceId:void 0}),B=()=>{d.value.referenceId=void 0},V=G(()=>e.workmasters?d.value.referenceId?e.workmasters.filter(a=>a.referenceId===d.value.referenceId):e.workmasters:[]),i=k({visible:!1,title:"Crear ruta",closable:!0,position:"center",modal:!0}),u=k({visible:!1,title:"Copiar ruta",closable:!0,position:"center",modal:!0});Q(async()=>{await e.fetchAll(),await C.fetchReferencesByModule("sales"),I.setMenuItem({icon:p.CALENDAR,title:"Gestió de rutes de fabricació"})});const N=()=>{const a=Z();e.setNew(a),i.visible=!0},D=(a,o)=>{console.log(o),e.workmasterToCopy={workmasterId:o.id,workmaster:o,referenceId:"",referenceCode:""},u.visible=!0},S=async()=>{e.workmasterToCopy&&e.workmasterToCopy.referenceId&&(e.workmasterToCopy.referenceId=e.workmasterToCopy.referenceId.trim()===""?null:e.workmasterToCopy.referenceId);const a=await e.copy(e.workmasterToCopy);await e.fetchAll(),u.visible=!1,a?b.add({severity:"success",summary:"Copiada",life:3e3}):b.add({severity:"error",summary:"Hi ha hagut un error en el proces",life:3e3})},R=()=>{e.workmasterToCopy.referenceCode=""},x=()=>{e.workmasterToCopy.referenceId=""},E=a=>{!a.originalEvent.target.className.includes("grid_delete_column_button")&&!a.originalEvent.target.className.includes("grid_copy_column_button")&&y.push({path:`/workmaster/${a.data.id}`})},U=async()=>{if(!e.workmaster)return;await e.create(e.workmaster)&&y.push({path:`/workmaster/${e.workmaster.id}`})},A=(a,o)=>{T.require({target:a.currentTarget,message:`Está segur que vol eliminar la ruta ${o.reference.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await e.delete(o.id)&&(b.add({severity:"success",summary:"Eliminada",life:3e3}),await e.fetchAll())}})};return(a,o)=>{const m=c("Button"),f=c("Column"),F=c("BooleanColumn"),M=c("DataTable"),w=c("Dialog"),H=c("BaseInput");return Y(),W(z,null,[r(M,{value:V.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh","sort-field":"reference.code","sort-order":1,onRowClick:E},{header:n(()=>[t("div",ee,[t("div",te,[t("div",oe,[le,r(v,{label:"",modelValue:d.value.referenceId,"onUpdate:modelValue":o[0]||(o[0]=l=>d.value.referenceId=l),fullName:!0},null,8,["modelValue"])])]),t("div",re,[r(m,{class:"datatable-button mr-2",icon:s(p).FILTER_SLASH,rounded:"",raised:"",onClick:B},null,8,["icon"]),r(m,{icon:s(p).PLUS,rounded:"",raised:"",onClick:N},null,8,["icon"])])])]),default:n(()=>[r(f,{field:"reference.code",sortable:"",header:"Referencia",style:{width:"50%"}},{body:n(l=>[J(h(s(C).getFullName(l.data.reference)),1)]),_:1}),r(f,{field:"baseQuantity",header:"Quantitat Base",style:{width:"25%"}}),r(f,{header:"Desactivada",style:{width:"25%"}},{body:n(l=>[r(F,{value:l.data.disabled},null,8,["value"])]),_:1}),r(f,null,{body:n(l=>[t("i",{class:g([s(p).COPY,"grid_copy_column_button"]),onClick:_=>D(_,l.data)},null,10,ae)]),_:1}),r(f,null,{body:n(l=>[t("i",{class:g([s(p).TIMES,"grid_delete_column_button"]),onClick:_=>A(_,l.data)},null,10,se)]),_:1})]),_:1},8,["value"]),r(w,{visible:i.visible,"onUpdate:visible":o[2]||(o[2]=l=>i.visible=l),header:i.title,closable:i.closable,modal:i.modal},{default:n(()=>[t("div",null,[r(v,{label:"Referència",modelValue:s(e).workmaster.referenceId,"onUpdate:modelValue":o[1]||(o[1]=l=>s(e).workmaster.referenceId=l),fullName:!0},null,8,["modelValue"])]),ne,t("div",null,[r(m,{label:"Crear",style:{float:"right"},onClick:U})])]),_:1},8,["visible","header","closable","modal"]),r(w,{visible:u.visible,"onUpdate:visible":o[5]||(o[5]=l=>u.visible=l),header:u.title,closable:!0,modal:!0},{default:n(()=>[ie,t("section",ce,[t("div",null,[t("p",null,h(s(C).getFullNameById(s(e).workmasterToCopy.workmaster.referenceId)),1)]),t("div",null,[r(v,{label:"Referència existent:",modelValue:s(e).workmasterToCopy.referenceId,"onUpdate:modelValue":o[3]||(o[3]=l=>s(e).workmasterToCopy.referenceId=l),fullName:!0,onChange:R},null,8,["modelValue"]),r(H,{class:"mb-2",label:"Nou codi:",id:"referenceCode",modelValue:s(e).workmasterToCopy.referenceCode,"onUpdate:modelValue":o[4]||(o[4]=l=>s(e).workmasterToCopy.referenceCode=l),onChange:x},null,8,["modelValue"])])]),t("div",null,[r(m,{label:"Copiar",style:{float:"right"},onClick:S})])]),_:1},8,["visible","header"])],64)}}});export{ke as default};
