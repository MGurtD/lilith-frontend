import{d as g,o as C,C as I,r as k,j as h,h as p,k as a,c as S,e as s,i as d,n as b,z as w,l as B,a as U,s as M,D as T,F as _,v as N,u as q,m as $,P as z,W as P}from"./index-40c5ef33.js";import{u as F}from"./expense-8d6fd90c.js";import{c as j,a as x,F as O}from"./form-validator-dd91bd90.js";import"./index-5e1e719e.js";import"./suppliers.service-3db6483c.js";const W={key:0},G={class:"four-columns"},J={class:"mt-2"},Y=s("label",{class:"block text-900 mb-2"},"Tipus",-1),H={class:"mt-2"},K=s("label",{class:"block text-900 mb-2"},"Data Alta",-1),Q={class:"mt-2"},X=s("label",{class:"block text-900 mb-2"},"Data Pagament",-1),Z={class:"mt-2"},ee={class:"four-columns"},ae={class:"mt-2"},te=s("label",{class:"block text-900 mb-2"},"Recurrent",-1),se={class:"mt-2"},oe=s("label",{class:"block text-900 mb-2"},"Freqüència",-1),le={class:"mt-2"},ne={class:"mt-2"},ie=s("label",{class:"block text-900 mb-2"},"Data fi",-1),re=s("label",{class:"block text-900 mb-2"},"Descripció",-1),de={class:"mt-2"},ue=g({__name:"FormExpense",props:{expense:{}},emits:["submit","cancel"],setup(E,{emit:m}){const n=E;C(()=>{});const v=F(),{expense:e}=I(v),l=k([{id:1,name:"Mensual"},{id:2,name:"Bimensual"},{id:3,name:"Trimestral"},{id:6,name:"Semestral"},{id:12,name:"Anual"}]),y=j().shape({expenseTypeId:x().required("El tipus de despesa es obligatoria"),creationDate:x().required("La data de creació es obligatoria"),paymentDate:x().required("La data de pagament es obligatoria"),amount:x().required("L'import es obligatori")}),i=k({result:!1,errors:{}}),V=()=>{const u=new O(y);i.value=u.validate(n.expense)},r=h(),c=async()=>{if(V(),i.value.result)n.expense.creationDate=T(n.expense.creationDate),n.expense.endDate=T(n.expense.endDate),n.expense.paymentDate=T(n.expense.paymentDate),m("submit",e.value);else{let u="";Object.entries(i.value.errors).forEach(t=>{u+=`${t[1].map(D=>D)}.   `}),r.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}};return(u,t)=>{const D=p("Dropdown"),f=p("Calendar"),A=p("Checkbox"),L=p("Textarea"),R=p("Button");return a(e)?(U(),S("form",W,[s("section",G,[s("div",J,[Y,d(D,{modelValue:a(e).expenseTypeId,"onUpdate:modelValue":t[0]||(t[0]=o=>a(e).expenseTypeId=o),editable:"",options:a(v).expenseTypes,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":i.value.errors.expenseTypeId}])},null,8,["modelValue","options","class"])]),s("div",H,[K,d(f,{id:"creationDate",modelValue:a(e).creationDate,"onUpdate:modelValue":t[1]||(t[1]=o=>a(e).creationDate=o),class:b({"p-invalid":i.value.errors.creationDate})},null,8,["modelValue","class"])]),s("div",Q,[X,d(f,{id:"paymentDate",modelValue:a(e).paymentDate,"onUpdate:modelValue":t[2]||(t[2]=o=>a(e).paymentDate=o),class:b({"p-invalid":i.value.errors.paymentDate})},null,8,["modelValue","class"])]),s("div",Z,[d(w,{label:"Import",id:"amount",modelValue:a(e).amount,"onUpdate:modelValue":t[3]||(t[3]=o=>a(e).amount=o),type:a(M).CURRENCY,class:b({"p-invalid":i.value.errors.amount})},null,8,["modelValue","type","class"])])]),s("section",ee,[s("div",ae,[te,d(A,{modelValue:a(e).recurring,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).recurring=o),class:"w-full",binary:!0},null,8,["modelValue"])]),s("div",se,[oe,d(D,{modelValue:a(e).frecuency,"onUpdate:modelValue":t[5]||(t[5]=o=>a(e).frecuency=o),disabled:!a(e).recurring,editable:"",options:l.value,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":i.value.errors.expenseTypeId}])},null,8,["modelValue","disabled","options","class"])]),s("div",le,[d(w,{label:"Dia de pagament",id:"paymentDay",modelValue:a(e).paymentDay,"onUpdate:modelValue":t[6]||(t[6]=o=>a(e).paymentDay=o),disabled:!a(e).recurring},null,8,["modelValue","disabled"])]),s("div",ne,[ie,d(f,{id:"endDate",modelValue:a(e).endDate,"onUpdate:modelValue":t[7]||(t[7]=o=>a(e).endDate=o),disabled:!a(e).recurring},null,8,["modelValue","disabled"])])]),s("div",null,[re,d(L,{modelValue:a(e).description,"onUpdate:modelValue":t[8]||(t[8]=o=>a(e).description=o),class:"w-full"},null,8,["modelValue"])]),s("div",de,[d(R,{label:"Guardar",class:"mr-2",onClick:c})])])):B("",!0)}}}),De=g({__name:"Expense",setup(E){const m=k(_.EDIT),n=N(),v=q(),e=F(),{expense:l}=I(e),y=async()=>{await e.fetchExpense(n.params.id);let r="";l.value?(m.value=_.EDIT,r="Modificació de despeses",l.value.creationDate=new Date(l.value.creationDate),l.value.endDate=new Date(l.value.endDate),l.value.paymentDate=new Date(l.value.paymentDate)):(m.value=_.CREATE,e.setNewExpense(n.params.id),r="Alta de despeses"),v.setMenuItem({icon:z.WALLET,backButtonVisible:!0,title:r})};C(async()=>{await y()});const i=h(),V=async()=>{const r=l.value;let c=!1,u="";m.value===_.CREATE?(c=await e.createExpense(r),u="Despesa registrada correctament"):(c=await e.updateExpense(r.id,r),u="Despesa actualizada correctament"),c&&(i.add({severity:"success",summary:u,life:5e3}),P.back())};return(r,c)=>a(l)?(U(),$(ue,{key:0,expense:a(l),onSubmit:V},null,8,["expense"])):B("",!0)}});export{De as default};
