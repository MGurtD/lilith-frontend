import{d as k,$ as x,r as $,o as B,a0 as M,V as P,h as v,m as T,w as c,a as D,e as n,i as a,z as g,k as f,P as h,H as I,G as S,R as V,n as j,p as q,b as H,f as F,g as z,u as A,x as G,j as J,J as K}from"./index-eea64e26.js";import{u as O}from"./reference-0201b480.js";import{_ as Q}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-f727f1c5.js";import{u as W}from"./customers-6978df67.js";const R=d=>(q("data-v-61c02954"),d=d(),H(),d),X={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Y={class:"datatable-filter-3"},Z={class:"filter-field"},ee=R(()=>n("label",null,"Codi",-1)),te={class:"filter-field"},se=R(()=>n("label",null,"Descripció",-1)),oe={class:"filter-field"},ae=R(()=>n("label",null,"Client",-1)),ne={class:"datatable-buttons"},le=["onClick"],re=k({__name:"TableReferences",props:{references:{}},emits:["add","edit","delete"],setup(d,{emit:i}){const p=d,u=x(),y=W(),e=$({code:"",description:"",customerId:""});B(()=>{const t=u.getFilter("References","");t&&(t.code&&(e.value.code=t.code),t.customerId&&(e.value.customerId=t.customerId))}),M(async()=>{await u.addFilter("References","",e.value)});const C=()=>{e.value.code="",e.value.customerId=""},b=P(()=>{if(!p.references)return[];let t=p.references;return e.value.customerId&&e.value.customerId.length>0&&(t=t.filter(s=>s.customerId===e.value.customerId)),e.value.code&&e.value.code.length>0&&(t=t.filter(s=>s.code.toLowerCase().includes(e.value.code.toLowerCase()))),e.value.description&&e.value.description.length>0&&(t=t.filter(s=>s.description.toLowerCase().includes(e.value.description.toLowerCase()))),t}),w=()=>{i("add")},r=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||i("edit",t.data)},_=(t,s)=>{i("delete",s)},L=t=>{var m;const s=(m=y.customers)==null?void 0:m.find(l=>l.id===t);return s?s.comercialName:""};return(t,s)=>{const m=v("Button"),l=v("Column"),U=v("BooleanColumn"),E=v("DataTable");return D(),T(E,{value:b.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:r},{header:c(()=>[n("div",X,[n("div",Y,[n("div",Z,[ee,a(g,{modelValue:e.value.code,"onUpdate:modelValue":s[0]||(s[0]=o=>e.value.code=o)},null,8,["modelValue"])]),n("div",te,[se,a(g,{modelValue:e.value.description,"onUpdate:modelValue":s[1]||(s[1]=o=>e.value.description=o)},null,8,["modelValue"])]),n("div",oe,[ae,a(Q,{label:"",modelValue:e.value.customerId,"onUpdate:modelValue":s[2]||(s[2]=o=>e.value.customerId=o)},null,8,["modelValue"])])]),n("div",ne,[a(m,{class:"datatable-button mr-2",icon:f(h).FILTER_SLASH,rounded:"",raised:"",onClick:C},null,8,["icon"]),a(m,{class:"datatable-button mr-2",icon:f(h).PLUS,rounded:"",raised:"",onClick:w},null,8,["icon"])])])]),default:c(()=>[a(l,{field:"code",header:"Codi",style:{width:"15%"}}),a(l,{field:"description",header:"Descripció",style:{width:"35%"}}),a(l,{field:"version",header:"Versió",style:{width:"10%"}}),a(l,{field:"customerId",header:"Client",style:{width:"20%"}},{body:c(o=>[n("span",null,I(L(o.data.customerId)),1)]),_:1}),a(l,{field:"price",header:"Preu",style:{width:"10%"}},{body:c(o=>[S(I(f(V)(o.data.price)),1)]),_:1}),a(l,{field:"cost",header:"Cost",style:{width:"10%"}},{body:c(o=>[S(I(f(V)(o.data.workMasterCost)),1)]),_:1}),a(l,{header:"Servei",style:{width:"10%"}},{body:c(o=>[a(U,{value:o.data.isService},null,8,["value"])]),_:1}),a(l,{style:{width:"10%"}},{body:c(o=>[n("i",{class:j([f(h).TIMES,"grid_delete_column_button"]),onClick:N=>_(N,o.data)},null,10,le)]),_:1})]),_:1},8,["value"])}}});const ce=F(re,[["__scopeId","data-v-61c02954"]]),de=k({__name:"References",setup(d){const i=z(),p=A();x();const u=O(),y=G(),e=J();B(async()=>{let r="Referencies de venta";p.setMenuItem({icon:h.TICKET,title:r}),await u.fetchReferencesByModule("sales")});const C=()=>{i.push({path:`/sales/reference/${K()}`})},b=r=>{i.push({path:`/sales/reference/${r.id}`})},w=r=>{y.require({message:`Está segur que vol eliminar la refèrencia ${r.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const _=await u.deleteReference(r.id);_.result?e.add({severity:"success",summary:"Referencia eliminada correctament",life:5e3}):e.add({severity:"warn",summary:_.errors[0],life:5e3,closable:!0})}})};return(r,_)=>(D(),T(ce,{references:f(u).references,onAdd:C,onEdit:b,onDelete:w},null,8,["references"]))}});const me=F(de,[["__scopeId","data-v-a47fed42"]]);export{me as default};
