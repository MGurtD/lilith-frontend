import{d as D,z as q,j as S,r as U,h as v,k as n,a as y,c as A,e as l,i as s,n as m,l as $,H as W,y as P,x,F as h,m as T,P as I,w as N,G as O,C as J,D as j,v as K,u as Q,o as X}from"./index-4a35f1ba.js";import{u as M}from"./customers-b2428f08.js";import{c as L,a as g,F as G,b as F}from"./form-validator-fef9bcaf.js";import{u as z}from"./masterData-80363acb.js";import{v as H}from"./v4-a960c1f4.js";import"./base.service-bb100fed.js";import"./index-ffdb11ba.js";const Y={key:0},Z={class:"three-columns"},ee=l("label",{class:"block text-900 mb-2"},"Tipus Client",-1),ae={class:"two-columns mb-2"},oe={class:"two-columns mb-2"},se=l("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),le=l("label",{class:"block text-900 mb-2"},"Observacions",-1),te={class:"mt-2"},ne=D({__name:"FormCustomer",emits:["submit"],setup(B,{emit:b}){const _=M(),E=z(),{customer:r}=q(_),i=S(),t=L().shape({comercialName:g().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),taxName:g().required("El nom fiscal és obligatori"),vatNumber:g().required("El CIF és obligatori"),accountNumber:g().required("El número de compte es obligatori")}),p=U({result:!1,errors:{}}),C=()=>{const o=new G(t);p.value=o.validate(r.value)},u=async()=>{if(C(),p.value.result)b("submit",r.value);else{let o="";Object.entries(p.value.errors).forEach(e=>{o+=`${e[1].map(c=>c)}.   `}),i.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,e)=>{const c=v("BaseInput"),V=v("Dropdown"),d=v("Textarea"),k=v("Button");return n(r)?(y(),A("form",Y,[l("section",Z,[s(c,{name:"comercialName",class:m(["mb-2",{"p-invalid":p.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:n(r).comercialName,"onUpdate:modelValue":e[0]||(e[0]=a=>n(r).comercialName=a)},null,8,["modelValue","class"]),s(c,{class:m(["mb-2",{"p-invalid":p.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:n(r).taxName,"onUpdate:modelValue":e[1]||(e[1]=a=>n(r).taxName=a)},null,8,["modelValue","class"]),l("div",null,[ee,s(V,{modelValue:n(r).customerTypeId,"onUpdate:modelValue":e[2]||(e[2]=a=>n(r).customerTypeId=a),editable:"",options:n(_).customerTypes,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),l("section",ae,[s(c,{name:"vatNumber",class:m(["mb-2",{"p-invalid":p.value.errors.vatNumber}]),label:"CIF",id:"vatNumber",modelValue:n(r).vatNumber,"onUpdate:modelValue":e[3]||(e[3]=a=>n(r).vatNumber=a)},null,8,["modelValue","class"]),s(c,{name:"web",class:m(["mb-2",{"p-invalid":p.value.errors.web}]),label:"Web",id:"web",modelValue:n(r).web,"onUpdate:modelValue":e[4]||(e[4]=a=>n(r).web=a)},null,8,["modelValue","class"])]),l("section",oe,[s(c,{name:"accountNumber",class:m(["mb-2",{"p-invalid":p.value.errors.accountNumber}]),label:"Número de compte",id:"accountNumber",modelValue:n(r).accountNumber,"onUpdate:modelValue":e[5]||(e[5]=a=>n(r).accountNumber=a)},null,8,["modelValue","class"]),l("div",null,[se,s(V,{modelValue:n(r).paymentMethodId,"onUpdate:modelValue":e[6]||(e[6]=a=>n(r).paymentMethodId=a),editable:"",options:n(E).paymentMethods,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])])]),l("div",null,[le,s(d,{modelValue:n(r).observations,"onUpdate:modelValue":e[7]||(e[7]=a=>n(r).observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",te,[s(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),re={key:0},ie={class:"three-columns"},de=l("label",{class:"block text-900 mb-2"},"Principal",-1),ue=l("label",{class:"block text-900 mb-2"},"Desactivada",-1),ce={class:"three-columns mb-2"},me=l("label",{class:"block text-900 mb-2"},"País",-1),pe=l("label",{class:"block text-900 mb-2"},"Província",-1),be=l("label",{class:"block text-900 mb-2"},"Municipi",-1),ve={class:"three-columns mb-2"},fe=l("label",{class:"block text-900 mb-2"},"Observacions",-1),Ce={class:"mt-2"},_e=D({__name:"FormCustomerAddress",props:{address:{}},emits:["submit","cancel"],setup(B,{emit:b}){const _=B,E=W(),r=S(),i=L().shape({name:g().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),country:g().required("El país és obligatori"),region:g().required("La província és obligatoria"),city:g().required("El municipi és obligatori"),postalCode:g().required("El codi postal és obligatori"),address:g().required("La direcció és obligatoria"),main:F().required(),disabled:F().required()}),t=U({result:!1,errors:{}}),p=()=>{const o=_.address;o.address=""},C=()=>{const o=new G(i);t.value=o.validate(_.address)},u=async()=>{if(C(),t.value.result)b("submit",_.address);else{let o="";Object.entries(t.value.errors).forEach(e=>{o+=`${e[1].map(c=>c)}.   `}),r.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,e)=>{const c=v("Checkbox"),V=v("Dropdown"),d=v("Textarea"),k=v("Button");return o.address?(y(),A("form",re,[l("section",ie,[s(P,{id:"name",class:m(["mb-2",{"p-invalid":t.value.errors.name}]),label:"Nom",modelValue:o.address.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.address.name=a)},null,8,["modelValue","class"]),l("div",null,[de,s(c,{modelValue:o.address.main,"onUpdate:modelValue":e[1]||(e[1]=a=>o.address.main=a),class:"w-full",binary:!0},null,8,["modelValue"])]),l("div",null,[ue,s(c,{modelValue:o.address.disabled,"onUpdate:modelValue":e[2]||(e[2]=a=>o.address.disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("section",ce,[l("div",null,[me,s(V,{modelValue:o.address.country,"onUpdate:modelValue":e[3]||(e[3]=a=>o.address.country=a),editable:"",options:["Espanya"],class:m(["w-full",{"p-invalid":t.value.errors.country}])},null,8,["modelValue","class"])]),l("div",null,[pe,s(V,{modelValue:o.address.region,"onUpdate:modelValue":e[4]||(e[4]=a=>o.address.region=a),editable:"",options:n(E).regions,optionValue:"nm",optionLabel:"nm",onChange:p,class:m(["w-full",{"p-invalid":t.value.errors.region}])},null,8,["modelValue","options","class"])]),l("div",null,[be,s(V,{modelValue:o.address.city,"onUpdate:modelValue":e[5]||(e[5]=a=>o.address.city=a),editable:"",options:n(E).getTownsByRegionName(o.address.region),optionValue:"nm",optionLabel:"nm",class:m(["w-full",{"p-invalid":t.value.errors.city}])},null,8,["modelValue","options","class"])])]),l("section",ve,[s(P,{label:"Codi Postal",id:"postalCode",modelValue:o.address.postalCode,"onUpdate:modelValue":e[6]||(e[6]=a=>o.address.postalCode=a),class:m({"p-invalid":t.value.errors.postalCode})},null,8,["modelValue","class"]),s(P,{label:"Direcció",id:"address",modelValue:o.address.address,"onUpdate:modelValue":e[7]||(e[7]=a=>o.address.address=a),class:m({"p-invalid":t.value.errors.address})},null,8,["modelValue","class"])]),l("div",null,[fe,s(d,{modelValue:o.address.observations,"onUpdate:modelValue":e[8]||(e[8]=a=>o.address.observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",Ce,[s(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),ye={key:2},Ve=["onClick"],ge=D({__name:"TableCustomerAddresses",emits:["create","update","delete"],setup(B,{emit:b}){const _=x(),E=M(),{customer:r}=q(E),i=U(h.CREATE),t=U(void 0),p=()=>{var e;t.value={customerId:(e=r.value)==null?void 0:e.id,id:H(),name:"",country:"",region:"",city:"",postalCode:"",address:"",main:!1,disabled:!1,observations:""},i.value=h.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(t.value=e.data,i.value=h.EDIT)},u=()=>{const e=t.value;i.value===h.CREATE?b("create",e):b("update",e),t.value=void 0},o=(e,c)=>{_.require({target:e.currentTarget,message:"Está segur que vol eliminar l'adreça?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var f;const V=v("Button"),d=v("Column"),k=v("BooleanColumn"),a=v("DataTable");return y(),A(O,null,[t.value?$("",!0):(y(),T(V,{key:0,icon:n(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),t.value?(y(),T(_e,{key:1,address:t.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>t.value=void 0)},null,8,["address"])):(y(),A("div",ye,[(f=n(r))!=null&&f.address?(y(),T(a,{key:0,value:n(r).address,tableStyle:"min-width: 100%",onRowClick:C},{default:N(()=>[s(d,{header:"Nom",field:"name",style:{width:"25%"}}),s(d,{header:"Província",field:"region",style:{width:"25%"}}),s(d,{header:"Municipi",field:"city",style:{width:"25%"}}),s(d,{header:"Codi Postal",field:"postalCode",style:{width:"25%"}}),s(d,{header:"Principal"},{body:N(w=>[s(k,{value:w.data.main,"show-color":!1},null,8,["value"])]),_:1}),s(d,null,{body:N(w=>[l("i",{class:m([n(I).TIMES,"grid_delete_column_button"]),onClick:R=>o(R,w.data)},null,10,Ve)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),he={key:0},we={class:"three-columns"},Ne={class:"three-columns"},Ee=l("label",{class:"block text-900 mb-2"},"Predeterminat",-1),ke={class:"mt-2"},Te=D({__name:"FormCustomerContact",props:{contact:{}},emits:["submit","cancel"],setup(B,{emit:b}){const _=B,E=S(),r=L().shape({firstName:g().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:g().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:g(),email:g().required("El correu és obligatori").email("Correu electrònic invàlid"),phoneNumber:g().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),disabled:F().required(),main:F().required()}),i=U({result:!1,errors:{}}),t=()=>{const u=new G(r);i.value=u.validate(_.contact)},p=async()=>{if(t(),i.value.result)b("submit",_.contact);else{let u="";Object.entries(i.value.errors).forEach(o=>{u+=`${o[1].map(e=>e)}.   `}),E.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}},C=()=>{b("cancel")};return(u,o)=>{const e=v("BaseInput"),c=v("Checkbox"),V=v("Button");return u.contact?(y(),A("form",he,[l("section",we,[s(e,{label:"Nom",id:"firstName",modelValue:u.contact.firstName,"onUpdate:modelValue":o[0]||(o[0]=d=>u.contact.firstName=d),class:m(["mb-2",{"p-invalid":i.value.errors.firstName}])},null,8,["modelValue","class"]),s(e,{label:"Cognoms",id:"lastName",modelValue:u.contact.lastName,"onUpdate:modelValue":o[1]||(o[1]=d=>u.contact.lastName=d),class:m(["mb-2",{"p-invalid":i.value.errors.lastName}])},null,8,["modelValue","class"]),s(e,{label:"Càrrec",id:"charge",modelValue:u.contact.charge,"onUpdate:modelValue":o[2]||(o[2]=d=>u.contact.charge=d),class:m(["mb-2",{"p-invalid":i.value.errors.charge}])},null,8,["modelValue","class"])]),l("section",Ne,[s(e,{class:m(["mb-2",{"p-invalid":i.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:u.contact.email,"onUpdate:modelValue":o[3]||(o[3]=d=>u.contact.email=d)},null,8,["modelValue","class"]),s(e,{class:m(["mb-2",{"p-invalid":i.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:u.contact.phoneNumber,"onUpdate:modelValue":o[4]||(o[4]=d=>u.contact.phoneNumber=d)},null,8,["modelValue","class"]),l("div",null,[Ee,s(c,{modelValue:u.contact.main,"onUpdate:modelValue":o[5]||(o[5]=d=>u.contact.main=d),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("div",ke,[s(V,{label:"Guardar",class:"mr-2",onClick:p}),s(V,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:C})])])):$("",!0)}}}),$e={key:2},Ie=["onClick"],Ue=D({__name:"TableCustomerContacts",emits:["create","update","delete"],setup(B,{emit:b}){const _=x(),E=M(),{customer:r}=q(E),i=U(h.CREATE),t=U(void 0),p=()=>{var e;t.value={customerId:(e=r.value)==null?void 0:e.id,id:H(),charge:"",email:"",firstName:"",lastName:"",disabled:!1,main:!1,phoneNumber:""},i.value=h.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(t.value=e.data,i.value=h.EDIT)},u=()=>{const e=t.value;i.value===h.CREATE?b("create",e):b("update",e),t.value=void 0},o=(e,c)=>{_.require({target:e.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var a;const V=v("Button"),d=v("Column"),k=v("DataTable");return y(),A(O,null,[t.value?$("",!0):(y(),T(V,{key:0,icon:n(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),t.value?(y(),T(Te,{key:1,contact:t.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>t.value=void 0)},null,8,["contact"])):(y(),A("div",$e,[(a=n(r))!=null&&a.contacts?(y(),T(k,{key:0,value:n(r).contacts,tableStyle:"min-width: 100%",onRowClick:C},{default:N(()=>[s(d,{header:"Nom",style:{width:"25%"}},{body:N(f=>[J(j(f.data.firstName)+" "+j(f.data.lastName),1)]),_:1}),s(d,{header:"Càrrec",field:"charge",style:{width:"25%"}}),s(d,{header:"Correu",field:"email",style:{width:"25%"}}),s(d,{header:"Telèfon",field:"phoneNumber",style:{width:"25%"}}),s(d,null,{body:N(f=>[l("i",{class:m([n(I).TIMES,"grid_delete_column_button"]),onClick:w=>o(w,f.data)},null,10,Ie)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),Be=l("span",null,"Client",-1),Ae=l("span",null,"Contactes",-1),De=l("span",null,"Adreces",-1),Ge=D({__name:"Customer",setup(B){const b=U(h.EDIT),_=K(),E=Q(),r=z(),i=M(),{customer:t}=q(i),p=async()=>{await i.fetchCustomer(_.params.id),i.fetchCustomerTypes(),r.fetchMasterData();let a="";t.value?(b.value=h.EDIT,a=`Client ${t.value.comercialName}`):(b.value=h.CREATE,i.setNewCustomer(_.params.id),a="Alta de client"),E.setMenuItem({icon:I.BUILDING,title:a,backButtonVisible:!0})};X(async()=>{await p()});const C=S(),u=async()=>{const a=t.value;let f=!1,w="";b.value===h.CREATE?(f=await i.createCustomer(a),w="Client creat correctament"):(f=await i.updateCustomer(a.id,a),w="Client actualizat correctament"),f&&(C.add({severity:"success",summary:w,life:5e3}),await p())},o=async a=>{await i.addContactToCustomer(a)&&C.add({severity:"success",summary:"Contacte afegit",life:5e3})},e=async a=>{await i.updateContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte actualizat",life:5e3})},c=async a=>{await i.removeContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte eliminat",life:5e3})},V=async a=>{await i.addAddressToCustomer(a)&&C.add({severity:"success",summary:"Adreça afegida",life:5e3})},d=async a=>{await i.updateAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça actualizada",life:5e3})},k=async a=>{await i.removeAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça eliminada",life:5e3})};return(a,f)=>{const w=v("TabPanel"),R=v("TabView");return y(),T(R,null,{default:N(()=>[s(w,null,{header:N(()=>[l("i",{class:m([n(I).WALLET,"mr-2"])},null,2),Be]),default:N(()=>[s(ne,{onSubmit:u})]),_:1}),b.value===n(h).EDIT?(y(),T(w,{key:0},{header:N(()=>[l("i",{class:m([n(I).USERS,"mr-2"])},null,2),Ae]),default:N(()=>[s(Ue,{onCreate:o,onUpdate:e,onDelete:c})]),_:1})):$("",!0),b.value===n(h).EDIT?(y(),T(w,{key:1},{header:N(()=>[l("i",{class:m([n(I).ENVELOPE,"mr-2"])},null,2),De]),default:N(()=>[s(ge,{onCreate:V,onUpdate:d,onDelete:k})]),_:1})):$("",!0)]),_:1})}}});export{Ge as default};
