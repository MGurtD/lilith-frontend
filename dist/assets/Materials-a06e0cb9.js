import{a as z,_ as O}from"./DropdownReferenceType.vue_vue_type_script_setup_true_lang-61edf715.js";import{d as A,Y as G,o as L,Z as J,T as C,h as F,m as c,w as l,a as d,e as o,i,z as K,k as f,P as k,G as D,H as v,R as B,l as I,n as Y,p as Z,b as Q,f as $,g as W,u as X,x as ee,j as te,r as re,J as ae}from"./index-feaddf7a.js";import{u as N}from"./reference-df7bd263.js";import{R as M}from"./index-7cbe1881.js";import{u as U}from"./referenceType-27f1987c.js";import{u as oe}from"./tax-8e3a9a0b.js";const E=u=>(Z("data-v-c104a4e8"),u=u(),Q(),u),ne={class:"flex flex-wrap align-items-center justify-content-between gap-2"},se={class:"datatable-filter-3"},le={class:"filter-field"},ie=E(()=>o("label",null,"Categoria",-1)),ce={class:"filter-field"},de=E(()=>o("label",null,"Codi",-1)),fe={class:"filter-field"},ue=E(()=>o("label",null,"Tipus",-1)),pe={class:"datatable-buttons"},ye=["onClick"],me=A({__name:"TableMaterials",props:{references:{},filter:{}},emits:["add","edit","delete"],setup(u,{emit:p}){const r=u,y=G(),b=U(),R=N();L(()=>{const e=y.getFilter("Materials","");e&&(r.filter.code=e.code,r.filter.referenceTypeId=e.referenceTypeId,r.filter.referenceCategory=e.referenceCategory)}),J(()=>{y.addFilter("Materials","",r.filter)});const w=()=>{r.filter.code="",r.filter.referenceTypeId=""},m=C(()=>r.references?r.filter.referenceCategory===""?[]:R.references.filter(e=>e.categoryName===r.filter.referenceCategory):[]),_=C(()=>{if(!m.value)return[];let e=m.value;return r.filter.referenceTypeId&&r.filter.referenceTypeId.length>0&&(e=e.filter(t=>t.referenceTypeId===r.filter.referenceTypeId)),r.filter.code.length>0&&(e=e.filter(t=>t.code.toLowerCase().includes(r.filter.code.toLowerCase()))),e}),g=C(()=>r.filter.referenceCategory===M.MATERIAL);C(()=>r.filter.referenceCategory===M.TOOL);const S=C(()=>r.filter.referenceCategory===M.SERVICE),V=()=>{p("add")},s=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||p("edit",e.data)},h=(e,t)=>{p("delete",t)},x=e=>{const t=b.getReferenceTypeById(e);return t?t.density:0},P=e=>{var T;const t=(T=R.referenceFormats)==null?void 0:T.find(n=>n.id===e);return t?t.description:""},j=e=>{const t=b.getReferenceTypeById(e);return t?t.description:""};return(e,t)=>{const T=F("Button"),n=F("Column"),q=F("DataTable");return d(),c(q,{value:_.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:s},{header:l(()=>[o("div",ne,[o("div",se,[o("div",le,[ie,i(z,{label:"",modelValue:e.filter.referenceCategory,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filter.referenceCategory=a)},null,8,["modelValue"])]),o("div",ce,[de,i(K,{modelValue:e.filter.code,"onUpdate:modelValue":t[1]||(t[1]=a=>e.filter.code=a)},null,8,["modelValue"])]),o("div",fe,[ue,i(O,{label:"",modelValue:e.filter.referenceTypeId,"onUpdate:modelValue":t[2]||(t[2]=a=>e.filter.referenceTypeId=a),disabled:e.filter.referenceCategory!==f(M).MATERIAL,onChange:w},null,8,["modelValue","disabled"])])]),o("div",pe,[i(T,{class:"datatable-button mr-2",icon:f(k).FILTER_SLASH,rounded:"",raised:"",onClick:w},null,8,["icon"]),i(T,{class:"datatable-button mr-2",icon:f(k).PLUS,rounded:"",raised:"",onClick:V},null,8,["icon"])])])]),default:l(()=>[i(n,{field:"code",header:"Codi",style:{width:"15%"}}),i(n,{field:"description",header:"Descripció",style:{width:"25%"}}),S.value?(d(),c(n,{key:0,header:"Preu",style:{width:"10%"}},{body:l(a=>[D(v(f(B)(a.data.price)),1)]),_:1})):I("",!0),S.value?(d(),c(n,{key:1,header:"Transport",style:{width:"10%"}},{body:l(a=>[D(v(f(B)(a.data.transportAmount)),1)]),_:1})):I("",!0),g.value?(d(),c(n,{key:2,field:"referenceTypeId",header:"Tipus",style:{width:"30%"}},{body:l(a=>[o("span",null,v(j(a.data.referenceTypeId)),1)]),_:1})):I("",!0),g.value?(d(),c(n,{key:3,field:"referenceFormatId",header:"Format",style:{width:"10%"}},{body:l(a=>[o("span",null,v(P(a.data.referenceFormatId)),1)]),_:1})):I("",!0),g.value?(d(),c(n,{key:4,header:"Densitat (mm)",style:{width:"10%"}},{body:l(a=>[D(v(x(a.data.referenceTypeId)),1)]),_:1})):I("",!0),i(n,{style:{width:"10%"}},{body:l(a=>[o("i",{class:Y([f(k).TIMES,"grid_delete_column_button"]),onClick:H=>h(H,a.data)},null,10,ye)]),_:1})]),_:1},8,["value"])}}});const _e=$(me,[["__scopeId","data-v-c104a4e8"]]),ge=A({__name:"Materials",setup(u){const p=W(),r=X(),y=N(),b=oe(),R=U(),w=ee(),m=te(),_=re({code:"",referenceTypeId:"",referenceCategory:""});L(async()=>{let s="Referències de compra";r.setMenuItem({icon:k.TICKET,title:s}),await y.fetchReferencesByModule("purchase"),b.fetchAll(),R.fetchAll()});const g=()=>{p.push({path:`/material/${ae()}/${_.value.referenceCategory}`})},S=s=>{p.push({path:`/material/${s.id}/${_.value.referenceCategory}`})},V=s=>{w.require({message:`Está segur que vol eliminar el material ${s.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const h=await y.deleteReference(s.id);h.result?m.add({severity:"success",summary:"Material eliminat correctament",life:5e3}):m.add({severity:"warn",summary:h.errors[0],life:5e3,closable:!0})}})};return(s,h)=>(d(),c(_e,{references:f(y).references,filter:_.value,onAdd:g,onEdit:S,onDelete:V},null,8,["references","filter"]))}});const Re=$(ge,[["__scopeId","data-v-7c74384c"]]);export{Re as default};
