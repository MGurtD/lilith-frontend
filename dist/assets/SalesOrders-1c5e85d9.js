import{_ as A}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-628d83b2.js";import{_ as G}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-ef9a91f0.js";import{_ as H}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-27123f00.js";import{_ as Y}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-fd007775.js";import{d as z,g as Q,j as J,x as K,u as W,r as D,E as X,o as Z,P as f,h as b,c as k,i as t,w as u,k as i,G as ee,a as E,e as c,C as S,D as x,n as te,l as ae}from"./index-64fee6e6.js";import{u as se}from"./order-608e20eb.js";import{u as oe}from"./reference-372e33a9.js";import{u as re}from"./customers-2f2b50e9.js";import{u as ie}from"./lifecycle-e8c951ba.js";import{a as N,f as P,g as le}from"./functions-2e154ea4.js";import{u as ne}from"./masterData-390891cf.js";import"./form-validator-f8953ae6.js";import"./_commonjsHelpers-725317a4.js";import"./index-2783be85.js";import"./base.service-0fa5a61f.js";import"./reference.service-10b4f35b.js";import"./index-93e66ee5.js";import"./v4-a960c1f4.js";const ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},de={class:"datatable-filter-3"},ue={class:"filter-field"},me={class:"filter-field"},fe=c("label",{class:"block text-900"},"Client",-1),_e={class:"filter-field"},pe=c("label",{class:"block text-900"},"Estat",-1),be={class:"datatable-buttons"},ve=["onClick"],qe=z({__name:"SalesOrders",setup(he){const C=Q(),w=J(),O=K(),l=W(),v=ne(),_=se(),R=oe(),V=re(),h=ie(),n=D({customerId:void 0,statusId:void 0}),d=X({visible:!1,title:"Crear comanda",closable:!0,position:"center",modal:!0});Z(async()=>{h.fetchOneByName("SalesOrder"),R.fetchReferences(),V.fetchCustomers(),await v.fetchMasterData(),g(),await m(),l.setMenuItem({icon:f.APPLE,title:"Comandes"})});const g=()=>{var r;const o=new Date().getFullYear().toString(),e=(r=v.exercises)==null?void 0:r.find(s=>s.name===o);e&&(l.exercisePicker.exercise=e,l.exercisePicker.dates=[new Date(l.exercisePicker.exercise.startDate),new Date(l.exercisePicker.exercise.endDate)])},T=()=>{n.value.customerId=void 0,n.value.statusId=void 0,g(),m()},p=D({}),B=()=>({id:le(),customerId:"",exerciseId:"",date:new Date}),F=()=>{p.value=B(),d.visible=!0},m=async()=>{if(l.exercisePicker.dates){const o=N(l.exercisePicker.dates[0]),e=N(l.exercisePicker.dates[1]);await _.GetFiltered(o,e,n.value.customerId,n.value.statusId)}else w.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},q=o=>{var r,s;const e=(s=(r=h.lifecycle)==null?void 0:r.statuses)==null?void 0:s.find(y=>y.id===o);return e?e.name:""},L=async()=>{d.visible=!1,await _.Create(p.value)&&C.push({path:`/salesorder/${p.value.id}`})},$=o=>{o.originalEvent.target.className.includes("grid_delete_column_button")||C.push({path:`/salesorder/${o.data.id}`})},U=(o,e)=>{O.require({message:"Està segur que vol eliminar la comanda?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await _.Delete(e.id)&&(w.add({severity:"success",summary:"Eliminada",life:3e3}),await m())}})};return(o,e)=>{const r=b("Button"),s=b("Column"),y=b("DataTable"),M=b("Dialog");return E(),k(ee,null,[t(y,{value:i(_).salesOrders,class:"small-datatable",tableStyle:"min-width: 100%","sort-field":"salesOrderNumber","sort-mode":"single","sort-order":1,scrollable:"",scrollHeight:"80vh",onRowClick:$},{header:u(()=>[c("div",ce,[c("div",de,[c("div",ue,[t(A,{exercises:i(v).exercises,onRangeSelected:m},null,8,["exercises"])]),c("div",me,[fe,t(H,{label:"",modelValue:n.value.customerId,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.customerId=a)},null,8,["modelValue"])]),c("div",_e,[pe,t(Y,{label:"",modelValue:n.value.statusId,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.statusId=a)},null,8,["modelValue"])])]),c("div",be,[t(r,{class:"datatable-button mr-2",icon:i(f).FILTER,rounded:"",raised:"",onClick:m},null,8,["icon"]),t(r,{class:"datatable-button mr-2",icon:i(f).FILTER_SLASH,rounded:"",raised:"",onClick:T},null,8,["icon"]),t(r,{icon:i(f).PLUS,rounded:"",raised:"",onClick:F},null,8,["icon"])])])]),default:u(()=>[t(s,{field:"number",header:"Número",sortable:"",style:{width:"10%"}}),t(s,{field:"date",header:"Data",style:{width:"10%"},sortable:""},{body:u(a=>[S(x(i(P)(a.data.date)),1)]),_:1}),t(s,{field:"expectedDate",header:"Data Entrega",style:{width:"10%"},sortable:""},{body:u(a=>[S(x(a.data.expectedDate?i(P)(a.data.expectedDate):""),1)]),_:1}),t(s,{field:"customerComercialName",header:"Client",style:{width:"30%"}}),t(s,{field:"customerNumber",header:"Comanda client",style:{width:"15%"}}),t(s,{header:"Estat",style:{width:"20%"}},{body:u(a=>[S(x(q(a.data.statusId)),1)]),_:1}),t(s,{style:{width:"5%"}},{body:u(a=>{var I;return[a.data.statusId===((I=i(h).lifecycle)==null?void 0:I.initialStatusId)?(E(),k("i",{key:0,class:te([i(f).TIMES,"grid_delete_column_button"]),onClick:j=>U(j,a.data)},null,10,ve)):ae("",!0)]}),_:1})]),_:1},8,["value"]),t(M,{visible:d.visible,"onUpdate:visible":e[2]||(e[2]=a=>d.visible=a),header:d.title,closable:d.closable,modal:d.modal},{default:u(()=>[t(G,{"create-request":p.value,onSubmit:L},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{qe as default};
