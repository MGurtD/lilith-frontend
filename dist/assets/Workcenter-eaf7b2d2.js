import{F as U}from"./FileEntityPicker-61729a96.js";import{d as E,j as h,C as x,r as F,h as y,k as e,c as C,e as s,i as d,n as b,z as I,l as M,a as g,s as D,F as k,v as L,u as P,o as S,m as N,L as W,P as $,V as A}from"./index-77e4d88f.js";import{c as R,a as f,F as z}from"./form-validator-7d52d458.js";import{u as q}from"./plantmodel-ae7b1452.js";import{u as j}from"./shift-68d004b2.js";import"./index-fc95771f.js";const G={key:0},O={class:"grid_add_row_button"},H={class:"four-columns mb-2"},J=s("label",{class:"block text-900 mb-2"},"Desactivat",-1),K={class:"three-columns"},Q=s("label",{class:"block text-900 mb-2"},"Tipus",-1),X=s("label",{class:"block text-900 mb-2"},"Area",-1),Y=s("label",{class:"block text-900 mb-2"},"Torn",-1),Z=E({__name:"FormWorkcenter",props:{workcenter:{}},emits:["submit","cancel"],setup(T,{emit:p}){const u=T,v=h(),n=q(),c=j(),{workcenter:t}=x(n),V=R().shape({name:f().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:f().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),workcenterTypeId:f().required("El tipus es obligatori"),areaId:f().required("L'area es obligatoria"),shiftId:f().required("El torn es obligatori")}),l=F({result:!1,errors:{}}),r=()=>{const i=new z(V);l.value=i.validate(u.workcenter)},m=async()=>{if(r(),l.value.result)p("submit",u.workcenter);else{let i="";Object.entries(l.value.errors).forEach(o=>{i+=`${o[1].map(w=>w)}.   `}),v.add({severity:"warn",summary:"Formulari inválid",detail:i,life:5e3})}};return(i,o)=>{const w=y("Button"),B=y("Checkbox"),_=y("Dropdown");return e(t)?(g(),C("form",G,[s("div",O,[d(w,{label:"Guardar",style:{float:"right"},onClick:m})]),s("section",H,[d(I,{label:"Nom",id:"name",modelValue:e(t).name,"onUpdate:modelValue":o[0]||(o[0]=a=>e(t).name=a),class:b({"p-invalid":l.value.errors.name})},null,8,["modelValue","class"]),d(I,{label:"Descripció",id:"description",modelValue:e(t).description,"onUpdate:modelValue":o[1]||(o[1]=a=>e(t).description=a),class:b({"p-invalid":l.value.errors.description})},null,8,["modelValue","class"]),d(I,{type:e(D).NUMERIC,minFractionDigits:2,class:"mb-2",label:"Marge de benefici",id:"profitPercentage",modelValue:e(t).profitPercentage,"onUpdate:modelValue":o[2]||(o[2]=a=>e(t).profitPercentage=a),suffix:"%"},null,8,["type","modelValue"]),s("div",null,[J,d(B,{modelValue:e(t).disabled,"onUpdate:modelValue":o[3]||(o[3]=a=>e(t).disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),s("section",K,[s("div",null,[Q,d(_,{modelValue:e(t).workcenterTypeId,"onUpdate:modelValue":o[4]||(o[4]=a=>e(t).workcenterTypeId=a),editable:"",options:e(n).workcenterTypes,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":l.value.errors.workcenterTypeId}])},null,8,["modelValue","options","class"])]),s("div",null,[X,d(_,{modelValue:e(t).areaId,"onUpdate:modelValue":o[5]||(o[5]=a=>e(t).areaId=a),editable:"",options:e(n).areas,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":l.value.errors.areaId}])},null,8,["modelValue","options","class"])]),s("div",null,[Y,d(_,{modelValue:e(t).shiftId,"onUpdate:modelValue":o[6]||(o[6]=a=>e(t).shiftId=a),editable:"",options:e(c).shifts,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":l.value.errors.shiftId}])},null,8,["modelValue","options","class"])])])])):M("",!0)}}}),ee={class:"mt-4"},ne=E({__name:"Workcenter",setup(T){const p=F(k.EDIT),u=L(),v=P(),n=q(),{workcenter:c}=x(n),t=async()=>{await n.fetchWorkcenter(u.params.id);let r="";c.value?(p.value=k.EDIT,r=`Màquina: ${c.value.name}`):(p.value=k.CREATE,n.setNewWorkcenter(u.params.id),r="Alta de màquina"),v.setMenuItem({icon:$.BUILDING,backButtonVisible:!0,title:r})};S(async()=>{await t()});const V=h(),l=async()=>{const r=c.value;let m=!1,i="";p.value===k.CREATE?(m=await n.createWorkcenter(r),i="Màquina creada correctament"):(m=await n.updateWorkcenter(r.id,r),i="Màquina actualizada correctament"),m&&(V.add({severity:"success",summary:i,life:5e3}),A.back())};return(r,m)=>(g(),C(W,null,[e(c)?(g(),N(Z,{key:0,workcenter:e(c),onSubmit:l},null,8,["workcenter"])):M("",!0),s("section",ee,[d(U,{title:"Imatge de la màquina",entity:"WorkcenterPicture","max-files":1,id:e(u).params.id},null,8,["id"])])],64))}});export{ne as default};
