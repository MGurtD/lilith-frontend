import{d as N,j as L,H as V,r as M,h as b,a as y,c as C,e as o,i,k as m,n as w,s as _,y as q,l as T,G as $,J as A}from"./index-69c3f293.js";import{u as G}from"./plantmodel-1b7fccc4.js";import{u as j}from"./workorder-5a328198.js";import{c as H,a as k,d as D,F as z}from"./form-validator-f8953ae6.js";import{d as u}from"./index-b0fd6b10.js";const R=o("br",null,null,-1),J={key:0},Q={class:"three-columns"},K={class:"mt-1"},X=o("label",{class:"block text-900 mb-2"},"Operari",-1),Y={class:"mt-1"},Z=o("label",{class:"block text-900 mb-2"},"Màquina",-1),x={class:"mt-1"},ee=o("label",{class:"block text-900 mb-2"},"Data Tíquet",-1),re={class:"three-columns"},te={class:"mt-1"},oe=o("label",{class:"block text-900 mb-2"},"Ordre Fabricació",-1),ae={class:"mt-1"},de=o("label",{class:"block text-900 mb-2"},"Fase Ordre Fabricació",-1),se={class:"mt-1"},le=o("label",{class:"block text-900 mb-2"},"Pas Ordre Fabricació",-1),ie={class:"two-columns"},ne={class:"mt-1"},ue={class:"mt-1"},ke=N({__name:"FormProductionPart",props:{productionPart:{}},emits:["submit","cancel"],setup(d,{emit:s}){const a=d,I=L(),O=G(),P=j(),F=V(()=>{var e;if(a.productionPart.workOrderId!==""&&a.productionPart.workCenterId!==""){let t=(e=P.detailedWorkOrders)==null?void 0:e.filter(l=>l.workOrderId===a.productionPart.workOrderId&&l.workcenterId===a.productionPart.workCenterId);return t||[]}return[]}),B=V(()=>{var e;if(a.productionPart.workOrderId!==""&&a.productionPart.workCenterId!==""&&a.productionPart.workOrderPhaseId!==""){let t=(e=P.detailedWorkOrders)==null?void 0:e.filter(l=>l.workOrderId===a.productionPart.workOrderId&&l.workcenterId===a.productionPart.workCenterId&&l.workOrderPhaseId===a.productionPart.workOrderPhaseId);return t||[]}return[]}),U=H().shape({operatorId:k().required("Escull un operari"),workOrderId:k().required("Escull una ordre de fabricació"),workOrderPhaseId:k().required("Escull una fase de l'ordre de fabricació"),workOrderPhaseDetailId:k().required("Escull un pas d'una fase"),quantity:D().required("Has d'introduir una quantitat entera (pot ser 0)").integer(),time:D().required("Has d'introduir el temps i ha de ser major que 0").moreThan(0)}),n=M({result:!1,errors:{}}),W=()=>{const e=new z(U);n.value=e.validate(a.productionPart)},g=async e=>{await P.fetchByWorkcenterId(e)},E=async()=>{if(W(),n.value.result)s("submit",a.productionPart);else{let e="";Object.entries(n.value.errors).forEach(t=>{e+=`${t[1].map(l=>l)}.   `}),I.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{var f,h,v;const l=b("Button"),c=b("Dropdown"),S=b("Calendar");return y(),C($,null,[o("div",null,[i(l,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:E}),R]),e.productionPart?(y(),C("form",J,[o("section",Q,[o("div",K,[X,i(c,{modelValue:e.productionPart.operatorId,"onUpdate:modelValue":t[0]||(t[0]=r=>e.productionPart.operatorId=r),editable:"",options:(f=m(O).operators)==null?void 0:f.sort((r,p)=>r.surname.localeCompare(p.surname)).map(r=>({value:r.id,label:r.surname+", "+r.name})),optionValue:"value",optionLabel:"label",class:w(["w-full",{"p-invalid":n.value.errors.operatorid}])},null,8,["modelValue","options","class"])]),o("div",Y,[Z,i(c,{modelValue:e.productionPart.workCenterId,"onUpdate:modelValue":t[1]||(t[1]=r=>e.productionPart.workCenterId=r),editable:"",options:(h=m(O).workcenters)==null?void 0:h.sort((r,p)=>r.description.localeCompare(p.description)),optionValue:"id",optionLabel:"description",class:"w-full",onChange:t[2]||(t[2]=r=>g(e.productionPart.workCenterId))},null,8,["modelValue","options"])]),o("div",x,[ee,i(S,{modelValue:e.productionPart.date,"onUpdate:modelValue":t[3]||(t[3]=r=>e.productionPart.date=r),dateFormat:"dd/mm/yy"},null,8,["modelValue"])])]),o("section",re,[o("div",te,[oe,i(c,{modelValue:e.productionPart.workOrderId,"onUpdate:modelValue":t[4]||(t[4]=r=>e.productionPart.workOrderId=r),editable:"",options:(v=m(P).detailedWorkOrders)==null?void 0:v.sort((r,p)=>r.workOrderCode.localeCompare(p.workOrderCode)).map(r=>({value:r.workOrderId,label:r.workOrderCode+" - "+r.referenceDescription})),optionValue:"value",optionLabel:"label",class:w(["w-full",{"p-invalid":n.value.errors.workOrderId}])},null,8,["modelValue","options","class"])]),o("div",ae,[de,i(c,{modelValue:e.productionPart.workOrderPhaseId,"onUpdate:modelValue":t[5]||(t[5]=r=>e.productionPart.workOrderPhaseId=r),editable:"",options:F.value,optionValue:"workOrderPhaseId",optionLabel:"workOrderPhaseCode",class:w(["w-full",{"p-invalid":n.value.errors.workOrderPhaseId}])},null,8,["modelValue","options","class"])]),o("div",se,[le,i(c,{modelValue:e.productionPart.workOrderPhaseDetailId,"onUpdate:modelValue":t[6]||(t[6]=r=>e.productionPart.workOrderPhaseDetailId=r),editable:"",options:B.value,optionValue:"workOrderPhaseDetailId",optionLabel:"machineStatusDescription",class:w(["w-full",{"p-invalid":n.value.errors.workOrderPhaseDetailId}])},null,8,["modelValue","options","class"])])]),o("section",ie,[o("div",ne,[i(q,{type:m(_).NUMERIC,label:"Quantitat",id:"quantity",modelValue:e.productionPart.quantity,"onUpdate:modelValue":t[7]||(t[7]=r=>e.productionPart.quantity=r)},null,8,["type","modelValue"])]),o("div",ue,[i(q,{type:m(_).NUMERIC,label:"Temps",id:"time",modelValue:e.productionPart.time,"onUpdate:modelValue":t[8]||(t[8]=r=>e.productionPart.time=r)},null,8,["type","modelValue"])])])])):T("",!0)],64)}}}),Ie=A({id:"productionParts",state:()=>({productionPart:void 0,productionParts:void 0}),getters:{},actions:{setNew(d){this.productionPart={id:d,date:new Date,workCenterId:"",workOrderPhaseDetailId:"",operatorId:"",quantity:0,time:0}},async fetchAll(){this.productionParts=await u.ProductionPart.getAll()},async fetchByWorkOrderId(d){this.productionParts=await u.ProductionPart.GetByWorkOrderId(d)},async fetchOne(d){this.productionPart=await u.ProductionPart.getById(d)},async fetchFiltered(d,s,a,I){this.productionParts=await u.ProductionPart.GetBetweenDates(d,s,a,I)},async create(d){const s=await u.ProductionPart.create(d);return s&&await this.fetchOne(d.id),s},async delete(d){const s=await u.ProductionPart.delete(d);return s&&await this.fetchAll(),s},async update(d,s){const a=await u.ProductionPart.update(d,s);return a&&await this.fetchAll(),a}}});export{ke as _,Ie as u};
