import{d as k,r as M,o as x,Y as U,K as $,h,m as B,w as c,a as T,e as l,i as a,y as P,k as u,P as y,D as I,C as w,n as j,p as q,b as K,f as V,g as A,u as F,x as H,j as J}from"./index-ffbfd559.js";import{u as O}from"./reference-696ceffd.js";import{_ as z}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-02acd90b.js";import{u as Y}from"./customers-87c7f85b.js";import{d as S,g as G}from"./functions-2e154ea4.js";import"./reference.service-92f0d222.js";import"./base.service-bfea8aa4.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";const D=i=>(q("data-v-9a52898c"),i=i(),K(),i),Q={class:"flex flex-wrap align-items-center justify-content-between gap-2"},W={class:"datatable-filter"},X={class:"filter-field"},Z=D(()=>l("label",null,"Codi",-1)),ee={class:"filter-field"},te=D(()=>l("label",null,"Client",-1)),se={class:"datatable-buttons"},oe=["onClick"],R="temges.filters.references",ae=k({__name:"TableReferences",props:{references:{}},emits:["add","edit","delete"],setup(i,{emit:d}){const p=i,f=Y(),t=M({code:"",customerId:""});x(()=>{const e=localStorage.getItem(R);e&&(t.value=JSON.parse(e))}),U(()=>{localStorage.setItem(R,JSON.stringify(t.value))});const v=()=>{t.value.code="",t.value.customerId=""},b=$(()=>{if(!p.references)return[];let e=p.references;return t.value.customerId.length>0&&(e=e.filter(s=>s.customerId===t.value.customerId)),t.value.code.length>0&&(e=e.filter(s=>s.code.toLowerCase().includes(t.value.code.toLowerCase()))),e}),C=()=>{d("add")},g=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||d("edit",e.data)},r=(e,s)=>{d("delete",s)},m=e=>{var _;const s=(_=f.customers)==null?void 0:_.find(n=>n.id===e);return s?s.comercialName:""};return(e,s)=>{const _=h("Button"),n=h("Column"),N=h("BooleanColumn"),L=h("DataTable");return T(),B(L,{value:b.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:g},{header:c(()=>[l("div",Q,[l("div",W,[l("div",X,[Z,a(P,{modelValue:t.value.code,"onUpdate:modelValue":s[0]||(s[0]=o=>t.value.code=o)},null,8,["modelValue"])]),l("div",ee,[te,a(z,{label:"",modelValue:t.value.customerId,"onUpdate:modelValue":s[1]||(s[1]=o=>t.value.customerId=o)},null,8,["modelValue"])])]),l("div",se,[a(_,{class:"datatable-button mr-2",icon:u(y).FILTER_SLASH,rounded:"",raised:"",onClick:v},null,8,["icon"]),a(_,{class:"datatable-button mr-2",icon:u(y).PLUS,rounded:"",raised:"",onClick:C},null,8,["icon"])])])]),default:c(()=>[a(n,{field:"code",header:"Codi",style:{width:"15%"}}),a(n,{field:"description",header:"Descripció",style:{width:"35%"}}),a(n,{field:"version",header:"Versió",style:{width:"10%"}}),a(n,{field:"customerId",header:"Client",style:{width:"20%"}},{body:c(o=>[l("span",null,I(m(o.data.customerId)),1)]),_:1}),a(n,{field:"price",header:"Preu",style:{width:"10%"}},{body:c(o=>[w(I(u(S)(o.data.price)),1)]),_:1}),a(n,{field:"cost",header:"Cost",style:{width:"10%"}},{body:c(o=>[w(I(u(S)(o.data.workMasterCost)),1)]),_:1}),a(n,{header:"Servei",style:{width:"10%"}},{body:c(o=>[a(N,{value:o.data.isService},null,8,["value"])]),_:1}),a(n,{style:{width:"10%"}},{body:c(o=>[l("i",{class:j([u(y).TIMES,"grid_delete_column_button"]),onClick:E=>r(E,o.data)},null,10,oe)]),_:1})]),_:1},8,["value"])}}});const ne=V(ae,[["__scopeId","data-v-9a52898c"]]),re=k({__name:"References",setup(i){const d=A(),p=F(),f=O(),t=H(),v=J();x(async()=>{let r="Referencies de venta";p.setMenuItem({icon:y.TICKET,title:r}),await f.fetchReferencesByModule("sales")});const b=()=>{d.push({path:`/sales/reference/${G()}`})},C=r=>{d.push({path:`/sales/reference/${r.id}`})},g=r=>{t.require({message:`Está segur que vol eliminar la refèrencia ${r.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const m=await f.deleteReference(r.id);m.result?v.add({severity:"success",summary:"Referencia eliminada correctament",life:5e3}):v.add({severity:"warn",summary:m.errors[0],life:5e3,closable:!0})}})};return(r,m)=>(T(),B(ne,{references:u(f).references,onAdd:b,onEdit:C,onDelete:g},null,8,["references"]))}});const ve=V(re,[["__scopeId","data-v-88f67bcf"]]);export{ve as default};
