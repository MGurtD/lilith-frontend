import{_ as k}from"./DropdownReference.vue_vue_type_script_setup_true_lang-71e36068.js";import{_ as O}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-0f36646d.js";import{d as j,g as q,u as G,X as Q,j as Y,x as z,r as J,R as K,K as g,o as P,P as p,Y as X,h as m,c as Z,i as a,w as i,L as ee,a as te,e as r,k as s,G as I,H as b,$ as oe,n as T,J as le}from"./index-0165ef2a.js";import{u as re}from"./workmaster-f6a81062.js";import{u as ae}from"./reference-3a204a36.js";import{u as se}from"./customers-7ea2bdbb.js";import"./index-836a0692.js";const ne={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ie={class:"datatable-filter"},de={class:"filter-field"},ce=r("label",{class:"block text-900"},"Referència",-1),ue={class:"filter-field"},me=r("label",{class:"block text-900"},"Client",-1),fe={class:"datatable-buttons"},pe=["onClick"],be=["onClick"],ve=r("br",null,null,-1),_e=r("section",{class:"two-columns"},[r("div",null,[r("h3",null,"Origen")]),r("div",null,[r("h3",null,"Destí")])],-1),Ce={class:"two-columns"},Se=j({__name:"Workmasters",setup(ye){const w=q(),V=G(),v=Q(),_=Y(),S=z(),t=re(),C=ae(),B=se(),n=J({referenceId:void 0,customerId:void 0}),N=()=>{n.value.referenceId=void 0,n.value.customerId=void 0,v.removeFilter("Workmasters","")},D=K(()=>{if(!t.workmasters)return[];let l=t.workmasters;return n.value.referenceId&&(l=l.filter(o=>o.referenceId===n.value.referenceId)),n.value.customerId&&(l=l.filter(o=>{var d;return((d=o.reference)==null?void 0:d.customerId)===n.value.customerId||o.reference.customerId===null})),l}),u=g({visible:!1,title:"Crear ruta",closable:!0,position:"center",modal:!0}),f=g({visible:!1,title:"Copiar ruta",closable:!0,position:"center",modal:!0});P(async()=>{V.setMenuItem({icon:p.CALENDAR,title:"Gestió de rutes de fabricació"}),C.fetchReferencesByModule("sales"),await t.fetchAll();const l=v.getFilter("Workmasters","");l&&(l.referenceId&&(n.value.referenceId=l.referenceId),l.customerId&&(n.value.customerId=l.customerId))}),X(()=>{v.addFilter("Workmasters","",n.value)});const R=()=>{const l=le();t.setNew(l),u.visible=!0},x=(l,o)=>{t.workmasterToCopy={workmasterId:o.id,workmaster:o,referenceId:null,referenceCode:""},f.visible=!0},F=async()=>{t.workmasterToCopy.referenceId===""&&(t.workmasterToCopy.referenceId=null);const l=await t.copy(t.workmasterToCopy);await t.fetchAll(),f.visible=!1,l?_.add({severity:"success",summary:"Copiada",life:3e3}):_.add({severity:"error",summary:"Hi ha hagut un error en el proces",life:3e3})},U=()=>{t.workmasterToCopy.referenceCode=""},E=()=>{t.workmasterToCopy.referenceId=""},A=l=>{!l.originalEvent.target.className.includes("grid_delete_column_button")&&!l.originalEvent.target.className.includes("grid_copy_column_button")&&w.push({path:`/workmaster/${l.data.id}`})},W=async()=>{if(!t.workmaster)return;await t.create(t.workmaster)&&w.push({path:`/workmaster/${t.workmaster.id}`})},$=(l,o)=>{S.require({target:l.currentTarget,message:`Está segur que vol eliminar la ruta ${o.reference.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await t.delete(o.id)&&(_.add({severity:"success",summary:"Eliminada",life:3e3}),await t.fetchAll())}})};return(l,o)=>{const d=m("Button"),c=m("Column"),L=m("BooleanColumn"),M=m("DataTable"),h=m("Dialog"),H=m("BaseInput");return te(),Z(ee,null,[a(M,{value:D.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh","sort-field":"reference.code","sort-order":1,onRowClick:A,paginator:"",rows:12},{header:i(()=>[r("div",ne,[r("div",ie,[r("div",de,[ce,a(k,{label:"",modelValue:n.value.referenceId,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value.referenceId=e),fullName:!0},null,8,["modelValue"])]),r("div",ue,[me,a(O,{label:"",modelValue:n.value.customerId,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value.customerId=e)},null,8,["modelValue"])])]),r("div",fe,[a(d,{class:"datatable-button mr-2",icon:s(p).FILTER_SLASH,rounded:"",raised:"",onClick:N},null,8,["icon"]),a(d,{icon:s(p).PLUS,rounded:"",raised:"",onClick:R},null,8,["icon"])])])]),default:i(()=>[a(c,{field:"reference.code",sortable:"",header:"Referencia",style:{width:"50%"}},{body:i(e=>[I(b(s(C).getFullName(e.data.reference)),1)]),_:1}),a(c,{sortable:"",header:"Client",style:{width:"25%"}},{body:i(e=>[I(b(s(B).getCustomerNameById(e.data.reference.customerId)),1)]),_:1}),a(c,{field:"baseQuantity",header:"Quantitat Base",style:{width:"25%"}}),a(c,{header:"Cost",style:{width:"25%"}},{body:i(e=>[I(b(s(oe)(e.data.machineCost+e.data.operatorCost+e.data.materialCost+e.data.externalCost)),1)]),_:1}),a(c,{header:"Desactivada",style:{width:"25%"}},{body:i(e=>[a(L,{value:e.data.disabled},null,8,["value"])]),_:1}),a(c,null,{body:i(e=>[r("i",{class:T([s(p).COPY,"grid_copy_column_button"]),onClick:y=>x(y,e.data)},null,10,pe)]),_:1}),a(c,null,{body:i(e=>[r("i",{class:T([s(p).TIMES,"grid_delete_column_button"]),onClick:y=>$(y,e.data)},null,10,be)]),_:1})]),_:1},8,["value"]),a(h,{visible:u.visible,"onUpdate:visible":o[3]||(o[3]=e=>u.visible=e),header:u.title,closable:u.closable,modal:u.modal},{default:i(()=>[r("div",null,[a(k,{label:"Referència",modelValue:s(t).workmaster.referenceId,"onUpdate:modelValue":o[2]||(o[2]=e=>s(t).workmaster.referenceId=e),fullName:!0},null,8,["modelValue"])]),ve,r("div",null,[a(d,{label:"Crear",style:{float:"right"},onClick:W})])]),_:1},8,["visible","header","closable","modal"]),a(h,{visible:f.visible,"onUpdate:visible":o[6]||(o[6]=e=>f.visible=e),header:f.title,closable:!0,modal:!0},{default:i(()=>[_e,r("section",Ce,[r("div",null,[r("p",null,b(s(C).getFullNameById(s(t).workmasterToCopy.workmaster.referenceId)),1)]),r("div",null,[a(k,{label:"Referència existent:",modelValue:s(t).workmasterToCopy.referenceId,"onUpdate:modelValue":o[4]||(o[4]=e=>s(t).workmasterToCopy.referenceId=e),fullName:!0,onChange:U},null,8,["modelValue"]),a(H,{class:"mb-2",label:"Nou codi:",id:"referenceCode",modelValue:s(t).workmasterToCopy.referenceCode,"onUpdate:modelValue":o[5]||(o[5]=e=>s(t).workmasterToCopy.referenceCode=e),onChange:E},null,8,["modelValue"])])]),r("div",null,[a(d,{label:"Copiar",style:{float:"right"},onClick:F})])]),_:1},8,["visible","header"])],64)}}});export{Se as default};
