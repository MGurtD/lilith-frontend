import{_ as F}from"./DropdownReference.vue_vue_type_script_setup_true_lang-897cb77b.js";import{c as U,d as L,a as O,F as j}from"./form-validator-f8953ae6.js";import{d as W,j as A,r as M,h,c as S,e as i,i as r,k as p,y as Q,l as T,a as y,s as z,E as G,x as H,w as k,G as D,P,C as $,D as B,n as J,m as V,v as K,g as X,u as Y,z as Z,o as ee,f as te}from"./index-53820b8d.js";import{g as ae}from"./functions-4d7ada1d.js";import{u as x}from"./plantmodel-884a3b96.js";import{_ as se}from"./FormWorkmasterPhase.vue_vue_type_script_setup_true_lang-e6fb2223.js";import{u as oe}from"./reference-4195502c.js";import{u as re}from"./workmaster-b78e0c53.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";import"./index-a03cc526.js";import"./base.service-80f81d45.js";import"./reference.service-f83d13c3.js";const ne={key:0},le=i("br",null,null,-1),ie={class:"three-columns"},de=i("label",{class:"block text-900 mb-2"},"Desactivat",-1),ce=W({__name:"FormWorkmaster",props:{workmaster:{}},emits:["submit","cancel"],setup(C,{emit:_}){const f=C,d=A(),b=U().shape({baseQuantity:L().min(1,"La quantitat base ha de ser superior a 0").required("La quanitat base és obligatoria"),referenceId:O().required("La referència és obligatoria")}),a=M({result:!1,errors:{}}),v=()=>{const t=new j(b);a.value=t.validate(f.workmaster)},l=async()=>{if(v(),a.value.result)_("submit",f.workmaster);else{let t="";Object.entries(a.value.errors).forEach(o=>{t+=`${o[1].map(w=>w)}.   `}),d.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,o)=>{const w=h("Button"),g=h("Checkbox");return t.workmaster?(y(),S("form",ne,[i("div",null,[r(w,{label:"Guardar Ruta",class:"grid_add_row_button",size:"small",onClick:l}),le]),i("section",ie,[i("div",null,[r(F,{label:"Referència",modelValue:t.workmaster.referenceId,"onUpdate:modelValue":o[0]||(o[0]=m=>t.workmaster.referenceId=m),fullName:!0},null,8,["modelValue"])]),i("div",null,[r(Q,{type:p(z).NUMERIC,label:"Quantitat Base",decimals:2,modelValue:t.workmaster.baseQuantity,"onUpdate:modelValue":o[1]||(o[1]=m=>t.workmaster.baseQuantity=m)},null,8,["type","modelValue"])]),i("div",null,[de,r(g,{modelValue:t.workmaster.disabled,"onUpdate:modelValue":o[2]||(o[2]=m=>t.workmaster.disabled=m),class:"w-full",binary:!0},null,8,["modelValue"])])])])):T("",!0)}}}),ue={class:"flex flex-wrap align-items-center justify-content-between gap-2"},me=i("span",{class:"text-xl text-900 font-bold"},"Fases de la ruta",-1),pe=["onClick"],fe=W({__name:"TableWorkmasterPhases",props:{workmaster:{},workmasterPhases:{}},emits:["add","edit","delete"],setup(C,{emit:_}){const f=C,d=G({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),b=H(),a=x(),v=e=>{var u;if(!a.workcenterTypes)return"";const s=(u=a.workcenterTypes)==null?void 0:u.find(n=>e===n.id);return s?s.name:""},l=e=>{var u;if(!a.workcenters)return"";const s=(u=a.workcenters)==null?void 0:u.find(n=>e===n.id);return s?s.name:""},t=e=>{var u;if(!a.operatorTypes)return"";const s=(u=a.operatorTypes)==null?void 0:u.find(n=>e===n.id);return s?s.name:""},o=M({}),w=()=>{o.value={id:ae(),workMasterId:f.workmaster.id,disabled:!1,code:((f.workmaster.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,workmasterPhaseDetails:[],workmasterPhaseBillOfMaterials:[]},d.visible=!0},g=e=>{d.visible=!1,_("add",e)},m=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||_("edit",e.data)},I=(e,s)=>{b.require({target:e.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{_("delete",s)}})};return(e,s)=>{const u=h("Button"),n=h("Column"),E=h("BooleanColumn"),R=h("DataTable"),N=h("Dialog");return y(),S(D,null,[r(R,{onRowClick:m,value:e.workmasterPhases,tableStyle:"min-width: 100%"},{header:k(()=>[i("div",ue,[me,r(u,{icon:p(P).PLUS,rounded:"",raised:"",onClick:w},null,8,["icon"])])]),default:k(()=>[r(n,{field:"code",header:"Codi",style:{width:"10%"}}),r(n,{field:"description",header:"Descripció",style:{width:"20%"}}),r(n,{header:"Tipus de màquina",style:{width:"15%"}},{body:k(c=>[$(B(v(c.data.workcenterTypeId)),1)]),_:1}),r(n,{header:"Màquina preferida",style:{width:"15%"}},{body:k(c=>[$(B(l(c.data.preferredWorkcenterId)),1)]),_:1}),r(n,{header:"Tipus d'operari",style:{width:"15%"}},{body:k(c=>[$(B(t(c.data.operatorTypeId)),1)]),_:1}),r(n,{header:"Extern",style:{width:"10%"}},{body:k(c=>[r(E,{value:c.data.isExternalWork},null,8,["value"])]),_:1}),r(n,{style:{width:"10%"}},{body:k(c=>[i("i",{class:J([p(P).TIMES,"grid_delete_column_button"]),onClick:q=>I(q,c.data)},null,10,pe)]),_:1})]),_:1},8,["value"]),r(N,{visible:d.visible,"onUpdate:visible":s[0]||(s[0]=c=>d.visible=c),header:d.title,closable:d.closable,modal:d.modal},{default:k(()=>[o.value?(y(),V(se,{key:0,workmaster:e.workmaster,phase:o.value,onSubmit:g},null,8,["workmaster","phase"])):T("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),ke={class:"main"},_e=W({__name:"Workmaster",setup(C){const _=K(),f=X(),d=Y(),b=oe(),a=re(),v=x(),{workmaster:l}=Z(a),t=M("");ee(async()=>{t.value=_.params.id,await o();let e="";e="Ruta de fabricació",l.value&&(e=`${e} ${b.getFullName(l.value.reference)}`),d.setMenuItem({icon:P.BUILDING,backButtonVisible:!0,title:e})});const o=async()=>{await b.fetchReferencesByModule("sales"),await a.fetchOne(t.value),v.fetchActiveModel()},w=async e=>{await a.update(t.value,e)&&await o()},g=async e=>{await a.createPhase(e)&&f.push({path:`/workmaster/${t.value}/phase/${e.id}`})},m=e=>{f.push({path:`/workmaster/${t.value}/phase/${e.id}`})},I=async e=>{await a.deletePhase(e.id)};return(e,s)=>(y(),S(D,null,[i("header",null,[p(l)?(y(),V(ce,{key:0,workmaster:p(l),onSubmit:w},null,8,["workmaster"])):T("",!0)]),i("main",ke,[p(l)&&p(l).phases?(y(),V(fe,{key:0,workmaster:p(l),workmasterPhases:p(l).phases,onAdd:g,onEdit:m,onDelete:I},null,8,["workmaster","workmasterPhases"])):T("",!0)])],64))}});const We=te(_e,[["__scopeId","data-v-a7de9030"]]);export{We as default};
