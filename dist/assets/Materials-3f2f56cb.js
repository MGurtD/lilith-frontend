import{a as J,_ as K}from"./DropdownReferenceType.vue_vue_type_script_setup_true_lang-840205b9.js";import{d as B,$ as Q,o as $,a0 as W,V as I,h as A,m as d,w as l,a as f,e as s,i as c,z as X,k as u,P as k,G as S,H as h,R as E,l as g,n as Y,p as Z,b as ee,f as L,g as te,u as re,x as ae,j as oe,r as se,J as ne}from"./index-6eb74133.js";import{u as N}from"./reference-4118162e.js";import{R as M}from"./index-7cbe1881.js";import{u as U}from"./referenceType-0c5d4d4f.js";import{u as le}from"./plantmodel-5f2d7485.js";import{u as ie}from"./tax-0a2cdf4c.js";import"./index-61ff8e2b.js";const D=p=>(Z("data-v-cd302e4c"),p=p(),ee(),p),ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},de={class:"datatable-filter-3"},fe={class:"filter-field"},ue=D(()=>s("label",null,"Categoria",-1)),pe={class:"filter-field"},me=D(()=>s("label",null,"Codi",-1)),ye={class:"filter-field"},_e=D(()=>s("label",null,"Tipus",-1)),he={class:"datatable-buttons"},ge=["onClick"],Te=B({__name:"TableMaterials",props:{references:{},filter:{}},emits:["add","edit","delete"],setup(p,{emit:m}){const r=p,y=Q(),w=U(),R=N(),T=le();$(()=>{const e=y.getFilter("Materials","");e&&(r.filter.code=e.code,r.filter.referenceTypeId=e.referenceTypeId,r.filter.referenceCategory=e.referenceCategory),T.areas||T.fetchAreas()}),W(()=>{y.addFilter("Materials","",r.filter)});const C=()=>{r.filter.code="",r.filter.referenceTypeId=""},_=I(()=>r.references?r.filter.referenceCategory===""?[]:R.references.filter(e=>e.categoryName===r.filter.referenceCategory):[]),V=I(()=>{if(!_.value)return[];let e=_.value;return r.filter.referenceTypeId&&r.filter.referenceTypeId.length>0&&(e=e.filter(t=>t.referenceTypeId===r.filter.referenceTypeId)),r.filter.code.length>0&&(e=e.filter(t=>t.code.toLowerCase().includes(r.filter.code.toLowerCase()))),e}),v=I(()=>r.filter.referenceCategory===M.MATERIAL),F=I(()=>r.filter.referenceCategory===M.TOOL),n=I(()=>r.filter.referenceCategory===M.SERVICE),b=()=>{m("add")},x=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||m("edit",e.data)},P=(e,t)=>{m("delete",t)},j=e=>{const t=w.getReferenceTypeById(e);return t?t.density:0},q=e=>{var i;const t=(i=R.referenceFormats)==null?void 0:i.find(o=>o.id===e);return t?t.description:""},H=e=>{const t=w.getReferenceTypeById(e);return t?t.description:""},z=e=>{var i;const t=(i=T.areas)==null?void 0:i.find(o=>o.id===e);return t?t.name:""};return(e,t)=>{const i=A("Button"),o=A("Column"),O=A("DataTable");return f(),d(O,{value:V.value,tableStyle:"min-width: 100%",class:"p-datatable-sm",scrollable:"",scrollHeight:"80vh",paginator:"",rows:19,onRowClick:x},{header:l(()=>[s("div",ce,[s("div",de,[s("div",fe,[ue,c(J,{label:"",modelValue:e.filter.referenceCategory,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filter.referenceCategory=a)},null,8,["modelValue"])]),s("div",pe,[me,c(X,{modelValue:e.filter.code,"onUpdate:modelValue":t[1]||(t[1]=a=>e.filter.code=a)},null,8,["modelValue"])]),s("div",ye,[_e,c(K,{label:"",modelValue:e.filter.referenceTypeId,"onUpdate:modelValue":t[2]||(t[2]=a=>e.filter.referenceTypeId=a),disabled:e.filter.referenceCategory!==u(M).MATERIAL,onChange:C},null,8,["modelValue","disabled"])])]),s("div",he,[c(i,{class:"datatable-button mr-2",icon:u(k).FILTER_SLASH,rounded:"",raised:"",onClick:C},null,8,["icon"]),c(i,{class:"datatable-button mr-2",icon:u(k).PLUS,rounded:"",raised:"",onClick:b},null,8,["icon"])])])]),default:l(()=>[c(o,{field:"code",header:"Codi",style:{width:"15%"}}),c(o,{field:"description",header:"Descripció",style:{width:"25%"}}),n.value?(f(),d(o,{key:0,header:"Preu",style:{width:"10%"}},{body:l(a=>[S(h(u(E)(a.data.price)),1)]),_:1})):g("",!0),n.value?(f(),d(o,{key:1,header:"Transport",style:{width:"10%"}},{body:l(a=>[S(h(u(E)(a.data.transportAmount)),1)]),_:1})):g("",!0),v.value?(f(),d(o,{key:2,field:"referenceTypeId",header:"Tipus",style:{width:"30%"}},{body:l(a=>[s("span",null,h(H(a.data.referenceTypeId)),1)]),_:1})):g("",!0),v.value?(f(),d(o,{key:3,field:"referenceFormatId",header:"Format",style:{width:"10%"}},{body:l(a=>[s("span",null,h(q(a.data.referenceFormatId)),1)]),_:1})):g("",!0),v.value?(f(),d(o,{key:4,header:"Densitat (mm)",style:{width:"10%"}},{body:l(a=>[S(h(j(a.data.referenceTypeId)),1)]),_:1})):g("",!0),F.value?(f(),d(o,{key:5,header:"Àrea",style:{width:"10%"}},{body:l(a=>[S(h(z(a.data.areaId)),1)]),_:1})):g("",!0),c(o,{style:{width:"10%"}},{body:l(a=>[s("i",{class:Y([u(k).TIMES,"grid_delete_column_button"]),onClick:G=>P(G,a.data)},null,10,ge)]),_:1})]),_:1},8,["value"])}}});const Ce=L(Te,[["__scopeId","data-v-cd302e4c"]]),ve=B({__name:"Materials",setup(p){const m=te(),r=re(),y=N(),w=ie(),R=U(),T=ae(),C=oe(),_=se({code:"",referenceTypeId:"",referenceCategory:""});$(async()=>{let n="Referències de compra";r.setMenuItem({icon:k.TICKET,title:n}),await y.fetchReferencesByModule("purchase"),w.fetchAll(),R.fetchAll()});const V=()=>{m.push({path:`/material/${ne()}/${_.value.referenceCategory}`})},v=n=>{m.push({path:`/material/${n.id}/${_.value.referenceCategory}`})},F=n=>{T.require({message:`Está segur que vol eliminar el material ${n.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const b=await y.deleteReference(n.id);b.result?C.add({severity:"success",summary:"Material eliminat correctament",life:5e3}):C.add({severity:"warn",summary:b.errors[0],life:5e3,closable:!0})}})};return(n,b)=>(f(),d(Ce,{references:u(y).references,filter:_.value,onAdd:V,onEdit:v,onDelete:F},null,8,["references","filter"]))}});const Fe=L(ve,[["__scopeId","data-v-7c74384c"]]);export{Fe as default};
