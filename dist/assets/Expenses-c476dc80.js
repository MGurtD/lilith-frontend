import{d as N,g as U,u as A,E as M,Z as $,j,x as q,r as H,T as G,o as Y,P as m,$ as z,O as k,h as x,m as O,w as c,k as o,a as Q,e as l,i as a,H as y,R as v,G as h,I as W,n as Z,y as J}from"./index-77e4d88f.js";import{u as K}from"./expense-efbc7558.js";import{_ as X}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-ea172d41.js";import"./index-4faf08dc.js";import"./suppliers.service-05c90099.js";const ee={class:"flex flex-wrap align-items-center justify-content-between gap-2"},te={class:"datatable-filter"},se={class:"filter-field"},ae={class:"filter-field"},ne=l("label",{class:"block text-900 mb-2"},"Tipus",-1),oe={class:"datatable-buttons"},ie=["onClick"],re={class:"flex-right"},xe=N({__name:"Expenses",setup(ce){const T=U(),s=A(),f=M(),i=K(),b=$(),w=j(),E=q(),p=H({expenseTypeId:void 0}),g=G(()=>{let e=0;return i.expenses&&i.expenses.forEach(t=>e+=t.amount),e}),I=()=>{const e=b.getFilter("Expenses","");e&&(p.value.expenseTypeId=e.expenseTypeId,e.exercisePicker&&(s.exercisePicker.exercise=e.exercisePicker.exercise,s.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))};Y(async()=>{s.setMenuItem({icon:m.WALLET,title:"Gestió de despeses"}),await i.fetchExpenseTypes(),f.exercises||await f.fetchActive(),P(),I(),_()}),z(()=>{const e={expenseTypeId:p.value.expenseTypeId,exercisePicker:s.exercisePicker};b.addFilter("Expenses","",e)});const _=async()=>{if(s.exercisePicker.dates){const e=k(s.exercisePicker.dates[0]),t=k(s.exercisePicker.dates[1]);await i.fetchExpenses(e,t,p.value.expenseTypeId)}},P=()=>{var r;const e=new Date().getFullYear().toString(),t=(r=f.exercises)==null?void 0:r.find(d=>d.name===e);t&&(s.exercisePicker.exercise=t,s.exercisePicker.dates=[new Date(s.exercisePicker.exercise.startDate),new Date(s.exercisePicker.exercise.endDate)])},C=async()=>{p.value.expenseTypeId="",s.cleanExercisePicker()},D=()=>{T.push({path:`/expense/${J()}`})},S=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||T.push({path:`/expense/${e.data.id}`})},F=(e,t)=>{E.require({target:e.currentTarget,message:"Està segur que vol eliminar la despesa?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await i.deleteExpense(t.id)&&(w.add({severity:"success",summary:"Eliminat",life:3e3}),await _())}})},B=e=>{var r;const t=(r=i.expenseTypes)==null?void 0:r.find(d=>d.id===e);return t?t.name:""};return(e,t)=>{const r=x("Dropdown"),d=x("Button"),u=x("Column"),L=x("BooleanColumn"),R=x("DataTable");return Q(),O(R,{value:o(i).expenses,class:"p-datatable-sm small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",onRowClick:S},{header:c(()=>[l("div",ee,[l("div",te,[l("div",se,[a(X,{exercises:o(f).exercises,onRangeSelected:_},null,8,["exercises"])]),l("div",ae,[ne,a(r,{modelValue:p.value.expenseTypeId,"onUpdate:modelValue":t[0]||(t[0]=n=>p.value.expenseTypeId=n),editable:"",options:o(i).expenseTypes,optionValue:"id",optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])])]),l("div",oe,[a(d,{class:"datatable-button mr-2",icon:o(m).FILTER,rounded:"",raised:"",onClick:_},null,8,["icon"]),a(d,{class:"datatable-button mr-2",icon:o(m).FILTER_SLASH,rounded:"",raised:"",onClick:C},null,8,["icon"]),a(d,{icon:o(m).PLUS,rounded:"",raised:"",onClick:D},null,8,["icon"])])])]),footer:c(()=>[l("div",re," Total "+y(o(v)(g.value)),1)]),default:c(()=>[a(u,{header:"Tipus",style:{width:"15%"}},{body:c(n=>[h(y(B(n.data.expenseTypeId)),1)]),_:1}),a(u,{field:"description",header:"Descripció",style:{width:"40%"},sortable:""}),a(u,{field:"paymentDate",header:"Data pagament",style:{width:"20%"},sortable:""},{body:c(n=>[h(y(o(W)(n.data.paymentDate)),1)]),_:1}),a(u,{field:"amount",header:"Import",style:{width:"15%"}},{body:c(n=>[h(y(o(v)(n.data.amount)),1)]),_:1}),a(u,{header:"Recurrent",style:{width:"10%"}},{body:c(n=>[a(L,{value:n.data.recurring,showColor:!1},null,8,["value"])]),_:1}),a(u,null,{body:c(n=>[l("i",{class:Z([o(m).TIMES,"grid_delete_column_button"]),onClick:V=>F(V,n.data)},null,10,ie)]),_:1})]),_:1},8,["value"])}}});export{xe as default};
