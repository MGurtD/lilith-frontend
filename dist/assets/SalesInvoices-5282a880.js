import{d as L,o as T,h as y,m as j,w as l,a as F,Q as H,i as o,G as h,H as D,k as n,I as P,R as Y,c as V,n as A,P as x,l as G,j as Q,x as z,g as J,u as K,Z,r as B,K as W,$ as X,O as E,L as ee,e as p,J as te}from"./index-d6370003.js";import{u as se}from"./lifecycle-17b09274.js";import{_ as ae}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-1c6877a3.js";import{u as oe}from"./invoice-a3b52cdf.js";import{u as ie}from"./customers-4cbfa719.js";import{u as re}from"./masterData-695403e4.js";import{_ as ce}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-7326b9c8.js";import"./index-d1bcd892.js";import"./form-validator-76860c5e.js";const ne=["onClick"],le=L({__name:"TableInvoices",props:{invoices:{},customers:{}},emits:["edit","delete"],setup(N,{emit:k}){const g=N,m=se();T(async()=>{await m.fetchOneByName("SalesInvoice")});const i=e=>{var a;const s=(a=g.customers)==null?void 0:a.find(d=>d.id===e);return s?s.comercialName:""},w=e=>{var a;const s=(a=m.lifecycle)==null?void 0:a.statuses.find(d=>d.id===e);return s?s.name:""},_=e=>e.salesInvoiceDueDates?e.salesInvoiceDueDates.length===0?P(e.invoiceDate):P(e.salesInvoiceDueDates[e.salesInvoiceDueDates.length-1].dueDate):"",b=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||k("edit",e.data)},f=(e,s)=>{k("delete",s)};return(e,s)=>{const a=y("Column"),d=y("DataTable");return F(),j(d,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",value:e.invoices,paginator:"",rows:12,onRowClick:b},{header:l(()=>[H(e.$slots,"filter")]),default:l(()=>[o(a,{field:"invoiceNumber",header:"Número",sortable:!0,style:{width:"10%"}}),o(a,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"15%"}},{body:l(r=>[h(D(n(P)(r.data.invoiceDate)),1)]),_:1}),o(a,{header:"Client",style:{width:"15%"}},{body:l(r=>[h(D(i(r.data.customerId)),1)]),_:1}),o(a,{header:"Estat",style:{width:"15%"}},{body:l(r=>[h(D(w(r.data.statusId)),1)]),_:1}),o(a,{header:"Venciment",style:{width:"15%"}},{body:l(r=>[h(D(_(r.data)),1)]),_:1}),o(a,{header:"Import",style:{width:"15%"}},{body:l(r=>[h(D(n(Y)(r.data.netAmount)),1)]),_:1}),o(a,{style:{width:"5%"}},{body:l(r=>{var u;return[r.data.statusId===((u=n(m).lifecycle)==null?void 0:u.initialStatusId)?(F(),V("i",{key:0,class:A([n(x).TIMES,"grid_delete_column_button"]),onClick:v=>f(v,r.data)},null,10,ne)):G("",!0)]}),_:1})]),_:3},8,["value"])}}}),de={class:"flex flex-wrap align-items-center justify-content-between gap-1"},ue={class:"datatable-filter"},me={class:"filter-field"},fe={class:"filter-field"},ve=p("label",{class:"block text-900 mb-2"},"Client",-1),pe={class:"datatable-buttons"},Se=L({__name:"SalesInvoices",setup(N){const k=Q(),g=z(),m=J(),i=K(),w=Z(),_=re(),b=ie(),f=oe(),e=B({customerId:void 0}),s=W({visible:!1,title:"Crear factura",closable:!0,position:"center",modal:!0});T(async()=>{b.fetchCustomers(),await _.fetchMasterData(),r(),a(),await u(),i.setMenuItem({icon:x.MONEY_BILL,title:"Factures de venta"})}),X(()=>{const t={customerId:e.value.customerId,exercisePicker:i.exercisePicker};w.addFilter("SalesInvoices","",t)});const a=()=>{const t=w.getFilter("SalesInvoices","");t&&(e.value.customerId=t.customerId,t.exercisePicker&&(i.exercisePicker.exercise=t.exercisePicker.exercise,i.exercisePicker.dates=[new Date(t.exercisePicker.dates[0]),new Date(t.exercisePicker.dates[1])]))},d=()=>{i.cleanExercisePicker(),e.value.customerId=void 0},r=()=>{var S;const t=new Date().getFullYear().toString(),c=(S=_.exercises)==null?void 0:S.find(I=>I.name===t);c&&(i.exercisePicker.exercise=c,i.exercisePicker.dates=[new Date(i.exercisePicker.exercise.startDate),new Date(i.exercisePicker.exercise.endDate)])},u=async()=>{let t="",c="";i.exercisePicker.dates&&(t=E(i.exercisePicker.dates[0]),c=E(i.exercisePicker.dates[1])),await f.GetFiltered(t,c,void 0,void 0,e.value.customerId)},v=B({}),R=()=>({id:te(),customerId:"",exerciseId:"",date:new Date}),$=()=>{v.value=R(),s.visible=!0},q=async()=>{await f.Create(v.value)&&m.push({path:`/sales-invoice/${v.value.id}`})},U=t=>{m.push({path:`/sales-invoice/${t.id}`})},M=t=>{g.require({message:"Està segur que vol eliminar la factura?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await f.Delete(t.id)&&(k.add({severity:"success",summary:"Eliminada",life:3e3}),await u())}})};return(t,c)=>{const S=y("Dropdown"),I=y("Button"),O=y("Dialog");return F(),V(ee,null,[o(le,{invoices:n(f).invoices,customers:n(b).customers,onEdit:U,onDelete:M},{filter:l(()=>[p("div",de,[p("div",ue,[p("div",me,[o(ae,{exercises:n(_).exercises,onRangeSelected:u},null,8,["exercises"])]),p("div",fe,[ve,o(S,{modelValue:e.value.customerId,"onUpdate:modelValue":c[0]||(c[0]=C=>e.value.customerId=C),editable:"",options:n(b).customers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),p("div",pe,[o(I,{class:"datatable-button mr-2",icon:n(x).FILTER,rounded:"",raised:"",onClick:u},null,8,["icon"]),o(I,{class:"datatable-button mr-2",icon:n(x).FILTER_SLASH,rounded:"",raised:"",onClick:d},null,8,["icon"]),o(I,{icon:n(x).PLUS,rounded:"",raised:"",onClick:$},null,8,["icon"])])])]),_:1},8,["invoices","customers"]),o(O,{visible:s.visible,"onUpdate:visible":c[1]||(c[1]=C=>s.visible=C),header:s.title,closable:s.closable,modal:s.modal},{default:l(()=>[o(ce,{"create-request":v.value,onSubmit:q},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Se as default};
