import{_ as $}from"./DropdownReferenceType.vue_vue_type_script_setup_true_lang-514d04ce.js";import{d as S,X as A,o as R,Y as j,r as q,R as H,h,m as M,w as c,a as x,e as r,i as o,z as P,k as v,P as T,H as C,G as z,n as G,p as J,b as K,f as B,g as X,u as Y,x as O,j as Q,J as W}from"./index-abfce291.js";import{u as D}from"./reference-cfffd00c.js";import{u as F}from"./referenceType-86104188.js";import{u as Z}from"./tax-aa602bc0.js";const k=i=>(J("data-v-bf507f79"),i=i(),K(),i),ee={class:"flex flex-wrap align-items-center justify-content-between gap-2"},te={class:"datatable-filter"},se={class:"filter-field"},ae=k(()=>r("label",null,"Codi",-1)),oe={class:"filter-field"},re=k(()=>r("label",null,"Tipus",-1)),ne={class:"datatable-buttons"},le=["onClick"],ce=S({__name:"TableMaterials",props:{references:{}},emits:["add","edit","delete"],setup(i,{emit:d}){const _=i,u=A(),m=F(),b=D();R(()=>{const e=u.getFilter("Materials","");e&&(s.value.code=e.code,s.value.referenceTypeId=e.referenceTypeId)}),j(()=>{u.addFilter("Materials","",s.value)});const s=q({code:"",referenceTypeId:""}),y=()=>{s.value.code="",s.value.referenceTypeId=""},I=H(()=>{if(!_.references)return[];let e=_.references;return s.value.referenceTypeId.length>0&&(e=e.filter(t=>t.referenceTypeId===s.value.referenceTypeId)),s.value.code.length>0&&(e=e.filter(t=>t.code.toLowerCase().includes(s.value.code.toLowerCase()))),e}),g=()=>{d("add")},w=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||d("edit",e.data)},n=(e,t)=>{d("delete",t)},f=e=>{const t=m.getReferenceTypeById(e);return t?t.density:0},V=e=>{var p;const t=(p=b.referenceFormats)==null?void 0:p.find(l=>l.id===e);return t?t.description:""},E=e=>{const t=m.getReferenceTypeById(e);return t?t.description:""};return(e,t)=>{const p=h("Button"),l=h("Column"),U=h("BooleanColumn"),L=h("DataTable");return x(),M(L,{value:I.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:w},{header:c(()=>[r("div",ee,[r("div",te,[r("div",se,[ae,o(P,{modelValue:s.value.code,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value.code=a)},null,8,["modelValue"])]),r("div",oe,[re,o($,{label:"",modelValue:s.value.referenceTypeId,"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.referenceTypeId=a)},null,8,["modelValue"])])]),r("div",ne,[o(p,{class:"datatable-button mr-2",icon:v(T).FILTER_SLASH,rounded:"",raised:"",onClick:y},null,8,["icon"]),o(p,{class:"datatable-button mr-2",icon:v(T).PLUS,rounded:"",raised:"",onClick:g},null,8,["icon"])])])]),default:c(()=>[o(l,{field:"code",header:"Codi",style:{width:"15%"}}),o(l,{field:"description",header:"Descripció",style:{width:"25%"}}),o(l,{field:"referenceTypeId",header:"Tipus",style:{width:"30%"}},{body:c(a=>[r("span",null,C(E(a.data.referenceTypeId)),1)]),_:1}),o(l,{header:"Densitat (mm)",style:{width:"10%"}},{body:c(a=>[z(C(f(a.data.referenceTypeId)),1)]),_:1}),o(l,{field:"referenceFormatId",header:"Format",style:{width:"10%"}},{body:c(a=>[r("span",null,C(V(a.data.referenceFormatId)),1)]),_:1}),o(l,{header:"Desc.",style:{width:"10%"}},{body:c(a=>[o(U,{value:a.data.disabled},null,8,["value"])]),_:1}),o(l,{style:{width:"10%"}},{body:c(a=>[r("i",{class:G([v(T).TIMES,"grid_delete_column_button"]),onClick:N=>n(N,a.data)},null,10,le)]),_:1})]),_:1},8,["value"])}}});const ie=B(ce,[["__scopeId","data-v-bf507f79"]]),de=S({__name:"Materials",setup(i){const d=X(),_=Y(),u=D(),m=Z(),b=F(),s=O(),y=Q();R(async()=>{let n="Materials de compra";_.setMenuItem({icon:T.TICKET,title:n}),await u.fetchReferencesByModule("purchase"),m.fetchAll(),b.fetchAll()});const I=()=>{d.push({path:`/material/${W()}`})},g=n=>{d.push({path:`/material/${n.id}`})},w=n=>{s.require({message:`Está segur que vol eliminar el material ${n.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const f=await u.deleteReference(n.id);f.result?y.add({severity:"success",summary:"Material eliminat correctament",life:5e3}):y.add({severity:"warn",summary:f.errors[0],life:5e3,closable:!0})}})};return(n,f)=>(x(),M(ie,{references:v(u).references,onAdd:I,onEdit:g,onDelete:w},null,8,["references"]))}});const ye=B(de,[["__scopeId","data-v-366c5f01"]]);export{ye as default};
