import{_ as F}from"./DropdownReference.vue_vue_type_script_setup_true_lang-1ea4bd71.js";import{c as T,d as y,F as A}from"./form-validator-f8953ae6.js";import{d as g,h as k,a as v,c as V,D as R,l as w,i,w as Q,k as s,Q as L,j as P,K as Y,r as W,e as o,s as m,n as f,F as j}from"./index-ffbfd559.js";import{u as B}from"./reference-696ceffd.js";import{u as E}from"./workmaster-e9b185bd.js";const O={class:"mb-2"},z={key:0,class:"block text-900 mb-2"},K={key:0,class:"flex align-items-center"},X=g({__name:"DropdownWorkmasters",props:{label:{},modelValue:{},referenceId:{}},emits:["update:modelValue"],setup(U,{emit:C}){const e=B(),c=E();return(r,b)=>{const I=k("Dropdown");return v(),V("div",O,[r.label.length>0?(v(),V("label",z,R(r.label),1)):w("",!0),i(I,L({showClear:"",filter:"",options:r.referenceId?s(c).getByReferenceId(r.referenceId):s(c).workmasters,optionValue:"id",optionLabel:n=>s(e).getShortNameById(n.referenceId)+" (Base = "+n.baseQuantity+")",class:"w-full"},r.$attrs,{"model-value":r.modelValue,onChange:b[0]||(b[0]=n=>C("update:modelValue",n.value))}),{option:Q(n=>[n.option?(v(),V("div",K,R(s(e).getShortNameById(n.option.referenceId)+" (Base = "+n.option.baseQuantity+" )"),1)):w("",!0)]),_:1},16,["options","optionLabel","model-value"])])}}}),G={key:0},H={class:"two-columns-7525"},J={class:"mb-2"},Z={class:"three-columns"},h={class:"mb-2"},_={class:"four-columns"},oe=g({__name:"FormBudgetOrderDetail",props:{formAction:{},header:{},detail:{}},emits:["submit"],setup(U,{emit:C}){const e=U,c=E(),r=B(),b=P(),I=Y(()=>e.formAction===j.CREATE?"Afegir":"Modificar"),n=()=>{const t=r.references.find(l=>l.id===e.detail.referenceId);t?(e.detail.description=t.description,e.detail.unitPrice=t.price,e.detail.workMasterId=null,e.detail.unitCost=t.lastCost,p()):(e.detail.description="",e.detail.unitPrice=0,e.detail.workMasterId=null,e.detail.unitCost=0,e.detail.totalCost=0,e.detail.amount=0)},q=async()=>{if(e.detail.workMasterId){const t=await c.calculate(e.detail.workMasterId,e.detail.quantity);e.detail.unitCost=t.content/e.detail.quantity,e.detail.totalCost=t.content,p()}else n()},$=()=>{e.detail.workMasterId&&(e.detail.totalCost=e.detail.unitCost*e.detail.quantity),p()},p=()=>{e.detail.profit>0?e.detail.amount=e.detail.unitCost*e.detail.quantity*(1+e.detail.profit/100):e.detail.amount=e.detail.unitCost*e.detail.quantity,e.detail.discount>0&&(e.detail.amount=e.detail.amount*(1-e.detail.discount/100))},M=T().shape({quantity:y().required("La quantitat és obligatoria").min(1,"La quantitat ha de ser un número positiu"),amount:y().required("El total és obligatori").min(1,"El total ha de ser un número positiu"),profit:y().required("El benefici és obligatori"),discount:y().required("El descompte és obligatori")}),u=W({result:!1,errors:{}}),N=()=>{const t=new A(M);u.value=t.validate(e.detail)},S=async()=>{if(N(),u.value.result)C("submit",e.detail);else{let t="";Object.entries(u.value.errors).forEach(l=>{t+=`${l[1].map(d=>d)}.   `}),b.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,l)=>{const d=k("BaseInput"),D=k("Button");return t.detail?(v(),V("form",G,[o("section",H,[o("div",J,[i(F,{label:"Referència",modelValue:t.detail.referenceId,"onUpdate:modelValue":[l[0]||(l[0]=a=>t.detail.referenceId=a),l[1]||(l[1]=a=>n())],customerId:t.header.customerId,fullName:!0},null,8,["modelValue","customerId"])]),o("div",null,[i(d,{class:"mb-2",label:"Preu Unitari",modelValue:t.detail.unitPrice,"onUpdate:modelValue":l[2]||(l[2]=a=>t.detail.unitPrice=a),type:s(m).CURRENCY,disabled:""},null,8,["modelValue","type"])])]),o("section",Z,[o("div",h,[i(X,{label:"Ruta de fabricació",modelValue:t.detail.workMasterId,"onUpdate:modelValue":[l[3]||(l[3]=a=>t.detail.workMasterId=a),l[4]||(l[4]=a=>q())],referenceId:t.detail.referenceId},null,8,["modelValue","referenceId"])]),o("div",null,[i(d,{class:"mb-2",label:"Cost Unitari",modelValue:t.detail.unitCost,"onUpdate:modelValue":l[5]||(l[5]=a=>t.detail.unitCost=a),type:s(m).CURRENCY,disabled:""},null,8,["modelValue","type"])]),o("div",null,[i(d,{class:"mb-2",label:"Cost Total",modelValue:t.detail.totalCost,"onUpdate:modelValue":l[6]||(l[6]=a=>t.detail.totalCost=a),type:s(m).CURRENCY,disabled:""},null,8,["modelValue","type"])])]),o("section",_,[o("div",null,[i(d,{class:f(["mb-2",{"p-invalid":u.value.errors.quantity}]),label:"Quantitat",modelValue:t.detail.quantity,"onUpdate:modelValue":[l[7]||(l[7]=a=>t.detail.quantity=a),l[8]||(l[8]=a=>$())],type:s(m).NUMERIC},null,8,["modelValue","type","class"])]),o("div",null,[i(d,{class:f(["mb-2",{"p-invalid":u.value.errors.profit}]),label:"% Benefici",modelValue:t.detail.profit,"onUpdate:modelValue":[l[9]||(l[9]=a=>t.detail.profit=a),l[10]||(l[10]=a=>p())],type:s(m).NUMERIC},null,8,["modelValue","type","class"])]),o("div",null,[i(d,{class:f(["mb-2",{"p-invalid":u.value.errors.discount}]),label:"% Descompte",modelValue:t.detail.discount,"onUpdate:modelValue":[l[11]||(l[11]=a=>t.detail.discount=a),l[12]||(l[12]=a=>p())],type:s(m).NUMERIC},null,8,["modelValue","type","class"])]),o("div",null,[i(d,{class:f(["mb-2",{"p-invalid":u.value.errors.amount}]),label:"Total",modelValue:t.detail.amount,"onUpdate:modelValue":l[13]||(l[13]=a=>t.detail.amount=a),type:s(m).CURRENCY},null,8,["modelValue","type","class"])])]),o("section",null,[o("div",null,[i(d,{class:f(["mb-2",{"p-invalid":u.value.errors.description}]),label:"Descripció",modelValue:t.detail.description,"onUpdate:modelValue":l[14]||(l[14]=a=>t.detail.description=a),type:s(m).TEXT},null,8,["modelValue","type","class"])])]),i(D,{label:I.value,onClick:S,style:{float:"right"}},null,8,["label"])])):w("",!0)}}});export{oe as _};
