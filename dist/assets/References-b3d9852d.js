import{d as k,r as M,o as x,Y as U,K as $,h,m as B,w as c,a as T,e as l,i as a,y as P,k as u,P as b,D as I,C as w,n as j,p as q,b as K,f as V,g as A,u as F,x as H,j as J}from"./index-8f350042.js";import{u as O}from"./reference-a84866df.js";import{_ as z}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-f90cc9a7.js";import{u as Y}from"./customers-df5c0a64.js";import{d as S,g as G}from"./functions-2e154ea4.js";import"./reference.service-7e50bcf5.js";import"./base.service-642755fa.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";const D=d=>(q("data-v-dd1b5e50"),d=d(),K(),d),Q={class:"flex flex-wrap align-items-center justify-content-between gap-2"},W={class:"datatable-filter"},X={class:"filter-field"},Z=D(()=>l("label",null,"Codi",-1)),ee={class:"filter-field"},te=D(()=>l("label",null,"Client",-1)),se={class:"datatable-buttons"},oe=["onClick"],R="temges.filters.references",ae=k({__name:"TableReferences",props:{references:{}},emits:["add","edit","delete"],setup(d,{emit:i}){const p=d,f=Y(),e=M({code:"",customerId:""});x(()=>{const t=localStorage.getItem(R);t&&(e.value=JSON.parse(t))}),U(()=>{localStorage.setItem(R,JSON.stringify(e.value))});const v=()=>{e.value.code="",e.value.customerId=""},y=$(()=>{if(!p.references)return[];let t=p.references;return e.value.customerId&&e.value.customerId.length>0&&(t=t.filter(s=>s.customerId===e.value.customerId)),e.value.code&&e.value.code.length>0&&(t=t.filter(s=>s.code.toLowerCase().includes(e.value.code.toLowerCase()))),t}),C=()=>{i("add")},g=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||i("edit",t.data)},r=(t,s)=>{i("delete",s)},m=t=>{var _;const s=(_=f.customers)==null?void 0:_.find(n=>n.id===t);return s?s.comercialName:""};return(t,s)=>{const _=h("Button"),n=h("Column"),N=h("BooleanColumn"),L=h("DataTable");return T(),B(L,{value:y.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:g},{header:c(()=>[l("div",Q,[l("div",W,[l("div",X,[Z,a(P,{modelValue:e.value.code,"onUpdate:modelValue":s[0]||(s[0]=o=>e.value.code=o)},null,8,["modelValue"])]),l("div",ee,[te,a(z,{label:"",modelValue:e.value.customerId,"onUpdate:modelValue":s[1]||(s[1]=o=>e.value.customerId=o)},null,8,["modelValue"])])]),l("div",se,[a(_,{class:"datatable-button mr-2",icon:u(b).FILTER_SLASH,rounded:"",raised:"",onClick:v},null,8,["icon"]),a(_,{class:"datatable-button mr-2",icon:u(b).PLUS,rounded:"",raised:"",onClick:C},null,8,["icon"])])])]),default:c(()=>[a(n,{field:"code",header:"Codi",style:{width:"15%"}}),a(n,{field:"description",header:"Descripció",style:{width:"35%"}}),a(n,{field:"version",header:"Versió",style:{width:"10%"}}),a(n,{field:"customerId",header:"Client",style:{width:"20%"}},{body:c(o=>[l("span",null,I(m(o.data.customerId)),1)]),_:1}),a(n,{field:"price",header:"Preu",style:{width:"10%"}},{body:c(o=>[w(I(u(S)(o.data.price)),1)]),_:1}),a(n,{field:"cost",header:"Cost",style:{width:"10%"}},{body:c(o=>[w(I(u(S)(o.data.workMasterCost)),1)]),_:1}),a(n,{header:"Servei",style:{width:"10%"}},{body:c(o=>[a(N,{value:o.data.isService},null,8,["value"])]),_:1}),a(n,{style:{width:"10%"}},{body:c(o=>[l("i",{class:j([u(b).TIMES,"grid_delete_column_button"]),onClick:E=>r(E,o.data)},null,10,oe)]),_:1})]),_:1},8,["value"])}}});const ne=V(ae,[["__scopeId","data-v-dd1b5e50"]]),re=k({__name:"References",setup(d){const i=A(),p=F(),f=O(),e=H(),v=J();x(async()=>{let r="Referencies de venta";p.setMenuItem({icon:b.TICKET,title:r}),await f.fetchReferencesByModule("sales")});const y=()=>{i.push({path:`/sales/reference/${G()}`})},C=r=>{i.push({path:`/sales/reference/${r.id}`})},g=r=>{e.require({message:`Está segur que vol eliminar la refèrencia ${r.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const m=await f.deleteReference(r.id);m.result?v.add({severity:"success",summary:"Referencia eliminada correctament",life:5e3}):v.add({severity:"warn",summary:m.errors[0],life:5e3,closable:!0})}})};return(r,m)=>(T(),B(ne,{references:u(f).references,onAdd:y,onEdit:C,onDelete:g},null,8,["references"]))}});const ve=V(re,[["__scopeId","data-v-88f67bcf"]]);export{ve as default};
