import{_ as A}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-9cdb8c27.js";import{_ as G}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-3af0fbbc.js";import{_ as z}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-0f36646d.js";import{_ as J}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-49b6258b.js";import{d as K,g as Q,j as X,x as W,u as Z,X as ee,r as D,K as te,o as se,P as f,Y as ae,O as P,h as p,c as F,i as s,w as u,k as c,L as re,a as N,e as n,G as I,H as S,I as O,n as ie,l as oe,J as le}from"./index-0165ef2a.js";import{u as ce}from"./order-33dbdef2.js";import{u as ne}from"./reference-3a204a36.js";import{u as de}from"./customers-7ea2bdbb.js";import{u as ue}from"./lifecycle-491d1308.js";import{u as me}from"./masterData-6d455d54.js";import"./form-validator-29ed56b4.js";import"./index-cc513c2f.js";const fe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},_e={class:"datatable-filter-3"},ve={class:"filter-field"},pe={class:"filter-field"},be=n("label",{class:"block text-900"},"Client",-1),xe={class:"filter-field"},he=n("label",{class:"block text-900"},"Estat",-1),Ie={class:"datatable-buttons"},Se=["onClick"],Te=K({__name:"SalesOrders",setup(ye){const y=Q(),k=X(),E=W(),o=Z(),w=ee(),b=me(),_=ce(),R=ne(),V=de(),x=ue(),r=D({customerId:void 0,statusId:void 0}),d=te({visible:!1,title:"Crear comanda",closable:!0,position:"center",modal:!0});se(async()=>{x.fetchOneByName("SalesOrder"),R.fetchReferences(),V.fetchCustomers(),await b.fetchMasterData(),g(),T(),await m(),o.setMenuItem({icon:f.APPLE,title:"Comandes"})}),ae(()=>{const e={statusId:r.value.statusId,customerId:r.value.customerId,exercisePicker:o.exercisePicker};w.addFilter("SalesOrders","",e)});const T=()=>{const e=w.getFilter("SalesOrders","");e&&(r.value.statusId=e.statusId,r.value.customerId=e.customerId,e.exercisePicker&&(o.exercisePicker.exercise=e.exercisePicker.exercise,o.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},g=()=>{var l;const e=new Date().getFullYear().toString(),t=(l=b.exercises)==null?void 0:l.find(i=>i.name===e);t&&(o.exercisePicker.exercise=t,o.exercisePicker.dates=[new Date(o.exercisePicker.exercise.startDate),new Date(o.exercisePicker.exercise.endDate)])},B=()=>{r.value.customerId=void 0,r.value.statusId=void 0,g(),m()},v=D({}),U=()=>({id:le(),customerId:"",exerciseId:"",date:new Date}),q=()=>{v.value=U(),d.visible=!0},m=async()=>{if(o.exercisePicker.dates){const e=P(o.exercisePicker.dates[0]),t=P(o.exercisePicker.dates[1]);await _.GetFiltered(e,t,r.value.customerId,r.value.statusId)}else k.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},L=e=>{var l,i;const t=(i=(l=x.lifecycle)==null?void 0:l.statuses)==null?void 0:i.find(h=>h.id===e);return t?t.name:""},$=async()=>{d.visible=!1,await _.Create(v.value)&&y.push({path:`/salesorder/${v.value.id}`})},M=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||y.push({path:`/salesorder/${e.data.id}`})},j=(e,t)=>{E.require({message:"Està segur que vol eliminar la comanda?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await _.Delete(t.id)&&(k.add({severity:"success",summary:"Eliminada",life:3e3}),await m())}})};return(e,t)=>{const l=p("Button"),i=p("Column"),h=p("DataTable"),H=p("Dialog");return N(),F(re,null,[s(h,{value:c(_).salesOrders,class:"small-datatable",tableStyle:"min-width: 100%","sort-field":"salesOrderNumber","sort-mode":"single","sort-order":1,scrollable:"",scrollHeight:"80vh",onRowClick:M},{header:u(()=>[n("div",fe,[n("div",_e,[n("div",ve,[s(A,{exercises:c(b).exercises,onRangeSelected:m},null,8,["exercises"])]),n("div",pe,[be,s(z,{label:"",modelValue:r.value.customerId,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value.customerId=a)},null,8,["modelValue"])]),n("div",xe,[he,s(J,{label:"",modelValue:r.value.statusId,"onUpdate:modelValue":t[1]||(t[1]=a=>r.value.statusId=a)},null,8,["modelValue"])])]),n("div",Ie,[s(l,{class:"datatable-button mr-2",icon:c(f).FILTER,rounded:"",raised:"",onClick:m},null,8,["icon"]),s(l,{class:"datatable-button mr-2",icon:c(f).FILTER_SLASH,rounded:"",raised:"",onClick:B},null,8,["icon"]),s(l,{icon:c(f).PLUS,rounded:"",raised:"",onClick:q},null,8,["icon"])])])]),default:u(()=>[s(i,{field:"number",header:"Número",sortable:"",style:{width:"10%"}}),s(i,{field:"date",header:"Data",style:{width:"10%"},sortable:""},{body:u(a=>[I(S(c(O)(a.data.date)),1)]),_:1}),s(i,{field:"expectedDate",header:"Data Entrega",style:{width:"10%"},sortable:""},{body:u(a=>[I(S(a.data.expectedDate?c(O)(a.data.expectedDate):""),1)]),_:1}),s(i,{field:"customerComercialName",header:"Client",style:{width:"30%"}}),s(i,{field:"customerNumber",header:"Comanda client",style:{width:"15%"}}),s(i,{header:"Estat",style:{width:"20%"}},{body:u(a=>[I(S(L(a.data.statusId)),1)]),_:1}),s(i,{style:{width:"5%"}},{body:u(a=>{var C;return[a.data.statusId===((C=c(x).lifecycle)==null?void 0:C.initialStatusId)?(N(),F("i",{key:0,class:ie([c(f).TIMES,"grid_delete_column_button"]),onClick:Y=>j(Y,a.data)},null,10,Se)):oe("",!0)]}),_:1})]),_:1},8,["value"]),s(H,{visible:d.visible,"onUpdate:visible":t[2]||(t[2]=a=>d.visible=a),header:d.title,closable:d.closable,modal:d.modal},{default:u(()=>[s(G,{"create-request":v.value,onSubmit:$},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Te as default};
