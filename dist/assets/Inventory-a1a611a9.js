import{N as F,d as C,j as N,r as D,h as I,a as _,c as T,e as s,i as n,n as $,k as r,s as y,z as c,l as L,u as P,o as A,P as Q,y as z,w as f,L as j,G as U,H as G,J as S}from"./index-8de45480.js";import{u as O}from"./stock-a2c476c9.js";import{u as E}from"./reference-d2534f01.js";import{u as H}from"./stockMovement-9ede54b7.js";import{_ as J}from"./DropdownReference.vue_vue_type_script_setup_true_lang-bb91400c.js";import{c as X,d as K,a as W,F as Y}from"./form-validator-58fc86c6.js";import"./index-4fb10613.js";const Z=F({id:"inventory",state:()=>({inventory:void 0,inventories:void 0}),getters:{},actions:{setNewInventory(g){this.inventory={id:g,stockId:"",movementType:"",locationId:"",referenceId:"",oldQuantity:0,newQuantity:0,width:0,length:0,height:0,diameter:0,thickness:0,movementDate:new Date}}}}),x={key:0},ee={class:"three-columns"},te={class:"three-columns"},ne={class:"mt-2"},ae={class:"mt-2"},oe={class:"mt-2"},ie=C({__name:"FormInventoryNewMovements",props:{newMovement:{}},emits:["submit","cancel"],setup(g,{emit:k}){const p=g,M=N();E();const m=X().shape({newQuantity:K().min(1).required("La quantitat ha de ser superior a 1"),referenceId:W().required("La referencia és obligatoria")}),v=D({result:!1,errors:{}}),V=()=>{const t=new Y(m);v.value=t.validate(p.newMovement)},b=async()=>{if(V(),v.value.result)k("submit",p.newMovement);else{let t="";Object.entries(v.value.errors).forEach(o=>{t+=`${o[1].map(w=>w)}.   `}),M.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,o)=>{const w=I("Button");return t.newMovement?(_(),T("form",x,[s("div",null,[n(J,{label:"Material",fullName:!0,modelValue:t.newMovement.referenceId,"onUpdate:modelValue":o[0]||(o[0]=i=>t.newMovement.referenceId=i),class:$({"p-invalid":v.value.errors.referenceId})},null,8,["modelValue","class"])]),s("section",ee,[s("div",null,[n(c,{type:r(y).NUMERIC,label:"Quantitat",modelValue:t.newMovement.newQuantity,"onUpdate:modelValue":o[1]||(o[1]=i=>t.newMovement.newQuantity=i)},null,8,["type","modelValue"])]),s("div",null,[n(c,{type:r(y).NUMERIC,label:"Amplada (mm)",decimals:2,modelValue:t.newMovement.width,"onUpdate:modelValue":o[2]||(o[2]=i=>t.newMovement.width=i)},null,8,["type","modelValue"])]),s("div",null,[n(c,{type:r(y).NUMERIC,decimals:2,label:"Alçada (mm)",modelValue:t.newMovement.height,"onUpdate:modelValue":o[3]||(o[3]=i=>t.newMovement.height=i)},null,8,["type","modelValue"])])]),s("section",te,[s("div",ne,[n(c,{type:r(y).NUMERIC,decimals:2,label:"Longitud (mm)",modelValue:t.newMovement.length,"onUpdate:modelValue":o[4]||(o[4]=i=>t.newMovement.length=i)},null,8,["type","modelValue"])]),s("div",ae,[n(c,{type:r(y).NUMERIC,decimals:2,label:"Diàmetre (mm)",modelValue:t.newMovement.diameter,"onUpdate:modelValue":o[5]||(o[5]=i=>t.newMovement.diameter=i)},null,8,["type","modelValue"])]),s("div",oe,[n(c,{type:r(y).NUMERIC,decimals:2,label:"Gruix (mm)",modelValue:t.newMovement.thickness,"onUpdate:modelValue":o[6]||(o[6]=i=>t.newMovement.thickness=i)},null,8,["type","modelValue"])])]),n(w,{label:"Crear",onClick:b,style:{float:"right"},size:"small",class:"mt-2"})])):L("",!0)}}}),le={class:"flex flex-wrap align-items-center justify-content-between gap-2"},se=s("span",{class:"text-xl text-900 font-bold"},"Inventari",-1),ye=C({__name:"Inventory",setup(g){const k=P(),p=O(),M=E(),m=Z(),v=H(),V=N();A(async()=>{k.setMenuItem({icon:Q.BOX,title:"Inventari"}),await b()});const b=async()=>{var d;await p.fetchStocks(),m.inventories=[],(d=p.stocks)==null||d.forEach(a=>{var l;let u={id:z(),stockId:a.id,movementType:"bal",locationId:a.locationId,referenceId:a.referenceId,oldQuantity:a.quantity,newQuantity:a.quantity,width:a.width,length:a.length,height:a.height,diameter:a.diameter,thickness:a.thickness,movementDate:new Date};(l=m.inventories)==null||l.push(u)}),await M.fetchReferences()},t=D(!1),o=D({}),w=d=>{var a;(a=m.inventories)==null||a.push(d),t.value=!1},i=()=>{t.value=!0,o.value={id:S(),stockId:S(),movementType:"",locationId:"3fa85f64-5717-4562-b3fc-2c963f66afa6",referenceId:"",oldQuantity:0,newQuantity:0,width:0,length:0,height:0,diameter:0,thickness:0,movementDate:new Date}},B=async()=>{var l;let d={id:"",stockId:"",movementType:"",locationId:"",referenceId:"",quantity:0,width:0,length:0,height:0,diameter:0,thickness:0,movementDate:new Date,description:""},a=[];(l=m.inventories)==null||l.filter(e=>e.newQuantity!=e.oldQuantity).forEach(async e=>{e.newQuantity<e.oldQuantity?d={id:e.id,stockId:e.stockId,movementType:"OUTPUT",locationId:e.locationId,referenceId:e.referenceId,quantity:e.newQuantity-e.oldQuantity,width:e.width,length:e.length,height:e.height,diameter:e.diameter,thickness:e.thickness,movementDate:e.movementDate,description:"Sortida per inventari"}:e.newQuantity>e.oldQuantity&&(d={id:e.id,stockId:e.stockId,movementType:"INPUT",locationId:e.locationId,referenceId:e.referenceId,quantity:e.newQuantity-e.oldQuantity,width:e.width,length:e.length,height:e.height,diameter:e.diameter,thickness:e.thickness,movementDate:e.movementDate,description:"Entrada per inventari"}),a.push(v.Create(d))});const u=await Promise.all(a);console.log(u),u.filter(e=>e===!0).length===a.length?(V.add({severity:"success",summary:"Inventari creat correctament",life:5e3}),b()):V.add({severity:"error",summary:"Error al crear el moviment d'inventari",life:5e3})};return(d,a)=>{const u=I("Button"),l=I("Column"),e=I("DataTable"),R=I("Dialog");return _(),T(j,null,[n(e,{value:r(m).inventories,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh"},{header:f(()=>[s("div",le,[se,s("div",null,[n(u,{icon:r(Q).PLUS,rounded:"",raised:"",onClick:i},null,8,["icon"]),U("   "),n(u,{icon:r(Q).SAVE,rounded:"",raised:"",onClick:B},null,8,["icon"])])])]),default:f(()=>[n(l,{header:"Producte",style:{width:"28%"}},{body:f(h=>[U(G(r(M).getFullNameById(h.data.referenceId)),1)]),_:1}),n(l,{field:"oldQuantity",header:"Uds.",style:{width:"12%"}}),n(l,{header:"Recompte",style:{width:"12%"}},{body:f(h=>[n(c,{class:"mb-2",label:"",id:"newQuantity",modelValue:h.data.newQuantity,"onUpdate:modelValue":q=>h.data.newQuantity=q},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(l,{field:"width",header:"Ample (x) mm",style:{width:"12%"}}),n(l,{field:"length",header:"Llarg (y) mm",style:{width:"12%"}}),n(l,{field:"height",header:"Alt (z) mm",style:{width:"12%"}}),n(l,{field:"diameter",header:"Diàmetre mm",style:{width:"12%"}}),n(l,{field:"thickness",header:"Gruix mm",style:{width:"12%"}})]),_:1},8,["value"]),n(R,{closable:!0,visible:t.value,"onUpdate:visible":a[0]||(a[0]=h=>t.value=h),modal:!0},{default:f(()=>[n(ie,{newMovement:o.value,onSubmit:w},null,8,["newMovement"])]),_:1},8,["visible"])],64)}}});export{ye as default};
