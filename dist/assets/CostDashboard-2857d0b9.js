import{N as V,d as G,h as u,a as M,m as I,w as h,i as t,e as F,H as T,u as L,E as W,r as y,o as H,P as x,c as J,k as P,L as Y,O as g,p as $,b as j,f as Q}from"./index-37657aa9.js";import{P as A,d as R}from"./index-6b178846.js";import{u as U}from"./plantmodel-5fef3088.js";import{_ as q}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-6e820354.js";const z=V({id:"productionCostDashboard",state:()=>({productionCostDashboardGrouped:void 0}),getters:{},actions:{async fetchGroupedByType(a,o){this.productionCostDashboardGrouped=await A.ProductionCostDashboardService.GetGroupedByMonthAndWorkcenterType(a,o)},async fetchGroupedByWorkcenter(a,o){this.productionCostDashboardGrouped=await A.ProductionCostDashboardService.GetGroupedByMonthAndWorkcenterType(a,o)},async fetchGroupedByOperator(a,o){this.productionCostDashboardGrouped=await A.ProductionCostDashboardService.GroupedByMonthAndOperator(a,o)}}}),K=G({__name:"TableProductionCosts",props:{costs:{}},setup(a){const o=a,B=p=>p.toFixed(2);return(p,f)=>{const i=u("Column"),n=u("DataTable");return M(),I(n,{value:o.costs,tableStyle:"min-width: 100%",paginator:"",rows:18,class:"p-datatable-sm",sortMode:"multiple"},{default:h(()=>[t(i,{field:"year",header:"Any"}),t(i,{field:"month",header:"Mes",sortable:""}),t(i,{field:"workcenterName",header:"Centre de treball",sortable:""}),t(i,{field:"workcenterTypeName",header:"Tipus de centre",sortable:""}),t(i,{field:"operatorName",header:"Operari",sortable:""}),t(i,{field:"totalTime",header:"Temps mensual"},{body:h(b=>[F("span",null,T(B(b.data.totalTime))+" hores",1)]),_:1}),t(i,{field:"totalCost",header:"Cost mensual"},{body:h(b=>[F("span",null,T(b.data.totalCost)+" €",1)]),_:1})]),_:1},8,["value"])}}}),X=a=>($("data-v-a770bca5"),a=a(),j(),a),Z={class:"dashboard-filter"},ee={class:"dashboard-filter-field"},oe={class:"dashboard-filter-field"},te=X(()=>F("label",{class:"block text-900"},"Concepte:",-1)),ae={class:"dashboard-container"},re=G({__name:"CostDashboard",setup(a){const o=L(),B=z(),p=U(),f=W(),i=new R("/ProductionCost"),n=y({dates:void 0,consolidatedBy:void 0}),b=()=>{o.cleanExercisePicker(),n.value.consolidatedBy=""},E=[{id:"operator",value:"Operaris"},{id:"workcentertype",value:"Tipus de centre de treball"}],v=y([]);H(async()=>{o.setMenuItem({icon:x.MONEY_BILL,title:"Dashboard costs producció"}),await p.fetchOperators(),await p.fetchWorkcenterTypes(),await f.fetchActive(),o.exercisePicker.exercise||o.setCurrentYear()});const D=async()=>{if(o.exercisePicker.dates){const d=g(o.exercisePicker.dates[0]),l=g(o.exercisePicker.dates[1]);var c;n.value.consolidatedBy=="operator"&&(await B.fetchGroupedByOperator(d,l),c=await i.GroupedByMonthAndOperator(d,l)),n.value.consolidatedBy=="workcentertype"&&(await B.fetchGroupedByType(d,l),c=await i.GetGroupedByMonthAndWorkcenterType(d,l)),w.value=O(),k.value=N(),c&&(v.value=c)}},w=y(),k=y(),O=()=>{const c=p.workcenterTypes.map(e=>e.name),d=p.operators.map(e=>e.name+" "+e.surname),l=["Gener","Febrer","Març","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"],r={};var _=[];B.productionCostDashboardGrouped.forEach(e=>{const s=l[e.month-1];r[s]||(r[s]={}),n.value.consolidatedBy=="operator"&&(r[s][e.operatorName]=e.totalCost),n.value.consolidatedBy=="workcentertype"&&(r[s][e.workcenterTypeName]=e.totalCost)});const m=Object.keys(r).sort((e,s)=>parseInt(e)-parseInt(s));return n.value.consolidatedBy=="operator"&&(_=d.map((e,s)=>({type:"bar",label:e,backgroundColor:S[s],data:m.map(C=>r[C][e]||0)}))),n.value.consolidatedBy=="workcentertype"&&(_=c.map((e,s)=>({type:"bar",label:e,backgroundColor:S[s],data:m.map(C=>r[C][e]||0)}))),{labels:m,datasets:_}},N=()=>{const c=getComputedStyle(document.documentElement),d=c.getPropertyValue("--p-text-color"),l=c.getPropertyValue("--p-text-muted-color"),r=c.getPropertyValue("--p-content-border-color");return{maintainAspectRatio:!1,aspectRatio:.8,plugins:{datalabels:{},tooltips:{mode:"index",intersect:!1},legend:{labels:{color:d}}},scales:{x:{stacked:!0,ticks:{color:l},grid:{color:r}},y:{stacked:!0,ticks:{color:l},grid:{color:r}}}}},S=["#FFB3BA","#B3FFBA","#BAE1FF","#FFDFBA","#FFFFBA","#BAFFC9","#FFB3E6","#B3FFFF","#FFBEBA","#D1BAFF","#BAFFC9","#C9BAFF","#FFBAD2","#BAFFD1","#FFC9BA","#B3BAFF","#B3FFA1","#FFD1BA","#FFBAE6","#BAE6FF","#F0BAFF","#FFBACD","#A1FFB3","#FFB3FF","#C2FFBA","#FFBAC2","#BAC2FF","#B3FFD1","#FFB3C9","#C9FFA1","#FFDFD1","#A1C9FF","#D1FFBA","#FFB3C9","#BAC2FF","#FFBACD","#BAFFC2","#D1BAFF","#FFBAF0","#BAFFDA"];return(c,d)=>{const l=u("Dropdown"),r=u("Button"),_=u("Chart"),m=u("TabPanel"),e=u("TabView");return M(),J(Y,null,[F("div",Z,[F("div",ee,[t(q,{exercises:P(f).exercises,onRangeSelected:D},null,8,["exercises"])]),F("div",oe,[te,t(l,{id:"consolidatedBy",modelValue:n.value.consolidatedBy,"onUpdate:modelValue":d[0]||(d[0]=s=>n.value.consolidatedBy=s),options:E,placeholder:"Selecciona...",optionValue:"id",optionLabel:"value",class:"w-full",onChange:D},null,8,["modelValue"])]),t(r,{class:"grid_add_row_button",icon:P(x).FILTER_SLASH,onClick:b},null,8,["icon"])]),t(e,null,{default:h(()=>[t(m,{header:"Grafics"},{default:h(()=>[F("div",ae,[t(_,{type:"bar",data:w.value,options:k.value,class:"w-full h-[70rem]"},null,8,["data","options"])])]),_:1}),t(m,{header:"Data"},{default:h(()=>[t(K,{costs:v.value},null,8,["costs"])]),_:1})]),_:1})],64)}}});const le=Q(re,[["__scopeId","data-v-a770bca5"]]);export{le as default};
