import{_ as A}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-4c7a90c1.js";import{d as H,g as Y,u as z,j as G,x as J,r as D,E as K,o as X,P as v,H as C,h as b,c as Z,i as a,w as s,k as i,G as ee,a as te,e as n,C as _,D as w,n as ae,p as oe,b as re,f as se}from"./index-69c3f293.js";import{a as O,d as ie,g as ne}from"./functions-4d7ada1d.js";import{u as le}from"./exercise-d39af01e.js";import{u as de,_ as ce}from"./productionpart-ec8bd222.js";import{u as ue}from"./plantmodel-1b7fccc4.js";import{u as pe}from"./workorder-5a328198.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";import"./index-ce241625.js";import"./base.service-330045d1.js";import"./reference.service-7103735d.js";import"./form-validator-f8953ae6.js";import"./index-b0fd6b10.js";const q=k=>(oe("data-v-ac688e88"),k=k(),re(),k),me={class:"flex flex-wrap align-items-center justify-content-between gap-2"},fe={class:"datatable-filter-3"},_e={class:"filter-field"},we={class:"filter-field"},he=q(()=>n("label",null,"Operari",-1)),ve={class:"filter-field"},be=q(()=>n("label",null,"Màquina",-1)),ke={class:"datatable-buttons"},Pe=["onClick"],ye={class:"footer"},Ie=H({__name:"ProductionParts",setup(k){const T=Y(),l=z(),S=G(),d=de(),I=le(),c=ue(),V=pe(),E=J(),N=()=>{var f;const t=new Date().getFullYear().toString(),e=(f=I.exercises)==null?void 0:f.find(h=>h.name===t);e&&(l.exercisePicker.exercise=e,l.exercisePicker.dates=[new Date(l.exercisePicker.exercise.startDate),new Date(l.exercisePicker.exercise.endDate)])},u=D({operatorId:"",workcenterId:""}),P=async()=>{if(l.exercisePicker.dates){const t=O(l.exercisePicker.dates[0]),e=O(l.exercisePicker.dates[1]);await d.fetchFiltered(t,e,u.value.workcenterId,u.value.operatorId)}else S.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},B=()=>{l.cleanExercisePicker(),u.value.workcenterId="",u.value.operatorId=""},p=K({visible:!1,title:"Crear tíquet de producció",closable:!0,position:"center",modal:!0});X(async()=>{l.setMenuItem({icon:v.CLOUD,title:"Tíquets de producció"}),V.fetchAll(),c.fetchWorkcenters(),c.fetchOperators(),c.fetchMachineStatuses(),await I.fetchActive(),N(),P()});const F=C(()=>{if(d.productionParts)return d.productionParts.reduce((t,e)=>t+e.time,0)}),M=C(()=>{if(d.productionParts)return d.productionParts.reduce((t,e)=>t+e.quantity,0)}),g=D({}),L=()=>({id:ne(),operatorId:"",workCenterId:"",workOrderId:"",workOrderPhaseId:"",workOrderPhaseDetailId:"",time:0,quantity:0,date:new Date}),$=t=>{if(t.workOrder&&t.workOrderPhase&&t.workOrderPhaseDetail){const e=c.getMachineStatusNameById(t.workOrderPhaseDetail.machineStatusId);return`${t.workOrder.code} - (${t.workOrderPhase.code}) ${t.workOrderPhase.description} - ${e}`}},U=()=>{g.value=L(),p.visible=!0},R=async()=>{p.visible=!1,await d.create(g.value)&&(T.push({path:"/productionpart"}),P())},Q=(t,e)=>{E.require({target:t.currentTarget,message:`Està segur que vol eliminar el tíquet de producció: ${e.id}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await d.delete(e.id)&&(S.add({severity:"success",summary:"Eliminat",life:3e3}),await P())}})};return(t,e)=>{const f=b("Dropdown"),h=b("Button"),m=b("Column"),W=b("DataTable"),j=b("Dialog");return te(),Z(ee,null,[a(W,{value:i(d).productionParts,class:"p-datatable-sm small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:10},{header:s(()=>{var o,y;return[n("div",me,[n("div",fe,[n("div",_e,[a(A,{exercises:i(I).exercises},null,8,["exercises"])]),n("div",we,[he,a(f,{modelValue:u.value.operatorId,"onUpdate:modelValue":e[0]||(e[0]=r=>u.value.operatorId=r),editable:"",filter:!0,options:(o=i(c).operators)==null?void 0:o.sort((r,x)=>r.surname.localeCompare(x.surname)).map(r=>({value:r.id,label:r.surname+", "+r.name})),optionValue:"value",optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),n("div",ve,[be,a(f,{modelValue:u.value.workcenterId,"onUpdate:modelValue":e[1]||(e[1]=r=>u.value.workcenterId=r),editable:"",filter:!0,options:(y=i(c).workcenters)==null?void 0:y.sort((r,x)=>r.description.localeCompare(x.description)),optionValue:"id",optionLabel:"description",class:"w-full"},null,8,["modelValue","options"])])]),n("div",ke,[a(h,{class:"datatable-button mr-2",icon:i(v).FILTER,rounded:"",raised:"",onClick:P},null,8,["icon"]),a(h,{class:"datatable-button mr-2",icon:i(v).FILTER_SLASH,rounded:"",raised:"",onClick:B},null,8,["icon"]),a(h,{icon:i(v).PLUS,rounded:"",raised:"",onClick:U},null,8,["icon"])])])]}),empty:s(()=>[_(" No s'han trobat tiquets. ")]),loading:s(()=>[_(" Carregant tiquets. Si us plau espera. ")]),footer:s(()=>[n("div",ye,[n("span",null," Temps total: "+w(F.value)+" minuts / Quantitat total: "+w(M.value),1)])]),default:s(()=>[a(m,{field:"operatorId",header:"Operari",style:{width:"15%"}},{body:s(o=>[_(w(i(c).getOperatorNameById(o.data.operatorId)),1)]),_:1}),a(m,{field:"workcenterId",header:"Màquina",style:{width:"20%"}},{body:s(o=>[_(w(i(c).getWorkcenterNameById(o.data.workcenterId)),1)]),_:1}),a(m,{field:"workOrderId",header:"OF",style:{width:"20%"}},{body:s(o=>[_(w($(o.data)),1)]),_:1}),a(m,{field:"date",header:"Data",style:{width:"15%"}},{body:s(o=>[_(w(i(ie)(o.data.date)),1)]),_:1}),a(m,{field:"quantity",header:"Quantitat",style:{width:"10%"}}),a(m,{field:"time",header:"Temps (min)",style:{width:"15%"}}),a(m,{style:{width:"5%"}},{body:s(o=>[n("i",{class:ae([i(v).TIMES,"grid_delete_column_button"]),onClick:y=>Q(y,o.data)},null,10,Pe)]),_:1})]),_:1},8,["value"]),a(j,{visible:p.visible,"onUpdate:visible":e[2]||(e[2]=o=>p.visible=o),header:p.title,closable:p.closable,modal:p.modal},{default:s(()=>[a(ce,{productionPart:g.value,onSubmit:R},null,8,["productionPart"])]),_:1},8,["visible","header","closable","modal"])],64)}}});const Le=se(Ie,[["__scopeId","data-v-ac688e88"]]);export{Le as default};
