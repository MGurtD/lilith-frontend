import{d as D,h as b,m as g,w as I,a as w,e as d,i as m,k as f,P as A,c as B,n as $,l as S,J as M,G as H,H as J,j as F,r as k,z as j,F as T,g as K,v as Q,u as W,C as X,K as Y,o as Z,L as ee,f as te}from"./index-8529e343.js";import{c as N,a as R,F as O}from"./form-validator-9bee509e.js";import{u as se}from"./lifecycle-5f73524a.js";const ae={class:"flex flex-wrap align-items-center justify-content-between gap-2"},oe=d("span",{class:"text-xl text-900 font-bold"},"Estats",-1),ne=["onClick"],le=D({__name:"TableStatuses",props:{lifecycleId:{},statuses:{},transitions:{}},emits:["add","edit","delete"],setup(E,{emit:p}){const u=E,c=i=>{let t=!1;return u.transitions&&(t=u.transitions.filter(e=>e.statusId===i.id||e.statusToId===i.id).length>0),t},v=()=>{const i={id:M(),lifecycleId:u.lifecycleId,name:"",disabled:!1,transitions:[],color:""};p("add",i)},s=i=>{i.originalEvent.target.className.includes("grid_delete_column_button")||p("edit",i.data)},l=(i,t)=>{p("delete",t)};return(i,t)=>{const e=b("Button"),a=b("Column"),r=b("DataTable");return w(),g(r,{onRowClick:s,value:u.statuses,tableStyle:"min-width: 100%"},{header:I(()=>[d("div",ae,[oe,m(e,{icon:f(A).PLUS,rounded:"",raised:"",onClick:v},null,8,["icon"])])]),default:I(()=>[m(a,{field:"name",header:"Nom",style:{width:"75%"}}),m(a,{style:{width:"25%"}},{body:I(_=>[c(_.data)?S("",!0):(w(),B("i",{key:0,class:$([f(A).TIMES,"grid_delete_column_button"]),onClick:y=>l(y,_.data)},null,10,ne))]),_:1})]),_:1},8,["value"])}}}),ie={class:"flex flex-wrap align-items-center justify-content-between gap-2"},re=d("span",{class:"text-xl text-900 font-bold"},"Transicions",-1),de=["onClick"],ue=D({__name:"TableStatusTransitions",props:{statuses:{},transitions:{}},emits:["add","edit","delete"],setup(E,{emit:p}){const u=E,c=i=>{var a,r;const t=(a=u.statuses)==null?void 0:a.find(_=>_.id===i.statusId),e=(r=u.statuses)==null?void 0:r.find(_=>_.id===i.statusToId);return t&&e?`${t.name} > ${e.name}`:""},v=()=>{const i={id:M(),statusId:"",statusToId:"",name:""};p("add",i)},s=i=>{i.originalEvent.target.className.includes("grid_delete_column_button")||p("edit",i.data)},l=(i,t)=>{p("delete",t)};return(i,t)=>{const e=b("Button"),a=b("Column"),r=b("DataTable");return w(),g(r,{onRowClick:s,value:u.transitions,tableStyle:"min-width: 100%"},{header:I(()=>[d("div",ie,[re,m(e,{icon:f(A).PLUS,rounded:"",raised:"",onClick:v},null,8,["icon"])])]),default:I(()=>[m(a,{field:"name",header:"Nom",style:{width:"25%"}}),m(a,{header:"Transició",style:{width:"50%"}},{body:I(_=>[H(J(c(_.data)),1)]),_:1}),m(a,{style:{width:"25%"}},{body:I(_=>[d("i",{class:$([f(A).TIMES,"grid_delete_column_button"]),onClick:y=>l(y,_.data)},null,10,de)]),_:1})]),_:1},8,["value"])}}}),ce={key:0},me={class:"three-columns"},pe=d("label",{class:"block text-900 mb-2"},"Estat inicial",-1),fe=D({__name:"FormLifecycle",props:{lifecycle:{}},emits:["submit","cancel"],setup(E,{emit:p}){F(),N().shape({name:R().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:R().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters")});const u=k({result:!1,errors:{}});return(c,v)=>{const s=b("Dropdown");return c.lifecycle?(w(),B("form",ce,[d("section",me,[m(j,{class:$(["mb-2",{"p-invalid":u.value.errors.name}]),label:"Nom",id:"name",modelValue:c.lifecycle.name,"onUpdate:modelValue":v[0]||(v[0]=l=>c.lifecycle.name=l)},null,8,["modelValue","class"]),m(j,{class:$(["mb-2",{"p-invalid":u.value.errors.description}]),label:"Descripció",id:"description",modelValue:c.lifecycle.description,"onUpdate:modelValue":v[1]||(v[1]=l=>c.lifecycle.description=l)},null,8,["modelValue","class"]),d("div",null,[pe,m(s,{class:"w-full",modelValue:c.lifecycle.initialStatusId,"onUpdate:modelValue":v[2]||(v[2]=l=>c.lifecycle.initialStatusId=l),editable:"",options:c.lifecycle.statuses,optionValue:"id",optionLabel:"name"},null,8,["modelValue","options"])])])])):S("",!0)}}}),_e={class:"three-columns"},ve={class:"mb-4"},be=d("label",{class:"block text-900 mb-2"},"Color",-1),ye={class:"mb-4"},Te=d("label",{class:"block text-900 mb-2"},"Deshabilitat",-1),we=D({__name:"FormStatus",props:{formAction:{},status:{}},emits:["submit"],setup(E,{emit:p}){const u=E,c=F(),v=N().shape({name:R().required("El nom és obligatori")}),s=k({result:!1,errors:{}}),l=()=>{const e=new O(v);s.value=e.validate(u.status)},i=async()=>{if(l(),s.value.result)p("submit",u.status);else{let e="";Object.entries(s.value.errors).forEach(a=>{e+=`${a[1].map(r=>r)}.   `}),c.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}},t=[{id:"",value:"Cap"},{id:"info",value:"Blau"},{id:"secondary",value:"Gris"},{id:"help",value:"Lila"},{id:"contrast",value:"Negre"},{id:"warn",value:"Taronja"},{id:"success",value:"Verd"},{id:"danger",value:"Vermell"}];return(e,a)=>{const r=b("BaseInput"),_=b("Dropdown"),y=b("Checkbox"),L=b("Button");return w(),B("form",null,[d("section",_e,[m(r,{class:$(["mb-2",{"p-invalid":s.value.errors.baseAmount}]),label:"Nom",modelValue:e.status.name,"onUpdate:modelValue":a[0]||(a[0]=h=>e.status.name=h)},null,8,["modelValue","class"]),d("div",ve,[be,m(_,{modelValue:e.status.color,"onUpdate:modelValue":a[1]||(a[1]=h=>e.status.color=h),editable:"",options:t,optionValue:"id",optionLabel:"value",class:$(["w-full",{"p-invalid":s.value.errors.statusId}])},null,8,["modelValue","class"])]),d("div",ye,[Te,m(y,{modelValue:e.status.disabled,"onUpdate:modelValue":a[2]||(a[2]=h=>e.status.disabled=h),binary:!0},null,8,["modelValue"])])]),m(L,{label:"Confirmar",onClick:i,style:{float:"right"}})])}}}),Ee={class:"two-columns"},Ve=d("label",{class:"block text-900 mb-2"},"Origen",-1),Ce={class:"mb-4"},Ie=d("label",{class:"block text-900 mb-2"},"Destí",-1),he=D({__name:"FormStatusTransition",props:{formAction:{},transition:{},statuses:{}},emits:["submit"],setup(E,{emit:p}){const u=E,c=F(),v=N().shape({name:R().required("El nom és obligatori")}),s=k({result:!1,errors:{}}),l=()=>{const t=new O(v);s.value=t.validate(u.transition)},i=async()=>{if(u.transition.statusId===u.transition.statusToId){c.add({severity:"warn",summary:"Formulari inválid",detail:"Els estats d'origen i destí han de ser diferents",life:5e3});return}if(l(),s.value.result)p("submit",u.transition);else{let t="";Object.entries(s.value.errors).forEach(e=>{t+=`${e[1].map(a=>a)}.   `}),c.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,e)=>{const a=b("BaseInput"),r=b("Dropdown"),_=b("Button");return w(),B("form",null,[m(a,{class:$(["mb-2",{"p-invalid":s.value.errors.name}]),label:"Nom",modelValue:t.transition.name,"onUpdate:modelValue":e[0]||(e[0]=y=>t.transition.name=y)},null,8,["modelValue","class"]),d("section",Ee,[d("div",null,[Ve,m(r,{modelValue:t.transition.statusId,"onUpdate:modelValue":e[1]||(e[1]=y=>t.transition.statusId=y),editable:"",options:t.statuses,optionValue:"id",optionLabel:"name"},null,8,["modelValue","options"])]),d("div",Ce,[Ie,m(r,{modelValue:t.transition.statusToId,"onUpdate:modelValue":e[2]||(e[2]=y=>t.transition.statusToId=y),editable:"",options:t.statuses,optionValue:"id",optionLabel:"name"},null,8,["modelValue","options"])])]),m(_,{label:"Confirmar",onClick:i,style:{float:"right"}})])}}}),ge={class:"container"},Se={class:"section_lifecycle mt-5"},ke={class:"section_status"},$e={class:"section_status_list"},De={class:"section_statustransition_list"},Ae=D({__name:"Lifecycle",setup(E){const p=k(T.EDIT),u=K(),c=Q(),v=W(),s=se(),{lifecycle:l,transitions:i}=X(s),t=k(T.CREATE),e=k(void 0),a=k(void 0),r=Y({visible:!1,title:"",closable:!0,position:"bottom",modal:!0}),_=async()=>{await s.fetchOne(c.params.id);let o="";l.value?(p.value=T.EDIT,o=`Cicle de vida ${l.value.name}`):(p.value=T.CREATE,s.setNew(c.params.id),o="Alta cicle de vida"),v.setMenuItem({icon:A.REFRESH,backButtonVisible:!0,title:o})};Z(async()=>{await _()});const y=(o,n)=>{p.value!==T.CREATE&&(t.value=o,e.value=n,a.value=void 0,r.visible=!0,r.title="Introducció d'estats")},L=async o=>{if(i.value.find(C=>C.statusId===o.id||C.statusToId===o.id)){x.add({severity:"warn",summary:"Estat dependent",detail:`L'estat ${o.name} forma part d'una transició`,life:5e3});return}await s.deleteStatus(o.id)},h=async o=>{let n;t.value==T.CREATE?n=s.createStatus(o):n=s.updateStatus(o.id,o),r.visible=!await n},U=(o,n)=>{p.value!==T.CREATE&&(t.value=o,e.value=void 0,a.value=n,r.visible=!0,r.title="Introducció de transicions")},q=async o=>await s.deleteTransition(o.id),z=async o=>{let n;t.value==T.CREATE?n=s.createTransition(o):n=s.updateTransition(o.id,o),r.visible=!await n},x=F(),G=async()=>{const o=l.value;let n=!1,C="";p.value===T.CREATE?(n=await s.create(o),C="Cicle de vida creat correctament"):(n=await s.update(o.id,o),C="Cicle de vida actualizat correctament"),n&&(x.add({severity:"success",summary:C,life:5e3}),p.value===T.EDIT?u.back():await _())};return(o,n)=>{const C=b("Button"),P=b("Dialog");return w(),B(ee,null,[d("main",ge,[m(C,{label:"Guardar",class:"grid_add_row_button",onClick:G}),d("section",Se,[f(l)?(w(),g(fe,{key:0,lifecycle:f(l)},null,8,["lifecycle"])):S("",!0)]),d("section",ke,[d("div",$e,[f(l)?(w(),g(le,{key:0,"lifecycle-id":f(l).id,statuses:f(l).statuses,transitions:f(s).transitions,onAdd:n[0]||(n[0]=V=>y(f(T).CREATE,V)),onEdit:n[1]||(n[1]=V=>y(f(T).EDIT,V)),onDelete:L},null,8,["lifecycle-id","statuses","transitions"])):S("",!0)]),d("div",De,[f(l)?(w(),g(ue,{key:0,statuses:f(l).statuses,transitions:f(s).transitions,onAdd:n[2]||(n[2]=V=>U(f(T).CREATE,V)),onEdit:n[3]||(n[3]=V=>U(f(T).EDIT,V)),onDelete:q},null,8,["statuses","transitions"])):S("",!0)])])]),m(P,{visible:r.visible,"onUpdate:visible":n[4]||(n[4]=V=>r.visible=V),header:r.title,closable:r.closable,modal:r.modal},{default:I(()=>[e.value?(w(),g(we,{key:0,status:e.value,formAction:t.value,onSubmit:h},null,8,["status","formAction"])):S("",!0),a.value?(w(),g(he,{key:1,transition:a.value,statuses:f(l).statuses,formAction:t.value,onSubmit:z},null,8,["transition","statuses","formAction"])):S("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}});const Le=te(Ae,[["__scopeId","data-v-4fed7321"]]);export{Le as default};
