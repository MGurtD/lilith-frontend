import{_ as L}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-ba9b1f03.js";import{_ as M}from"./FormCreateWorkorder.vue_vue_type_script_setup_true_lang-a83b1564.js";import{d as V,g as $,u as Q,j,x as q,r as C,E as U,o as H,P as p,h as _,c as Y,i as e,w as n,k as s,G as z,a as G,e as l,C as w,D as y,n as J}from"./index-53820b8d.js";import{u as K}from"./reference-4195502c.js";import{a as I,d as X}from"./functions-4d7ada1d.js";import{u as Z}from"./exercise-fcd703c2.js";import{u as ee}from"./lifecycle-3c6f7322.js";import{u as te}from"./workorder-6d2bed68.js";import{u as ae}from"./workmaster-b78e0c53.js";import"./form-validator-f8953ae6.js";import"./_commonjsHelpers-725317a4.js";import"./reference.service-f83d13c3.js";import"./base.service-80f81d45.js";import"./v4-a960c1f4.js";import"./index-6d4d46b9.js";import"./index-a03cc526.js";const oe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},se={class:"datatable-filter"},re={class:"filter-field"},ie={class:"filter-field"},ne=l("label",{class:"block text-900 mb-2"},"Estat",-1),le={class:"datatable-buttons"},ce=["onClick"],Ie=V({__name:"Workorders",setup(de){const x=$(),r=Q(),D=j(),E=q(),P=ae(),i=te(),g=K(),v=Z(),b=ee(),T=()=>{var m;const o=new Date().getFullYear().toString(),t=(m=v.exercises)==null?void 0:m.find(f=>f.name===o);t&&(r.exercisePicker.exercise=t,r.exercisePicker.dates=[new Date(r.exercisePicker.exercise.startDate),new Date(r.exercisePicker.exercise.endDate)])},u=C({referenceId:void 0,statusId:void 0}),B=()=>{u.value.referenceId=void 0,u.value.statusId=void 0},S=async()=>{if(r.exercisePicker.dates){const o=I(r.exercisePicker.dates[0]),t=I(r.exercisePicker.dates[1]);await i.fetchFiltered(o,t,u.value.statusId)}else D.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},c=U({visible:!1,title:"Crear ordre",closable:!0,position:"center",modal:!0}),k=C({workMasterId:"",plannedDate:"",plannedQuantity:0,comment:""});H(async()=>{await g.fetchReferencesByModule("sales"),await v.fetchActive(),b.fetchOneByName("WorkOrder"),P.fetchAllActives(),r.setMenuItem({icon:p.CALENDAR,title:"Ordres de fabricació"}),T(),S()});const O=()=>{c.visible=!0},F=o=>{o.originalEvent.target.className.includes("grid_delete_column_button")||x.push({path:`/workorder/${o.data.id}`})},R=async()=>{if(!k.value)return;await i.create(k.value)&&i.workorder&&x.push({path:`/workorder/${i.workorder.id}`})},N=(o,t)=>{E.require({target:o.currentTarget,message:`Está segur que vol eliminar la ordre ${t.code}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await i.delete(t.id)&&(D.add({severity:"success",summary:"Eliminada",life:3e3}),await i.fetchAll())}})};return(o,t)=>{const m=_("Dropdown"),f=_("Button"),d=_("Column"),W=_("DataTable"),A=_("Dialog");return G(),Y(z,null,[e(W,{value:s(i).workorders,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",onRowClick:F},{header:n(()=>{var a;return[l("div",oe,[l("div",se,[l("div",re,[e(L,{exercises:s(v).exercises},null,8,["exercises"])]),l("div",ie,[ne,e(m,{modelValue:u.value.statusId,"onUpdate:modelValue":t[0]||(t[0]=h=>u.value.statusId=h),editable:"",options:(a=s(b).lifecycle)==null?void 0:a.statuses,optionValue:"id",optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])])]),l("div",le,[e(f,{class:"datatable-button mr-2",icon:s(p).FILTER,rounded:"",raised:"",onClick:S},null,8,["icon"]),e(f,{class:"datatable-button mr-2",icon:s(p).FILTER_SLASH,rounded:"",raised:"",onClick:B},null,8,["icon"]),e(f,{icon:s(p).PLUS,rounded:"",raised:"",onClick:O},null,8,["icon"])])])]}),default:n(()=>[e(d,{field:"code",header:"Codi",style:{width:"15%"}}),e(d,{header:"Referencia",style:{width:"40%"}},{body:n(a=>[w(y(s(g).getFullNameById(a.data.referenceId)),1)]),_:1}),e(d,{field:"statusId",header:"Estat",style:{width:"10%"}},{body:n(a=>[w(y(s(b).getStatusName(a.data.statusId)),1)]),_:1}),e(d,{field:"plannedDate",header:"Data Prevista",style:{width:"10%"}},{body:n(a=>[w(y(s(X)(a.data.plannedDate)),1)]),_:1}),e(d,{field:"plannedQuantity",header:"Quantitat",style:{width:"10%"}}),e(d,null,{body:n(a=>[l("i",{class:J([s(p).TIMES,"grid_delete_column_button"]),onClick:h=>N(h,a.data)},null,10,ce)]),_:1})]),_:1},8,["value"]),e(A,{visible:c.visible,"onUpdate:visible":t[1]||(t[1]=a=>c.visible=a),header:c.title,closable:c.closable,modal:c.modal},{default:n(()=>[e(M,{createWorkOrderDto:k.value,onSubmit:R},null,8,["createWorkOrderDto"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Ie as default};
