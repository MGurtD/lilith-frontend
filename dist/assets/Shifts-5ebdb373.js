import{d as V,j as k,r as g,h as m,a as S,c as $,e as a,i as s,n as j,y as A,l as w,u as H,z,E as x,o as L,w as p,k as f,G as R,P as U,m as N}from"./index-7c1e9124.js";import{u as q}from"./shift-6344c83f.js";import{c as I,a as G,F as O}from"./form-validator-f8953ae6.js";import{i as P,g as E}from"./functions-2e154ea4.js";import"./index-b0477b25.js";import"./base.service-14be693f.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";const M={key:0},J={class:"two-columns"},K={class:"mb-4"},Q=a("label",{class:"block text-900 mb-2"},"Deshabilitat",-1),W=V({__name:"FormShift",props:{shift:{}},emits:["submit","cancel"],setup(T,{emit:i}){const l=T,h=k(),u=I().shape({name:G().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters")}),r=g({result:!1,errors:{}}),v=()=>{const e=new O(u);r.value=e.validate(l.shift)},n=async()=>{if(console.log("submit"),v(),r.value.result)i("submit",l.shift);else{let e="";Object.entries(r.value.errors).forEach(t=>{e+=`${t[1].map(d=>d)}.   `}),h.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const d=m("Checkbox"),_=m("Button");return e.shift?(S(),$("form",M,[a("section",J,[s(A,{class:j(["mb-2",{"p-invalid":r.value.errors.baseAmount}]),label:"Nom",modelValue:e.shift.name,"onUpdate:modelValue":t[0]||(t[0]=b=>e.shift.name=b)},null,8,["modelValue","class"]),a("div",K,[Q,s(d,{modelValue:e.shift.disabled,"onUpdate:modelValue":t[1]||(t[1]=b=>e.shift.disabled=b),binary:!0},null,8,["modelValue"])])]),s(_,{label:"Confirmar",onClick:n,style:{float:"right"}})])):w("",!0)}}}),X={key:0},Y={class:"three-columns"},Z={class:"mb-4"},ee=a("label",{class:"block text-900 mb-2"},"Temps productiu:",-1),te=V({__name:"FormShiftDetail",props:{shiftdetail:{}},emits:["submit","cancel"],setup(T,{emit:i}){const l=T,h=k(),u=I().shape({}),r=g({result:!1,errors:{}}),v=()=>{const e=new O(u);r.value=e.validate(l.shiftdetail)},n=async()=>{if(l.shiftdetail.startTime=P(l.shiftdetail.startTime),l.shiftdetail.endTime=P(l.shiftdetail.endTime),console.log(l.shiftdetail),v(),r.value.result)i("submit",l.shiftdetail);else{let e="";Object.entries(r.value.errors).forEach(t=>{e+=`${t[1].map(d=>d)}.   `}),h.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const d=m("Calendar"),_=m("Checkbox"),b=m("Button");return e.shiftdetail?(S(),$("form",X,[a("section",Y,[s(d,{class:"mb-2",label:"Inici Torn:",modelValue:e.shiftdetail.startTime,"onUpdate:modelValue":t[0]||(t[0]=o=>e.shiftdetail.startTime=o),timeOnly:"",hourFormat:"24"},null,8,["modelValue"]),s(d,{class:"mb-2",label:"Fi Torn:",modelValue:e.shiftdetail.endTime,"onUpdate:modelValue":t[1]||(t[1]=o=>e.shiftdetail.endTime=o),timeOnly:"",hourFormat:"24"},null,8,["modelValue"]),a("div",Z,[ee,s(_,{modelValue:e.shiftdetail.isProductiveTime,"onUpdate:modelValue":t[2]||(t[2]=o=>e.shiftdetail.isProductiveTime=o),binary:!0},null,8,["modelValue"])])]),s(b,{label:"Confirmar",onClick:n,style:{float:"right"}})])):w("",!0)}}}),se={class:"container"},ae={class:"two-columns"},ie={class:"flex flex-wrap align-items-center justify-content-between gap-2"},le=a("span",{class:"text-xl text-900 font-bold"},"Torns",-1),oe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ne=a("span",{class:"text-xl text-900 font-bold"},"Horaris",-1),pe=V({__name:"Shifts",setup(T){H();const i=q(),l=k(),{shift:h,shiftdetail:u}=z(i),r=()=>{i.setNewShift(E()),n.visible=!0,n.title="Alta de torns"},v=()=>{i.setNewShiftDetail(E()),u.value.shiftId=t.value.id,e.visible=!0,e.title="Configuració de torns"},n=x({visible:!1,title:"",closable:!0,position:"center",modal:!0}),e=x({visible:!1,title:"",closable:!0,position:"center",modal:!0}),t=g(void 0),d=async o=>{await i.fetchShiftDetailsByShiftId(o.data.id),t.value=o.data};L(async()=>{await i.fetchAllShifts()});const _=async()=>{const o=h.value;let c=!1;c=await i.createShift(o),c&&(n.visible=!1,l.add({severity:"success",summary:"Torn creat correctament",life:5e3}))},b=async()=>{const o=u.value;let c=!1;c=await i.createDetail(o),c&&(e.visible=!1,l.add({severity:"success",summary:"Detall creat correctament",life:5e3}))};return(o,c)=>{const D=m("Button"),y=m("Column"),B=m("DataTable"),F=m("Dialog");return S(),$(R,null,[a("main",se,[a("section",ae,[a("div",null,[s(B,{value:f(i).shifts,tableStyle:"min-width: 100%",onRowClick:d},{header:p(()=>[a("div",ie,[le,s(D,{icon:f(U).PLUS,rounded:"",raised:"",onClick:r},null,8,["icon"])])]),default:p(()=>[s(y,{field:"name",header:"Nom"}),s(y,{field:"disabled",header:"Inactiu"})]),_:1},8,["value"])]),a("div",null,[s(B,{value:f(i).shiftdetails,tableStyle:"min-width: 100%"},{header:p(()=>[a("div",oe,[ne,s(D,{icon:f(U).PLUS,rounded:"",raised:"",onClick:v},null,8,["icon"])])]),default:p(()=>[s(y,{field:"startTime",header:"Hora inici"}),s(y,{field:"endTime",header:"Hora fi"}),s(y,{field:"isProductiveTime",header:"Temps Productiu"})]),_:1},8,["value"])])])]),s(F,{visible:n.visible,"onUpdate:visible":c[0]||(c[0]=C=>n.visible=C),header:n.title,closable:n.closable,modal:n.modal},{default:p(()=>[f(h)?(S(),N(W,{key:0,shift:f(h),onSubmit:_},null,8,["shift"])):w("",!0)]),_:1},8,["visible","header","closable","modal"]),s(F,{visible:e.visible,"onUpdate:visible":c[1]||(c[1]=C=>e.visible=C),header:e.title,closable:e.closable,modal:e.modal},{default:p(()=>[f(u)?(S(),N(te,{key:0,shiftdetail:f(u),onSubmit:b},null,8,["shiftdetail"])):w("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}});export{pe as default};
