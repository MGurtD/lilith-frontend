import{_ as L}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-f8fc3768.js";import{_ as M}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-4fa33fdf.js";import{_ as U}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-7206f397.js";import{_ as A}from"./FormCreateWorkorder.vue_vue_type_script_setup_true_lang-8c60366b.js";import{d as Q,g as j,u as q,$ as H,j as z,x as G,E as K,r as g,K as Y,o as J,P as m,a0 as X,h as _,c as Z,i as t,w as c,k as o,L as ee,O as C,a as te,e as l,G as v,H as p,I as re,n as se}from"./index-40c5ef33.js";import{u as ae}from"./reference-00b1433c.js";import{u as oe}from"./lifecycle-d45e6b06.js";import{u as ie}from"./workorder-7b474682.js";import{u as le}from"./workmaster-ed8c1cc9.js";import{u as de}from"./customers-e5cc267b.js";import"./form-validator-dd91bd90.js";import"./index-da72429f.js";const ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ne={class:"datatable-filter-3"},ue={class:"filter-field"},me={class:"filter-field"},fe=l("label",{class:"block text-900"},"Client",-1),_e={class:"filter-field"},ve=l("label",{class:"block text-900"},"Estat",-1),pe={class:"datatable-buttons"},ke=["onClick"],Oe=Q({__name:"Workorders",setup(be){const h=j(),i=q(),k=H(),y=z(),D=G(),P=le(),n=ie(),x=ae(),F=de(),w=K(),S=oe(),r=g({referenceId:void 0,statusId:void 0,customerId:void 0}),E=()=>{r.value.referenceId=void 0,r.value.statusId=void 0,r.value.customerId=void 0,k.removeFilter("Workorders","")},b=async()=>{if(i.exercisePicker.dates){const e=C(i.exercisePicker.dates[0]),a=C(i.exercisePicker.dates[1]);await n.fetchFiltered(e,a,r.value.statusId,r.value.referenceId,r.value.customerId)}else y.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},u=Y({visible:!1,title:"Crear ordre",closable:!0,position:"center",modal:!0}),I=g({workMasterId:"",plannedDate:"",plannedQuantity:0,comment:""});J(async()=>{await x.fetchReferencesByModule("sales"),await w.fetchActive(),S.fetchOneByName("WorkOrder"),P.fetchAllActives(),i.setMenuItem({icon:m.CALENDAR,title:"Ordres de fabricació"}),O(),i.exercisePicker.exercise||i.setCurrentYear(),b()}),X(()=>{const e={referenceId:r.value.referenceId,statusId:r.value.statusId,customerId:r.value.customerId,exercisePicker:i.exercisePicker};k.addFilter("Workorders","",e)});const O=()=>{const e=k.getFilter("Workorders","");e&&(r.value.referenceId=e.referenceId,r.value.statusId=e.statusId,r.value.customerId=e.customerId,e.exercisePicker&&(i.exercisePicker.exercise=e.exercisePicker.exercise,i.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},W=()=>{u.visible=!0},B=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||h.push({path:`/workorder/${e.data.id}`})},T=async()=>{if(!I.value)return;await n.create(I.value)&&n.workorder&&h.push({path:`/workorder/${n.workorder.id}`})},N=(e,a)=>{D.require({target:e.currentTarget,message:`Está segur que vol eliminar la ordre ${a.code}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await n.delete(a.id)&&(y.add({severity:"success",summary:"Eliminada",life:3e3}),b())}})};return(e,a)=>{const f=_("Button"),d=_("Column"),R=_("DataTable"),V=_("Dialog");return te(),Z(ee,null,[t(R,{value:o(n).workorders,tableStyle:"min-width: 100%",class:"p-datatable-sm small-datatable",scrollable:"",scrollHeight:"76vh","sort-mode":"multiple",onRowClick:B,paginator:"",rows:25},{header:c(()=>[l("div",ce,[l("div",ne,[l("div",ue,[t(M,{exercises:o(w).exercises},null,8,["exercises"])]),l("div",me,[fe,t(L,{label:"",modelValue:r.value.customerId,"onUpdate:modelValue":a[0]||(a[0]=s=>r.value.customerId=s)},null,8,["modelValue"])]),l("div",_e,[ve,t(U,{label:"",name:"WorkOrder",modelValue:r.value.statusId,"onUpdate:modelValue":a[1]||(a[1]=s=>r.value.statusId=s)},null,8,["modelValue"])])]),l("div",pe,[t(f,{class:"datatable-button mr-2",icon:o(m).FILTER,rounded:"",raised:"",onClick:b},null,8,["icon"]),t(f,{class:"datatable-button mr-2",icon:o(m).FILTER_SLASH,rounded:"",raised:"",onClick:E},null,8,["icon"]),t(f,{icon:o(m).PLUS,rounded:"",raised:"",onClick:W},null,8,["icon"])])])]),default:c(()=>[t(d,{field:"code",header:"Codi",style:{width:"15%"}}),t(d,{header:"Referencia",style:{width:"40%"}},{body:c(s=>[v(p(o(x).getFullNameById(s.data.referenceId)),1)]),_:1}),t(d,{header:"Client",style:{width:"15%"}},{body:c(s=>[v(p(o(F).getCustomerNameById(s.data.reference.customerId)),1)]),_:1}),t(d,{field:"statusId",header:"Estat",style:{width:"10%"}},{body:c(s=>[v(p(o(S).getStatusName(s.data.statusId)),1)]),_:1}),t(d,{field:"plannedDate",header:"Data Prevista",sortable:"",style:{width:"12%"}},{body:c(s=>[v(p(o(re)(s.data.plannedDate)),1)]),_:1}),t(d,{field:"order",header:"Prioritat",style:{width:"10%"}}),t(d,{field:"plannedQuantity",header:"Quantitat",style:{width:"10%"}}),t(d,null,{body:c(s=>[l("i",{class:se([o(m).TIMES,"grid_delete_column_button"]),onClick:$=>N($,s.data)},null,10,ke)]),_:1})]),_:1},8,["value"]),t(V,{visible:u.visible,"onUpdate:visible":a[2]||(a[2]=s=>u.visible=s),header:u.title,closable:u.closable,modal:u.modal},{default:c(()=>[t(A,{createWorkOrderDto:I.value,onSubmit:T},null,8,["createWorkOrderDto"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Oe as default};
