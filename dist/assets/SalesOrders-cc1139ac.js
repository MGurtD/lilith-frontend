import{_ as A}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-4c7a90c1.js";import{_ as G}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-27d688bb.js";import{d as H,g as Y,j as z,x as Q,u as J,r as g,E as K,o as W,P as m,h as f,c as D,i as e,w as d,k as i,G as X,a as k,e as u,C as I,D as N,n as Z,l as ee}from"./index-69c3f293.js";import{u as te}from"./order-5632adab.js";import{u as se}from"./reference-4ad8a4b8.js";import{u as ae}from"./customers-11bdd44c.js";import{u as oe}from"./lifecycle-6e6aec73.js";import{a as O,f as re,g as ie}from"./functions-4d7ada1d.js";import{u as le}from"./masterData-8ec1245c.js";import"./form-validator-f8953ae6.js";import"./_commonjsHelpers-725317a4.js";import"./index-e4285fe4.js";import"./base.service-330045d1.js";import"./reference.service-7103735d.js";import"./index-ce241625.js";import"./v4-a960c1f4.js";const ne={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ce={class:"datatable-filter"},de={class:"filter-field"},ue={class:"filter-field"},me=u("label",{class:"block text-900 mb-2"},"Client",-1),fe={class:"datatable-buttons"},pe=["onClick"],Re=H({__name:"SalesOrders",setup(_e){const S=Y(),w=z(),P=Q(),o=J(),v=le(),p=te(),E=se(),C=ae(),y=oe(),_=g({customerId:void 0,referenceId:void 0}),c=K({visible:!1,title:"Crear comanda",closable:!0,position:"center",modal:!0});W(async()=>{y.fetchOneByName("SalesOrder"),E.fetchReferences(),C.fetchCustomers(),await v.fetchMasterData(),R(),await h(),o.setMenuItem({icon:m.APPLE,title:"Comandes"})});const R=()=>{var l;const s=new Date().getFullYear().toString(),t=(l=v.exercises)==null?void 0:l.find(n=>n.name===s);t&&(o.exercisePicker.exercise=t,o.exercisePicker.dates=[new Date(o.exercisePicker.exercise.startDate),new Date(o.exercisePicker.exercise.endDate)])},T=()=>{o.cleanExercisePicker(),_.value.customerId=void 0},b=g({}),B=()=>({id:ie(),customerId:"",exerciseId:"",date:new Date}),F=()=>{b.value=B(),c.visible=!0},h=async()=>{if(o.exercisePicker.dates){const s=O(o.exercisePicker.dates[0]),t=O(o.exercisePicker.dates[1]);await p.GetFiltered(s,t,_.value.customerId)}else w.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},V=s=>{var l,n;const t=(n=(l=y.lifecycle)==null?void 0:l.statuses)==null?void 0:n.find(r=>r.id===s);return t?t.name:""},q=async()=>{c.visible=!1,await p.Create(b.value)&&S.push({path:`/salesorder/${b.value.id}`})},L=s=>{s.originalEvent.target.className.includes("grid_delete_column_button")||S.push({path:`/salesorder/${s.data.id}`})},M=(s,t)=>{P.require({message:"Està segur que vol eliminar la comanda?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await p.Delete(t.id)&&(w.add({severity:"success",summary:"Eliminada",life:3e3}),await h())}})};return(s,t)=>{const l=f("Dropdown"),n=f("Button"),r=f("Column"),U=f("DataTable"),$=f("Dialog");return k(),D(X,null,[e(U,{value:i(p).salesOrders,class:"small-datatable",tableStyle:"min-width: 100%","sort-field":"salesOrderNumber","sort-mode":"single","sort-order":1,scrollable:"",scrollHeight:"80vh",onRowClick:L},{header:d(()=>[u("div",ne,[u("div",ce,[u("div",de,[e(A,{exercises:i(v).exercises,onRangeSelected:h},null,8,["exercises"])]),u("div",ue,[me,e(l,{modelValue:_.value.customerId,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value.customerId=a),editable:"",options:i(C).customers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),u("div",fe,[e(n,{class:"datatable-button mr-2",icon:i(m).FILTER,rounded:"",raised:"",onClick:h},null,8,["icon"]),e(n,{class:"datatable-button mr-2",icon:i(m).FILTER_SLASH,rounded:"",raised:"",onClick:T},null,8,["icon"]),e(n,{icon:i(m).PLUS,rounded:"",raised:"",onClick:F},null,8,["icon"])])])]),default:d(()=>[e(r,{field:"salesOrderNumber",header:"Número",sortable:"",style:{width:"10%"}}),e(r,{field:"budgetNumber",header:"Pressupost",style:{width:"10%"}}),e(r,{field:"salesOrderDate",header:"Data",style:{width:"15%"},sortable:""},{body:d(a=>[I(N(i(re)(a.data.salesOrderDate)),1)]),_:1}),e(r,{field:"customerComercialName",header:"Client",style:{width:"30%"}}),e(r,{field:"customerSalesOrderNumber",header:"Comanda client",style:{width:"15%"}}),e(r,{header:"Estat",style:{width:"20%"}},{body:d(a=>[I(N(V(a.data.statusId)),1)]),_:1}),e(r,{style:{width:"5%"}},{body:d(a=>{var x;return[a.data.statusId===((x=i(y).lifecycle)==null?void 0:x.initialStatusId)?(k(),D("i",{key:0,class:Z([i(m).TIMES,"grid_delete_column_button"]),onClick:j=>M(j,a.data)},null,10,pe)):ee("",!0)]}),_:1})]),_:1},8,["value"]),e($,{visible:c.visible,"onUpdate:visible":t[1]||(t[1]=a=>c.visible=a),header:c.title,closable:c.closable,modal:c.modal},{default:d(()=>[e(G,{"create-request":b.value,onSubmit:q},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Re as default};
