import{_ as k}from"./DropdownReference.vue_vue_type_script_setup_true_lang-27729c3c.js";import{_ as q}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-d3be88f5.js";import{d as G,g as Q,u as z,$ as J,j as K,x as P,r as Y,V as X,K as g,o as Z,P as p,a0 as ee,h as u,c as te,i as a,w as i,L as oe,a as le,e as r,k as s,G as v,H as b,R as re,n as V,J as ae}from"./index-aa781fed.js";import{u as se}from"./workmaster-bce9482c.js";import{u as ne}from"./reference-4f638e26.js";import{u as ie}from"./customers-cddcd1f1.js";import"./index-97a3f172.js";const de={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ce={class:"datatable-filter"},ue={class:"filter-field"},me=r("label",{class:"block text-900"},"Referència",-1),fe={class:"filter-field"},pe=r("label",{class:"block text-900"},"Client",-1),be={class:"datatable-buttons"},ve=["onClick"],_e=["onClick"],Ce=r("br",null,null,-1),ye=r("section",{class:"two-columns"},[r("div",null,[r("h3",null,"Origen")]),r("div",null,[r("h3",null,"Destí")])],-1),we={class:"two-columns"},ke=r("label",{class:"block text-900 mb-2"},"Mode",-1),De=G({__name:"Workmasters",setup(Ie){const I=Q(),T=z(),_=J(),C=K(),S=P(),o=se(),y=ne(),B=ie(),n=Y({referenceId:void 0,customerId:void 0}),N=()=>{n.value.referenceId=void 0,n.value.customerId=void 0,_.removeFilter("Workmasters","")},D=X(()=>{if(!o.workmasters)return[];let l=o.workmasters;return n.value.referenceId&&(l=l.filter(t=>t.referenceId===n.value.referenceId)),n.value.customerId&&(l=l.filter(t=>{var d;return((d=t.reference)==null?void 0:d.customerId)===n.value.customerId||t.reference.customerId===null})),l}),m=g({visible:!1,title:"Crear ruta",closable:!0,position:"center",modal:!0}),x=l=>{var t;return(t=o.workmasterModes.find(d=>d.id===l))==null?void 0:t.value},f=g({visible:!1,title:"Copiar ruta",closable:!0,position:"center",modal:!0});Z(async()=>{T.setMenuItem({icon:p.CALENDAR,title:"Gestió de rutes de fabricació"}),y.fetchReferencesByModule("sales"),await o.fetchAll();const l=_.getFilter("Workmasters","");l&&(l.referenceId&&(n.value.referenceId=l.referenceId),l.customerId&&(n.value.customerId=l.customerId))}),ee(()=>{_.addFilter("Workmasters","",n.value)});const R=()=>{const l=ae();o.setNew(l),m.visible=!0},U=(l,t)=>{o.workmasterToCopy={workmasterId:t.id,workmaster:t,referenceId:null,referenceCode:"",mode:1},f.visible=!0},F=async()=>{o.workmasterToCopy.referenceId===""&&(o.workmasterToCopy.referenceId=null);const l=await o.copy(o.workmasterToCopy);await o.fetchAll(),f.visible=!1,l.result?C.add({severity:"success",summary:"Copiada",life:3e3}):C.add({severity:l.errors.length>0?"warn":"error",summary:l.errors.length>0?l.errors[0]:"Hi ha hagut un error en el proces",life:6e3})},M=()=>{o.workmasterToCopy.referenceCode=""},E=()=>{o.workmasterToCopy.referenceId=""},A=l=>{!l.originalEvent.target.className.includes("grid_delete_column_button")&&!l.originalEvent.target.className.includes("grid_copy_column_button")&&I.push({path:`/workmaster/${l.data.id}`})},L=async()=>{if(!o.workmaster)return;await o.create(o.workmaster)&&I.push({path:`/workmaster/${o.workmaster.id}`})},W=(l,t)=>{S.require({target:l.currentTarget,message:`Está segur que vol eliminar la ruta ${t.reference.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await o.delete(t.id)&&(C.add({severity:"success",summary:"Eliminada",life:3e3}),await o.fetchAll())}})};return(l,t)=>{const d=u("Button"),c=u("Column"),$=u("BooleanColumn"),H=u("DataTable"),h=u("Dialog"),O=u("Dropdown"),j=u("BaseInput");return le(),te(oe,null,[a(H,{value:D.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh","sort-field":"reference.code","sort-order":1,onRowClick:A,paginator:"",rows:12},{header:i(()=>[r("div",de,[r("div",ce,[r("div",ue,[me,a(k,{label:"",modelValue:n.value.referenceId,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.referenceId=e),fullName:!0},null,8,["modelValue"])]),r("div",fe,[pe,a(q,{label:"",modelValue:n.value.customerId,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.customerId=e)},null,8,["modelValue"])])]),r("div",be,[a(d,{class:"datatable-button mr-2",icon:s(p).FILTER_SLASH,rounded:"",raised:"",onClick:N},null,8,["icon"]),a(d,{icon:s(p).PLUS,rounded:"",raised:"",onClick:R},null,8,["icon"])])])]),default:i(()=>[a(c,{field:"reference.code",sortable:"",header:"Referencia",style:{width:"40%"}},{body:i(e=>[v(b(s(y).getFullName(e.data.reference)),1)]),_:1}),a(c,{sortable:"",header:"Client",style:{width:"20%"}},{body:i(e=>[v(b(s(B).getCustomerNameById(e.data.reference.customerId)),1)]),_:1}),a(c,{field:"baseQuantity",header:"Quantitat Base",style:{width:"10%"}}),a(c,{header:"Cost",style:{width:"10%"}},{body:i(e=>[v(b(s(re)(e.data.machineCost+e.data.operatorCost+e.data.materialCost+e.data.externalCost)),1)]),_:1}),a(c,{header:"Mode",sytle:"width: 30%"},{body:i(e=>[v(b(x(e.data.mode)),1)]),_:1}),a(c,{header:"Desactivada",style:{width:"10%"}},{body:i(e=>[a($,{value:e.data.disabled},null,8,["value"])]),_:1}),a(c,null,{body:i(e=>[r("i",{class:V([s(p).COPY,"grid_copy_column_button"]),onClick:w=>U(w,e.data)},null,10,ve)]),_:1}),a(c,null,{body:i(e=>[r("i",{class:V([s(p).TIMES,"grid_delete_column_button"]),onClick:w=>W(w,e.data)},null,10,_e)]),_:1})]),_:1},8,["value"]),a(h,{visible:m.visible,"onUpdate:visible":t[3]||(t[3]=e=>m.visible=e),header:m.title,closable:m.closable,modal:m.modal},{default:i(()=>[r("div",null,[a(k,{label:"Referència",modelValue:s(o).workmaster.referenceId,"onUpdate:modelValue":t[2]||(t[2]=e=>s(o).workmaster.referenceId=e),fullName:!0},null,8,["modelValue"])]),Ce,r("div",null,[a(d,{label:"Crear",style:{float:"right"},onClick:L})])]),_:1},8,["visible","header","closable","modal"]),a(h,{visible:f.visible,"onUpdate:visible":t[7]||(t[7]=e=>f.visible=e),header:f.title,closable:!0,modal:!0},{default:i(()=>[ye,r("section",we,[r("div",null,[r("p",null,b(s(y).getFullNameById(s(o).workmasterToCopy.workmaster.referenceId)),1)]),r("div",null,[a(k,{label:"Referència existent:",modelValue:s(o).workmasterToCopy.referenceId,"onUpdate:modelValue":t[4]||(t[4]=e=>s(o).workmasterToCopy.referenceId=e),fullName:!0,onChange:M},null,8,["modelValue"]),ke,a(O,{modelValue:s(o).workmasterToCopy.mode,"onUpdate:modelValue":t[5]||(t[5]=e=>s(o).workmasterToCopy.mode=e),options:s(o).workmasterModes,optionLabel:"value",optionValue:"id",placeholder:"Seleccione el modo",class:"w-full"},null,8,["modelValue","options"]),a(j,{class:"mb-2",label:"Nou codi:",id:"referenceCode",modelValue:s(o).workmasterToCopy.referenceCode,"onUpdate:modelValue":t[6]||(t[6]=e=>s(o).workmasterToCopy.referenceCode=e),onChange:E},null,8,["modelValue"])])]),r("div",null,[a(d,{label:"Copiar",style:{float:"right"},onClick:F})])]),_:1},8,["visible","header"])],64)}}});export{De as default};
