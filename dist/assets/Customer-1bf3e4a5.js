import{d as A,C as D,j as S,r as U,h as v,k as r,a as _,c as q,e as l,i as o,n as m,l as $,M as W,z as L,x as j,F as h,m as T,P as I,w as N,L as O,y as z,G as J,H as G,v as K,u as Q,o as X}from"./index-0165ef2a.js";import{u as M}from"./customers-7ea2bdbb.js";import{c as P,a as V,F as x,b as F}from"./form-validator-29ed56b4.js";import{u as H}from"./masterData-6d455d54.js";const Y={key:0},Z={class:"three-columns"},ee=l("label",{class:"block text-900 mb-2"},"Tipus Client",-1),ae={class:"two-columns mb-2"},se={class:"two-columns mb-2"},oe=l("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),le=l("label",{class:"block text-900 mb-2"},"Observacions",-1),te={class:"mt-2"},ne=A({__name:"FormCustomer",emits:["submit"],setup(B,{emit:b}){const y=M(),E=H(),{customer:i}=D(y),n=S(),t=P().shape({comercialName:V().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),taxName:V().required("El nom fiscal és obligatori"),vatNumber:V().required("El CIF és obligatori"),accountNumber:V().required("El número de compte es obligatori")}),p=U({result:!1,errors:{}}),C=()=>{const s=new x(t);p.value=s.validate(i.value)},u=async()=>{if(C(),p.value.result)b("submit",i.value);else{let s="";Object.entries(p.value.errors).forEach(e=>{s+=`${e[1].map(c=>c)}.   `}),n.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,e)=>{const c=v("BaseInput"),g=v("Dropdown"),d=v("Textarea"),k=v("Button");return r(i)?(_(),q("form",Y,[l("section",Z,[o(c,{name:"comercialName",class:m(["mb-2",{"p-invalid":p.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:r(i).comercialName,"onUpdate:modelValue":e[0]||(e[0]=a=>r(i).comercialName=a)},null,8,["modelValue","class"]),o(c,{class:m(["mb-2",{"p-invalid":p.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:r(i).taxName,"onUpdate:modelValue":e[1]||(e[1]=a=>r(i).taxName=a)},null,8,["modelValue","class"]),l("div",null,[ee,o(g,{modelValue:r(i).customerTypeId,"onUpdate:modelValue":e[2]||(e[2]=a=>r(i).customerTypeId=a),editable:"",options:r(y).customerTypes,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),l("section",ae,[o(c,{name:"vatNumber",class:m(["mb-2",{"p-invalid":p.value.errors.vatNumber}]),label:"CIF",id:"vatNumber",modelValue:r(i).vatNumber,"onUpdate:modelValue":e[3]||(e[3]=a=>r(i).vatNumber=a)},null,8,["modelValue","class"]),o(c,{name:"web",class:m(["mb-2",{"p-invalid":p.value.errors.web}]),label:"Web",id:"web",modelValue:r(i).web,"onUpdate:modelValue":e[4]||(e[4]=a=>r(i).web=a)},null,8,["modelValue","class"])]),l("section",se,[o(c,{name:"accountNumber",class:m(["mb-2",{"p-invalid":p.value.errors.accountNumber}]),label:"Número de compte",id:"accountNumber",modelValue:r(i).accountNumber,"onUpdate:modelValue":e[5]||(e[5]=a=>r(i).accountNumber=a)},null,8,["modelValue","class"]),l("div",null,[oe,o(g,{modelValue:r(i).paymentMethodId,"onUpdate:modelValue":e[6]||(e[6]=a=>r(i).paymentMethodId=a),editable:"",options:r(E).paymentMethods,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])])]),l("div",null,[le,o(d,{modelValue:r(i).observations,"onUpdate:modelValue":e[7]||(e[7]=a=>r(i).observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",te,[o(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),re={key:0},ie={class:"three-columns"},de=l("label",{class:"block text-900 mb-2"},"Principal",-1),ue=l("label",{class:"block text-900 mb-2"},"Desactivada",-1),ce={class:"three-columns mb-2"},me=l("label",{class:"block text-900 mb-2"},"País",-1),pe=l("label",{class:"block text-900 mb-2"},"Província",-1),be=l("label",{class:"block text-900 mb-2"},"Municipi",-1),ve={class:"three-columns mb-2"},fe=l("label",{class:"block text-900 mb-2"},"Observacions",-1),Ce={class:"mt-2"},ye=A({__name:"FormCustomerAddress",props:{address:{}},emits:["submit","cancel"],setup(B,{emit:b}){const y=B,E=W(),i=S(),n=P().shape({name:V().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),country:V().required("El país és obligatori"),region:V().required("La província és obligatoria"),city:V().required("El municipi és obligatori"),postalCode:V().required("El codi postal és obligatori"),address:V().required("La direcció és obligatoria"),main:F().required(),disabled:F().required()}),t=U({result:!1,errors:{}}),p=()=>{const s=y.address;s.address=""},C=()=>{const s=new x(n);t.value=s.validate(y.address)},u=async()=>{if(C(),t.value.result)b("submit",y.address);else{let s="";Object.entries(t.value.errors).forEach(e=>{s+=`${e[1].map(c=>c)}.   `}),i.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,e)=>{const c=v("Checkbox"),g=v("Dropdown"),d=v("Textarea"),k=v("Button");return s.address?(_(),q("form",re,[l("section",ie,[o(L,{id:"name",class:m(["mb-2",{"p-invalid":t.value.errors.name}]),label:"Nom",modelValue:s.address.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.address.name=a)},null,8,["modelValue","class"]),l("div",null,[de,o(c,{modelValue:s.address.main,"onUpdate:modelValue":e[1]||(e[1]=a=>s.address.main=a),class:"w-full",binary:!0},null,8,["modelValue"])]),l("div",null,[ue,o(c,{modelValue:s.address.disabled,"onUpdate:modelValue":e[2]||(e[2]=a=>s.address.disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("section",ce,[l("div",null,[me,o(g,{modelValue:s.address.country,"onUpdate:modelValue":e[3]||(e[3]=a=>s.address.country=a),editable:"",options:["Espanya"],class:m(["w-full",{"p-invalid":t.value.errors.country}])},null,8,["modelValue","class"])]),l("div",null,[pe,o(g,{modelValue:s.address.region,"onUpdate:modelValue":e[4]||(e[4]=a=>s.address.region=a),editable:"",options:r(E).regions,optionValue:"nm",optionLabel:"nm",onChange:p,class:m(["w-full",{"p-invalid":t.value.errors.region}])},null,8,["modelValue","options","class"])]),l("div",null,[be,o(g,{modelValue:s.address.city,"onUpdate:modelValue":e[5]||(e[5]=a=>s.address.city=a),editable:"",options:r(E).getTownsByRegionName(s.address.region),optionValue:"nm",optionLabel:"nm",class:m(["w-full",{"p-invalid":t.value.errors.city}])},null,8,["modelValue","options","class"])])]),l("section",ve,[o(L,{label:"Codi Postal",id:"postalCode",modelValue:s.address.postalCode,"onUpdate:modelValue":e[6]||(e[6]=a=>s.address.postalCode=a),class:m({"p-invalid":t.value.errors.postalCode})},null,8,["modelValue","class"]),o(L,{label:"Direcció",id:"address",modelValue:s.address.address,"onUpdate:modelValue":e[7]||(e[7]=a=>s.address.address=a),class:m({"p-invalid":t.value.errors.address})},null,8,["modelValue","class"])]),l("div",null,[fe,o(d,{modelValue:s.address.observations,"onUpdate:modelValue":e[8]||(e[8]=a=>s.address.observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",Ce,[o(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),Ve={key:2},_e=["onClick"],ge=A({__name:"TableCustomerAddresses",emits:["create","update","delete"],setup(B,{emit:b}){const y=j(),E=M(),{customer:i}=D(E),n=U(h.CREATE),t=U(void 0),p=()=>{var e;t.value={customerId:(e=i.value)==null?void 0:e.id,id:z(),name:"",country:"",region:"",city:"",postalCode:"",address:"",main:!1,disabled:!1,observations:""},n.value=h.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(t.value=e.data,n.value=h.EDIT)},u=()=>{const e=t.value;n.value===h.CREATE?b("create",e):b("update",e),t.value=void 0},s=(e,c)=>{y.require({target:e.currentTarget,message:"Está segur que vol eliminar l'adreça?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var f;const g=v("Button"),d=v("Column"),k=v("BooleanColumn"),a=v("DataTable");return _(),q(O,null,[t.value?$("",!0):(_(),T(g,{key:0,icon:r(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),t.value?(_(),T(ye,{key:1,address:t.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>t.value=void 0)},null,8,["address"])):(_(),q("div",Ve,[(f=r(i))!=null&&f.address?(_(),T(a,{key:0,value:r(i).address,tableStyle:"min-width: 100%",onRowClick:C},{default:N(()=>[o(d,{header:"Nom",field:"name",style:{width:"25%"}}),o(d,{header:"Província",field:"region",style:{width:"25%"}}),o(d,{header:"Municipi",field:"city",style:{width:"25%"}}),o(d,{header:"Codi Postal",field:"postalCode",style:{width:"25%"}}),o(d,{header:"Principal"},{body:N(w=>[o(k,{value:w.data.main,"show-color":!1},null,8,["value"])]),_:1}),o(d,null,{body:N(w=>[l("i",{class:m([r(I).TIMES,"grid_delete_column_button"]),onClick:R=>s(R,w.data)},null,10,_e)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),he={key:0},we={class:"three-columns"},Ne={class:"four-columns"},Ee=l("label",{class:"block text-900 mb-2"},"Predeterminat",-1),ke={class:"mt-2"},Te=A({__name:"FormCustomerContact",props:{contact:{}},emits:["submit","cancel"],setup(B,{emit:b}){const y=B,E=S(),i=P().shape({firstName:V().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:V().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:V(),email:V().required("El correu és obligatori").email("Correu electrònic invàlid"),phoneNumber:V().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),extension:V().required("L'extensió del telèfon és obligatoria"),disabled:F().required(),main:F().required()}),n=U({result:!1,errors:{}}),t=()=>{const u=new x(i);n.value=u.validate(y.contact)},p=async()=>{if(t(),n.value.result)b("submit",y.contact);else{let u="";Object.entries(n.value.errors).forEach(s=>{u+=`${s[1].map(e=>e)}.   `}),E.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}},C=()=>{b("cancel")};return(u,s)=>{const e=v("BaseInput"),c=v("Checkbox"),g=v("Button");return u.contact?(_(),q("form",he,[l("section",we,[o(e,{label:"Nom",id:"firstName",modelValue:u.contact.firstName,"onUpdate:modelValue":s[0]||(s[0]=d=>u.contact.firstName=d),class:m(["mb-2",{"p-invalid":n.value.errors.firstName}])},null,8,["modelValue","class"]),o(e,{label:"Cognoms",id:"lastName",modelValue:u.contact.lastName,"onUpdate:modelValue":s[1]||(s[1]=d=>u.contact.lastName=d),class:m(["mb-2",{"p-invalid":n.value.errors.lastName}])},null,8,["modelValue","class"]),o(e,{label:"Càrrec",id:"charge",modelValue:u.contact.charge,"onUpdate:modelValue":s[2]||(s[2]=d=>u.contact.charge=d),class:m(["mb-2",{"p-invalid":n.value.errors.charge}])},null,8,["modelValue","class"])]),l("section",Ne,[o(e,{class:m(["mb-2",{"p-invalid":n.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:u.contact.email,"onUpdate:modelValue":s[3]||(s[3]=d=>u.contact.email=d)},null,8,["modelValue","class"]),o(e,{class:m(["mb-2",{"p-invalid":n.value.errors.extension}]),label:"Extensió",id:"extension",modelValue:u.contact.extension,"onUpdate:modelValue":s[4]||(s[4]=d=>u.contact.extension=d)},null,8,["modelValue","class"]),o(e,{class:m(["mb-2",{"p-invalid":n.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:u.contact.phoneNumber,"onUpdate:modelValue":s[5]||(s[5]=d=>u.contact.phoneNumber=d)},null,8,["modelValue","class"]),l("div",null,[Ee,o(c,{modelValue:u.contact.main,"onUpdate:modelValue":s[6]||(s[6]=d=>u.contact.main=d),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("div",ke,[o(g,{label:"Guardar",class:"mr-2",onClick:p}),o(g,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:C})])])):$("",!0)}}}),$e={key:2},Ie=["onClick"],Ue=A({__name:"TableCustomerContacts",emits:["create","update","delete"],setup(B,{emit:b}){const y=j(),E=M(),{customer:i}=D(E),n=U(h.CREATE),t=U(void 0),p=()=>{var e;t.value={customerId:(e=i.value)==null?void 0:e.id,id:z(),charge:"",email:"",firstName:"",lastName:"",disabled:!1,main:!1,phoneNumber:""},n.value=h.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(t.value=e.data,n.value=h.EDIT)},u=()=>{const e=t.value;n.value===h.CREATE?b("create",e):b("update",e),t.value=void 0},s=(e,c)=>{y.require({target:e.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var a;const g=v("Button"),d=v("Column"),k=v("DataTable");return _(),q(O,null,[t.value?$("",!0):(_(),T(g,{key:0,icon:r(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),t.value?(_(),T(Te,{key:1,contact:t.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>t.value=void 0)},null,8,["contact"])):(_(),q("div",$e,[(a=r(i))!=null&&a.contacts?(_(),T(k,{key:0,value:r(i).contacts,tableStyle:"min-width: 100%",onRowClick:C},{default:N(()=>[o(d,{header:"Nom",style:{width:"25%"}},{body:N(f=>[J(G(f.data.firstName)+" "+G(f.data.lastName),1)]),_:1}),o(d,{header:"Càrrec",field:"charge",style:{width:"25%"}}),o(d,{header:"Correu",field:"email",style:{width:"25%"}}),o(d,{header:"Ext.",field:"extension",style:{width:"5%"}}),o(d,{header:"Telèfon",field:"phoneNumber",style:{width:"20%"}}),o(d,null,{body:N(f=>[l("i",{class:m([r(I).TIMES,"grid_delete_column_button"]),onClick:w=>s(w,f.data)},null,10,Ie)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),Be=l("span",null,"Client",-1),qe=l("span",null,"Contactes",-1),Ae=l("span",null,"Adreces",-1),Re=A({__name:"Customer",setup(B){const b=U(h.EDIT),y=K(),E=Q(),i=H(),n=M(),{customer:t}=D(n),p=async()=>{await n.fetchCustomer(y.params.id),n.fetchCustomerTypes(),i.fetchMasterData();let a="";t.value?(b.value=h.EDIT,a=`Client ${t.value.comercialName}`):(b.value=h.CREATE,n.setNewCustomer(y.params.id),a="Alta de client"),E.setMenuItem({icon:I.BUILDING,title:a,backButtonVisible:!0})};X(async()=>{await p()});const C=S(),u=async()=>{const a=t.value;let f=!1,w="";b.value===h.CREATE?(f=await n.createCustomer(a),w="Client creat correctament"):(f=await n.updateCustomer(a.id,a),w="Client actualizat correctament"),f&&(C.add({severity:"success",summary:w,life:5e3}),await p())},s=async a=>{await n.addContactToCustomer(a)&&C.add({severity:"success",summary:"Contacte afegit",life:5e3})},e=async a=>{await n.updateContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte actualizat",life:5e3})},c=async a=>{await n.removeContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte eliminat",life:5e3})},g=async a=>{await n.addAddressToCustomer(a)&&C.add({severity:"success",summary:"Adreça afegida",life:5e3})},d=async a=>{await n.updateAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça actualizada",life:5e3})},k=async a=>{await n.removeAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça eliminada",life:5e3})};return(a,f)=>{const w=v("TabPanel"),R=v("TabView");return _(),T(R,null,{default:N(()=>[o(w,null,{header:N(()=>[l("i",{class:m([r(I).WALLET,"mr-2"])},null,2),Be]),default:N(()=>[o(ne,{onSubmit:u})]),_:1}),b.value===r(h).EDIT?(_(),T(w,{key:0},{header:N(()=>[l("i",{class:m([r(I).USERS,"mr-2"])},null,2),qe]),default:N(()=>[o(Ue,{onCreate:s,onUpdate:e,onDelete:c})]),_:1})):$("",!0),b.value===r(h).EDIT?(_(),T(w,{key:1},{header:N(()=>[l("i",{class:m([r(I).ENVELOPE,"mr-2"])},null,2),Ae]),default:N(()=>[o(ge,{onCreate:g,onUpdate:d,onDelete:k})]),_:1})):$("",!0)]),_:1})}}});export{Re as default};
