import{d as L,j as G,K as de,r as F,h as P,a as D,c as A,e,i as t,k as s,n as $,s as Q,y as N,l as W,E as K,x as ne,w as m,P as R,C as g,D as I,m as M,G as X,J as ie,v as ue,g as ce,u as me,z as pe,o as fe,p as ke,b as be,f as we}from"./index-0c51ec9c.js";import{u as H}from"./plantmodel-f7819718.js";import{u as Y}from"./workorder-2e91182c.js";import{c as Z,a as q,d as j,F as ee}from"./form-validator-f8953ae6.js";import{_ as _e}from"./DropdownReference.vue_vue_type_script_setup_true_lang-53939be1.js";import{u as J}from"./lifecycle-44d614e8.js";import{_ as he}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-0a078129.js";import{g as te,h as ve,f as ye,c as Pe,d as x}from"./functions-2e154ea4.js";import{_ as Ie}from"./FormWorkorderPhase.vue_vue_type_script_setup_true_lang-24cf44c6.js";import{u as oe}from"./productionpart-a431b4bc.js";import{u as Oe}from"./reference-7bd40fb9.js";import"./index-3b48b213.js";import"./base.service-ebedc193.js";import"./_commonjsHelpers-725317a4.js";import"./index-f0c9bd46.js";import"./reference.service-051d81be.js";import"./v4-a960c1f4.js";const Ce={key:0},Ve={class:"mt-2"},Te=e("label",{class:"block text-900 mb-2"},"Fase | Activitat",-1),ge={class:"three-columns mt-2"},De=e("label",{class:"block text-900 mb-2"},"Operari",-1),$e=e("label",{class:"block text-900 mb-2"},"Màquina",-1),Se=e("label",{class:"block text-900 mb-2"},"Data Tíquet",-1),qe={class:"two-columns mt-2"},We=e("br",null,null,-1),Be={class:"flex-right"},Ee=L({__name:"FormWorkOrderProductionPart",props:{productionPart:{},avoidWorkOrderRefresh:{type:Boolean}},emits:["submit","cancel"],setup(C,{emit:V}){const v=C,y=G(),T=H(),b=Y(),h=de(()=>{var p,i,f;if(!v.productionPart.workOrderPhaseId)return[];const u=(i=(p=b.workorder)==null?void 0:p.phases)==null?void 0:i.find(_=>_.id===v.productionPart.workOrderPhaseId);return u?(f=T.workcenters)==null?void 0:f.filter(_=>_.workcenterTypeId===u.workcenterTypeId):T.workcenters}),n=F(void 0),r=()=>{n.value.value&&(v.productionPart.workOrderId=n.value.value.workOrderId,v.productionPart.workOrderPhaseId=n.value.value.workOrderPhaseId,v.productionPart.workOrderPhaseDetailId=n.value.value.workOrderPhaseDetailId)},l=Z().shape({operatorId:q().required("Escull un operari"),workcenterId:q().required("Escull una màquina"),workOrderId:q().required("Escull una ordre de fabricació"),workOrderPhaseId:q().required("Escull una fase"),workOrderPhaseDetailId:q().required("Escull una activitat"),quantity:j().required("Has d'introduir una quantitat entera (pot ser 0)").integer(),time:j().required("Has d'introduir el temps i ha de ser major que 0").moreThan(0)}),o=F({result:!1,errors:{}}),w=()=>{const u=new ee(l);o.value=u.validate(v.productionPart)},O=async u=>{v.avoidWorkOrderRefresh||(n.value=void 0,await b.fetchByWorkcenterId(u))},c=async()=>{if(w(),o.value.result)V("submit",v.productionPart);else{let u="";Object.entries(o.value.errors).forEach(p=>{u+=`${p[1].map(i=>i)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}};return(u,p)=>{var k,B,E;const i=P("Dropdown"),f=P("Calendar"),_=P("Button");return u.productionPart?(D(),A("form",Ce,[e("section",Ve,[e("div",null,[Te,t(i,{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=d=>n.value=d),editable:"",filter:!0,options:(k=s(b).detailedWorkOrders)==null?void 0:k.sort((d,a)=>d.workOrderCode.localeCompare(a.workOrderCode)).map(d=>({label:"Fase "+d.workOrderPhaseCode+"  ("+d.workOrderPhaseDescription+") | "+d.machineStatusDescription,value:d})),optionLabel:"label",class:$(["w-full",{"p-invalid":o.value.errors.workOrderId}]),onChange:r},null,8,["modelValue","options","class"])])]),e("section",ge,[e("div",null,[De,t(i,{modelValue:u.productionPart.operatorId,"onUpdate:modelValue":p[1]||(p[1]=d=>u.productionPart.operatorId=d),editable:"",filter:!0,options:(B=s(T).operators)==null?void 0:B.sort((d,a)=>d.surname.localeCompare(a.surname)).map(d=>({value:d.id,label:d.name+" "+d.surname})),optionValue:"value",optionLabel:"label",class:$(["w-full",{"p-invalid":o.value.errors.operatorid}])},null,8,["modelValue","options","class"])]),e("div",null,[$e,t(i,{modelValue:u.productionPart.workcenterId,"onUpdate:modelValue":p[2]||(p[2]=d=>u.productionPart.workcenterId=d),editable:"",filter:!0,options:(E=h.value)==null?void 0:E.sort((d,a)=>d.description.localeCompare(a.description)),optionValue:"id",optionLabel:"description",class:"w-full",onChange:p[3]||(p[3]=d=>O(u.productionPart.workcenterId))},null,8,["modelValue","options"])]),e("div",null,[Se,t(f,{modelValue:u.productionPart.date,"onUpdate:modelValue":p[4]||(p[4]=d=>u.productionPart.date=d),dateFormat:"dd/mm/yy"},null,8,["modelValue"])])]),e("section",qe,[e("div",null,[t(N,{type:s(Q).NUMERIC,label:"Quantitat",id:"quantity",modelValue:u.productionPart.quantity,"onUpdate:modelValue":p[5]||(p[5]=d=>u.productionPart.quantity=d)},null,8,["type","modelValue"])]),e("div",null,[t(N,{type:s(Q).NUMERIC,label:"Temps total (minuts)",id:"time",modelValue:u.productionPart.time,"onUpdate:modelValue":p[6]||(p[6]=d=>u.productionPart.time=d)},null,8,["type","modelValue"])])]),We,e("div",Be,[t(_,{label:"Guardar",size:"small",onClick:c})])])):W("",!0)}}}),Ue={key:0},Me=e("br",null,null,-1),Fe={class:"four-columns"},Ne=e("label",{class:"block text-900 mb-2"},"Data Prevista",-1),Re={class:"four-columns"},Le=e("label",{class:"block text-900 mb-2"},"Data Inici",-1),xe=e("label",{class:"block text-900 mb-2"},"Data Fi",-1),Qe=e("label",{class:"block text-900 mb-2"},"Comentari Fabricació",-1),je=L({__name:"FormWorkorder",props:{workorder:{}},emits:["submit","cancel"],setup(C,{emit:V}){const v=C;J();const y=G(),T=Z().shape({plannedQuantity:j().min(1,"La quantitat ha de ser superior a 0").required("La quanitat és obligatoria"),referenceId:q().required("La referència és obligatoria"),order:j().required("L'ordre és obligatori"),plannedDate:q().required("La data prevista és obligatoria")}),b=F({result:!1,errors:{}}),h=()=>{const r=new ee(T);b.value=r.validate(v.workorder)},n=async()=>{if(h(),b.value.result)V("submit",v.workorder);else{let r="";Object.entries(b.value.errors).forEach(l=>{r+=`${l[1].map(o=>o)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:r,life:5e3})}};return(r,l)=>{const o=P("Button"),w=P("Calendar"),O=P("Textarea");return r.workorder?(D(),A("form",Ue,[e("div",null,[t(o,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:n}),Me]),e("section",Fe,[e("div",null,[t(N,{label:"Codi",modelValue:r.workorder.code,"onUpdate:modelValue":l[0]||(l[0]=c=>r.workorder.code=c),disabled:""},null,8,["modelValue"])]),e("div",null,[t(_e,{label:"Referència",modelValue:r.workorder.referenceId,"onUpdate:modelValue":l[1]||(l[1]=c=>r.workorder.referenceId=c),fullName:!0,disabled:""},null,8,["modelValue"])]),e("div",null,[t(N,{type:s(Q).NUMERIC,label:"Quantitat",modelValue:r.workorder.plannedQuantity,"onUpdate:modelValue":l[2]||(l[2]=c=>r.workorder.plannedQuantity=c),class:$({"p-invalid":b.value.errors.plannedQuantity})},null,8,["type","modelValue","class"])]),e("div",null,[Ne,t(w,{modelValue:r.workorder.plannedDate,"onUpdate:modelValue":l[3]||(l[3]=c=>r.workorder.plannedDate=c),dateFormat:"dd/mm/yy",class:$(["mt-2",{"p-invalid":b.value.errors.plannedDate}])},null,8,["modelValue","class"])])]),e("section",Re,[e("div",null,[t(he,{label:"Estat",modelValue:r.workorder.statusId,"onUpdate:modelValue":l[4]||(l[4]=c=>r.workorder.statusId=c),class:$({"p-invalid":b.value.errors.statusId})},null,8,["modelValue","class"])]),e("div",null,[Le,t(w,{modelValue:r.workorder.startTime,"onUpdate:modelValue":l[5]||(l[5]=c=>r.workorder.startTime=c),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),e("div",null,[xe,t(w,{modelValue:r.workorder.endTime,"onUpdate:modelValue":l[6]||(l[6]=c=>r.workorder.endTime=c),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),e("div",null,[t(N,{type:s(Q).NUMERIC,label:"Ordre",modelValue:r.workorder.order,"onUpdate:modelValue":l[7]||(l[7]=c=>r.workorder.order=c),class:$({"p-invalid":b.value.errors.plannedorderQuantity})},null,8,["type","modelValue","class"])])]),e("div",null,[Qe,t(O,{class:"w-full",modelValue:r.workorder.comment,"onUpdate:modelValue":l[8]||(l[8]=c=>r.workorder.comment=c)},null,8,["modelValue"])])])):W("",!0)}}}),Ae={class:"flex flex-wrap align-items-center justify-content-between gap-2"},He=e("span",{class:"text-xl text-900 font-bold"},"Fases",-1),ze=["onClick"],Ge=L({__name:"TableWorkorderPhases",props:{workorder:{},workorderPhases:{}},emits:["add","edit","delete"],setup(C,{emit:V}){const v=C,y=K({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),T=ne(),b=H(),h=J(),n=i=>{var _;if(!b.workcenterTypes)return"";const f=(_=b.workcenterTypes)==null?void 0:_.find(k=>i===k.id);return f?f.name:""},r=i=>{var _;if(!b.workcenters)return"";const f=(_=b.workcenters)==null?void 0:_.find(k=>i===k.id);return f?f.name:""},l=i=>{var _;if(!b.operatorTypes)return"";const f=(_=b.operatorTypes)==null?void 0:_.find(k=>i===k.id);return f?f.name:""},o=i=>{var _;if(!h.lifecycle||!h.lifecycle.statuses)return"";const f=(_=h.lifecycle.statuses)==null?void 0:_.find(k=>i===k.id);return f?f.name:""},w=F({}),O=()=>{w.value={id:te(),workOrderId:v.workorder.id,disabled:!1,code:((v.workorder.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,statusId:"",startTime:null,endTime:null,workOrderPhaseDetails:[],workOrderPhaseBillOfMaterials:[]},y.visible=!0},c=i=>{y.visible=!1,V("add",i)},u=i=>{i.originalEvent.target.className.includes("grid_delete_column_button")||V("edit",i.data)},p=(i,f)=>{T.require({target:i.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{V("delete",f)}})};return(i,f)=>{const _=P("Button"),k=P("Column"),B=P("BooleanColumn"),E=P("DataTable"),d=P("Dialog");return D(),A(X,null,[t(E,{onRowClick:u,value:i.workorderPhases,tableStyle:"min-width: 100%","sort-field":"code","sort-order":1},{header:m(()=>[e("div",Ae,[He,t(_,{icon:s(R).PLUS,rounded:"",raised:"",onClick:O},null,8,["icon"])])]),default:m(()=>[t(k,{field:"code",header:"Codi",sortable:"",style:{width:"10%"}}),t(k,{field:"description",header:"Descripció",style:{width:"15%"}}),t(k,{header:"Tipus de màquina",style:{width:"15%"}},{body:m(a=>[g(I(n(a.data.workcenterTypeId)),1)]),_:1}),t(k,{header:"Màquina preferida",style:{width:"15%"}},{body:m(a=>[g(I(r(a.data.preferredWorkcenterId)),1)]),_:1}),t(k,{header:"Tipus d'operari",style:{width:"15%"}},{body:m(a=>[g(I(l(a.data.operatorTypeId)),1)]),_:1}),t(k,{header:"Estat",style:{width:"15%"}},{body:m(a=>[g(I(o(a.data.statusId)),1)]),_:1}),t(k,{header:"Extern",style:{width:"5%"}},{body:m(a=>[t(B,{value:a.data.isExternalWork},null,8,["value"])]),_:1}),t(k,{style:{width:"5%"}},{body:m(a=>[e("i",{class:$([s(R).TIMES,"grid_delete_column_button"]),onClick:U=>p(U,a.data)},null,10,ze)]),_:1})]),_:1},8,["value"]),t(d,{visible:y.visible,"onUpdate:visible":f[0]||(f[0]=a=>y.visible=a),header:y.title,closable:y.closable,modal:y.modal},{default:m(()=>[w.value?(D(),M(Ie,{key:0,workorder:i.workorder,phase:w.value,onSubmit:c},null,8,["workorder","phase"])):W("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),Je=["onClick"],Ke=L({__name:"TableProductionParts",emits:["delete"],setup(C,{emit:V}){const v=oe(),y=H(),T=h=>{if(!h)return"";if(h.workOrderPhase&&h.workOrderPhaseDetail){const n=y.getMachineStatusNameById(h.workOrderPhaseDetail.machineStatusId);return`(${h.workOrderPhase.code}) ${h.workOrderPhase.description} - ${n}`}},b=(h,n)=>{h.stopPropagation(),V("delete",n)};return(h,n)=>{const r=P("Column"),l=P("DataTable");return D(),M(l,{value:s(v).productionParts,class:"p-datatable-sm",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"40vh"},{header:m(()=>[ie(h.$slots,"header")]),empty:m(()=>[g(" No s'han trobat tiquets. ")]),loading:m(()=>[g(" Carregant tiquets. Si us plau espera. ")]),default:m(()=>[t(r,{field:"operatorId",header:"Operari",style:{width:"15%"}},{body:m(o=>[g(I(s(y).getOperatorNameById(o.data.operatorId)),1)]),_:1}),t(r,{field:"workcenterId",header:"Màquina",style:{width:"20%"}},{body:m(o=>[g(I(s(y).getWorkcenterNameById(o.data.workcenterId)),1)]),_:1}),t(r,{field:"workOrderPhaseId",header:"Fase/Estat",style:{width:"25%"}},{body:m(o=>[g(I(T(o.data)),1)]),_:1}),t(r,{field:"date",header:"Data",style:{width:"15%"}},{body:m(o=>[g(I(s(ve)(o.data.date)),1)]),_:1}),t(r,{field:"quantity",header:"Quantitat",style:{width:"10%"}}),t(r,{field:"time",header:"Temps Total (min)",style:{width:"15%"}}),t(r,{style:{width:"5%"}},{body:m(o=>[e("i",{class:$([s(R).TIMES,"grid_delete_column_button"]),onClick:w=>b(w,o.data)},null,10,Je)]),_:1})]),_:3},8,["value"])}}}),S=C=>(ke("data-v-beef5da0"),C=C(),be(),C),Xe={class:"main"},Ye={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Ze=S(()=>e("span",{class:"text-xl text-900 font-bold"},"Hores",-1)),et={class:"four-columns"},tt={class:"mt-1"},ot=S(()=>e("label",{class:"block text-900 mb-2"},"Temps Operari:",-1)),rt={class:"summary-field"},at={class:"mt-1"},st=S(()=>e("label",{class:"block text-900 mb-2"},"Temps Màquina:",-1)),lt={class:"summary-field"},dt=S(()=>e("div",{class:"mt-1"},null,-1)),nt={class:"four-columns mt-4"},it={class:"mt-1"},ut=S(()=>e("label",{class:"block text-900 mb-2"},"Cost Operari:",-1)),ct={class:"summary-field"},mt={class:"mt-1"},pt=S(()=>e("label",{class:"block text-900 mb-2"},"Cost Máquina:",-1)),ft={class:"summary-field"},kt={class:"mt-1"},bt=S(()=>e("label",{class:"block text-900 mb-2"},"Cost Material:",-1)),wt={class:"summary-field"},_t={class:"mt-1"},ht=S(()=>e("label",{class:"block text-900 mb-2"},"Cost Total:",-1)),vt={class:"summary-field"},yt=L({__name:"Workorder",setup(C){const V=ue(),v=ce(),y=me(),T=G(),b=J(),h=Oe(),n=Y(),r=H(),l=oe(),{workorder:o}=pe(n),w=F(""),O=K({visible:!1,title:"Crear tíquet de producció",closable:!0,position:"center",modal:!0});fe(async()=>{w.value=V.params.id,n.detailedWorkOrders=void 0,await u();let a="";a="Ordre de fabricació",o.value&&(a=`${a} ${o.value.code}`),y.setMenuItem({icon:R.BUILDING,backButtonVisible:!0,title:a})});const c=async()=>{await n.fetchOne(w.value),n.workorder&&(n.workorder.plannedDate=ye(n.workorder.plannedDate))},u=async()=>{h.fetchReferencesByModule("sales"),r.fetchActiveModel(),b.fetchOneByName("WorkOrder"),l.fetchByWorkOrderId(w.value),await c()},p=async a=>{n.workorder&&(n.workorder.plannedDate=Pe(n.workorder.plannedDate)),await n.update(w.value,a)&&await u()},i=async a=>{await n.createPhase(a)?v.push({path:`/workorder/${w.value}/phase/${a.id}`}):T.add({severity:"error",summary:"Error al crear la fase",detail:"Revisi el log per a més informació",life:1e4})},f=a=>{v.push({path:`/workorder/${w.value}/phase/${a.id}`})},_=async a=>{await n.deletePhase(a.id)},k=F({}),B=()=>{k.value={id:te(),workOrderId:w.value,workOrderPhaseId:"",workOrderPhaseDetailId:"",operatorId:"",workcenterId:"",time:0,quantity:0,date:new Date},o.value&&n.fetchByWorkOrderId(o.value.id),O.visible=!0},E=async()=>{O.visible=!1,await l.create(k.value)&&(l.fetchByWorkOrderId(w.value),c())},d=async a=>{await l.delete(a.id),l.fetchByWorkOrderId(w.value),c()};return(a,U)=>{const z=P("TabPanel"),re=P("Button"),ae=P("TabView"),se=P("Dialog");return D(),A(X,null,[e("header",null,[s(o)?(D(),M(je,{key:0,workorder:s(o),onSubmit:p},null,8,["workorder"])):W("",!0)]),e("main",Xe,[t(ae,null,{default:m(()=>[t(z,{header:"Fases"},{default:m(()=>[s(o)&&s(o).phases?(D(),M(Ge,{key:0,workorder:s(o),workorderPhases:s(o).phases,onAdd:i,onEdit:f,onDelete:_},null,8,["workorder","workorderPhases"])):W("",!0)]),_:1}),t(z,{header:"Hores"},{default:m(()=>[s(l).productionParts?(D(),M(Ke,{key:0,productionParts:s(l).productionParts,onDelete:d},{header:m(()=>[e("div",Ye,[Ze,t(re,{icon:s(R).PLUS,rounded:"",raised:"",onClick:B},null,8,["icon"])])]),_:1},8,["productionParts"])):W("",!0)]),_:1}),s(o)?(D(),M(z,{key:0,header:"Costs"},{default:m(()=>[e("section",et,[e("div",tt,[ot,e("span",rt,I(s(o).operatorTime)+" mins.",1)]),e("div",at,[st,e("span",lt,I(s(o).machineTime)+" mins.",1)]),dt]),e("section",nt,[e("div",it,[ut,e("span",ct,I(s(x)(s(o).operatorCost)),1)]),e("div",mt,[pt,e("span",ft,I(s(x)(s(o).machineCost)),1)]),e("div",kt,[bt,e("span",wt,I(s(x)(s(o).materialCost)),1)]),e("div",_t,[ht,e("span",vt,I(s(x)(s(o).machineCost+s(o).materialCost+s(o).operatorCost)),1)])])]),_:1})):W("",!0)]),_:1})]),t(se,{visible:O.visible,"onUpdate:visible":U[0]||(U[0]=le=>O.visible=le),header:O.title,closable:O.closable,modal:O.modal},{default:m(()=>[t(Ee,{productionPart:k.value,"avoid-work-order-refresh":!0,onSubmit:E},null,8,["productionPart"])]),_:1},8,["visible","header","closable","modal"])],64)}}});const Nt=we(yt,[["__scopeId","data-v-beef5da0"]]);export{Nt as default};
