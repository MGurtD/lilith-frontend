import{_ as H}from"./DropdownReference.vue_vue_type_script_setup_true_lang-d9949780.js";import{c as J,d as M,a as R,F as K}from"./form-validator-f8953ae6.js";import{d as E,j as L,r as U,h as b,c as N,e as t,i as a,y as W,k,n as T,l as S,a as h,s as q,E as X,x as Y,w,G as Q,P as B,C,D,m as O,v as Z,g as ee,u as re,z as oe,o as te,f as ae}from"./index-61ceac46.js";import{u as F}from"./lifecycle-89ce980f.js";import{_ as se,a as le}from"./FormWorkorderPhase.vue_vue_type_script_setup_true_lang-421bd6ab.js";import{g as ne,f as de,c as ie}from"./functions-4d7ada1d.js";import{u as j}from"./plantmodel-e5258ecb.js";import{u as ue}from"./reference-d9f5317f.js";import{u as ce}from"./workorder-586574a0.js";import"./_commonjsHelpers-725317a4.js";import"./index-f0d98432.js";import"./base.service-558553c0.js";import"./reference.service-bac3a278.js";import"./v4-a960c1f4.js";import"./index-5c7caccd.js";const me={key:0},pe=t("br",null,null,-1),fe={class:"four-columns"},ke=t("label",{class:"block text-900 mb-2"},"Data Prevista",-1),we={class:"four-columns"},ye=t("label",{class:"block text-900 mb-2"},"Data Inici",-1),be=t("label",{class:"block text-900 mb-2"},"Data Fi",-1),ve=t("label",{class:"block text-900 mb-2"},"Comentari Fabricació",-1),_e=E({__name:"FormWorkorder",props:{workorder:{}},emits:["submit","cancel"],setup(I,{emit:v}){const y=I;F();const m=L(),V=J().shape({plannedQuantity:M().min(1,"La quantitat ha de ser superior a 0").required("La quanitat és obligatoria"),referenceId:R().required("La referència és obligatoria"),order:M().required("L'ordre és obligatori"),plannedDate:R().required("La data prevista és obligatoria")}),n=U({result:!1,errors:{}}),_=()=>{const o=new K(V);n.value=o.validate(y.workorder)},i=async()=>{if(_(),n.value.result)v("submit",y.workorder);else{let o="";Object.entries(n.value.errors).forEach(r=>{o+=`${r[1].map(p=>p)}.   `}),m.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,r)=>{const p=b("Button"),f=b("Calendar"),g=b("Textarea");return o.workorder?(h(),N("form",me,[t("div",null,[a(p,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:i}),pe]),t("section",fe,[t("div",null,[a(W,{label:"Codi",modelValue:o.workorder.code,"onUpdate:modelValue":r[0]||(r[0]=s=>o.workorder.code=s),disabled:""},null,8,["modelValue"])]),t("div",null,[a(H,{label:"Referència",modelValue:o.workorder.referenceId,"onUpdate:modelValue":r[1]||(r[1]=s=>o.workorder.referenceId=s),fullName:!0,disabled:""},null,8,["modelValue"])]),t("div",null,[a(W,{type:k(q).NUMERIC,label:"Quantitat",modelValue:o.workorder.plannedQuantity,"onUpdate:modelValue":r[2]||(r[2]=s=>o.workorder.plannedQuantity=s),class:T({"p-invalid":n.value.errors.plannedQuantity})},null,8,["type","modelValue","class"])]),t("div",null,[ke,a(f,{modelValue:o.workorder.plannedDate,"onUpdate:modelValue":r[3]||(r[3]=s=>o.workorder.plannedDate=s),dateFormat:"dd/mm/yy",class:T(["mt-2",{"p-invalid":n.value.errors.plannedDate}])},null,8,["modelValue","class"])])]),t("section",we,[t("div",null,[a(se,{label:"Estat",modelValue:o.workorder.statusId,"onUpdate:modelValue":r[4]||(r[4]=s=>o.workorder.statusId=s),class:T({"p-invalid":n.value.errors.statusId})},null,8,["modelValue","class"])]),t("div",null,[ye,a(f,{modelValue:o.workorder.startTime,"onUpdate:modelValue":r[5]||(r[5]=s=>o.workorder.startTime=s),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),t("div",null,[be,a(f,{modelValue:o.workorder.endTime,"onUpdate:modelValue":r[6]||(r[6]=s=>o.workorder.endTime=s),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),t("div",null,[a(W,{type:k(q).NUMERIC,label:"Ordre",modelValue:o.workorder.order,"onUpdate:modelValue":r[7]||(r[7]=s=>o.workorder.order=s),class:T({"p-invalid":n.value.errors.plannedorderQuantity})},null,8,["type","modelValue","class"])])]),t("div",null,[ve,a(g,{class:"w-full",modelValue:o.workorder.comment,"onUpdate:modelValue":r[8]||(r[8]=s=>o.workorder.comment=s)},null,8,["modelValue"])])])):S("",!0)}}}),he={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Ve=t("span",{class:"text-xl text-900 font-bold"},"Fases",-1),ge=["onClick"],Te=E({__name:"TableWorkorderPhases",props:{workorder:{},workorderPhases:{}},emits:["add","edit","delete"],setup(I,{emit:v}){const y=I,m=X({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),V=Y(),n=j(),_=F(),i=e=>{var u;if(!n.workcenterTypes)return"";const l=(u=n.workcenterTypes)==null?void 0:u.find(d=>e===d.id);return l?l.name:""},o=e=>{var u;if(!n.workcenters)return"";const l=(u=n.workcenters)==null?void 0:u.find(d=>e===d.id);return l?l.name:""},r=e=>{var u;if(!n.operatorTypes)return"";const l=(u=n.operatorTypes)==null?void 0:u.find(d=>e===d.id);return l?l.name:""},p=e=>{var u;if(!_.lifecycle||!_.lifecycle.statuses)return"";const l=(u=_.lifecycle.statuses)==null?void 0:u.find(d=>e===d.id);return l?l.name:""},f=U({}),g=()=>{f.value={id:ne(),workOrderId:y.workorder.id,disabled:!1,code:((y.workorder.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,statusId:"",startTime:null,endTime:null,workOrderPhaseDetails:[],workOrderPhaseBillOfMaterials:[]},m.visible=!0},s=e=>{m.visible=!1,v("add",e)},$=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||v("edit",e.data)},P=(e,l)=>{V.require({target:e.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",l)}})};return(e,l)=>{const u=b("Button"),d=b("Column"),A=b("BooleanColumn"),x=b("DataTable"),z=b("Dialog");return h(),N(Q,null,[a(x,{onRowClick:$,value:e.workorderPhases,tableStyle:"min-width: 100%"},{header:w(()=>[t("div",he,[Ve,a(u,{icon:k(B).PLUS,rounded:"",raised:"",onClick:g},null,8,["icon"])])]),default:w(()=>[a(d,{field:"code",header:"Codi",style:{width:"10%"}}),a(d,{field:"description",header:"Descripció",style:{width:"15%"}}),a(d,{header:"Tipus de màquina",style:{width:"15%"}},{body:w(c=>[C(D(i(c.data.workcenterTypeId)),1)]),_:1}),a(d,{header:"Màquina preferida",style:{width:"15%"}},{body:w(c=>[C(D(o(c.data.preferredWorkcenterId)),1)]),_:1}),a(d,{header:"Tipus d'operari",style:{width:"15%"}},{body:w(c=>[C(D(r(c.data.operatorTypeId)),1)]),_:1}),a(d,{header:"Estat",style:{width:"15%"}},{body:w(c=>[C(D(p(c.data.statusId)),1)]),_:1}),a(d,{header:"Extern",style:{width:"5%"}},{body:w(c=>[a(A,{value:c.data.isExternalWork},null,8,["value"])]),_:1}),a(d,{style:{width:"5%"}},{body:w(c=>[t("i",{class:T([k(B).TIMES,"grid_delete_column_button"]),onClick:G=>P(G,c.data)},null,10,ge)]),_:1})]),_:1},8,["value"]),a(z,{visible:m.visible,"onUpdate:visible":l[0]||(l[0]=c=>m.visible=c),header:m.title,closable:m.closable,modal:m.modal},{default:w(()=>[f.value?(h(),O(le,{key:0,workorder:e.workorder,phase:f.value,onSubmit:s},null,8,["workorder","phase"])):S("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),Ie={class:"main"},Ce=E({__name:"Workorder",setup(I){const v=Z(),y=ee(),m=re(),V=L(),n=F(),_=ue(),i=ce(),o=j(),{workorder:r}=oe(i),p=U("");te(async()=>{p.value=v.params.id,await f();let e="";e="Ordre de fabricació",r.value&&(e=`${e} ${r.value.code}`),m.setMenuItem({icon:B.BUILDING,backButtonVisible:!0,title:e})});const f=async()=>{await _.fetchReferencesByModule("sales"),await i.fetchOne(p.value),o.fetchActiveModel(),n.fetchOneByName("WorkOrder"),i.workorder&&(i.workorder.plannedDate=de(i.workorder.plannedDate))},g=async e=>{i.workorder&&(i.workorder.plannedDate=ie(i.workorder.plannedDate)),await i.update(p.value,e)&&await f()},s=async e=>{await i.createPhase(e)?y.push({path:`/workorder/${p.value}/phase/${e.id}`}):V.add({severity:"error",summary:"Error al crear la fase",detail:"Revisi el log per a més informació"})},$=e=>{y.push({path:`/workorder/${p.value}/phase/${e.id}`})},P=async e=>{await i.deletePhase(e.id)};return(e,l)=>(h(),N(Q,null,[t("header",null,[k(r)?(h(),O(_e,{key:0,workorder:k(r),onSubmit:g},null,8,["workorder"])):S("",!0)]),t("main",Ie,[k(r)&&k(r).phases?(h(),O(Te,{key:0,workorder:k(r),workorderPhases:k(r).phases,onAdd:s,onEdit:$,onDelete:P},null,8,["workorder","workorderPhases"])):S("",!0)])],64))}});const Qe=ae(Ce,[["__scopeId","data-v-00804be4"]]);export{Qe as default};
