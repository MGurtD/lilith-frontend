import{d as F,M as G,C as B,j as $,o as L,r as I,h as y,k as l,a as g,c as q,e as t,i as o,n as p,l as S,x as j,F as N,m as w,P as k,w as E,G as O,H as P,L as z,y as H,v as J,u as K}from"./index-0165ef2a.js";import{u as M}from"./suppliers-c41f6a2c.js";import{c as R,a as v,F as A,b as D}from"./form-validator-29ed56b4.js";import{u as Q}from"./paymentMethod-f6aeb80d.js";import"./suppliers.service-a7d0b185.js";const W={key:0},X={class:"three-columns"},Y={class:"three-columns mb-2"},Z=t("label",{class:"block text-900 mb-2"},"País",-1),ee=t("label",{class:"block text-900 mb-2"},"Província",-1),ae=t("label",{class:"block text-900 mb-2"},"Municipi",-1),le={class:"three-columns mb-2"},oe={class:"three-columns"},te=t("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),se=t("label",{class:"block text-900 mb-2"},"Tipus Proveïdor",-1),ne=t("label",{class:"block text-900 mb-2"},"Observacions",-1),re={class:"mt-2"},ie=F({__name:"FormSupplier",emits:["submit"],setup(U,{emit:V}){const C=G(),h=M(),b=Q(),{supplier:e}=B(h),f=$();L(async()=>{await b.fetchAll()});const _=R().shape({comercialName:v().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),vatNumber:v().required("El CIF és obligatori").max(15,"El CIF no pot superar els 15 carácters"),taxName:v().required("El nom fiscal és obligatori"),region:v().required("La província és obligatoria"),city:v().required("El municipi és obligatori"),postalCode:v().required("El codi postal és obligatori"),address:v().required("La direcció és obligatoria"),phone:v().required("El telèfon és obligatori"),accountNumber:v().required("El número de compte és obligatori").max(35,"El número de compte no pot superar el 35 dígits"),supplierTypeId:v().required("El tipus de proveïdor és obligatori"),paymentMethodId:v().required("La forma de pagament és obligatoria")}),m=I({result:!1,errors:{}}),r=()=>{e.value.address=""},c=()=>{const s=new A(_);m.value=s.validate(e.value)},u=async()=>{if(c(),m.value.result)V("submit",e.value);else{let s="";Object.entries(m.value.errors).forEach(a=>{s+=`${a[1].map(i=>i)}.   `}),f.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,a)=>{const i=y("BaseInput"),d=y("Dropdown"),x=y("Textarea"),T=y("Button");return l(e)?(g(),q("form",W,[t("section",X,[o(i,{name:"comercialName",class:p(["mb-2",{"p-invalid":m.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:l(e).comercialName,"onUpdate:modelValue":a[0]||(a[0]=n=>l(e).comercialName=n)},null,8,["modelValue","class"]),o(i,{class:p(["mb-2",{"p-invalid":m.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:l(e).taxName,"onUpdate:modelValue":a[1]||(a[1]=n=>l(e).taxName=n)},null,8,["modelValue","class"]),o(i,{label:"CIF",id:"vatNumber",modelValue:l(e).vatNumber,"onUpdate:modelValue":a[2]||(a[2]=n=>l(e).vatNumber=n),class:p({"p-invalid":m.value.errors.vatNumber})},null,8,["modelValue","class"])]),t("section",Y,[t("div",null,[Z,o(d,{modelValue:l(e).country,"onUpdate:modelValue":a[3]||(a[3]=n=>l(e).country=n),editable:"",options:["Espanya"],class:p(["w-full",{"p-invalid":m.value.errors.country}])},null,8,["modelValue","class"])]),t("div",null,[ee,o(d,{modelValue:l(e).region,"onUpdate:modelValue":a[4]||(a[4]=n=>l(e).region=n),editable:"",options:l(C).regions,optionValue:"nm",optionLabel:"nm",onChange:r,class:p(["w-full",{"p-invalid":m.value.errors.region}])},null,8,["modelValue","options","class"])]),t("div",null,[ae,o(d,{modelValue:l(e).city,"onUpdate:modelValue":a[5]||(a[5]=n=>l(e).city=n),editable:"",options:l(C).getTownsByRegionName(l(e).region),optionValue:"nm",optionLabel:"nm",class:p(["w-full",{"p-invalid":m.value.errors.city}])},null,8,["modelValue","options","class"])])]),t("section",le,[o(i,{label:"Codi Postal",id:"postalCode",modelValue:l(e).postalCode,"onUpdate:modelValue":a[6]||(a[6]=n=>l(e).postalCode=n),class:p({"p-invalid":m.value.errors.postalCode})},null,8,["modelValue","class"]),o(i,{label:"Direcció",id:"address",modelValue:l(e).address,"onUpdate:modelValue":a[7]||(a[7]=n=>l(e).address=n),class:p({"p-invalid":m.value.errors.address})},null,8,["modelValue","class"]),o(i,{label:"Telèfon",id:"phone",modelValue:l(e).phone,"onUpdate:modelValue":a[8]||(a[8]=n=>l(e).phone=n),class:p({"p-invalid":m.value.errors.phone})},null,8,["modelValue","class"])]),t("section",oe,[t("div",null,[te,o(d,{modelValue:l(e).paymentMethodId,"onUpdate:modelValue":a[9]||(a[9]=n=>l(e).paymentMethodId=n),editable:"",options:l(b).paymentMethods,optionValue:"id",optionLabel:"name",class:p(["w-full",{"p-invalid":m.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])]),o(i,{label:"Número de compte",id:"accountNumber",modelValue:l(e).accountNumber,"onUpdate:modelValue":a[10]||(a[10]=n=>l(e).accountNumber=n),class:p({"p-invalid":m.value.errors.accountNumber})},null,8,["modelValue","class"]),t("div",null,[se,o(d,{modelValue:l(e).supplierTypeId,"onUpdate:modelValue":a[11]||(a[11]=n=>l(e).supplierTypeId=n),editable:"",options:l(h).supplierTypes,optionValue:"id",optionLabel:"name",class:p(["w-full",{"p-invalid":m.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),t("div",null,[ne,o(x,{modelValue:l(e).observations,"onUpdate:modelValue":a[12]||(a[12]=n=>l(e).observations=n),class:"w-full"},null,8,["modelValue"])]),t("div",re,[o(T,{label:"Guardar",class:"mr-2",onClick:u})])])):S("",!0)}}}),ue={key:0},de={class:"three-columns"},ce={class:"three-columns"},me=t("label",{class:"block text-900 mb-2"},"Predeterminat",-1),pe=t("label",{class:"block text-900 mb-2"},"Observacions",-1),be={class:"mt-2"},ve=F({__name:"FormSupplierContact",props:{contact:{}},emits:["submit","cancel"],setup(U,{emit:V}){const C=U,h=$(),b=R().shape({firstName:v().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:v().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:v(),email:v().required("El correu és obligatori").email("Correu electrònic invàlid"),phone:v().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),phoneExtension:v(),observations:v(),disabled:D().required(),default:D().required()}),e=I({result:!1,errors:{}}),f=()=>{const r=new A(b);e.value=r.validate(C.contact)},_=async()=>{if(f(),e.value.result)V("submit",C.contact);else{let r="";Object.entries(e.value.errors).forEach(c=>{r+=`${c[1].map(u=>u)}.   `}),h.add({severity:"warn",summary:"Formulari inválid",detail:r,life:5e3})}},m=()=>{V("cancel")};return(r,c)=>{const u=y("BaseInput"),s=y("Checkbox"),a=y("Textarea"),i=y("Button");return r.contact?(g(),q("form",ue,[t("section",de,[o(u,{label:"Nom",id:"firstName",modelValue:r.contact.firstName,"onUpdate:modelValue":c[0]||(c[0]=d=>r.contact.firstName=d),class:p(["mb-2",{"p-invalid":e.value.errors.firstName}])},null,8,["modelValue","class"]),o(u,{label:"Cognoms",id:"lastName",modelValue:r.contact.lastName,"onUpdate:modelValue":c[1]||(c[1]=d=>r.contact.lastName=d),class:p(["mb-2",{"p-invalid":e.value.errors.lastName}])},null,8,["modelValue","class"]),o(u,{label:"Càrrec",id:"charge",modelValue:r.contact.charge,"onUpdate:modelValue":c[2]||(c[2]=d=>r.contact.charge=d),class:p(["mb-2",{"p-invalid":e.value.errors.charge}])},null,8,["modelValue","class"])]),t("section",ce,[o(u,{class:p(["mb-2",{"p-invalid":e.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:r.contact.email,"onUpdate:modelValue":c[3]||(c[3]=d=>r.contact.email=d)},null,8,["modelValue","class"]),o(u,{class:p(["mb-2",{"p-invalid":e.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:r.contact.phone,"onUpdate:modelValue":c[4]||(c[4]=d=>r.contact.phone=d)},null,8,["modelValue","class"]),t("div",null,[me,o(s,{modelValue:r.contact.default,"onUpdate:modelValue":c[5]||(c[5]=d=>r.contact.default=d),class:"w-full",binary:!0},null,8,["modelValue"])])]),t("div",null,[pe,o(a,{modelValue:r.contact.observations,"onUpdate:modelValue":c[6]||(c[6]=d=>r.contact.observations=d),class:"w-full"},null,8,["modelValue"])]),t("div",be,[o(i,{label:"Guardar",class:"mr-2",onClick:_}),o(i,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:m})])])):S("",!0)}}}),fe={key:2},Ve=["onClick"],ye=F({__name:"TableSupplierContacts",emits:["create","update","delete"],setup(U,{emit:V}){const C=j(),h=M(),{supplier:b}=B(h),e=I(N.CREATE),f=I(void 0),_=()=>{var u;f.value={supplierId:(u=b.value)==null?void 0:u.id,id:H(),firstName:"",lastName:"",email:"",phone:"",phoneExtension:"",charge:"",disabled:!1,default:!1,observations:""},e.value=N.CREATE},m=u=>{u.originalEvent.target.className.includes("grid_delete_column_button")||(f.value=u.data,e.value=N.EDIT)},r=()=>{const u=f.value;e.value===N.CREATE?V("create",u):V("update",u),f.value=void 0},c=(u,s)=>{C.require({target:u.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{V("delete",s)}})};return(u,s)=>{var x;const a=y("Button"),i=y("Column"),d=y("DataTable");return g(),q(z,null,[f.value?S("",!0):(g(),w(a,{key:0,icon:l(k).PLUS,class:"grid_add_row_button",rounded:"",onClick:_},null,8,["icon"])),f.value?(g(),w(ve,{key:1,contact:f.value,onSubmit:r,onCancel:s[0]||(s[0]=()=>f.value=void 0)},null,8,["contact"])):(g(),q("div",fe,[(x=l(b))!=null&&x.contacts?(g(),w(d,{key:0,value:l(b).contacts,tableStyle:"min-width: 100%",onRowClick:m},{default:E(()=>[o(i,{header:"Nom",style:{width:"25%"}},{body:E(T=>[O(P(T.data.firstName)+" "+P(T.data.lastName),1)]),_:1}),o(i,{header:"Càrrec",field:"charge",style:{width:"25%"}}),o(i,{header:"Correu",field:"email",style:{width:"25%"}}),o(i,{header:"Telèfon",field:"phone",style:{width:"25%"}}),o(i,null,{body:E(T=>[t("i",{class:p([l(k).TIMES,"grid_delete_column_button"]),onClick:n=>c(n,T.data)},null,10,Ve)]),_:1})]),_:1},8,["value"])):S("",!0)]))],64)}}}),Ce=t("span",null,"Proveïdor",-1),_e=t("span",null,"Contactes",-1),we=F({__name:"Supplier",setup(U){const V=I(N.EDIT),C=J(),h=K(),b=M(),{supplier:e}=B(b),f=async()=>{await b.fetchSupplier(C.params.id),b.fetchSupplierTypes();let s="";e.value?(V.value=N.EDIT,s=`Proveïdor ${e.value.comercialName}`):(V.value=N.CREATE,b.setNewSupplier(C.params.id),s="Alta de proveïdor"),h.setMenuItem({icon:k.BUILDING,title:s,backButtonVisible:!0})};L(async()=>{await f()});const _=$(),m=async()=>{const s=e.value;let a=!1,i="";V.value===N.CREATE?(a=await b.createSupplier(s),i="Proveïdor creat correctament"):(a=await b.updateSupplier(s.id,s),i="Proveïdor actualizat correctament"),a&&(_.add({severity:"success",summary:i,life:5e3}),await f())},r=async s=>{await b.addContactToSupplier(s)&&_.add({severity:"success",summary:"Contacte afegit",life:5e3})},c=async s=>{await b.updateContactFromSupplier(s)&&_.add({severity:"success",summary:"Contacte actualizat",life:5e3})},u=async s=>{await b.removeContactFromSupplier(s)&&_.add({severity:"success",summary:"Contacte eliminat",life:5e3})};return(s,a)=>{const i=y("TabPanel"),d=y("TabView");return g(),w(d,null,{default:E(()=>[o(i,null,{header:E(()=>[t("i",{class:p([l(k).BUILDING,"mr-2"])},null,2),Ce]),default:E(()=>[o(ie,{onSubmit:m})]),_:1}),V.value===l(N).EDIT?(g(),w(i,{key:0},{header:E(()=>[t("i",{class:p([l(k).USERS,"mr-2"])},null,2),_e]),default:E(()=>[o(ye,{onCreate:r,onUpdate:c,onDelete:u})]),_:1})):S("",!0)]),_:1})}}});export{we as default};
