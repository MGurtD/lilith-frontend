import{_ as B}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-7206f397.js";import{c as F,a as v,F as M}from"./form-validator-dd91bd90.js";import{d as S,o as L,j as N,r as V,V as q,h,c as D,e as l,i as r,z as i,n as u,k as c,l as $,a as z,s as k}from"./index-40c5ef33.js";import{u as j}from"./plantmodel-fa1520ad.js";import{R as A}from"./index-7cbe1881.js";import{u as O}from"./reference-00b1433c.js";const Y={key:0},G=l("br",null,null,-1),H={class:"three-columns mb-2"},J={class:"four-columns mb-2"},K=l("label",{class:"block text-900 mb-2"},"Tipus de màquina",-1),Q=l("label",{class:"block text-900 mb-2"},"Màquina preferida",-1),X=l("label",{class:"block text-900 mb-2"},"Tipus d'operari",-1),Z={class:"four-columns mb-2"},x=l("label",{class:"block text-900 mt-1 mb-1"},"Externa",-1),_=l("label",{class:"block text-900 mb-2"},"Servei",-1),te=S({__name:"FormWorkorderPhase",props:{workorder:{},phase:{}},emits:["submit","cancel"],setup(y,{emit:C}){const a=y;L(async()=>{m.value=await W.getReferencesByModuleAndCategory("purchase",A.SERVICE)});const I=N(),p=j(),W=O(),m=V(void 0),g=q(()=>a.phase.workcenterTypeId?p.getWorkcentersByTypeId(a.phase.workcenterTypeId):[]),w=()=>{if(m.value){const e=m.value.find(o=>o.id===a.phase.serviceReferenceId);e&&(a.phase.externalWorkCost=e.price,a.phase.transportCost=e.transportAmount)}},T=()=>{var o;a.phase.preferredWorkcenterId=null;let e=(o=p.workcenterTypes)==null?void 0:o.find(n=>n.id===a.phase.workcenterTypeId);a.phase.profitPercentage=e.profitPercentage},b=()=>{var o,n;let e=(o=p.workcenters)==null?void 0:o.find(d=>d.id===a.phase.preferredWorkcenterId);if(e.profitPercentage>0)a.phase.profitPercentage=e.profitPercentage;else{let d=(n=p.workcenterTypes)==null?void 0:n.find(f=>f.id===a.phase.workcenterTypeId);a.phase.profitPercentage=d.profitPercentage}},E=async()=>{a.phase.isExternalWork?(a.phase.operatorTypeId=null,a.phase.workcenterTypeId=null,a.phase.preferredWorkcenterId=null):(a.phase.externalWorkCost=0,a.phase.transportCost=0,a.phase.serviceReferenceId=null)},R=F().shape({code:v().required("El codi és obligatori"),statusId:v().required("L'estat és obligatori")}),t=V({result:!1,errors:{}}),U=()=>{const e=new M(R);t.value=e.validate(a.phase)},P=async()=>{if(U(),t.value.result)a.phase.preferredWorkcenterId===""&&(a.phase.preferredWorkcenterId=null),C("submit",a.phase);else{let e="";Object.entries(t.value.errors).forEach(o=>{e+=`${o[1].map(n=>n)}.   `}),I.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,o)=>{const n=h("Button"),d=h("Dropdown"),f=h("Checkbox");return e.phase?(z(),D("form",Y,[l("div",null,[r(n,{label:"Guardar Fase",class:"grid_add_row_button",size:"small",onClick:P}),G]),l("section",H,[l("div",null,[r(i,{label:"Codi de la fase",modelValue:e.phase.code,"onUpdate:modelValue":o[0]||(o[0]=s=>e.phase.code=s)},null,8,["modelValue"])]),l("div",null,[r(i,{label:"Descripció",modelValue:e.phase.description,"onUpdate:modelValue":o[1]||(o[1]=s=>e.phase.description=s)},null,8,["modelValue"])]),l("div",null,[r(B,{label:"Estat",modelValue:e.phase.statusId,"onUpdate:modelValue":o[2]||(o[2]=s=>e.phase.statusId=s),name:"WorkOrder",class:u({"p-invalid":t.value.errors.statusId})},null,8,["modelValue","class"])])]),l("section",J,[l("div",null,[K,r(d,{modelValue:e.phase.workcenterTypeId,"onUpdate:modelValue":o[3]||(o[3]=s=>e.phase.workcenterTypeId=s),editable:"",options:c(p).workcenterTypes,optionValue:"id",optionLabel:"name",class:u(["w-full",{"p-invalid":t.value.errors.workcenterTypeId}]),onChange:T},null,8,["modelValue","options","class"])]),l("div",null,[Q,r(d,{modelValue:e.phase.preferredWorkcenterId,"onUpdate:modelValue":o[4]||(o[4]=s=>e.phase.preferredWorkcenterId=s),editable:"",options:g.value,optionValue:"id",optionLabel:"description",class:"w-full",onChange:b},null,8,["modelValue","options"])]),l("div",null,[r(i,{type:c(k).NUMERIC,minFractionDigits:2,class:"mb-2",label:"Marge de benefici",id:"profitPercentage",modelValue:e.phase.profitPercentage,"onUpdate:modelValue":o[5]||(o[5]=s=>e.phase.profitPercentage=s),suffix:"%",onChange:b},null,8,["type","modelValue"])]),l("div",null,[X,r(d,{modelValue:e.phase.operatorTypeId,"onUpdate:modelValue":o[6]||(o[6]=s=>e.phase.operatorTypeId=s),editable:"",options:c(p).operatorTypes,optionValue:"id",optionLabel:"description",class:u(["w-full",{"p-invalid":t.value.errors.operatorTypeId}])},null,8,["modelValue","options","class"])])]),l("section",Z,[l("div",null,[x,r(f,{modelValue:e.phase.isExternalWork,"onUpdate:modelValue":o[7]||(o[7]=s=>e.phase.isExternalWork=s),class:"w-full",binary:!0,onChange:E},null,8,["modelValue"])]),l("div",null,[_,r(d,{modelValue:e.phase.serviceReferenceId,"onUpdate:modelValue":o[8]||(o[8]=s=>e.phase.serviceReferenceId=s),editable:"",options:m.value,optionValue:"id",optionLabel:s=>s.code+" - "+s.description,disabled:!e.phase.isExternalWork,class:"w-full",onChange:w},null,8,["modelValue","options","optionLabel","disabled"])]),l("div",null,[r(i,{type:c(k).CURRENCY,label:"Cost servei",modelValue:e.phase.externalWorkCost,"onUpdate:modelValue":o[9]||(o[9]=s=>e.phase.externalWorkCost=s),disabled:!e.phase.isExternalWork,class:u({"p-invalid":t.value.errors.externalWorkCost})},null,8,["type","modelValue","disabled","class"])]),l("div",null,[r(i,{type:c(k).CURRENCY,label:"Cost transport",modelValue:e.phase.transportCost,"onUpdate:modelValue":o[10]||(o[10]=s=>e.phase.transportCost=s),disabled:!e.phase.isExternalWork,class:u({"p-invalid":t.value.errors.externalWorkCost})},null,8,["type","modelValue","disabled","class"])])])])):$("",!0)}}});export{te as _};
