import{_ as M}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-3114bda9.js";import{_ as U}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-34caa0b7.js";import{_ as $}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-7d1d556b.js";import{_ as A}from"./FormCreateWorkorder.vue_vue_type_script_setup_true_lang-5083f662.js";import{d as Q,g as j,u as q,Y as H,j as Y,x as z,E as G,r as g,K,o as Z,P as m,Z as J,h as _,c as X,i as t,w as d,k as o,L as ee,O as C,a as te,e as l,G as v,H as p,I as re,n as se}from"./index-709c40c8.js";import{u as ae}from"./reference-ced38a82.js";import{u as oe}from"./lifecycle-3d27f6c5.js";import{u as ie}from"./workorder-5043c40b.js";import{u as le}from"./workmaster-699a1a15.js";import{u as ce}from"./customers-f89785ad.js";import"./form-validator-6d089293.js";import"./index-5492b314.js";const de={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ne={class:"datatable-filter-3"},ue={class:"filter-field"},me={class:"filter-field"},fe=l("label",{class:"block text-900"},"Client",-1),_e={class:"filter-field"},ve=l("label",{class:"block text-900"},"Estat",-1),pe={class:"datatable-buttons"},ke=["onClick"],Be=Q({__name:"Workorders",setup(Ie){const h=j(),i=q(),k=H(),y=Y(),D=z(),P=le(),n=ie(),x=ae(),F=ce(),w=G(),S=oe(),r=g({referenceId:void 0,statusId:void 0,customerId:void 0}),E=()=>{r.value.referenceId=void 0,r.value.statusId=void 0,r.value.customerId=void 0,k.removeFilter("Workorders","")},I=async()=>{if(i.exercisePicker.dates){const e=C(i.exercisePicker.dates[0]),a=C(i.exercisePicker.dates[1]);await n.fetchFiltered(e,a,r.value.statusId,r.value.referenceId,r.value.customerId)}else y.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},u=K({visible:!1,title:"Crear ordre",closable:!0,position:"center",modal:!0}),b=g({workMasterId:"",plannedDate:"",plannedQuantity:0,comment:""});Z(async()=>{await x.fetchReferencesByModule("sales"),await w.fetchActive(),S.fetchOneByName("WorkOrder"),P.fetchAllActives(),i.setMenuItem({icon:m.CALENDAR,title:"Ordres de fabricació"}),B(),i.exercisePicker.exercise||i.setCurrentYear(),I()}),J(()=>{const e={referenceId:r.value.referenceId,statusId:r.value.statusId,customerId:r.value.customerId,exercisePicker:i.exercisePicker};k.addFilter("Workorders","",e)});const B=()=>{const e=k.getFilter("Workorders","");e&&(r.value.referenceId=e.referenceId,r.value.statusId=e.statusId,r.value.customerId=e.customerId,e.exercisePicker&&(i.exercisePicker.exercise=e.exercisePicker.exercise,i.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},O=()=>{u.visible=!0},W=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||h.push({path:`/workorder/${e.data.id}`})},T=async()=>{if(!b.value)return;await n.create(b.value)&&n.workorder&&h.push({path:`/workorder/${n.workorder.id}`})},N=(e,a)=>{D.require({target:e.currentTarget,message:`Está segur que vol eliminar la ordre ${a.code}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await n.delete(a.id)&&(y.add({severity:"success",summary:"Eliminada",life:3e3}),I())}})};return(e,a)=>{const f=_("Button"),c=_("Column"),R=_("DataTable"),V=_("Dialog");return te(),X(ee,null,[t(R,{value:o(n).workorders,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh","sort-mode":"multiple",onRowClick:W},{header:d(()=>[l("div",de,[l("div",ne,[l("div",ue,[t(U,{exercises:o(w).exercises},null,8,["exercises"])]),l("div",me,[fe,t(M,{label:"",modelValue:r.value.customerId,"onUpdate:modelValue":a[0]||(a[0]=s=>r.value.customerId=s)},null,8,["modelValue"])]),l("div",_e,[ve,t($,{label:"",modelValue:r.value.statusId,"onUpdate:modelValue":a[1]||(a[1]=s=>r.value.statusId=s)},null,8,["modelValue"])])]),l("div",pe,[t(f,{class:"datatable-button mr-2",icon:o(m).FILTER,rounded:"",raised:"",onClick:I},null,8,["icon"]),t(f,{class:"datatable-button mr-2",icon:o(m).FILTER_SLASH,rounded:"",raised:"",onClick:E},null,8,["icon"]),t(f,{icon:o(m).PLUS,rounded:"",raised:"",onClick:O},null,8,["icon"])])])]),default:d(()=>[t(c,{field:"code",header:"Codi",style:{width:"15%"}}),t(c,{header:"Referencia",style:{width:"40%"}},{body:d(s=>[v(p(o(x).getFullNameById(s.data.referenceId)),1)]),_:1}),t(c,{header:"Client",style:{width:"15%"}},{body:d(s=>[v(p(o(F).getCustomerNameById(s.data.reference.customerId)),1)]),_:1}),t(c,{field:"statusId",header:"Estat",style:{width:"10%"}},{body:d(s=>[v(p(o(S).getStatusName(s.data.statusId)),1)]),_:1}),t(c,{field:"plannedDate",header:"Data Prevista",sortable:"",style:{width:"12%"}},{body:d(s=>[v(p(o(re)(s.data.plannedDate)),1)]),_:1}),t(c,{field:"order",header:"Prioritat",style:{width:"10%"}}),t(c,{field:"plannedQuantity",header:"Quantitat",style:{width:"10%"}}),t(c,null,{body:d(s=>[l("i",{class:se([o(m).TIMES,"grid_delete_column_button"]),onClick:L=>N(L,s.data)},null,10,ke)]),_:1})]),_:1},8,["value"]),t(V,{visible:u.visible,"onUpdate:visible":a[2]||(a[2]=s=>u.visible=s),header:u.title,closable:u.closable,modal:u.modal},{default:d(()=>[t(A,{createWorkOrderDto:b.value,onSubmit:T},null,8,["createWorkOrderDto"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Be as default};
