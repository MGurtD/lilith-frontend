import{_ as y}from"./DropdownReference.vue_vue_type_script_setup_true_lang-14e78baf.js";import{_ as j}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-27123f00.js";import{d as q,g as H,u as W,j as G,x as Q,r as z,K,E as I,o as P,P as p,h as m,c as Y,i as a,w as i,G as J,a as X,e as l,k as s,C as k,D as b,n as g}from"./index-64fee6e6.js";import{u as Z}from"./workmaster-64ab54c8.js";import{u as ee}from"./reference-372e33a9.js";import{u as te}from"./customers-2f2b50e9.js";import{d as oe,g as le}from"./functions-2e154ea4.js";import"./index-af0e943c.js";import"./base.service-0fa5a61f.js";import"./reference.service-10b4f35b.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";const ae={class:"flex flex-wrap align-items-center justify-content-between gap-2"},re={class:"datatable-filter"},se={class:"filter-field"},ne=l("label",{class:"block text-900"},"Referència",-1),ie={class:"filter-field"},de=l("label",{class:"block text-900"},"Client",-1),ce={class:"datatable-buttons"},ue=["onClick"],me=["onClick"],fe=l("br",null,null,-1),pe=l("section",{class:"two-columns"},[l("div",null,[l("h3",null,"Origen")]),l("div",null,[l("h3",null,"Destí")])],-1),be={class:"two-columns"},Se=q({__name:"Workmasters",setup(Ce){const w=H(),T=W(),C=G(),V=Q(),t=Z(),_=ee(),B=te(),n=z({referenceId:void 0,customerId:void 0}),N=()=>{n.value.referenceId=void 0,n.value.customerId=void 0},S=K(()=>{if(!t.workmasters)return[];let r=t.workmasters;return n.value.referenceId&&(r=r.filter(o=>o.referenceId===n.value.referenceId)),n.value.customerId&&(r=r.filter(o=>{var d;return((d=o.reference)==null?void 0:d.customerId)===n.value.customerId||o.reference.customerId===null})),r}),u=I({visible:!1,title:"Crear ruta",closable:!0,position:"center",modal:!0}),f=I({visible:!1,title:"Copiar ruta",closable:!0,position:"center",modal:!0});P(async()=>{await t.fetchAll(),await _.fetchReferencesByModule("sales"),T.setMenuItem({icon:p.CALENDAR,title:"Gestió de rutes de fabricació"})});const D=()=>{const r=le();t.setNew(r),u.visible=!0},x=(r,o)=>{t.workmasterToCopy={workmasterId:o.id,workmaster:o,referenceId:null,referenceCode:""},f.visible=!0},R=async()=>{t.workmasterToCopy.referenceId===""&&(t.workmasterToCopy.referenceId=null);const r=await t.copy(t.workmasterToCopy);await t.fetchAll(),f.visible=!1,r?C.add({severity:"success",summary:"Copiada",life:3e3}):C.add({severity:"error",summary:"Hi ha hagut un error en el proces",life:3e3})},E=()=>{t.workmasterToCopy.referenceCode=""},U=()=>{t.workmasterToCopy.referenceId=""},A=r=>{!r.originalEvent.target.className.includes("grid_delete_column_button")&&!r.originalEvent.target.className.includes("grid_copy_column_button")&&w.push({path:`/workmaster/${r.data.id}`})},F=async()=>{if(!t.workmaster)return;await t.create(t.workmaster)&&w.push({path:`/workmaster/${t.workmaster.id}`})},M=(r,o)=>{V.require({target:r.currentTarget,message:`Está segur que vol eliminar la ruta ${o.reference.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await t.delete(o.id)&&(C.add({severity:"success",summary:"Eliminada",life:3e3}),await t.fetchAll())}})};return(r,o)=>{const d=m("Button"),c=m("Column"),$=m("BooleanColumn"),L=m("DataTable"),h=m("Dialog"),O=m("BaseInput");return X(),Y(J,null,[a(L,{value:S.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh","sort-field":"reference.code","sort-order":1,onRowClick:A},{header:i(()=>[l("div",ae,[l("div",re,[l("div",se,[ne,a(y,{label:"",modelValue:n.value.referenceId,"onUpdate:modelValue":o[0]||(o[0]=e=>n.value.referenceId=e),fullName:!0},null,8,["modelValue"])]),l("div",ie,[de,a(j,{label:"",modelValue:n.value.customerId,"onUpdate:modelValue":o[1]||(o[1]=e=>n.value.customerId=e)},null,8,["modelValue"])])]),l("div",ce,[a(d,{class:"datatable-button mr-2",icon:s(p).FILTER_SLASH,rounded:"",raised:"",onClick:N},null,8,["icon"]),a(d,{icon:s(p).PLUS,rounded:"",raised:"",onClick:D},null,8,["icon"])])])]),default:i(()=>[a(c,{field:"reference.code",sortable:"",header:"Referencia",style:{width:"50%"}},{body:i(e=>[k(b(s(_).getFullName(e.data.reference)),1)]),_:1}),a(c,{sortable:"",header:"Client",style:{width:"25%"}},{body:i(e=>[k(b(s(B).getCustomerNameById(e.data.reference.customerId)),1)]),_:1}),a(c,{field:"baseQuantity",header:"Quantitat Base",style:{width:"25%"}}),a(c,{header:"Cost",style:{width:"25%"}},{body:i(e=>[k(b(s(oe)(e.data.machineCost+e.data.operatorCost+e.data.materialCost+e.data.externalCost)),1)]),_:1}),a(c,{header:"Desactivada",style:{width:"25%"}},{body:i(e=>[a($,{value:e.data.disabled},null,8,["value"])]),_:1}),a(c,null,{body:i(e=>[l("i",{class:g([s(p).COPY,"grid_copy_column_button"]),onClick:v=>x(v,e.data)},null,10,ue)]),_:1}),a(c,null,{body:i(e=>[l("i",{class:g([s(p).TIMES,"grid_delete_column_button"]),onClick:v=>M(v,e.data)},null,10,me)]),_:1})]),_:1},8,["value"]),a(h,{visible:u.visible,"onUpdate:visible":o[3]||(o[3]=e=>u.visible=e),header:u.title,closable:u.closable,modal:u.modal},{default:i(()=>[l("div",null,[a(y,{label:"Referència",modelValue:s(t).workmaster.referenceId,"onUpdate:modelValue":o[2]||(o[2]=e=>s(t).workmaster.referenceId=e),fullName:!0},null,8,["modelValue"])]),fe,l("div",null,[a(d,{label:"Crear",style:{float:"right"},onClick:F})])]),_:1},8,["visible","header","closable","modal"]),a(h,{visible:f.visible,"onUpdate:visible":o[6]||(o[6]=e=>f.visible=e),header:f.title,closable:!0,modal:!0},{default:i(()=>[pe,l("section",be,[l("div",null,[l("p",null,b(s(_).getFullNameById(s(t).workmasterToCopy.workmaster.referenceId)),1)]),l("div",null,[a(y,{label:"Referència existent:",modelValue:s(t).workmasterToCopy.referenceId,"onUpdate:modelValue":o[4]||(o[4]=e=>s(t).workmasterToCopy.referenceId=e),fullName:!0,onChange:E},null,8,["modelValue"]),a(O,{class:"mb-2",label:"Nou codi:",id:"referenceCode",modelValue:s(t).workmasterToCopy.referenceCode,"onUpdate:modelValue":o[5]||(o[5]=e=>s(t).workmasterToCopy.referenceCode=e),onChange:U},null,8,["modelValue"])])]),l("div",null,[a(d,{label:"Copiar",style:{float:"right"},onClick:R})])]),_:1},8,["visible","header"])],64)}}});export{Se as default};
