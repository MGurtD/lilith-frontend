import{d as A,C as D,j as S,r as U,h as v,k as t,a as _,c as q,e as l,i as s,n as m,l as $,M as W,z as x,x as j,F as N,m as T,P as I,w as h,L as O,y as z,G as J,H as G,v as K,u as Q,o as X}from"./index-77e4d88f.js";import{u as M}from"./customers-5603f6e7.js";import{c as L,a as y,F as P,b as F}from"./form-validator-7d52d458.js";import{u as H}from"./masterData-12cde164.js";const Y={key:0},Z={class:"three-columns"},ee=l("label",{class:"block text-900 mb-2"},"Tipus Client",-1),ae={class:"two-columns mb-2"},oe={class:"two-columns mb-2"},se=l("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),le=l("label",{class:"block text-900 mb-2"},"Observacions",-1),te=l("label",{class:"block text-900 mb-2"},"Notes de factura",-1),ne={class:"mt-2"},re=A({__name:"FormCustomer",emits:["submit"],setup(B,{emit:b}){const V=M(),E=H(),{customer:n}=D(V),i=S(),r=L().shape({comercialName:y().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),taxName:y().required("El nom fiscal és obligatori"),vatNumber:y().required("El CIF és obligatori"),accountNumber:y().required("El número de compte es obligatori")}),p=U({result:!1,errors:{}}),C=()=>{const o=new P(r);p.value=o.validate(n.value)},u=async()=>{if(C(),p.value.result)b("submit",n.value);else{let o="";Object.entries(p.value.errors).forEach(e=>{o+=`${e[1].map(c=>c)}.   `}),i.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,e)=>{const c=v("BaseInput"),g=v("Dropdown"),d=v("Textarea"),k=v("Button");return t(n)?(_(),q("form",Y,[l("section",Z,[s(c,{name:"comercialName",class:m(["mb-2",{"p-invalid":p.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:t(n).comercialName,"onUpdate:modelValue":e[0]||(e[0]=a=>t(n).comercialName=a)},null,8,["modelValue","class"]),s(c,{class:m(["mb-2",{"p-invalid":p.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:t(n).taxName,"onUpdate:modelValue":e[1]||(e[1]=a=>t(n).taxName=a)},null,8,["modelValue","class"]),l("div",null,[ee,s(g,{modelValue:t(n).customerTypeId,"onUpdate:modelValue":e[2]||(e[2]=a=>t(n).customerTypeId=a),editable:"",options:t(V).customerTypes,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),l("section",ae,[s(c,{name:"vatNumber",class:m(["mb-2",{"p-invalid":p.value.errors.vatNumber}]),label:"CIF",id:"vatNumber",modelValue:t(n).vatNumber,"onUpdate:modelValue":e[3]||(e[3]=a=>t(n).vatNumber=a)},null,8,["modelValue","class"]),s(c,{name:"web",class:m(["mb-2",{"p-invalid":p.value.errors.web}]),label:"Web",id:"web",modelValue:t(n).web,"onUpdate:modelValue":e[4]||(e[4]=a=>t(n).web=a)},null,8,["modelValue","class"])]),l("section",oe,[s(c,{name:"accountNumber",class:m(["mb-2",{"p-invalid":p.value.errors.accountNumber}]),label:"Número de compte",id:"accountNumber",modelValue:t(n).accountNumber,"onUpdate:modelValue":e[5]||(e[5]=a=>t(n).accountNumber=a)},null,8,["modelValue","class"]),l("div",null,[se,s(g,{modelValue:t(n).paymentMethodId,"onUpdate:modelValue":e[6]||(e[6]=a=>t(n).paymentMethodId=a),editable:"",options:t(E).paymentMethods,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])])]),l("div",null,[le,s(d,{modelValue:t(n).observations,"onUpdate:modelValue":e[7]||(e[7]=a=>t(n).observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",null,[te,s(d,{modelValue:t(n).invoiceNotes,"onUpdate:modelValue":e[8]||(e[8]=a=>t(n).invoiceNotes=a),class:"w-full"},null,8,["modelValue"])]),l("div",ne,[s(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),ie={key:0},de={class:"three-columns"},ue=l("label",{class:"block text-900 mb-2"},"Principal",-1),ce=l("label",{class:"block text-900 mb-2"},"Desactivada",-1),me={class:"three-columns mb-2"},pe=l("label",{class:"block text-900 mb-2"},"País",-1),be=l("label",{class:"block text-900 mb-2"},"Província",-1),ve=l("label",{class:"block text-900 mb-2"},"Municipi",-1),fe={class:"three-columns mb-2"},Ce=l("label",{class:"block text-900 mb-2"},"Observacions",-1),Ve={class:"mt-2"},ye=A({__name:"FormCustomerAddress",props:{address:{}},emits:["submit","cancel"],setup(B,{emit:b}){const V=B,E=W(),n=S(),i=L().shape({name:y().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),country:y().required("El país és obligatori"),region:y().required("La província és obligatoria"),city:y().required("El municipi és obligatori"),postalCode:y().required("El codi postal és obligatori"),address:y().required("La direcció és obligatoria"),main:F().required(),disabled:F().required()}),r=U({result:!1,errors:{}}),p=()=>{const o=V.address;o.address=""},C=()=>{const o=new P(i);r.value=o.validate(V.address)},u=async()=>{if(C(),r.value.result)b("submit",V.address);else{let o="";Object.entries(r.value.errors).forEach(e=>{o+=`${e[1].map(c=>c)}.   `}),n.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,e)=>{const c=v("Checkbox"),g=v("Dropdown"),d=v("Textarea"),k=v("Button");return o.address?(_(),q("form",ie,[l("section",de,[s(x,{id:"name",class:m(["mb-2",{"p-invalid":r.value.errors.name}]),label:"Nom",modelValue:o.address.name,"onUpdate:modelValue":e[0]||(e[0]=a=>o.address.name=a)},null,8,["modelValue","class"]),l("div",null,[ue,s(c,{modelValue:o.address.main,"onUpdate:modelValue":e[1]||(e[1]=a=>o.address.main=a),class:"w-full",binary:!0},null,8,["modelValue"])]),l("div",null,[ce,s(c,{modelValue:o.address.disabled,"onUpdate:modelValue":e[2]||(e[2]=a=>o.address.disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("section",me,[l("div",null,[pe,s(g,{modelValue:o.address.country,"onUpdate:modelValue":e[3]||(e[3]=a=>o.address.country=a),editable:"",options:["Espanya"],class:m(["w-full",{"p-invalid":r.value.errors.country}])},null,8,["modelValue","class"])]),l("div",null,[be,s(g,{modelValue:o.address.region,"onUpdate:modelValue":e[4]||(e[4]=a=>o.address.region=a),editable:"",options:t(E).regions,optionValue:"nm",optionLabel:"nm",onChange:p,class:m(["w-full",{"p-invalid":r.value.errors.region}])},null,8,["modelValue","options","class"])]),l("div",null,[ve,s(g,{modelValue:o.address.city,"onUpdate:modelValue":e[5]||(e[5]=a=>o.address.city=a),editable:"",options:t(E).getTownsByRegionName(o.address.region),optionValue:"nm",optionLabel:"nm",class:m(["w-full",{"p-invalid":r.value.errors.city}])},null,8,["modelValue","options","class"])])]),l("section",fe,[s(x,{label:"Codi Postal",id:"postalCode",modelValue:o.address.postalCode,"onUpdate:modelValue":e[6]||(e[6]=a=>o.address.postalCode=a),class:m({"p-invalid":r.value.errors.postalCode})},null,8,["modelValue","class"]),s(x,{label:"Direcció",id:"address",modelValue:o.address.address,"onUpdate:modelValue":e[7]||(e[7]=a=>o.address.address=a),class:m({"p-invalid":r.value.errors.address})},null,8,["modelValue","class"])]),l("div",null,[Ce,s(d,{modelValue:o.address.observations,"onUpdate:modelValue":e[8]||(e[8]=a=>o.address.observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",Ve,[s(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),_e={key:2},ge=["onClick"],Ne=A({__name:"TableCustomerAddresses",emits:["create","update","delete"],setup(B,{emit:b}){const V=j(),E=M(),{customer:n}=D(E),i=U(N.CREATE),r=U(void 0),p=()=>{var e;r.value={customerId:(e=n.value)==null?void 0:e.id,id:z(),name:"",country:"",region:"",city:"",postalCode:"",address:"",main:!1,disabled:!1,observations:""},i.value=N.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(r.value=e.data,i.value=N.EDIT)},u=()=>{const e=r.value;i.value===N.CREATE?b("create",e):b("update",e),r.value=void 0},o=(e,c)=>{V.require({target:e.currentTarget,message:"Está segur que vol eliminar l'adreça?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var f;const g=v("Button"),d=v("Column"),k=v("BooleanColumn"),a=v("DataTable");return _(),q(O,null,[r.value?$("",!0):(_(),T(g,{key:0,icon:t(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),r.value?(_(),T(ye,{key:1,address:r.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>r.value=void 0)},null,8,["address"])):(_(),q("div",_e,[(f=t(n))!=null&&f.address?(_(),T(a,{key:0,value:t(n).address,tableStyle:"min-width: 100%",onRowClick:C},{default:h(()=>[s(d,{header:"Nom",field:"name",style:{width:"25%"}}),s(d,{header:"Província",field:"region",style:{width:"25%"}}),s(d,{header:"Municipi",field:"city",style:{width:"25%"}}),s(d,{header:"Codi Postal",field:"postalCode",style:{width:"25%"}}),s(d,{header:"Principal"},{body:h(w=>[s(k,{value:w.data.main,"show-color":!1},null,8,["value"])]),_:1}),s(d,null,{body:h(w=>[l("i",{class:m([t(I).TIMES,"grid_delete_column_button"]),onClick:R=>o(R,w.data)},null,10,ge)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),we={key:0},he={class:"three-columns"},Ee={class:"four-columns"},ke=l("label",{class:"block text-900 mb-2"},"Predeterminat",-1),Te={class:"mt-2"},$e=A({__name:"FormCustomerContact",props:{contact:{}},emits:["submit","cancel"],setup(B,{emit:b}){const V=B,E=S(),n=L().shape({firstName:y().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:y().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:y(),email:y().required("El correu és obligatori").email("Correu electrònic invàlid"),phoneNumber:y().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),extension:y().required("L'extensió del telèfon és obligatoria"),disabled:F().required(),main:F().required()}),i=U({result:!1,errors:{}}),r=()=>{const u=new P(n);i.value=u.validate(V.contact)},p=async()=>{if(r(),i.value.result)b("submit",V.contact);else{let u="";Object.entries(i.value.errors).forEach(o=>{u+=`${o[1].map(e=>e)}.   `}),E.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}},C=()=>{b("cancel")};return(u,o)=>{const e=v("BaseInput"),c=v("Checkbox"),g=v("Button");return u.contact?(_(),q("form",we,[l("section",he,[s(e,{label:"Nom",id:"firstName",modelValue:u.contact.firstName,"onUpdate:modelValue":o[0]||(o[0]=d=>u.contact.firstName=d),class:m(["mb-2",{"p-invalid":i.value.errors.firstName}])},null,8,["modelValue","class"]),s(e,{label:"Cognoms",id:"lastName",modelValue:u.contact.lastName,"onUpdate:modelValue":o[1]||(o[1]=d=>u.contact.lastName=d),class:m(["mb-2",{"p-invalid":i.value.errors.lastName}])},null,8,["modelValue","class"]),s(e,{label:"Càrrec",id:"charge",modelValue:u.contact.charge,"onUpdate:modelValue":o[2]||(o[2]=d=>u.contact.charge=d),class:m(["mb-2",{"p-invalid":i.value.errors.charge}])},null,8,["modelValue","class"])]),l("section",Ee,[s(e,{class:m(["mb-2",{"p-invalid":i.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:u.contact.email,"onUpdate:modelValue":o[3]||(o[3]=d=>u.contact.email=d)},null,8,["modelValue","class"]),s(e,{class:m(["mb-2",{"p-invalid":i.value.errors.extension}]),label:"Extensió",id:"extension",modelValue:u.contact.extension,"onUpdate:modelValue":o[4]||(o[4]=d=>u.contact.extension=d)},null,8,["modelValue","class"]),s(e,{class:m(["mb-2",{"p-invalid":i.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:u.contact.phoneNumber,"onUpdate:modelValue":o[5]||(o[5]=d=>u.contact.phoneNumber=d)},null,8,["modelValue","class"]),l("div",null,[ke,s(c,{modelValue:u.contact.main,"onUpdate:modelValue":o[6]||(o[6]=d=>u.contact.main=d),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("div",Te,[s(g,{label:"Guardar",class:"mr-2",onClick:p}),s(g,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:C})])])):$("",!0)}}}),Ie={key:2},Ue=["onClick"],Be=A({__name:"TableCustomerContacts",emits:["create","update","delete"],setup(B,{emit:b}){const V=j(),E=M(),{customer:n}=D(E),i=U(N.CREATE),r=U(void 0),p=()=>{var e;r.value={customerId:(e=n.value)==null?void 0:e.id,id:z(),charge:"",email:"",firstName:"",lastName:"",disabled:!1,main:!1,phoneNumber:""},i.value=N.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(r.value=e.data,i.value=N.EDIT)},u=()=>{const e=r.value;i.value===N.CREATE?b("create",e):b("update",e),r.value=void 0},o=(e,c)=>{V.require({target:e.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var a;const g=v("Button"),d=v("Column"),k=v("DataTable");return _(),q(O,null,[r.value?$("",!0):(_(),T(g,{key:0,icon:t(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),r.value?(_(),T($e,{key:1,contact:r.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>r.value=void 0)},null,8,["contact"])):(_(),q("div",Ie,[(a=t(n))!=null&&a.contacts?(_(),T(k,{key:0,value:t(n).contacts,tableStyle:"min-width: 100%",onRowClick:C},{default:h(()=>[s(d,{header:"Nom",style:{width:"25%"}},{body:h(f=>[J(G(f.data.firstName)+" "+G(f.data.lastName),1)]),_:1}),s(d,{header:"Càrrec",field:"charge",style:{width:"25%"}}),s(d,{header:"Correu",field:"email",style:{width:"25%"}}),s(d,{header:"Ext.",field:"extension",style:{width:"5%"}}),s(d,{header:"Telèfon",field:"phoneNumber",style:{width:"20%"}}),s(d,null,{body:h(f=>[l("i",{class:m([t(I).TIMES,"grid_delete_column_button"]),onClick:w=>o(w,f.data)},null,10,Ue)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),qe=l("span",null,"Client",-1),Ae=l("span",null,"Contactes",-1),Fe=l("span",null,"Adreces",-1),xe=A({__name:"Customer",setup(B){const b=U(N.EDIT),V=K(),E=Q(),n=H(),i=M(),{customer:r}=D(i),p=async()=>{await i.fetchCustomer(V.params.id),i.fetchCustomerTypes(),n.fetchMasterData();let a="";r.value?(b.value=N.EDIT,a=`Client ${r.value.comercialName}`):(b.value=N.CREATE,i.setNewCustomer(V.params.id),a="Alta de client"),E.setMenuItem({icon:I.BUILDING,title:a,backButtonVisible:!0})};X(async()=>{await p()});const C=S(),u=async()=>{const a=r.value;let f=!1,w="";b.value===N.CREATE?(f=await i.createCustomer(a),w="Client creat correctament"):(f=await i.updateCustomer(a.id,a),w="Client actualizat correctament"),f&&(C.add({severity:"success",summary:w,life:5e3}),await p())},o=async a=>{await i.addContactToCustomer(a)&&C.add({severity:"success",summary:"Contacte afegit",life:5e3})},e=async a=>{await i.updateContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte actualizat",life:5e3})},c=async a=>{await i.removeContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte eliminat",life:5e3})},g=async a=>{await i.addAddressToCustomer(a)&&C.add({severity:"success",summary:"Adreça afegida",life:5e3})},d=async a=>{await i.updateAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça actualizada",life:5e3})},k=async a=>{await i.removeAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça eliminada",life:5e3})};return(a,f)=>{const w=v("TabPanel"),R=v("TabView");return _(),T(R,null,{default:h(()=>[s(w,null,{header:h(()=>[l("i",{class:m([t(I).WALLET,"mr-2"])},null,2),qe]),default:h(()=>[s(re,{onSubmit:u})]),_:1}),b.value===t(N).EDIT?(_(),T(w,{key:0},{header:h(()=>[l("i",{class:m([t(I).USERS,"mr-2"])},null,2),Ae]),default:h(()=>[s(Be,{onCreate:o,onUpdate:e,onDelete:c})]),_:1})):$("",!0),b.value===t(N).EDIT?(_(),T(w,{key:1},{header:h(()=>[l("i",{class:m([t(I).ENVELOPE,"mr-2"])},null,2),Fe]),default:h(()=>[s(Ne,{onCreate:g,onUpdate:d,onDelete:k})]),_:1})):$("",!0)]),_:1})}}});export{xe as default};
