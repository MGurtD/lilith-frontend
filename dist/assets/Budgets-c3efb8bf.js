import{_ as Y}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-531f6a29.js";import{_ as z}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-1252a474.js";import{_ as J}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-4ee5aa2e.js";import{_ as K}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-10e06abb.js";import{d as Q,g as X,j as W,x as Z,u as ee,X as te,r as P,K as se,o as ae,P as p,Y as re,O as B,h as v,c as F,i as a,w as d,k as l,L as ie,a as N,e as n,G as b,H as y,I as E,n as oe,l as ce,J as le}from"./index-abfce291.js";import{u as de}from"./reference-cfffd00c.js";import{u as ne}from"./customers-82526395.js";import{u as ue}from"./lifecycle-5d58652b.js";import{u as me}from"./masterData-7d768ff1.js";import{u as fe}from"./budget-eb68bab2.js";import"./form-validator-012be6a9.js";import"./index-f2d7d7d6.js";const pe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},_e={class:"datatable-filter-3"},ve={class:"filter-field"},be={class:"filter-field"},ye=n("label",{class:"block text-900"},"Client",-1),ge={class:"filter-field"},he=n("label",{class:"block text-900"},"Estat",-1),xe={class:"datatable-buttons"},Ie=["onClick"],Ue=Q({__name:"Budgets",setup(ke){const k=X(),g=W(),R=Z(),c=ee(),w=te(),h=me(),u=fe(),V=de(),S=ne(),x=ue(),o=P({customerId:void 0,statusId:void 0}),m=se({visible:!1,title:"Crear pressupost",closable:!0,position:"center",modal:!0});ae(async()=>{x.fetchOneByName("Budget"),V.fetchReferences(),S.fetchCustomers(),await h.fetchMasterData(),D(),T(),await f(),c.setMenuItem({icon:p.APPLE,title:"Pressupostos"})}),re(()=>{const e={statusId:o.value.statusId,customerId:o.value.customerId,exercisePicker:c.exercisePicker};w.addFilter("Budgets","",e)});const T=()=>{const e=w.getFilter("Budgets","");e&&(o.value.statusId=e.statusId,o.value.customerId=e.customerId,e.exercisePicker&&(c.exercisePicker.exercise=e.exercisePicker.exercise,c.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},D=()=>{var i;const e=new Date().getFullYear().toString(),t=(i=h.exercises)==null?void 0:i.find(r=>r.name===e);t&&(c.exercisePicker.exercise=t,c.exercisePicker.dates=[new Date(c.exercisePicker.exercise.startDate),new Date(c.exercisePicker.exercise.endDate)])},U=()=>{o.value.customerId=void 0,o.value.statusId=void 0,D(),f()},_=P({}),q=()=>({id:le(),customerId:"",exerciseId:"",date:new Date}),L=()=>{_.value=q(),m.visible=!0},f=async()=>{if(c.exercisePicker.dates){const e=B(c.exercisePicker.dates[0]),t=B(c.exercisePicker.dates[1]);await u.GetFiltered(e,t,o.value.customerId,o.value.statusId)}else g.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},$=e=>{var i,r;const t=(r=(i=x.lifecycle)==null?void 0:i.statuses)==null?void 0:r.find(I=>I.id===e);return t?t.name:""},O=e=>{var i;const t=(i=S.customers)==null?void 0:i.find(r=>r.id===e);return t?t.comercialName:""},M=async()=>{m.visible=!1,await u.Create(_.value)&&k.push({path:`/budget/${_.value.id}`})},j=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||k.push({path:`/budget/${e.data.id}`})},A=async(e,t)=>{if(await u.GetAssociatedSalesOrders(t.id),u.order){g.add({severity:"warn",summary:"No es pot eliminar",detail:`El pressupost té la comanda ${u.order.number} associada`,life:5e3});return}R.require({message:"Està segur que vol eliminar el pressupost?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await u.Delete(t.id)&&(g.add({severity:"success",summary:"Eliminada",life:3e3}),await f())}})};return(e,t)=>{const i=v("Button"),r=v("Column"),I=v("DataTable"),G=v("Dialog");return N(),F(ie,null,[a(I,{value:l(u).budgets,class:"small-datatable",tableStyle:"min-width: 100%","sort-field":"salesOrderNumber","sort-mode":"single","sort-order":1,scrollable:"",scrollHeight:"80vh",onRowClick:j},{header:d(()=>[n("div",pe,[n("div",_e,[n("div",ve,[a(Y,{exercises:l(h).exercises,onRangeSelected:f},null,8,["exercises"])]),n("div",be,[ye,a(J,{label:"",modelValue:o.value.customerId,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.customerId=s)},null,8,["modelValue"])]),n("div",ge,[he,a(K,{label:"",modelValue:o.value.statusId,"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.statusId=s)},null,8,["modelValue"])])]),n("div",xe,[a(i,{class:"datatable-button mr-2",icon:l(p).FILTER,rounded:"",raised:"",onClick:f},null,8,["icon"]),a(i,{class:"datatable-button mr-2",icon:l(p).FILTER_SLASH,rounded:"",raised:"",onClick:U},null,8,["icon"]),a(i,{icon:l(p).PLUS,rounded:"",raised:"",onClick:L},null,8,["icon"])])])]),default:d(()=>[a(r,{field:"number",header:"Número",style:{width:"10%"}}),a(r,{field:"date",header:"Data",style:{width:"15%"},sortable:""},{body:d(s=>[b(y(l(E)(s.data.date)),1)]),_:1}),a(r,{header:"Client",style:{width:"20%"}},{body:d(s=>[b(y(O(s.data.customerId)),1)]),_:1}),a(r,{header:"Estat",style:{width:"20%"}},{body:d(s=>[b(y($(s.data.statusId)),1)]),_:1}),a(r,{field:"acceptanceDate",header:"Data d'acceptació",style:{width:"15%"}},{body:d(s=>[b(y(s.data.acceptanceDate?l(E)(s.data.acceptanceDate):""),1)]),_:1}),a(r,{field:"deliveryDays",header:"Dies d'entrega",style:{width:"10%"}}),a(r,{style:{width:"5%"}},{body:d(s=>{var C;return[s.data.statusId===((C=l(x).lifecycle)==null?void 0:C.initialStatusId)?(N(),F("i",{key:0,class:oe([l(p).TIMES,"grid_delete_column_button"]),onClick:H=>A(H,s.data)},null,10,Ie)):ce("",!0)]}),_:1})]),_:1},8,["value"]),a(G,{visible:m.visible,"onUpdate:visible":t[2]||(t[2]=s=>m.visible=s),header:m.title,closable:m.closable,modal:m.modal},{default:d(()=>[a(z,{"create-request":_.value,onSubmit:M},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Ue as default};
