import{_ as Y}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-973b3509.js";import{_ as z}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-4b68b416.js";import{_ as J}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-2c3c5283.js";import{_ as K}from"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-327dba19.js";import{d as Q,g as W,j as X,x as Z,u as ee,$ as te,r as P,K as se,o as ae,P as p,a0 as re,O as B,h as v,c as F,i as a,w as d,k as l,L as ie,a as N,e as n,G as b,H as g,I as E,n as oe,l as ce,J as le}from"./index-8de45480.js";import{u as de}from"./reference-d2534f01.js";import{u as ne}from"./customers-140fb91b.js";import{u as ue}from"./lifecycle-fcf482ed.js";import{u as me}from"./masterData-be745aaa.js";import{u as fe}from"./budget-479645b8.js";import"./form-validator-58fc86c6.js";import"./index-04f3e510.js";const pe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},_e={class:"datatable-filter-3"},ve={class:"filter-field"},be={class:"filter-field"},ge=n("label",{class:"block text-900"},"Client",-1),ye={class:"filter-field"},he=n("label",{class:"block text-900"},"Estat",-1),xe={class:"datatable-buttons"},Ie=["onClick"],Ue=Q({__name:"Budgets",setup(we){const w=W(),y=X(),R=Z(),c=ee(),k=te(),h=me(),u=fe(),V=de(),S=ne(),x=ue(),o=P({customerId:void 0,statusId:void 0}),m=se({visible:!1,title:"Crear pressupost",closable:!0,position:"center",modal:!0});ae(async()=>{x.fetchOneByName("Budget"),V.fetchReferences(),S.fetchCustomers(),await h.fetchMasterData(),D(),T(),await f(),c.setMenuItem({icon:p.APPLE,title:"Pressupostos"})}),re(()=>{const e={statusId:o.value.statusId,customerId:o.value.customerId,exercisePicker:c.exercisePicker};k.addFilter("Budgets","",e)});const T=()=>{const e=k.getFilter("Budgets","");e&&(o.value.statusId=e.statusId,o.value.customerId=e.customerId,e.exercisePicker&&(c.exercisePicker.exercise=e.exercisePicker.exercise,c.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},D=()=>{var i;const e=new Date().getFullYear().toString(),t=(i=h.exercises)==null?void 0:i.find(r=>r.name===e);t&&(c.exercisePicker.exercise=t,c.exercisePicker.dates=[new Date(c.exercisePicker.exercise.startDate),new Date(c.exercisePicker.exercise.endDate)])},U=()=>{o.value.customerId=void 0,o.value.statusId=void 0,D(),f()},_=P({}),$=()=>({id:le(),customerId:"",exerciseId:"",date:new Date}),q=()=>{_.value=$(),m.visible=!0},f=async()=>{if(c.exercisePicker.dates){const e=B(c.exercisePicker.dates[0]),t=B(c.exercisePicker.dates[1]);await u.GetFiltered(e,t,o.value.customerId,o.value.statusId)}else y.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},L=e=>{var i,r;const t=(r=(i=x.lifecycle)==null?void 0:i.statuses)==null?void 0:r.find(I=>I.id===e);return t?t.name:""},O=e=>{var i;const t=(i=S.customers)==null?void 0:i.find(r=>r.id===e);return t?t.comercialName:""},M=async()=>{m.visible=!1,await u.Create(_.value)&&w.push({path:`/budget/${_.value.id}`})},j=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||w.push({path:`/budget/${e.data.id}`})},A=async(e,t)=>{if(await u.GetAssociatedSalesOrders(t.id),u.order){y.add({severity:"warn",summary:"No es pot eliminar",detail:`El pressupost té la comanda ${u.order.number} associada`,life:5e3});return}R.require({message:"Està segur que vol eliminar el pressupost?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await u.Delete(t.id)&&(y.add({severity:"success",summary:"Eliminada",life:3e3}),await f())}})};return(e,t)=>{const i=v("Button"),r=v("Column"),I=v("DataTable"),G=v("Dialog");return N(),F(ie,null,[a(I,{value:l(u).budgets,class:"small-datatable",tableStyle:"min-width: 100%","sort-field":"salesOrderNumber","sort-mode":"single","sort-order":1,scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:j},{header:d(()=>[n("div",pe,[n("div",_e,[n("div",ve,[a(Y,{exercises:l(h).exercises,onRangeSelected:f},null,8,["exercises"])]),n("div",be,[ge,a(J,{label:"",modelValue:o.value.customerId,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.customerId=s)},null,8,["modelValue"])]),n("div",ye,[he,a(K,{label:"",name:"Budget",modelValue:o.value.statusId,"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.statusId=s)},null,8,["modelValue"])])]),n("div",xe,[a(i,{class:"datatable-button mr-2",icon:l(p).FILTER,rounded:"",raised:"",onClick:f},null,8,["icon"]),a(i,{class:"datatable-button mr-2",icon:l(p).FILTER_SLASH,rounded:"",raised:"",onClick:U},null,8,["icon"]),a(i,{icon:l(p).PLUS,rounded:"",raised:"",onClick:q},null,8,["icon"])])])]),default:d(()=>[a(r,{field:"number",header:"Número",style:{width:"10%"}}),a(r,{field:"date",header:"Data",style:{width:"15%"},sortable:""},{body:d(s=>[b(g(l(E)(s.data.date)),1)]),_:1}),a(r,{header:"Client",style:{width:"20%"}},{body:d(s=>[b(g(O(s.data.customerId)),1)]),_:1}),a(r,{header:"Estat",style:{width:"20%"}},{body:d(s=>[b(g(L(s.data.statusId)),1)]),_:1}),a(r,{field:"acceptanceDate",header:"Data d'acceptació",style:{width:"15%"}},{body:d(s=>[b(g(s.data.acceptanceDate?l(E)(s.data.acceptanceDate):""),1)]),_:1}),a(r,{field:"deliveryDays",header:"Dies d'entrega",style:{width:"10%"}}),a(r,{style:{width:"5%"}},{body:d(s=>{var C;return[s.data.statusId===((C=l(x).lifecycle)==null?void 0:C.initialStatusId)?(N(),F("i",{key:0,class:oe([l(p).TIMES,"grid_delete_column_button"]),onClick:H=>A(H,s.data)},null,10,Ie)):ce("",!0)]}),_:1})]),_:1},8,["value"]),a(G,{visible:m.visible,"onUpdate:visible":t[2]||(t[2]=s=>m.visible=s),header:m.title,closable:m.closable,modal:m.modal},{default:d(()=>[a(z,{"create-request":_.value,onSubmit:M},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Ue as default};
