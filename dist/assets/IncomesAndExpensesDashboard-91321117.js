import{ac as I,t as F,d as A,u as O,E as V,r as i,o as $,P as B,O as w,h as d,c as M,e as b,i as a,k as v,w as u,L as G,a as L,G as N,H as Y,I as H,f as j}from"./index-6eb74133.js";import{_ as Q}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-f13b172f.js";import{E as q}from"./index-0c01bc4e.js";import"./suppliers.service-c8170604.js";class z extends I{async GetBetweenDates(r,p){const _=`${this.resource}/consolidated?startTime=${r}&endTime=${p}`,f=await F.get(_);if(f.status===200)return f.data}}const J={class:"dashboard-filter"},K={class:"dashboard-filter-field"},R={class:"dashboard-container"},U=A({__name:"IncomesAndExpensesDashboard",setup(k){const r=O(),p=V(),_=new z("/income"),f=i({dates:void 0,consolidatedBy:void 0}),E=()=>{r.cleanExercisePicker(),f.value.consolidatedBy=""},x=i([]),D=i([]);$(async()=>{r.setMenuItem({icon:B.MONEY_BILL,title:"Dashboard comparatiu flux de caixa"}),await p.fetchActive(),r.exercisePicker.exercise||r.setCurrentYear(),g()});const g=async()=>{if(m.value=[],r.exercisePicker.dates){const s=w(r.exercisePicker.dates[0]),n=w(r.exercisePicker.dates[1]);var t,o;t=await _.GetBetweenDates(s,n),o=await q.Expense.getConsolidated(s,n,"",""),t&&(x.value=t),o&&(D.value=o),C.value=P(),S.value=T()}},C=i(),S=i(),m=i([]),P=()=>{const t={},o={};x.value.forEach(e=>{const c=`${e.year}-${String(e.month).padStart(2,"0")}`;t[c]=(t[c]||0)+e.amount,m.value.push({date:e.date,type:e.type,detail:e.typeDetail,description:e.description,total:e.amount})}),D.value.forEach(e=>{const c=`${e.yearPaymentDate}-${String(e.monthPaymentDate).padStart(2,"0")}`;o[c]=(o[c]||0)+e.amount,m.value.push({date:e.paymentDate,type:e.type,detail:e.typeDetail,description:e.description,total:e.amount})});const s=Object.keys(t).concat(Object.keys(o)).filter((e,c,y)=>y.indexOf(e)===c).sort(),n={type:"line",label:"Ingressos",borderColor:"#B3FFBA",backgroundColor:"#B3FFBA",data:s.map(e=>t[e]||0),fill:!1},l=[{type:"line",label:"Despeses",borderColor:"#ff336f",backgroundColor:"#ff336f",data:s.map(e=>o[e]||0),fill:!1},n];return{labels:s,datasets:l}},T=()=>{const t=getComputedStyle(document.documentElement),o=t.getPropertyValue("--p-text-color"),s=t.getPropertyValue("--p-text-muted-color"),n=t.getPropertyValue("--p-content-border-color");return{maintainAspectRatio:!1,aspectRatio:.8,plugins:{datalabels:{},tooltips:{mode:"index",intersect:!1},legend:{labels:{color:o}}},scales:{x:{ticks:{color:s},grid:{color:n}},y:{ticks:{color:s},grid:{color:n}}}}};return(t,o)=>{const s=d("Button"),n=d("Chart"),h=d("TabPanel"),l=d("Column"),e=d("DataTable"),c=d("TabView");return L(),M(G,null,[b("div",J,[b("div",K,[a(Q,{exercises:v(p).exercises,onRangeSelected:g},null,8,["exercises"])]),a(s,{class:"grid_add_row_button",icon:v(B).FILTER_SLASH,onClick:E},null,8,["icon"])]),a(c,null,{default:u(()=>[a(h,{header:"Grafics"},{default:u(()=>[b("div",R,[a(n,{type:"line",data:C.value,options:S.value,class:"w-full h-[70rem]"},null,8,["data","options"])])]),_:1}),a(h,{header:"Data"},{default:u(()=>[a(e,{value:m.value,class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",sortField:"date",sortOrder:1,rows:12},{default:u(()=>[a(l,{field:"date",header:"Data",style:{width:"15%"},sortable:""},{body:u(y=>[N(Y(v(H)(y.data.date)),1)]),_:1}),a(l,{header:"Tipus",field:"type"}),a(l,{header:"Detall",field:"detail"}),a(l,{header:"Descripci√≥",field:"description"}),a(l,{header:"Total",field:"total"})]),_:1},8,["value"])]),_:1})]),_:1})],64)}}});const te=j(U,[["__scopeId","data-v-43a1caf8"]]);export{te as default};
