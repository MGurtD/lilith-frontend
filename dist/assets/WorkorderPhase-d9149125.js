import{_ as oe}from"./FormWorkorderPhase.vue_vue_type_script_setup_true_lang-1aac46a8.js";import{d as $,x as A,h,a as g,m as D,w as b,e as i,i as l,k as d,P as B,G as F,H as L,B as se,n as M,J as W,j as N,r as E,c as R,s as T,z as V,l as S,v as ie,u as re,C as ne,K as de,o as me,F as k,L as ue}from"./index-d4f01faf.js";import{u as q}from"./plantmodel-8bfb9a3a.js";import{u as ce}from"./workmaster-3649af81.js";import{c as j,d as O,F as z,a as pe}from"./form-validator-e18d88f5.js";import{u as G}from"./reference-1f2c96f9.js";import{_ as he}from"./DropdownReference.vue_vue_type_script_setup_true_lang-9e7acd0e.js";import{u as fe}from"./workorder-78c0d402.js";import"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-728289a5.js";import"./index-7cbe1881.js";import"./index-402f70f9.js";const be={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ve=i("span",{class:"text-xl text-900 font-bold"},"Pasos de fabricació",-1),ye=["onClick"],_e=$({__name:"TableWorkorderPhaseDetails",props:{workorderPhase:{},details:{}},emits:["add","edit","delete"],setup(C,{emit:c}){const f=C,I=A();ce();const v=q(),y=t=>{var m;if(!v.machineStatuses)return"";const a=(m=v.machineStatuses)==null?void 0:m.find(p=>t===p.id);return a?a.name:""},s=()=>{const t={id:W(),workOrderPhaseId:f.workorderPhase.id,estimatedTime:0,estimatedOperatorTime:0,isCycleTime:!1,machineStatusId:"",comment:"",order:_()};c("add",t)},_=()=>{let t=10;return f.details?(f.details.length+1)*10:t},o=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||c("edit",t.data)},e=(t,a)=>{I.require({target:t.currentTarget,message:"Está segur que vol eliminar el pas de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{c("delete",a)}})};return(t,a)=>{const m=h("Button"),p=h("Column"),u=h("DataTable");return g(),D(u,{onRowClick:o,value:t.details,tableStyle:"min-width: 100%","sort-field":"order","sort-order":1},{header:b(()=>[i("div",be,[ve,l(m,{icon:d(B).PLUS,rounded:"",raised:"",onClick:s},null,8,["icon"])])]),default:b(()=>[l(p,{sortable:"",field:"order",header:"Ordre",style:{width:"10%"}}),l(p,{header:"Estat de màquina",style:{width:"25%"}},{body:b(n=>[F(L(y(n.data.machineStatusId)),1)]),_:1}),l(p,{header:"Temps de cicle",style:{width:"25%"}},{body:b(n=>[l(se,{value:n.data.isCycleTime},null,8,["value"])]),_:1}),l(p,{field:"estimatedTime",header:"Temps màquina (min)",style:{width:"25%"}}),l(p,{field:"estimatedOperatorTime",header:"Temps operari (min)",style:{width:"25%"}}),l(p,{style:{width:"25%"}},{body:b(n=>[i("i",{class:M([d(B).TIMES,"grid_delete_column_button"]),onClick:P=>e(P,n.data)},null,10,ye)]),_:1})]),_:1},8,["value"])}}}),we={key:0},Ie={class:"three-columns"},ke=i("label",{class:"block text-900 mb-2"},"Estat",-1),Te=i("label",{class:"block text-900v mb-1"},"Temps de cicle",-1),Ve={class:"three-columns mt-2"},ge={class:"mt-2"},Ce=i("label",{class:"block text-900v mb-1"},"Comentari fabricació",-1),Pe=i("br",null,null,-1),Ee=$({__name:"FormWorkorderPhaseDetail",props:{detail:{}},emits:["submit","cancel"],setup(C,{emit:c}){const f=C,I=q(),v=N(),y=j().shape({order:O().required("L'ordre és obligatori").positive("L'ordre ha de ser positiu"),estimatedTime:O().required("El temps estimat és obligatori")}),s=E({result:!1,errors:{}}),_=()=>{const e=new z(y);s.value=e.validate(f.detail)},o=async()=>{if(_(),s.value.result)c("submit",f.detail);else{let e="";Object.entries(s.value.errors).forEach(t=>{e+=`${t[1].map(a=>a)}.   `}),v.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const a=h("Dropdown"),m=h("Checkbox"),p=h("Textarea"),u=h("Button");return e.detail?(g(),R("form",we,[i("section",Ie,[i("div",null,[l(V,{type:d(T).NUMERIC,label:"Ordre",modelValue:e.detail.order,"onUpdate:modelValue":t[0]||(t[0]=n=>e.detail.order=n),class:M({"p-invalid":s.value.errors.order})},null,8,["type","modelValue","class"])]),i("div",null,[ke,l(a,{modelValue:e.detail.machineStatusId,"onUpdate:modelValue":t[1]||(t[1]=n=>e.detail.machineStatusId=n),editable:"",options:d(I).machineStatuses,optionValue:"id",optionLabel:"description",class:M(["w-full",{"p-invalid":s.value.errors.machineStatusId}])},null,8,["modelValue","options","class"])]),i("div",null,[Te,l(m,{modelValue:e.detail.isCycleTime,"onUpdate:modelValue":t[2]||(t[2]=n=>e.detail.isCycleTime=n),class:"w-full",binary:!0},null,8,["modelValue"])])]),i("section",Ve,[i("div",null,[l(V,{type:d(T).NUMERIC,decimals:2,label:"Temps màquina (min)",modelValue:e.detail.estimatedTime,"onUpdate:modelValue":t[3]||(t[3]=n=>e.detail.estimatedTime=n),class:M({"p-invalid":s.value.errors.estimatedTime})},null,8,["type","modelValue","class"])]),i("div",null,[l(V,{type:d(T).NUMERIC,decimals:2,label:"Temps operari (min)",modelValue:e.detail.estimatedOperatorTime,"onUpdate:modelValue":t[4]||(t[4]=n=>e.detail.estimatedOperatorTime=n),class:M({"p-invalid":s.value.errors.estimatedTime})},null,8,["type","modelValue","class"])])]),i("div",ge,[Ce,l(p,{class:"w-full",modelValue:e.detail.comment,"onUpdate:modelValue":t[5]||(t[5]=n=>e.detail.comment=n)},null,8,["modelValue"])]),Pe,i("div",null,[l(u,{label:"Guardar pas",style:{float:"right"},size:"small",onClick:o})])])):S("",!0)}}}),Me={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Se=i("span",{class:"text-xl text-900 font-bold"},"Materials de fabricació",-1),De=["onClick"],Be=$({__name:"TableWorkorderPhaseBillOfMaterials",props:{workorderPhase:{},billOfMaterials:{}},emits:["add","edit","delete"],setup(C,{emit:c}){const f=C,I=A(),v=G(),y=e=>{var a;if(!v.references)return"";const t=(a=v.references)==null?void 0:a.find(m=>e===m.id);return t?v.getFullName(t):""},s=()=>{const e={id:W(),workOrderPhaseId:f.workorderPhase.id,referenceId:"",quantity:0,width:0,diameter:0,height:0,length:0,thickness:0};c("add",e)},_=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||c("edit",e.data)},o=(e,t)=>{I.require({target:e.currentTarget,message:"Está segur que vol eliminar el material de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{c("delete",t)}})};return(e,t)=>{const a=h("Button"),m=h("Column"),p=h("DataTable");return g(),D(p,{onRowClick:_,value:e.billOfMaterials,tableStyle:"min-width: 100%"},{header:b(()=>[i("div",Me,[Se,l(a,{icon:d(B).PLUS,rounded:"",raised:"",onClick:s},null,8,["icon"])])]),default:b(()=>[l(m,{header:"Material consum",style:{width:"30%"}},{body:b(u=>[F(L(y(u.data.referenceId)),1)]),_:1}),l(m,{field:"quantity",header:"Consum",style:{width:"15%"}}),l(m,{field:"width",header:"Ample (x) mm",style:{width:"12%"}}),l(m,{field:"length",header:"Llarg (y) mm",style:{width:"12%"}}),l(m,{field:"height",header:"Alt (z) mm",style:{width:"12%"}}),l(m,{field:"diameter",header:"Diàmetre mm",style:{width:"12%"}}),l(m,{field:"thickness",header:"Gruix mm",style:{width:"12%"}}),l(m,{style:{width:"10%"}},{body:b(u=>[i("i",{class:M([d(B).TIMES,"grid_delete_column_button"]),onClick:n=>o(n,u.data)},null,10,De)]),_:1})]),_:1},8,["value"])}}}),$e={key:0},Ue={class:"three-columns"},Re={class:"three-columns"},Oe={class:"mt-2"},Ne={class:"mt-2"},qe={class:"mt-2"},Ae=i("br",null,null,-1),Fe=$({__name:"FormWorkorderPhaseBomItem",props:{bomItem:{}},emits:["submit","cancel"],setup(C,{emit:c}){const f=C,I=N(),v=j().shape({referenceId:pe().required("El material de consum és obligatori"),quantity:O().min(1,"La quantitat a consumir ha de ser positiva").required("La quantitat a consumir és obligatoria")}),y=E({result:!1,errors:{}}),s=()=>{const o=new z(v);y.value=o.validate(f.bomItem)},_=async()=>{if(s(),y.value.result)c("submit",f.bomItem);else{let o="";Object.entries(y.value.errors).forEach(e=>{o+=`${e[1].map(t=>t)}.   `}),I.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,e)=>{const t=h("Button");return o.bomItem?(g(),R("form",$e,[i("div",null,[l(he,{label:"Material",fullName:!0,modelValue:o.bomItem.referenceId,"onUpdate:modelValue":e[0]||(e[0]=a=>o.bomItem.referenceId=a),class:M({"p-invalid":y.value.errors.referenceId})},null,8,["modelValue","class"])]),i("section",Ue,[i("div",null,[l(V,{type:d(T).NUMERIC,label:"Quantitat",modelValue:o.bomItem.quantity,"onUpdate:modelValue":e[1]||(e[1]=a=>o.bomItem.quantity=a)},null,8,["type","modelValue"])]),i("div",null,[l(V,{type:d(T).NUMERIC,label:"Amplada (mm)",decimals:2,modelValue:o.bomItem.width,"onUpdate:modelValue":e[2]||(e[2]=a=>o.bomItem.width=a)},null,8,["type","modelValue"])]),i("div",null,[l(V,{type:d(T).NUMERIC,decimals:2,label:"Alçada (mm)",modelValue:o.bomItem.height,"onUpdate:modelValue":e[3]||(e[3]=a=>o.bomItem.height=a)},null,8,["type","modelValue"])])]),i("section",Re,[i("div",Oe,[l(V,{type:d(T).NUMERIC,decimals:2,label:"Longitud (mm)",modelValue:o.bomItem.length,"onUpdate:modelValue":e[4]||(e[4]=a=>o.bomItem.length=a)},null,8,["type","modelValue"])]),i("div",Ne,[l(V,{type:d(T).NUMERIC,decimals:2,label:"Diàmetre (mm)",modelValue:o.bomItem.diameter,"onUpdate:modelValue":e[5]||(e[5]=a=>o.bomItem.diameter=a)},null,8,["type","modelValue"])]),i("div",qe,[l(V,{type:d(T).NUMERIC,decimals:2,label:"Gruix (mm)",modelValue:o.bomItem.thickness,"onUpdate:modelValue":e[6]||(e[6]=a=>o.bomItem.thickness=a)},null,8,["type","modelValue"])])]),Ae,i("div",null,[l(t,{label:"Guardar material",style:{float:"right"},size:"small",onClick:_})])])):S("",!0)}}}),Le={key:0,class:"main"},Ze=$({__name:"WorkorderPhase",setup(C){const c=ie(),f=N(),I=re(),v=G(),y=q(),s=fe(),{workorder:_,workorderPhase:o}=ne(s),e=E(""),t=E(""),a=de({visible:!1,title:"Fase",closable:!0,position:"center",modal:!0});me(async()=>{e.value=c.params.id,t.value=c.params.phaseid,await m();let r="";r="Ordre de fabricació",_.value&&o.value&&(r=`${r} ${_.value.code} - Fase ${o.value.code}`),I.setMenuItem({icon:B.BUILDING,backButtonVisible:!0,title:r}),v.fetchReferencesByModule("purchase"),y.fetchActiveModel()});const m=async()=>{await s.fetchPhaseById(t.value)},p=async r=>{await s.updatePhase(t.value,r)&&f.add({severity:"success",summary:"Fase actualitzada",detail:`La fase ${r.code} ha estat actualitzada correctament`,life:1e4})},u=E(k.CREATE),n=E(void 0),P=E(void 0),H=()=>{n.value=void 0,P.value=void 0},J=r=>{u.value=k.CREATE,n.value=r,a.title="Afegir pas de fabricació",a.visible=!0},K=r=>{u.value=k.EDIT,n.value=r,a.title="Modificar pas de fabricació",a.visible=!0},Q=async r=>{await s.updatePhase(t.value,s.workorderPhase),await s.deletePhaseDetail(r.id)},x=async r=>{let w;u.value===k.CREATE?w=s.createPhaseDetail(r):u.value===k.EDIT&&(w=s.updatePhaseDetail(r.id,r)),await s.updatePhase(t.value,s.workorderPhase),await w&&(a.visible=!1)},X=r=>{u.value=k.CREATE,P.value=r,a.title="Afegir material",a.visible=!0},Y=r=>{u.value=k.EDIT,P.value=r,a.title="Modificar material",a.visible=!0},Z=async r=>{await s.updatePhase(t.value,s.workorderPhase),await s.deletePhaseBomItem(r.id)},ee=async r=>{let w;u.value===k.CREATE?w=s.createPhaseBomItem(r):u.value===k.EDIT&&(w=s.updatePhaseBomItem(r.id,r)),await s.updatePhase(t.value,s.workorderPhase),await w&&(a.visible=!1)};return(r,w)=>{const U=h("TabPanel"),te=h("TabView"),ae=h("Dialog");return g(),R(ue,null,[i("header",null,[d(_)&&d(o)?(g(),D(oe,{key:0,workorder:d(_),phase:d(o),onSubmit:p},null,8,["workorder","phase"])):S("",!0)]),d(o)?(g(),R("main",Le,[l(te,null,{default:b(()=>[l(U,{header:"Pasos"},{default:b(()=>[l(_e,{workorderPhase:d(o),details:d(o).details,onAdd:J,onEdit:K,onDelete:Q},null,8,["workorderPhase","details"])]),_:1}),l(U,{header:"Materials"},{default:b(()=>[l(Be,{workorderPhase:d(o),billOfMaterials:d(o).billOfMaterials,onAdd:X,onEdit:Y,onDelete:Z},null,8,["workorderPhase","billOfMaterials"])]),_:1})]),_:1}),l(ae,{visible:a.visible,"onUpdate:visible":w[0]||(w[0]=le=>a.visible=le),header:a.title,closable:a.closable,modal:a.modal,onHide:H},{default:b(()=>[n.value?(g(),D(Ee,{key:0,detail:n.value,onSubmit:x},null,8,["detail"])):S("",!0),P.value?(g(),D(Fe,{key:1,bomItem:P.value,onSubmit:ee},null,8,["bomItem"])):S("",!0)]),_:1},8,["visible","header","closable","modal"])])):S("",!0)],64)}}});export{Ze as default};
