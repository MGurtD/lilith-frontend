import{_ as ce}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-31b366d2.js";import{d as Y,j as Z,r as E,h as P,a as z,c as A,e as o,i as l,k as s,n as G,s as R,z as j,l as ee,g as pe,u as me,$ as ve,E as ke,x as we,K as fe,o as he,P as q,a0 as be,V as _,w as v,L as Pe,O as K,G as f,H as w,R as D,I as Ie,ad as X,J as ye}from"./index-680c2dac.js";import{u as Ce}from"./productionpart-bfdb0123.js";import{u as te}from"./plantmodel-cddce6d5.js";import{u as re}from"./workorder-31883e47.js";import{c as _e,a as S,d as Q,F as Oe}from"./form-validator-f475731c.js";import"./index-be90d370.js";const Ve={key:0},ge={class:"three-columns mt-2"},Te=o("label",{class:"block text-900 mb-2"},"Operari",-1),qe=o("label",{class:"block text-900 mb-2"},"Màquina",-1),De=o("label",{class:"block text-900 mb-2"},"Data Tíquet",-1),Se={class:"mt-2"},Fe=o("label",{class:"block text-900 mb-2"},"Ordre Fabricació | Fase | Activitat",-1),$e={class:"three-columns mt-2"},Ue=o("br",null,null,-1),xe={class:"flex-right"},Ee=Y({__name:"FormProductionPart",props:{productionPart:{},avoidWorkOrderRefresh:{type:Boolean}},emits:["submit","cancel"],setup(J,{emit:M}){const u=J,F=Z(),O=te(),p=re(),h=E(void 0),k=()=>{h.value.value&&(u.productionPart.workOrderId=h.value.value.workOrderId,u.productionPart.workOrderPhaseId=h.value.value.workOrderPhaseId,u.productionPart.workOrderPhaseDetailId=h.value.value.workOrderPhaseDetailId)},V=_e().shape({operatorId:S().required("Escull un operari"),workcenterId:S().required("Escull una màquina"),workOrderId:S().required("Escull una ordre de fabricació"),workOrderPhaseId:S().required("Escull una fase"),workOrderPhaseDetailId:S().required("Escull una activitat"),quantity:Q().required("Has d'introduir una quantitat entera (pot ser 0)").integer(),workcenterTime:Q().required("Has d'introduir el temps i ha de ser major que 0").integer(),operatorTime:Q().required("Has d'introduir el temps i ha de ser major que 0").integer()}),I=E({result:!1,errors:{}}),d=()=>{const a=new Oe(V);I.value=a.validate(u.productionPart)},C=async a=>{u.avoidWorkOrderRefresh||(h.value=void 0,await p.fetchByWorkcenterId(a))},W=async()=>{if(d(),I.value.result)M("submit",u.productionPart);else{let a="";Object.entries(I.value.errors).forEach(i=>{a+=`${i[1].map(c=>c)}.   `}),F.add({severity:"warn",summary:"Formulari inválid",detail:a,life:5e3})}};return(a,i)=>{var $,g,T;const c=P("Dropdown"),B=P("Calendar"),H=P("Button");return a.productionPart?(z(),A("form",Ve,[o("section",ge,[o("div",null,[Te,l(c,{modelValue:a.productionPart.operatorId,"onUpdate:modelValue":i[0]||(i[0]=t=>a.productionPart.operatorId=t),editable:"",filter:!0,options:($=s(O).operators)==null?void 0:$.sort((t,y)=>t.surname.localeCompare(y.surname)).map(t=>({value:t.id,label:t.name+" "+t.surname})),optionValue:"value",optionLabel:"label",class:G(["w-full",{"p-invalid":I.value.errors.operatorid}])},null,8,["modelValue","options","class"])]),o("div",null,[qe,l(c,{modelValue:a.productionPart.workcenterId,"onUpdate:modelValue":i[1]||(i[1]=t=>a.productionPart.workcenterId=t),editable:"",filter:!0,options:(g=s(O).workcenters)==null?void 0:g.sort((t,y)=>t.description.localeCompare(y.description)),optionValue:"id",optionLabel:"description",class:"w-full",onChange:i[2]||(i[2]=t=>C(a.productionPart.workcenterId))},null,8,["modelValue","options"])]),o("div",null,[De,l(B,{modelValue:a.productionPart.date,"onUpdate:modelValue":i[3]||(i[3]=t=>a.productionPart.date=t),dateFormat:"dd/mm/yy"},null,8,["modelValue"])])]),o("section",Se,[o("div",null,[Fe,l(c,{modelValue:h.value,"onUpdate:modelValue":i[4]||(i[4]=t=>h.value=t),editable:"",filter:!0,options:(T=s(p).detailedWorkOrders)==null?void 0:T.sort((t,y)=>t.workOrderCode.localeCompare(y.workOrderCode)).map(t=>({label:t.workOrderCode+"  ("+t.referenceDescription+") - "+t.workOrderPhaseCode+"  ("+t.workOrderPhaseDescription+") | "+t.machineStatusDescription,value:t})),optionLabel:"label",class:G(["w-full",{"p-invalid":I.value.errors.workOrderId}]),onChange:k},null,8,["modelValue","options","class"])])]),o("section",$e,[o("div",null,[l(j,{type:s(R).NUMERIC,label:"Quantitat",id:"quantity",modelValue:a.productionPart.quantity,"onUpdate:modelValue":i[5]||(i[5]=t=>a.productionPart.quantity=t)},null,8,["type","modelValue"])]),o("div",null,[l(j,{type:s(R).NUMERIC,label:"Temps operari (minuts)",id:"time",modelValue:a.productionPart.operatorTime,"onUpdate:modelValue":i[6]||(i[6]=t=>a.productionPart.operatorTime=t)},null,8,["type","modelValue"])]),o("div",null,[l(j,{type:s(R).NUMERIC,label:"Temps centre de treball (minuts)",id:"time",modelValue:a.productionPart.workcenterTime,"onUpdate:modelValue":i[7]||(i[7]=t=>a.productionPart.workcenterTime=t)},null,8,["type","modelValue"])])]),Ue,o("div",xe,[l(H,{label:"Guardar",size:"small",onClick:W})])])):ee("",!0)}}}),Me={class:"flex flex-wrap align-items-center justify-content-between gap-2"},We={class:"datatable-filter-5"},Be={class:"filter-field"},He={class:"filter-field"},Ne=o("label",null,"Operari",-1),Le={class:"filter-field"},Re=o("label",null,"Màquina",-1),je={class:"filter-field"},Qe=o("label",null,"OF",-1),ze=["onClick"],Ae={key:0,class:"flex-right"},Ge=o("br",null,null,-1),Je=o("br",null,null,-1),ot=Y({__name:"ProductionParts",setup(J){const M=pe(),u=me(),F=ve(),O=Z(),p=Ce(),h=ke(),k=te(),V=re(),I=we(),d=E({operatorId:"",workcenterId:"",workorderId:""}),C=async()=>{if(u.exercisePicker.dates){const e=K(u.exercisePicker.dates[0]),r=K(u.exercisePicker.dates[1]);await p.fetchFiltered(e,r,d.value.workcenterId,d.value.operatorId,d.value.workorderId),await V.fetchFiltered(e,r)}else O.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},W=()=>{u.cleanExercisePicker(),d.value.workcenterId="",d.value.operatorId=""},a=fe({visible:!1,title:"Crear tíquet de producció",closable:!0,position:"center",modal:!0});he(async()=>{u.setMenuItem({icon:q.CLOUD,title:"Tíquets de producció"}),k.fetchWorkcenters(),k.fetchOperators(),k.fetchOperatorTypes(),k.fetchMachineStatuses(),await k.fetchWorkcenterCosts(),await h.fetchActive(),i(),C(),V.detailedWorkOrders=void 0}),be(()=>{const e={...d.value,exercisePicker:u.exercisePicker};F.addFilter("ProductionParts","",e)});const i=()=>{const e=F.getFilter("ProductionParts","");e&&(d.value.operatorId=e.operatorId,d.value.workcenterId=e.workcenterId,d.value.workorderId=e.workorderId,e.exercisePicker&&(u.exercisePicker.exercise=e.exercisePicker.exercise,u.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},c=_(()=>{if(p.productionParts)return p.productionParts.map(e=>({...e,personalCost:le(e),workcenterCost:ae(e)}))}),B=_(()=>{if(p.productionParts)return p.productionParts.reduce((e,r)=>e+r.operatorTime,0)}),H=_(()=>{if(p.productionParts)return p.productionParts.reduce((e,r)=>e+r.workcenterTime,0)}),$=_(()=>{if(p.productionParts)return p.productionParts.reduce((e,r)=>e+r.quantity,0)}),g=_(()=>{if(c.value&&c.value.length>0)return c.value.reduce((e,r)=>e+(r.personalCost?r.personalCost:0),0)}),T=_(()=>{if(c.value&&c.value.length>0)return c.value.reduce((e,r)=>e+(r.workcenterCost?r.workcenterCost:0),0)}),t=E({}),y=()=>({id:ye(),operatorId:"",workcenterId:"",workOrderId:"",workOrderPhaseId:"",workOrderPhaseDetailId:"",operatorHourCost:0,machineHourCost:0,operatorTime:0,workcenterTime:0,quantity:0,date:new Date}),oe=e=>{if(e.workOrder&&e.workOrderPhase&&e.workOrderPhaseDetail){const r=k.getMachineStatusNameById(e.workOrderPhaseDetail.machineStatusId);return`${e.workOrder.code} - ${e.workOrderPhase.code} (${e.workOrderPhase.description}) - ${r}`}},ae=e=>{const r=e.machineHourCost*e.workcenterTime/60;return X.round(r,2)},le=e=>{const r=e.operatorHourCost*e.operatorTime/60;return X.round(r,2)},se=()=>{t.value=y(),a.visible=!0},ie=async()=>{a.visible=!1,await p.create(t.value)&&(M.push({path:"/productionpart"}),C())},ne=(e,r)=>{I.require({target:e.currentTarget,message:"Està segur que vol eliminar el tíquet de producció?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await p.delete(r.id)&&(O.add({severity:"success",summary:"Eliminat",life:3e3}),await C())}})};return(e,r)=>{const U=P("Dropdown"),N=P("Button"),b=P("Column"),de=P("DataTable"),ue=P("Dialog");return z(),A(Pe,null,[l(de,{value:c.value,class:"p-datatable-sm small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"79vh","sort-order":1,"sort-field":"date",paginator:"",rows:25},{header:v(()=>{var n,x;return[o("div",Me,[o("div",We,[o("div",Be,[l(ce,{exercises:s(h).exercises},null,8,["exercises"])]),o("div",He,[Ne,l(U,{modelValue:d.value.operatorId,"onUpdate:modelValue":r[0]||(r[0]=m=>d.value.operatorId=m),"show-clear":!0,filter:!0,options:(n=s(k).operators)==null?void 0:n.sort((m,L)=>m.surname.localeCompare(L.surname)).map(m=>({value:m.id,label:m.surname+", "+m.name})),optionValue:"value",optionLabel:"label",class:"w-full"},null,8,["modelValue","options"])]),o("div",Le,[Re,l(U,{modelValue:d.value.workcenterId,"onUpdate:modelValue":r[1]||(r[1]=m=>d.value.workcenterId=m),"show-clear":!0,filter:!0,options:(x=s(k).workcenters)==null?void 0:x.sort((m,L)=>m.description.localeCompare(L.description)),optionValue:"id",optionLabel:"description",class:"w-full"},null,8,["modelValue","options"])]),o("div",je,[Qe,l(U,{modelValue:d.value.workorderId,"onUpdate:modelValue":r[2]||(r[2]=m=>d.value.workorderId=m),"show-clear":!0,filter:!0,options:s(V).workorders,optionValue:"id",optionLabel:"code",class:"w-full"},null,8,["modelValue","options"])]),o("div",null,[l(N,{class:"datatable-button mr-2",icon:s(q).FILTER,rounded:"",raised:"",onClick:C},null,8,["icon"]),l(N,{class:"datatable-button mr-2",icon:s(q).FILTER_SLASH,rounded:"",raised:"",onClick:W},null,8,["icon"]),l(N,{icon:s(q).PLUS,rounded:"",raised:"",onClick:se},null,8,["icon"])])])])]}),empty:v(()=>[f(" No s'han trobat tiquets. ")]),loading:v(()=>[f(" Carregant tiquets. Si us plau espera. ")]),footer:v(()=>[c.value&&c.value.length>0?(z(),A("div",Ae,[o("span",null,[f(" Quantitat: "+w($.value)+" unitats ",1),Ge,f(" Temps màquina: "+w(H.value)+" / Temps operari : "+w(B.value)+" ",1),Je,f(" Cost màquina: "+w(s(D)(T.value))+" / Cost operari: "+w(s(D)(g.value))+" = "+w(s(D)(g.value+T.value)),1)])])):ee("",!0)]),default:v(()=>[l(b,{field:"operatorId",header:"Operari",style:{width:"15%"}},{body:v(n=>[f(w(s(k).getOperatorNameById(n.data.operatorId)),1)]),_:1}),l(b,{field:"workcenterId",header:"Màquina",style:{width:"15%"}},{body:v(n=>[f(w(s(k).getWorkcenterNameById(n.data.workcenterId)),1)]),_:1}),l(b,{field:"workOrderId",header:"OF",style:{width:"20%"}},{body:v(n=>[f(w(oe(n.data)),1)]),_:1}),l(b,{field:"date",header:"Data",style:{width:"10%"},sortable:""},{body:v(n=>[f(w(s(Ie)(n.data.date)),1)]),_:1}),l(b,{field:"quantity",header:"Quantitat",style:{width:"5%"}}),l(b,{field:"operatorTime",header:"Temps Oper.",style:{width:"10%"}}),l(b,{field:"workcenterTime",header:"Temps Maq.",style:{width:"10%"}}),l(b,{header:"Cost Operari",style:{width:"10%"},field:"operatorHourCost"},{body:v(n=>[f(w(s(D)(n.data.operatorHourCost/60*n.data.operatorTime)),1)]),_:1}),l(b,{header:"Cost Màquina",style:{width:"10%"},field:"machineHourCost"},{body:v(n=>[f(w(s(D)(n.data.machineHourCost/60*n.data.workcenterTime)),1)]),_:1}),l(b,{style:{width:"5%"}},{body:v(n=>[o("i",{class:G([s(q).TIMES,"grid_delete_column_button"]),onClick:x=>ne(x,n.data)},null,10,ze)]),_:1})]),_:1},8,["value"]),l(ue,{visible:a.visible,"onUpdate:visible":r[3]||(r[3]=n=>a.visible=n),header:a.title,closable:a.closable,modal:a.modal},{default:v(()=>[l(Ee,{productionPart:t.value,"avoid-work-order-refresh":!1,onSubmit:ie},null,8,["productionPart"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{ot as default};
