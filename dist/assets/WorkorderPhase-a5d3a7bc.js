import{_ as oe}from"./FormWorkorderPhase.vue_vue_type_script_setup_true_lang-11baecb8.js";import{d as $,x as A,h as f,a as V,m as S,w as h,e as s,i as l,k as d,P as B,C as F,D as L,B as se,n as D,j as N,r as P,c as R,s as g,y as T,l as M,v as ie,u as re,z as ne,E as de,o as me,F as k,G as ue}from"./index-64fee6e6.js";import{g as W}from"./functions-2e154ea4.js";import{u as q}from"./plantmodel-13c630e1.js";import{u as ce}from"./workmaster-64ab54c8.js";import{c as j,d as O,F as z,a as pe}from"./form-validator-f8953ae6.js";import{u as G}from"./reference-372e33a9.js";import{_ as fe}from"./DropdownReference.vue_vue_type_script_setup_true_lang-14e78baf.js";import{u as be}from"./workorder-c497cf68.js";import"./DropdownLifecycle.vue_vue_type_script_setup_true_lang-fd007775.js";import"./lifecycle-e8c951ba.js";import"./index-93e66ee5.js";import"./base.service-0fa5a61f.js";import"./reference.service-10b4f35b.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";import"./index-af0e943c.js";const he={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ve=s("span",{class:"text-xl text-900 font-bold"},"Pasos de fabricació",-1),ye=["onClick"],_e=$({__name:"TableWorkorderPhaseDetails",props:{workorderPhase:{},details:{}},emits:["add","edit","delete"],setup(C,{emit:c}){const b=C,w=A();ce();const v=q(),y=a=>{var m;if(!v.machineStatuses)return"";const t=(m=v.machineStatuses)==null?void 0:m.find(p=>a===p.id);return t?t.name:""},n=()=>{const a={id:W(),workOrderPhaseId:b.workorderPhase.id,estimatedTime:0,estimatedOperatorTime:0,isCycleTime:!1,machineStatusId:"",comment:"",order:_()};c("add",a)},_=()=>{let a=10;return b.details?(b.details.length+1)*10:a},o=a=>{a.originalEvent.target.className.includes("grid_delete_column_button")||c("edit",a.data)},e=(a,t)=>{w.require({target:a.currentTarget,message:"Está segur que vol eliminar el pas de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{c("delete",t)}})};return(a,t)=>{const m=f("Button"),p=f("Column"),u=f("DataTable");return V(),S(u,{onRowClick:o,value:a.details,tableStyle:"min-width: 100%","sort-field":"order","sort-order":1},{header:h(()=>[s("div",he,[ve,l(m,{icon:d(B).PLUS,rounded:"",raised:"",onClick:n},null,8,["icon"])])]),default:h(()=>[l(p,{sortable:"",field:"order",header:"Ordre",style:{width:"10%"}}),l(p,{header:"Estat de màquina",style:{width:"25%"}},{body:h(r=>[F(L(y(r.data.machineStatusId)),1)]),_:1}),l(p,{header:"Temps de cicle",style:{width:"25%"}},{body:h(r=>[l(se,{value:r.data.isCycleTime},null,8,["value"])]),_:1}),l(p,{field:"estimatedTime",header:"Temps màquina (min)",style:{width:"25%"}}),l(p,{field:"estimatedOperatorTime",header:"Temps operari (min)",style:{width:"25%"}}),l(p,{style:{width:"25%"}},{body:h(r=>[s("i",{class:D([d(B).TIMES,"grid_delete_column_button"]),onClick:E=>e(E,r.data)},null,10,ye)]),_:1})]),_:1},8,["value"])}}}),Ie={key:0},we={class:"three-columns"},ke=s("label",{class:"block text-900 mb-2"},"Estat",-1),ge=s("label",{class:"block text-900v mb-1"},"Temps de cicle",-1),Te={class:"three-columns mt-2"},Ve={class:"mt-2"},Ce=s("label",{class:"block text-900v mb-1"},"Comentari fabricació",-1),Ee=s("br",null,null,-1),Pe=$({__name:"FormWorkorderPhaseDetail",props:{detail:{}},emits:["submit","cancel"],setup(C,{emit:c}){const b=C,w=q(),v=N(),y=j().shape({order:O().required("L'ordre és obligatori").positive("L'ordre ha de ser positiu"),estimatedTime:O().required("El temps estimat és obligatori")}),n=P({result:!1,errors:{}}),_=()=>{const e=new z(y);n.value=e.validate(b.detail)},o=async()=>{if(_(),n.value.result)c("submit",b.detail);else{let e="";Object.entries(n.value.errors).forEach(a=>{e+=`${a[1].map(t=>t)}.   `}),v.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,a)=>{const t=f("Dropdown"),m=f("Checkbox"),p=f("Textarea"),u=f("Button");return e.detail?(V(),R("form",Ie,[s("section",we,[s("div",null,[l(T,{type:d(g).NUMERIC,label:"Ordre",modelValue:e.detail.order,"onUpdate:modelValue":a[0]||(a[0]=r=>e.detail.order=r),class:D({"p-invalid":n.value.errors.order})},null,8,["type","modelValue","class"])]),s("div",null,[ke,l(t,{modelValue:e.detail.machineStatusId,"onUpdate:modelValue":a[1]||(a[1]=r=>e.detail.machineStatusId=r),editable:"",options:d(w).machineStatuses,optionValue:"id",optionLabel:"description",class:D(["w-full",{"p-invalid":n.value.errors.machineStatusId}])},null,8,["modelValue","options","class"])]),s("div",null,[ge,l(m,{modelValue:e.detail.isCycleTime,"onUpdate:modelValue":a[2]||(a[2]=r=>e.detail.isCycleTime=r),class:"w-full",binary:!0},null,8,["modelValue"])])]),s("section",Te,[s("div",null,[l(T,{type:d(g).NUMERIC,decimals:2,label:"Temps màquina (min)",modelValue:e.detail.estimatedTime,"onUpdate:modelValue":a[3]||(a[3]=r=>e.detail.estimatedTime=r),class:D({"p-invalid":n.value.errors.estimatedTime})},null,8,["type","modelValue","class"])]),s("div",null,[l(T,{type:d(g).NUMERIC,decimals:2,label:"Temps operari (min)",modelValue:e.detail.estimatedOperatorTime,"onUpdate:modelValue":a[4]||(a[4]=r=>e.detail.estimatedOperatorTime=r),class:D({"p-invalid":n.value.errors.estimatedTime})},null,8,["type","modelValue","class"])])]),s("div",Ve,[Ce,l(p,{class:"w-full",modelValue:e.detail.comment,"onUpdate:modelValue":a[5]||(a[5]=r=>e.detail.comment=r)},null,8,["modelValue"])]),Ee,s("div",null,[l(u,{label:"Guardar pas",style:{float:"right"},size:"small",onClick:o})])])):M("",!0)}}}),De={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Me=s("span",{class:"text-xl text-900 font-bold"},"Materials de fabricació",-1),Se=["onClick"],Be=$({__name:"TableWorkorderPhaseBillOfMaterials",props:{workorderPhase:{},billOfMaterials:{}},emits:["add","edit","delete"],setup(C,{emit:c}){const b=C,w=A(),v=G(),y=e=>{var t;if(!v.references)return"";const a=(t=v.references)==null?void 0:t.find(m=>e===m.id);return a?v.getFullName(a):""},n=()=>{const e={id:W(),workOrderPhaseId:b.workorderPhase.id,referenceId:"",quantity:0,width:0,diameter:0,height:0,length:0,thickness:0};c("add",e)},_=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||c("edit",e.data)},o=(e,a)=>{w.require({target:e.currentTarget,message:"Está segur que vol eliminar el material de la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{c("delete",a)}})};return(e,a)=>{const t=f("Button"),m=f("Column"),p=f("DataTable");return V(),S(p,{onRowClick:_,value:e.billOfMaterials,tableStyle:"min-width: 100%"},{header:h(()=>[s("div",De,[Me,l(t,{icon:d(B).PLUS,rounded:"",raised:"",onClick:n},null,8,["icon"])])]),default:h(()=>[l(m,{header:"Material consum",style:{width:"30%"}},{body:h(u=>[F(L(y(u.data.referenceId)),1)]),_:1}),l(m,{field:"quantity",header:"Consum",style:{width:"15%"}}),l(m,{field:"width",header:"Ample (x) mm",style:{width:"12%"}}),l(m,{field:"length",header:"Llarg (y) mm",style:{width:"12%"}}),l(m,{field:"height",header:"Alt (z) mm",style:{width:"12%"}}),l(m,{field:"diameter",header:"Diàmetre mm",style:{width:"12%"}}),l(m,{field:"thickness",header:"Gruix mm",style:{width:"12%"}}),l(m,{style:{width:"10%"}},{body:h(u=>[s("i",{class:D([d(B).TIMES,"grid_delete_column_button"]),onClick:r=>o(r,u.data)},null,10,Se)]),_:1})]),_:1},8,["value"])}}}),$e={key:0},Ue={class:"three-columns"},Re={class:"three-columns"},Oe={class:"mt-2"},Ne={class:"mt-2"},qe={class:"mt-2"},Ae=s("br",null,null,-1),Fe=$({__name:"FormWorkorderPhaseBomItem",props:{bomItem:{}},emits:["submit","cancel"],setup(C,{emit:c}){const b=C,w=N(),v=j().shape({referenceId:pe().required("El material de consum és obligatori"),quantity:O().min(1,"La quantitat a consumir ha de ser positiva").required("La quantitat a consumir és obligatoria")}),y=P({result:!1,errors:{}}),n=()=>{const o=new z(v);y.value=o.validate(b.bomItem)},_=async()=>{if(n(),y.value.result)c("submit",b.bomItem);else{let o="";Object.entries(y.value.errors).forEach(e=>{o+=`${e[1].map(a=>a)}.   `}),w.add({severity:"warn",summary:"Formulari inválid",detail:o,life:5e3})}};return(o,e)=>{const a=f("Button");return o.bomItem?(V(),R("form",$e,[s("div",null,[l(fe,{label:"Material",fullName:!0,modelValue:o.bomItem.referenceId,"onUpdate:modelValue":e[0]||(e[0]=t=>o.bomItem.referenceId=t),class:D({"p-invalid":y.value.errors.referenceId})},null,8,["modelValue","class"])]),s("section",Ue,[s("div",null,[l(T,{type:d(g).NUMERIC,label:"Quantitat",modelValue:o.bomItem.quantity,"onUpdate:modelValue":e[1]||(e[1]=t=>o.bomItem.quantity=t)},null,8,["type","modelValue"])]),s("div",null,[l(T,{type:d(g).NUMERIC,label:"Amplada (mm)",decimals:2,modelValue:o.bomItem.width,"onUpdate:modelValue":e[2]||(e[2]=t=>o.bomItem.width=t)},null,8,["type","modelValue"])]),s("div",null,[l(T,{type:d(g).NUMERIC,decimals:2,label:"Alçada (mm)",modelValue:o.bomItem.height,"onUpdate:modelValue":e[3]||(e[3]=t=>o.bomItem.height=t)},null,8,["type","modelValue"])])]),s("section",Re,[s("div",Oe,[l(T,{type:d(g).NUMERIC,decimals:2,label:"Longitud (mm)",modelValue:o.bomItem.length,"onUpdate:modelValue":e[4]||(e[4]=t=>o.bomItem.length=t)},null,8,["type","modelValue"])]),s("div",Ne,[l(T,{type:d(g).NUMERIC,decimals:2,label:"Diàmetre (mm)",modelValue:o.bomItem.diameter,"onUpdate:modelValue":e[5]||(e[5]=t=>o.bomItem.diameter=t)},null,8,["type","modelValue"])]),s("div",qe,[l(T,{type:d(g).NUMERIC,decimals:2,label:"Gruix (mm)",modelValue:o.bomItem.thickness,"onUpdate:modelValue":e[6]||(e[6]=t=>o.bomItem.thickness=t)},null,8,["type","modelValue"])])]),Ae,s("div",null,[l(a,{label:"Guardar material",style:{float:"right"},size:"small",onClick:_})])])):M("",!0)}}}),Le={key:0,class:"main"},st=$({__name:"WorkorderPhase",setup(C){const c=ie(),b=N(),w=re(),v=G(),y=q(),n=be(),{workorder:_,workorderPhase:o}=ne(n),e=P(""),a=P(""),t=de({visible:!1,title:"Fase",closable:!0,position:"center",modal:!0});me(async()=>{e.value=c.params.id,a.value=c.params.phaseid,await m();let i="";i="Ordre de fabricació",_.value&&o.value&&(i=`${i} ${_.value.code} - Fase ${o.value.code}`),w.setMenuItem({icon:B.BUILDING,backButtonVisible:!0,title:i}),v.fetchReferencesByModule("purchase"),y.fetchActiveModel()});const m=async()=>{await n.fetchPhaseById(a.value)},p=async i=>{await n.updatePhase(a.value,i)&&b.add({severity:"success",summary:"Fase actualitzada",detail:`La fase ${i.code} ha estat actualitzada correctament`,life:1e4})},u=P(k.CREATE),r=P(void 0),E=P(void 0),H=()=>{r.value=void 0,E.value=void 0},Q=i=>{u.value=k.CREATE,r.value=i,t.title="Afegir pas de fabricació",t.visible=!0},x=i=>{u.value=k.EDIT,r.value=i,t.title="Modificar pas de fabricació",t.visible=!0},J=i=>{n.deletePhaseDetail(i.id)},K=async i=>{let I;u.value===k.CREATE?I=n.createPhaseDetail(i):u.value===k.EDIT&&(I=n.updatePhaseDetail(i.id,i)),await I&&(t.visible=!1)},X=i=>{u.value=k.CREATE,E.value=i,t.title="Afegir material",t.visible=!0},Y=i=>{u.value=k.EDIT,E.value=i,t.title="Modificar material",t.visible=!0},Z=i=>{n.deletePhaseBomItem(i.id)},ee=async i=>{let I;u.value===k.CREATE?I=n.createPhaseBomItem(i):u.value===k.EDIT&&(I=n.updatePhaseBomItem(i.id,i)),await I&&(t.visible=!1)};return(i,I)=>{const U=f("TabPanel"),te=f("TabView"),ae=f("Dialog");return V(),R(ue,null,[s("header",null,[d(_)&&d(o)?(V(),S(oe,{key:0,workorder:d(_),phase:d(o),onSubmit:p},null,8,["workorder","phase"])):M("",!0)]),d(o)?(V(),R("main",Le,[l(te,null,{default:h(()=>[l(U,{header:"Pasos"},{default:h(()=>[l(_e,{workorderPhase:d(o),details:d(o).details,onAdd:Q,onEdit:x,onDelete:J},null,8,["workorderPhase","details"])]),_:1}),l(U,{header:"Materials"},{default:h(()=>[l(Be,{workorderPhase:d(o),billOfMaterials:d(o).billOfMaterials,onAdd:X,onEdit:Y,onDelete:Z},null,8,["workorderPhase","billOfMaterials"])]),_:1})]),_:1}),l(ae,{visible:t.visible,"onUpdate:visible":I[0]||(I[0]=le=>t.visible=le),header:t.title,closable:t.closable,modal:t.modal,onHide:H},{default:h(()=>[r.value?(V(),S(Pe,{key:0,detail:r.value,onSubmit:K},null,8,["detail"])):M("",!0),E.value?(V(),S(Fe,{key:1,bomItem:E.value,onSubmit:ee},null,8,["bomItem"])):M("",!0)]),_:1},8,["visible","header","closable","modal"])])):M("",!0)],64)}}});export{st as default};
