import{_ as j}from"./DropdownReference.vue_vue_type_script_setup_true_lang-d626da92.js";import{c as z,d as A,a as G,F as Q}from"./form-validator-98408db2.js";import{d as E,j as R,V as K,r as N,h as v,c as q,e as t,i as l,G as P,k as c,z as J,H as k,l as $,a as I,s as X,R as T,K as Y,x as Z,w as b,L as F,P as B,n as ee,m as D,J as te,v as se,g as ae,u as oe,C as re,o as le,f as ne}from"./index-31e65974.js";import{u as U}from"./workmaster-c95e8570.js";import{u as H}from"./plantmodel-0a75363b.js";import{_ as ie}from"./FormWorkmasterPhase.vue_vue_type_script_setup_true_lang-328c0638.js";import{u as ce}from"./reference-043713ab.js";import"./index-f118885c.js";import"./index-7cbe1881.js";const de={key:0},ue={class:"grid_add_row_button"},me=t("br",null,null,-1),pe={class:"five-columns"},_e=t("label",{class:"block text-900 mb-2"},"Mode",-1),he=t("label",{class:"block text-900 mb-2"},"Desactivat",-1),fe={class:"six-columns"},ke={class:"mt-1"},we=t("label",{class:"block text-900 mb-2"},"Cost Operari:",-1),be={class:"summary-field"},ve={class:"mt-1"},ye=t("label",{class:"block text-900 mb-2"},"Cost Màquina:",-1),Ce={class:"summary-field"},ge={class:"mt-1"},Te=t("label",{class:"block text-900 mb-2"},"Cost Material:",-1),Ie={class:"summary-field"},Ve={class:"mt-1"},xe=t("label",{class:"block text-900 mb-2"},"Cost Extern:",-1),Me={class:"summary-field"},Pe={class:"mt-1"},$e=t("label",{class:"block text-900 mb-2"},"Cost Total:",-1),Se={class:"summary-field"},We={class:"mt-1"},Be=t("label",{class:"block text-900 mb-2"},"Pes Total:",-1),De={class:"summary-field"},Ee=E({__name:"FormWorkmaster",props:{workmaster:{}},emits:["submit","calculateCost","cancel"],setup(M,{emit:w}){const d=M,m=U(),y=R(),C=K(()=>d.workmaster.operatorCost+d.workmaster.machineCost+d.workmaster.materialCost+d.workmaster.externalCost),r=z().shape({baseQuantity:A().min(1,"La quantitat base ha de ser superior a 0").required("La quanitat base és obligatoria"),referenceId:G().required("La referència és obligatoria")}),f=N({result:!1,errors:{}}),u=()=>{const s=new Q(r);f.value=s.validate(d.workmaster)},p=async()=>{if(u(),f.value.result)w("submit",d.workmaster);else{let s="";Object.entries(f.value.errors).forEach(n=>{s+=`${n[1].map(h=>h)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}},g=()=>{if(u(),f.value.result)w("calculateCost",d.workmaster);else{let s="";Object.entries(f.value.errors).forEach(n=>{s+=`${n[1].map(h=>h)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,n)=>{const h=v("Button"),V=v("Dropdown"),x=v("Checkbox");return s.workmaster?(I(),q("form",de,[t("div",ue,[l(h,{label:"Calcular Cost",size:"small",onClick:g}),P("   "),l(h,{label:"Guardar",size:"small",onClick:p}),me]),t("section",pe,[t("div",null,[l(j,{label:"Referència",modelValue:s.workmaster.referenceId,"onUpdate:modelValue":n[0]||(n[0]=e=>s.workmaster.referenceId=e),fullName:!0},null,8,["modelValue"])]),t("div",null,[l(J,{type:c(X).NUMERIC,label:"Quantitat Base",decimals:2,modelValue:s.workmaster.baseQuantity,"onUpdate:modelValue":n[1]||(n[1]=e=>s.workmaster.baseQuantity=e)},null,8,["type","modelValue"])]),t("div",null,[_e,l(V,{modelValue:s.workmaster.mode,"onUpdate:modelValue":n[2]||(n[2]=e=>s.workmaster.mode=e),options:c(m).workmasterModes,optionLabel:"value",optionValue:"id",placeholder:"Seleccione el modo",class:"w-full"},null,8,["modelValue","options"])]),t("div",null,[he,l(x,{modelValue:s.workmaster.disabled,"onUpdate:modelValue":n[3]||(n[3]=e=>s.workmaster.disabled=e),class:"w-full",binary:!0},null,8,["modelValue"])])]),t("section",fe,[t("div",ke,[we,t("span",be,k(c(T)(s.workmaster.operatorCost)),1)]),t("div",ve,[ye,t("span",Ce,k(c(T)(s.workmaster.machineCost)),1)]),t("div",ge,[Te,t("span",Ie,k(c(T)(s.workmaster.materialCost)),1)]),t("div",Ve,[xe,t("span",Me,k(c(T)(s.workmaster.externalCost)),1)]),t("div",Pe,[$e,t("span",Se,k(c(T)(C.value)),1)]),t("div",We,[Be,t("span",De,k(s.workmaster.totalWeight)+" KG",1)])])])):$("",!0)}}}),Re={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Ne=t("span",{class:"text-xl text-900 font-bold"},"Fases de la ruta",-1),qe=["onClick"],Fe=E({__name:"TableWorkmasterPhases",props:{workmaster:{},workmasterPhases:{},scrollHeight:{}},emits:["add","edit","delete"],setup(M,{emit:w}){const d=M,m=Y({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),y=R(),C=Z(),r=H(),f=e=>{var o;if(!r.workcenterTypes)return"";const a=(o=r.workcenterTypes)==null?void 0:o.find(i=>e===i.id);return a?a.name:""},u=e=>{var o;if(!r.workcenters)return"";const a=(o=r.workcenters)==null?void 0:o.find(i=>e===i.id);return a?a.name:""},p=e=>{var o;if(!r.operatorTypes)return"";const a=(o=r.operatorTypes)==null?void 0:o.find(i=>e===i.id);return a?a.name:""},g=()=>{const a=d.workmaster.phases.reduce((i,S)=>{const W=parseInt(S.code,10)||0;return Math.max(i,W)},0);return(Math.ceil((a+1)/10)*10).toString()},s=N({}),n=()=>{s.value={id:te(),workMasterId:d.workmaster.id,disabled:!1,code:g(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,transportCost:0,serviceReferenceId:null,profitPercentage:0,workmasterPhaseDetails:[],workmasterPhaseBillOfMaterials:[]},m.visible=!0},h=e=>{if(d.workmaster.phases.find(o=>o.code===e.code)){y.add({severity:"warn",summary:"Fase invàlida",detail:`La fase ${e.code} ja existeix`,life:5e3});return}m.visible=!1,w("add",e)},V=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||w("edit",e.data)},x=(e,a)=>{C.require({target:e.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{w("delete",a)}})};return(e,a)=>{const o=v("Button"),i=v("Column"),S=v("BooleanColumn"),W=v("DataTable"),L=v("Dialog");return I(),q(F,null,[l(W,{onRowClick:V,class:"p-datatable-sm",value:e.workmasterPhases,tableStyle:"min-width: 100%","sort-field":"code","sort-order":1,scrollable:e.scrollHeight!==void 0,scrollHeight:e.scrollHeight?`${e.scrollHeight}vh`:""},{header:b(()=>[t("div",Re,[Ne,l(o,{icon:c(B).PLUS,rounded:"",raised:"",onClick:n},null,8,["icon"])])]),default:b(()=>[l(i,{field:"code",header:"Codi",sortable:"",style:{width:"10%"}}),l(i,{field:"description",header:"Descripció",style:{width:"20%"}}),l(i,{header:"Tipus de màquina",style:{width:"15%"}},{body:b(_=>[P(k(f(_.data.workcenterTypeId)),1)]),_:1}),l(i,{header:"Màquina preferida",style:{width:"15%"}},{body:b(_=>[P(k(u(_.data.preferredWorkcenterId)),1)]),_:1}),l(i,{header:"Tipus d'operari",style:{width:"15%"}},{body:b(_=>[P(k(p(_.data.operatorTypeId)),1)]),_:1}),l(i,{header:"Extern",style:{width:"10%"}},{body:b(_=>[l(S,{value:_.data.isExternalWork},null,8,["value"])]),_:1}),l(i,{style:{width:"10%"}},{body:b(_=>[t("i",{class:ee([c(B).TIMES,"grid_delete_column_button"]),onClick:O=>x(O,_.data)},null,10,qe)]),_:1})]),_:1},8,["value","scrollable","scrollHeight"]),l(L,{visible:m.visible,"onUpdate:visible":a[0]||(a[0]=_=>m.visible=_),header:m.title,closable:m.closable,modal:m.modal},{default:b(()=>[s.value?(I(),D(ie,{key:0,workmaster:e.workmaster,phase:s.value,onSubmit:h},null,8,["workmaster","phase"])):$("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),Ue={class:"main"},He=E({__name:"Workmaster",setup(M){const w=se(),d=ae(),m=oe(),y=R(),C=ce(),r=U(),f=H(),{workmaster:u}=re(r),p=N("");le(async()=>{p.value=w.params.id,await g();let e="";e="Ruta de fabricació",u.value&&(e=`${e} ${C.getFullName(u.value.reference)}`),m.setMenuItem({icon:B.BUILDING,backButtonVisible:!0,title:e})});const g=async()=>{await C.fetchReferencesByModule("sales"),await r.fetchOne(p.value),f.fetchActiveModel()},s=async e=>{await r.update(p.value,e)&&await g()},n=async e=>{const a=await r.update(p.value,e),o=await r.calculate(e.id);a&&o.result?(y.add({severity:"success",summary:"Cálcul de cost",detail:`${T(o.content)}`,life:1e4}),await r.fetchOne(p.value)):y.add({severity:"warn",summary:"Cálcul de cost",detail:o.errors.length>0?o.errors[0]:"Errors detectats durant el cálcul",life:1e4})},h=async e=>{await r.createPhase(e)&&d.push({path:`/workmaster/${p.value}/phase/${e.id}`})},V=e=>{d.push({path:`/workmaster/${p.value}/phase/${e.id}`})},x=async e=>{await r.deletePhase(e.id)};return(e,a)=>(I(),q(F,null,[t("header",null,[c(u)?(I(),D(Ee,{key:0,workmaster:c(u),onCalculateCost:n,onSubmit:s},null,8,["workmaster"])):$("",!0)]),t("main",Ue,[c(u)&&c(u).phases?(I(),D(Fe,{key:0,workmaster:c(u),workmasterPhases:c(u).phases,"scroll-height":67,onAdd:h,onEdit:V,onDelete:x},null,8,["workmaster","workmasterPhases"])):$("",!0)])],64))}});const Xe=ne(He,[["__scopeId","data-v-513b217a"]]);export{Xe as default};
