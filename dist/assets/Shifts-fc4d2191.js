import{d as g,j as B,r as D,h as r,a as C,c as $,e as l,i as a,n as A,z as H,l as k,ak as N,u as z,C as G,K as P,o as M,P as w,w as d,k as c,L as R,B as I,m as O,J as j}from"./index-77e4d88f.js";import{u as q}from"./shift-68d004b2.js";import{c as E,a as J,F as L}from"./form-validator-7d52d458.js";import"./index-fc95771f.js";const K={key:0},Q={class:"two-columns"},W={class:"mb-4"},X=l("label",{class:"block text-900 mb-2"},"Deshabilitat",-1),Y=g({__name:"FormShift",props:{shift:{}},emits:["submit","cancel"],setup(V,{emit:p}){const s=V,v=B(),m=E().shape({name:J().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters")}),i=D({result:!1,errors:{}}),_=()=>{const e=new L(m);i.value=e.validate(s.shift)},y=async()=>{if(console.log("submit"),_(),i.value.result)p("submit",s.shift);else{let e="";Object.entries(i.value.errors).forEach(t=>{e+=`${t[1].map(o=>o)}.   `}),v.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const o=r("Checkbox"),S=r("Button");return e.shift?(C(),$("form",K,[l("section",Q,[a(H,{class:A(["mb-2",{"p-invalid":i.value.errors.baseAmount}]),label:"Nom",modelValue:e.shift.name,"onUpdate:modelValue":t[0]||(t[0]=u=>e.shift.name=u)},null,8,["modelValue","class"]),l("div",W,[X,a(o,{modelValue:e.shift.disabled,"onUpdate:modelValue":t[1]||(t[1]=u=>e.shift.disabled=u),binary:!0},null,8,["modelValue"])])]),a(S,{label:"Confirmar",onClick:y,style:{float:"right"}})])):k("",!0)}}}),Z={key:0},ee={class:"three-columns"},te={class:"mb-4"},se=l("label",{class:"block text-900 mb-2"},"Temps productiu:",-1),ae=g({__name:"FormShiftDetail",props:{shiftdetail:{}},emits:["submit","cancel"],setup(V,{emit:p}){const s=V,v=B(),m=E().shape({}),i=D({result:!1,errors:{}}),_=()=>{const e=new L(m);i.value=e.validate(s.shiftdetail)},y=async()=>{if(s.shiftdetail.startTime=N(s.shiftdetail.startTime),s.shiftdetail.endTime=N(s.shiftdetail.endTime),console.log(s.shiftdetail),_(),i.value.result)p("submit",s.shiftdetail);else{let e="";Object.entries(i.value.errors).forEach(t=>{e+=`${t[1].map(o=>o)}.   `}),v.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,t)=>{const o=r("Calendar"),S=r("Checkbox"),u=r("Button");return e.shiftdetail?(C(),$("form",Z,[l("section",ee,[a(o,{class:"mb-2",label:"Inici Torn:",modelValue:e.shiftdetail.startTime,"onUpdate:modelValue":t[0]||(t[0]=f=>e.shiftdetail.startTime=f),timeOnly:"",hourFormat:"24"},null,8,["modelValue"]),a(o,{class:"mb-2",label:"Fi Torn:",modelValue:e.shiftdetail.endTime,"onUpdate:modelValue":t[1]||(t[1]=f=>e.shiftdetail.endTime=f),timeOnly:"",hourFormat:"24"},null,8,["modelValue"]),l("div",te,[se,a(S,{modelValue:e.shiftdetail.isProductiveTime,"onUpdate:modelValue":t[2]||(t[2]=f=>e.shiftdetail.isProductiveTime=f),binary:!0},null,8,["modelValue"])])]),a(u,{label:"Confirmar",onClick:y,style:{float:"right"}})])):k("",!0)}}}),le={class:"container"},ie={class:"two-columns"},oe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ne=l("span",{class:"text-xl text-900 font-bold"},"Torns",-1),re={class:"flex flex-wrap align-items-center justify-content-between gap-2"},de=l("span",{class:"text-xl text-900 font-bold"},"Horaris",-1),he=g({__name:"Shifts",setup(V){const p=z(),s=q(),v=B(),{shift:m,shiftdetail:i}=G(s),_=()=>{s.setNewShift(j()),e.visible=!0,e.title="Alta de torns"},y=()=>{s.setNewShiftDetail(j()),i.value.shiftId=o.value.id,t.visible=!0,t.title="Configuració de torns"},e=P({visible:!1,title:"",closable:!0,position:"center",modal:!0}),t=P({visible:!1,title:"",closable:!0,position:"center",modal:!0}),o=D(void 0),S=async h=>{await s.fetchShiftDetailsByShiftId(h.data.id),o.value=h.data};M(async()=>{await s.fetchAllShifts(),p.setMenuItem({icon:w.BUILDING,backButtonVisible:!1,title:"Gestió de torns"})});const u=async()=>{const h=m.value;let n=!1;n=await s.createShift(h),n&&(e.visible=!1,v.add({severity:"success",summary:"Torn creat correctament",life:5e3}))},f=async()=>{const h=i.value;let n=!1;n=await s.createDetail(h),n&&(t.visible=!1,v.add({severity:"success",summary:"Detall creat correctament",life:5e3}))};return(h,n)=>{const F=r("Button"),T=r("Column"),x=r("DataTable"),U=r("Dialog");return C(),$(R,null,[l("main",le,[l("section",ie,[l("div",null,[a(x,{value:c(s).shifts,tableStyle:"min-width: 100%",onRowClick:S},{header:d(()=>[l("div",oe,[ne,a(F,{icon:c(w).PLUS,rounded:"",raised:"",onClick:_},null,8,["icon"])])]),default:d(()=>[a(T,{field:"name",header:"Nom"}),a(T,{field:"disabled",header:"Desactivat"},{body:d(b=>[a(I,{value:b.data.disabled},null,8,["value"])]),_:1})]),_:1},8,["value"])]),l("div",null,[a(x,{value:c(s).shiftdetails,tableStyle:"min-width: 100%"},{header:d(()=>[l("div",re,[de,a(F,{icon:c(w).PLUS,rounded:"",raised:"",onClick:y},null,8,["icon"])])]),default:d(()=>[a(T,{field:"startTime",header:"Hora inici"}),a(T,{field:"endTime",header:"Hora fi"}),a(T,{field:"isProductiveTime",header:"Temps Productiu"},{body:d(b=>[a(I,{value:b.data.isProductiveTime},null,8,["value"])]),_:1})]),_:1},8,["value"])])])]),a(U,{visible:e.visible,"onUpdate:visible":n[0]||(n[0]=b=>e.visible=b),header:e.title,closable:e.closable,modal:e.modal},{default:d(()=>[c(m)?(C(),O(Y,{key:0,shift:c(m),onSubmit:u},null,8,["shift"])):k("",!0)]),_:1},8,["visible","header","closable","modal"]),a(U,{visible:t.visible,"onUpdate:visible":n[1]||(n[1]=b=>t.visible=b),header:t.title,closable:t.closable,modal:t.modal},{default:d(()=>[c(i)?(C(),O(ae,{key:0,shiftdetail:c(i),onSubmit:f},null,8,["shiftdetail"])):k("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}});export{he as default};
