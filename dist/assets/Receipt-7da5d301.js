import{d as A,j as G,z as X,o as Y,r as N,h as w,a as C,c as k,i as t,k as a,e as l,s as _,y as g,n as L,l as O,p as ie,b as ne,f as re,m as J,w as V,K as de,C as z,D as $,P as j,v as ue,u as ce,H as me,E as pe,F as U,L as fe}from"./index-3b8fad0b.js";import{u as K}from"./receipt-a2dc7965.js";import{u as be}from"./suppliers-d7c827d3.js";import{u as Z}from"./lifecycle-fc73f11b.js";import{c as ee,a as P,F as te,d as ve}from"./form-validator-f8953ae6.js";import{c as he,f as B,g as M}from"./functions-2e154ea4.js";import{u as ye}from"./masterData-275a2841.js";import{_ as _e}from"./DropdownReference.vue_vue_type_script_setup_true_lang-f8a66cf5.js";import{_ as ge}from"./FormReference.vue_vue_type_script_setup_true_lang-20cca9fb.js";import{u as Ve}from"./reference-e0518f57.js";import"./index-f03ae8d8.js";import"./base.service-95f208f7.js";import"./suppliers.service-eb5d51e2.js";import"./index-30d8ed80.js";import"./reference.service-d6c42ab4.js";import"./_commonjsHelpers-725317a4.js";import"./v4-a960c1f4.js";import"./DropdownCustomers.vue_vue_type_script_setup_true_lang-f2e5ded2.js";import"./customers-e8acd008.js";import"./FileEntityPicker-a7e7bc24.js";import"./file.service-d6ce817a.js";import"./tax-ea8e84c2.js";import"./referenceType-272e0af2.js";const F=R=>(ie("data-v-70931d13"),R=R(),ne(),R),we=F(()=>l("br",null,null,-1)),Re={key:0},Ie={class:"three-columns"},Ce={class:"mt-1"},De={class:"mt-1"},ke=F(()=>l("label",{class:"block text-900 mb-2"},"Exercici",-1)),Ee={class:"mt-1"},Se=F(()=>l("label",{class:"block text-900 mb-2"},"Data Albarà",-1)),Ue={class:"three-columns"},Ne={class:"mt-1"},Fe=F(()=>l("label",{class:"block text-900 mb-2"},"Estat",-1)),Te={class:"mt-1"},$e=F(()=>l("label",{class:"block text-900 mb-2"},"Proveïdor",-1)),Be={class:"mt-1"},Me=A({__name:"FormReceipt",emits:["submit","cancel"],setup(R,{expose:I,emit:v}){const f=K(),h=be(),b=ye(),n=Z(),u=G(),{receipt:d}=X(f);Y(async()=>{await b.fetchMasterData(),await h.fetchSuppliers(),await n.fetchOneByName("Receipts")});const p=ee().shape({supplierId:P().required("El client es obligatori"),statusId:P().required("L'estat es obligatori"),exerciseId:P().required("L'exercici es obligatori")}),e=N({result:!1,errors:{}}),o=()=>{const s=new te(p);e.value=s.validate(d.value)},m=async()=>{if(o(),e.value.result)d.value.date=he(d.value.date),v("submit",d.value);else{let s="";Object.entries(e.value.errors).forEach(c=>{s+=`${c[1].map(E=>E)}.   `}),u.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return I({submitForm:m}),(s,c)=>{var T;const E=w("Button"),S=w("Dropdown"),x=w("Calendar");return C(),k("div",null,[t(E,{label:"Guardar",size:"small",class:"grid_add_row_button",onClick:m}),we,a(d)?(C(),k("form",Re,[l("section",Ie,[l("div",Ce,[t(g,{type:a(_).TEXT,label:"Número",id:"number",modelValue:a(d).number,"onUpdate:modelValue":c[0]||(c[0]=y=>a(d).number=y),disabled:""},null,8,["type","modelValue"])]),l("div",De,[ke,t(S,{modelValue:a(d).exerciseId,"onUpdate:modelValue":c[1]||(c[1]=y=>a(d).exerciseId=y),editable:"",options:a(b).exercises,optionValue:"id",optionLabel:"name",class:L(["w-full",{"p-invalid":e.value.errors.exerciseId}])},null,8,["modelValue","options","class"])]),l("div",Ee,[Se,t(x,{modelValue:a(d).date,"onUpdate:modelValue":c[2]||(c[2]=y=>a(d).date=y),dateFormat:"dd/mm/yy"},null,8,["modelValue"])])]),l("section",Ue,[l("div",Ne,[Fe,t(S,{modelValue:a(d).statusId,"onUpdate:modelValue":c[3]||(c[3]=y=>a(d).statusId=y),editable:"",options:(T=a(n).lifecycle)==null?void 0:T.statuses,optionValue:"id",optionLabel:"name",class:L(["w-full",{"p-invalid":e.value.errors.statusId}])},null,8,["modelValue","options","class"])]),l("div",Te,[$e,t(S,{modelValue:a(d).supplierId,"onUpdate:modelValue":c[4]||(c[4]=y=>a(d).supplierId=y),editable:"",options:a(h).suppliers,optionValue:"id",optionLabel:"comercialName",class:L(["w-full",{"p-invalid":e.value.errors.customerId}])},null,8,["modelValue","options","class"])]),l("div",Be,[t(g,{type:a(_).TEXT,label:"Número Albarà",id:"supplierNumber",modelValue:a(d).supplierNumber,"onUpdate:modelValue":c[5]||(c[5]=y=>a(d).supplierNumber=y)},null,8,["type","modelValue"])])])])):O("",!0)])}}});const Le=re(Me,[["__scopeId","data-v-70931d13"]]),Pe=["onClick"],Ae=A({__name:"TableReceiptDetails",props:{details:{}},emits:["edit","delete"],setup(R,{emit:I}){const v=R,f=b=>{b.originalEvent.target.className.includes("grid_delete_column_button")||I("edit",b.data)},h=(b,n)=>{I("delete",n)};return(b,n)=>{const u=w("Column"),d=w("DataTable");return C(),J(d,{onRowClick:f,value:v.details,tableStyle:"min-width: 100%",class:"p-datatable-sm"},{header:V(()=>[de(b.$slots,"header")]),default:V(()=>[t(u,{field:"quantity",header:"Quantitat",style:{width:"7.5%"}}),t(u,{header:"Material",style:{width:"25%"}},{body:V(p=>[z($(p.data.reference.code)+" - "+$(p.data.reference.description),1)]),_:1}),t(u,{field:"width",header:"Amplada",style:{width:"7.5%"}}),t(u,{field:"height",header:"Alçada",style:{width:"7.5%"}}),t(u,{field:"lenght",header:"Longitud",style:{width:"7.5%"}}),t(u,{field:"thickness",header:"Gruix",style:{width:"7.5%"}}),t(u,{field:"diameter",header:"Diàmetre",style:{width:"7.5%"}}),t(u,{field:"totalWeight",header:"Pes",style:{width:"7.5%"}},{body:V(p=>[z($(p.data.amount)+" KG",1)]),_:1}),t(u,{field:"amount",header:"Preu",style:{width:"7.5%"}},{body:V(p=>[z($(p.data.amount)+" €",1)]),_:1}),t(u,{style:{width:"5%"}},{body:V(p=>[p.data.stockMovementId===null?(C(),k("i",{key:0,class:L([a(j).TIMES,"grid_delete_column_button"]),onClick:e=>h(e,p.data)},null,10,Pe)):O("",!0)]),_:1})]),_:3},8,["value"])}}}),Oe={key:0},xe={class:"two-columns-7525"},qe={class:"three-columns mt-2"},We={class:"three-columns mt-2"},ze={class:"two-columns mt-2"},je=A({__name:"FormReceiptDetail",props:{detail:{}},emits:["submit","cancel"],setup(R,{emit:I}){const v=R,f=G(),h=K(),b=async()=>{const e=await h.calculateDetailWeightAndPrice(v.detail);e?(v.detail.unitWeight=e.unitWeight,v.detail.totalWeight=e.totalWeight,v.detail.unitPrice=e.unitPrice,v.detail.amount=e.amount):f.add({summary:"Calculadora de pes/preu",detail:"Hi ha hagut un problema al realitzar el cálcul",severity:"warn",life:6e3})},n=ee().shape({quantity:ve().min(1).required("La quantitat ha de ser superior a 1"),referenceId:P().required("La referencia és obligatoria")}),u=N({result:!1,errors:{}}),d=()=>{const e=new te(n);u.value=e.validate(v.detail)},p=async()=>{if(d(),u.value.result)I("submit",v.detail);else{let e="";Object.entries(u.value.errors).forEach(o=>{e+=`${o[1].map(m=>m)}.   `}),f.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,o)=>{const m=w("Button");return e.detail?(C(),k("form",Oe,[l("section",xe,[l("div",null,[t(_e,{label:"Material",modelValue:e.detail.referenceId,"onUpdate:modelValue":o[0]||(o[0]=s=>e.detail.referenceId=s),fullName:!0},null,8,["modelValue"])]),l("div",null,[t(g,{type:a(_).CURRENCY,label:"Preu / Kilo",highlightOnFocus:"",modelValue:e.detail.kilogramPrice,"onUpdate:modelValue":o[1]||(o[1]=s=>e.detail.kilogramPrice=s)},null,8,["type","modelValue"])])]),l("section",qe,[l("div",null,[t(g,{type:a(_).NUMERIC,highlightOnFocus:"",label:"Amplada (mm)",decimals:2,modelValue:e.detail.width,"onUpdate:modelValue":o[2]||(o[2]=s=>e.detail.width=s)},null,8,["type","modelValue"])]),l("div",null,[t(g,{type:a(_).NUMERIC,decimals:2,label:"Alçada (mm)",highlightOnFocus:"",modelValue:e.detail.height,"onUpdate:modelValue":o[3]||(o[3]=s=>e.detail.height=s)},null,8,["type","modelValue"])]),l("div",null,[t(g,{type:a(_).NUMERIC,decimals:2,label:"Longitud (mm)",highlightOnFocus:"",modelValue:e.detail.lenght,"onUpdate:modelValue":o[4]||(o[4]=s=>e.detail.lenght=s)},null,8,["type","modelValue"])])]),l("section",We,[l("div",null,[t(g,{type:a(_).NUMERIC,decimals:2,label:"Diàmetre (mm)",highlightOnFocus:"",modelValue:e.detail.diameter,"onUpdate:modelValue":o[5]||(o[5]=s=>e.detail.diameter=s)},null,8,["type","modelValue"])]),l("div",null,[t(g,{type:a(_).NUMERIC,decimals:2,label:"Gruix (mm)",highlightOnFocus:"",modelValue:e.detail.thickness,"onUpdate:modelValue":o[6]||(o[6]=s=>e.detail.thickness=s)},null,8,["type","modelValue"])]),l("div",null,[t(g,{type:a(_).NUMERIC,decimals:2,label:"Pes (kg)",modelValue:e.detail.totalWeight,"onUpdate:modelValue":o[7]||(o[7]=s=>e.detail.totalWeight=s)},null,8,["type","modelValue"])])]),l("section",ze,[l("div",null,[t(g,{type:a(_).NUMERIC,label:"Quantitat",highlightOnFocus:"",modelValue:e.detail.quantity,"onUpdate:modelValue":o[8]||(o[8]=s=>e.detail.quantity=s)},null,8,["type","modelValue"])]),l("div",null,[t(g,{type:a(_).CURRENCY,label:"Preu",modelValue:e.detail.amount,"onUpdate:modelValue":o[9]||(o[9]=s=>e.detail.amount=s)},null,8,["type","modelValue"])])]),t(m,{label:"Crear",onClick:p,style:{float:"right"},size:"small",class:"mt-2"}),t(m,{label:"Calcular",onClick:b,style:{float:"right"},size:"small",class:"mt-2 mr-2"})])):O("",!0)}}}),Ge={key:0},Ke=l("br",null,null,-1),He={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Qe=l("span",{class:"text-xl text-900 font-bold"},"Detall de l'albarà",-1),Xe={key:1},gt=A({__name:"Receipt",setup(R){const I=ue(),v=ce(),f=Ve(),h=K(),b=Z(),{receipt:n}=X(h),u=N(0),d=async()=>{var i;await h.fetchReceipt(I.params.id),b.fetchOneByName("Receipts"),f.fetchReferencesByModule("purchase"),n.value&&(n.value.date=B(n.value.date)),v.setMenuItem({icon:j.BUILDING,title:`Albarà de recepció ${(i=n.value)==null?void 0:i.number}`,backButtonVisible:!0})};Y(async()=>{await d()});const p=G(),e=me(()=>{var r;if(!b.lifecycle)return!1;const i=b.lifecycle.statuses.find(D=>D.name==="Recepcionat");return i?((r=n.value)==null?void 0:r.statusId)===i.id:!1}),o=async()=>{let i=!1,r="";n.value&&(i=await h.updateReceipt(n.value.id,n.value),r="Albarà actualizat correctament",i&&(p.add({severity:"success",summary:r,life:5e3}),fe.back()))},m=pe({visible:!1,title:"Linea",closable:!0,position:"center",modal:!0}),s=N(U.CREATE),c=N({}),E=()=>{s.value=U.CREATE,c.value={id:M(),receiptId:n.value.id,amount:0,diameter:0,height:0,kilogramPrice:0,lenght:0,quantity:1,thickness:0,totalWeight:0,unitPrice:0,unitWeight:0,width:0,disabled:!1},f.setNewReference(M()),m.title="Crear línia",m.visible=!0},S=i=>{s.value=U.EDIT,c.value=i,f.setNewReference(M()),m.title="Modificar línia",m.visible=!0},x=i=>{s.value===U.CREATE?T(i):s.value===U.EDIT&&y(i),m.visible=!1},T=async i=>{const r=await h.createReceiptDetail(i);n.value.date=B(n.value.date),r.result||q(r)},y=async i=>{const r=await h.updateReceiptDetail(i.id,i);n.value.date=B(n.value.date),r.result||q(r)},ae=async i=>{const r=await h.deleteReceiptDetail(i.id);n.value.date=B(n.value.date),r.result||q(r)},q=i=>{p.add({severity:"error",summary:i.errors[0],life:1e4,closable:!0})},le=async i=>{let r=!1,D="";r=await f.createReference(i),r?D="Referència creada correctament":D="La referència + versió introduïda ja existeix",p.add({severity:r?"success":"warn",summary:D,life:5e3}),r&&(c.value.referenceId=i.id,u.value=0,f.setNewReference(M()))};return(i,r)=>{var Q;const D=w("Button"),H=w("TabPanel"),se=w("TabView"),oe=w("Dialog");return a(n)?(C(),k("main",Ge,[t(Le,{onSubmit:o}),Ke,t(Ae,{details:(Q=a(n))==null?void 0:Q.details,onEdit:S,onDelete:ae},{header:V(()=>[l("div",He,[Qe,l("div",null,[t(D,{size:"small",icon:a(j).PLUS,rounded:"",disabled:e.value,onClick:E},null,8,["icon","disabled"])])])]),_:1},8,["details"]),t(oe,{visible:m.visible,"onUpdate:visible":r[1]||(r[1]=W=>m.visible=W),header:m.title,closable:m.closable,modal:m.modal},{default:V(()=>[t(se,{activeIndex:u.value,"onUpdate:activeIndex":r[0]||(r[0]=W=>u.value=W)},{default:V(()=>[t(H,{header:"Línea"},{default:V(()=>[t(je,{detail:c.value,onSubmit:x},null,8,["detail"])]),_:1}),t(H,{header:"Referencia"},{default:V(()=>[a(f).reference?(C(),J(ge,{key:0,module:"purchase",reference:a(f).reference,onSubmit:le},null,8,["reference"])):O("",!0)]),_:1})]),_:1},8,["activeIndex"])]),_:1},8,["visible","header","closable","modal"])])):(C(),k("main",Xe,"Carregant albarà ..."))}}});export{gt as default};
