import{d as L,o as T,h as y,m as j,w as n,a as F,Q as H,i as o,G as h,H as D,k as l,I as P,c as V,n as Y,P as x,l as A,j as G,x as Q,g as z,u as J,Z as K,r as B,K as Z,$ as W,O as E,L as X,e as p,J as ee}from"./index-77e4d88f.js";import{u as te}from"./lifecycle-7ace1220.js";import{_ as se}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-ea172d41.js";import{u as ae}from"./invoice-09426dba.js";import{u as oe}from"./customers-5603f6e7.js";import{u as ie}from"./masterData-12cde164.js";import{_ as re}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-0b462591.js";import"./index-c5381636.js";import"./form-validator-7d52d458.js";const ce=["onClick"],ne=L({__name:"TableInvoices",props:{invoices:{},customers:{}},emits:["edit","delete"],setup(N,{emit:k}){const g=N,m=te();T(async()=>{await m.fetchOneByName("SalesInvoice")});const i=e=>{var a;const s=(a=g.customers)==null?void 0:a.find(d=>d.id===e);return s?s.comercialName:""},w=e=>{var a;const s=(a=m.lifecycle)==null?void 0:a.statuses.find(d=>d.id===e);return s?s.name:""},_=e=>e.salesInvoiceDueDates?e.salesInvoiceDueDates.length===0?P(e.invoiceDate):P(e.salesInvoiceDueDates[e.salesInvoiceDueDates.length-1].dueDate):"",b=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||k("edit",e.data)},f=(e,s)=>{k("delete",s)};return(e,s)=>{const a=y("Column"),d=y("DataTable");return F(),j(d,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",value:e.invoices,paginator:"",rows:12,onRowClick:b},{header:n(()=>[H(e.$slots,"filter")]),default:n(()=>[o(a,{field:"invoiceNumber",header:"Número",sortable:!0,style:{width:"10%"}}),o(a,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"15%"}},{body:n(r=>[h(D(l(P)(r.data.invoiceDate)),1)]),_:1}),o(a,{header:"Client",style:{width:"15%"}},{body:n(r=>[h(D(i(r.data.customerId)),1)]),_:1}),o(a,{header:"Estat",style:{width:"15%"}},{body:n(r=>[h(D(w(r.data.statusId)),1)]),_:1}),o(a,{header:"Venciment",style:{width:"15%"}},{body:n(r=>[h(D(_(r.data)),1)]),_:1}),o(a,{header:"Import",style:{width:"15%"}},{body:n(r=>[h(D(r.data.netAmount)+" € ",1)]),_:1}),o(a,{style:{width:"5%"}},{body:n(r=>{var u;return[r.data.statusId===((u=l(m).lifecycle)==null?void 0:u.initialStatusId)?(F(),V("i",{key:0,class:Y([l(x).TIMES,"grid_delete_column_button"]),onClick:v=>f(v,r.data)},null,10,ce)):A("",!0)]}),_:1})]),_:3},8,["value"])}}}),le={class:"flex flex-wrap align-items-center justify-content-between gap-1"},de={class:"datatable-filter"},ue={class:"filter-field"},me={class:"filter-field"},fe=p("label",{class:"block text-900 mb-2"},"Client",-1),ve={class:"datatable-buttons"},we=L({__name:"SalesInvoices",setup(N){const k=G(),g=Q(),m=z(),i=J(),w=K(),_=ie(),b=oe(),f=ae(),e=B({customerId:void 0}),s=Z({visible:!1,title:"Crear factura",closable:!0,position:"center",modal:!0});T(async()=>{b.fetchCustomers(),await _.fetchMasterData(),r(),a(),await u(),i.setMenuItem({icon:x.MONEY_BILL,title:"Factures de venta"})}),W(()=>{const t={customerId:e.value.customerId,exercisePicker:i.exercisePicker};w.addFilter("SalesInvoices","",t)});const a=()=>{const t=w.getFilter("SalesInvoices","");t&&(e.value.customerId=t.customerId,t.exercisePicker&&(i.exercisePicker.exercise=t.exercisePicker.exercise,i.exercisePicker.dates=[new Date(t.exercisePicker.dates[0]),new Date(t.exercisePicker.dates[1])]))},d=()=>{i.cleanExercisePicker(),e.value.customerId=void 0},r=()=>{var S;const t=new Date().getFullYear().toString(),c=(S=_.exercises)==null?void 0:S.find(I=>I.name===t);c&&(i.exercisePicker.exercise=c,i.exercisePicker.dates=[new Date(i.exercisePicker.exercise.startDate),new Date(i.exercisePicker.exercise.endDate)])},u=async()=>{let t="",c="";i.exercisePicker.dates&&(t=E(i.exercisePicker.dates[0]),c=E(i.exercisePicker.dates[1])),await f.GetFiltered(t,c,void 0,void 0,e.value.customerId)},v=B({}),$=()=>({id:ee(),customerId:"",exerciseId:"",date:new Date}),q=()=>{v.value=$(),s.visible=!0},R=async()=>{await f.Create(v.value)&&m.push({path:`/sales-invoice/${v.value.id}`})},U=t=>{m.push({path:`/sales-invoice/${t.id}`})},M=t=>{g.require({message:"Està segur que vol eliminar la factura?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await f.Delete(t.id)&&(k.add({severity:"success",summary:"Eliminada",life:3e3}),await u())}})};return(t,c)=>{const S=y("Dropdown"),I=y("Button"),O=y("Dialog");return F(),V(X,null,[o(ne,{invoices:l(f).invoices,customers:l(b).customers,onEdit:U,onDelete:M},{filter:n(()=>[p("div",le,[p("div",de,[p("div",ue,[o(se,{exercises:l(_).exercises,onRangeSelected:u},null,8,["exercises"])]),p("div",me,[fe,o(S,{modelValue:e.value.customerId,"onUpdate:modelValue":c[0]||(c[0]=C=>e.value.customerId=C),editable:"",options:l(b).customers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),p("div",ve,[o(I,{class:"datatable-button mr-2",icon:l(x).FILTER,rounded:"",raised:"",onClick:u},null,8,["icon"]),o(I,{class:"datatable-button mr-2",icon:l(x).FILTER_SLASH,rounded:"",raised:"",onClick:d},null,8,["icon"]),o(I,{icon:l(x).PLUS,rounded:"",raised:"",onClick:q},null,8,["icon"])])])]),_:1},8,["invoices","customers"]),o(O,{visible:s.visible,"onUpdate:visible":c[1]||(c[1]=C=>s.visible=C),header:s.title,closable:s.closable,modal:s.modal},{default:n(()=>[o(re,{"create-request":v.value,onSubmit:R},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{we as default};
