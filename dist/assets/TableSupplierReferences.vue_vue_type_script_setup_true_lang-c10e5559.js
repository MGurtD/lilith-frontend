import{u as q}from"./suppliers-e71be660.js";import{d as T,h as S,a as o,c as _,H as V,l as t,i,w as m,a4 as G,k as d,j as A,r as E,e as f,m as y,n as $,z as R,s as B,x as H,F as g,L as O,Q,G as N,R as Y,P as F,y as J}from"./index-aa781fed.js";import{_ as K}from"./DropdownReference.vue_vue_type_script_setup_true_lang-27729c3c.js";import{c as W,a as X,d as U,F as Z}from"./form-validator-ef8c3cb9.js";import{u as x}from"./reference-4f638e26.js";const ee={class:"mb-2"},re={key:0,class:"block text-900 mb-2"},le={key:0,class:"flex align-items-center"},se=T({__name:"DropdownSupplier",props:{label:{},modelValue:{}},emits:["update:modelValue"],setup(k,{emit:v}){const n=q();return(c,I)=>{const a=S("Dropdown");return o(),_("div",ee,[c.label.length>0?(o(),_("label",re,V(c.label),1)):t("",!0),i(a,G({showClear:"",filter:"","filter-fields":["comercialName"],editable:"",options:d(n).suppliers,placeholder:"Selecciona...",optionValue:"id",optionLabel:"comercialName",class:"w-full"},c.$attrs,{"model-value":c.modelValue,onChange:I[0]||(I[0]=p=>v("update:modelValue",p.value))}),{option:m(p=>[p.option?(o(),_("div",le,V(`${p.option.comercialName}`),1)):t("",!0)]),_:1},16,["options","model-value"])])}}}),oe={key:0},ie={class:"three-columns pt-5"},ae={class:"three-columns"},te={class:"mt-2"},ne=T({__name:"FormSupplierReference",props:{referenceId:{},supplierId:{},referenceSupplier:{}},emits:["submit","cancel"],setup(k,{emit:v}){const n=k,c=A(),I=W().shape({supplierCode:X().required("El codi és obligatori"),supplierPrice:U().required("El preu és obligatori"),supplyDays:U().required("Els dies de subministrament són obligatoris")}),a=E({result:!1,errors:{}}),p=()=>{const e=new Z(I);a.value=e.validate(n.referenceSupplier)},h=async()=>{if(p(),a.value.result)v("submit",n.referenceSupplier);else{let e="";Object.entries(a.value.errors).forEach(r=>{e+=`${r[1].map(D=>D)}.   `}),c.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,r)=>{const D=S("Button");return e.referenceSupplier?(o(),_("form",oe,[f("section",ie,[e.referenceId?t("",!0):(o(),y(K,{key:0,label:"Referència",modelValue:e.referenceSupplier.referenceId,"onUpdate:modelValue":r[0]||(r[0]=s=>e.referenceSupplier.referenceId=s),fullName:!0},null,8,["modelValue"])),e.supplierId?t("",!0):(o(),y(se,{key:1,label:"Proveïdor",modelValue:e.referenceSupplier.supplierId,"onUpdate:modelValue":r[1]||(r[1]=s=>e.referenceSupplier.supplierId=s)},null,8,["modelValue"])),i(R,{label:"Codi proveïdor",id:"supplierCode",modelValue:e.referenceSupplier.supplierCode,"onUpdate:modelValue":r[2]||(r[2]=s=>e.referenceSupplier.supplierCode=s),class:$(["mb-2",{"p-invalid":a.value.errors.supplierCode}])},null,8,["modelValue","class"]),i(R,{label:"Descripció proveïdor",id:"supplierDescription",modelValue:e.referenceSupplier.supplierDescription,"onUpdate:modelValue":r[3]||(r[3]=s=>e.referenceSupplier.supplierDescription=s),class:"mb-2"},null,8,["modelValue"])]),f("section",ae,[i(R,{label:"Preu proveïdor",id:"supplierPrice",modelValue:e.referenceSupplier.supplierPrice,"onUpdate:modelValue":r[4]||(r[4]=s=>e.referenceSupplier.supplierPrice=s),type:d(B).CURRENCY,class:$(["mb-2",{"p-invalid":a.value.errors.supplierPrice}])},null,8,["modelValue","type","class"]),i(R,{label:"Dies de subministrament",id:"supplyDays",modelValue:e.referenceSupplier.supplyDays,"onUpdate:modelValue":r[5]||(r[5]=s=>e.referenceSupplier.supplyDays=s),type:d(B).NUMERIC,class:$(["mb-2",{"p-invalid":a.value.errors.supplyDays}])},null,8,["modelValue","type","class"])]),f("div",te,[i(D,{label:"Guardar",class:"mr-2",onClick:h})])])):t("",!0)}}}),pe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ue={class:"text-l text-900 font-bold"},de=["onClick"],ye=T({__name:"TableSupplierReferences",props:{title:{},formActionMode:{},referenceId:{},supplierId:{},supplierReferences:{}},emits:["create","update","delete"],setup(k,{emit:v}){const n=k,c=A(),I=H(),a=x(),p=q(),h=E(g.CREATE),e=E(void 0),r=E(!1),D=()=>{e.value={id:J(),disabled:!1,supplierId:n.supplierId?n.supplierId:"",referenceId:n.referenceId?n.referenceId:"",supplierCode:"",supplierDescription:"",supplierPrice:0,supplyDays:0},h.value=g.CREATE,r.value=!0},s=l=>{l.originalEvent.target.className.includes("grid_delete_column_button")||(e.value=l.data,h.value=g.EDIT,r.value=!0)},M=()=>{var w;const l=e.value;if(h.value===g.CREATE){var C=(w=p.supplierReferences)==null?void 0:w.find(P=>P.referenceId===l.referenceId);if(C){c.add({severity:"warn",summary:"Creació de referència",detail:"La referència ja existeix"});return}v("create",l)}else v("update",l);r.value=!1,e.value=void 0},j=(l,C)=>{I.require({target:l.currentTarget,message:"Está segur que vol eliminar la referència?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{v("delete",C)}})};return(l,C)=>{const w=S("Dialog"),P=S("Button"),b=S("Column"),L=S("DataTable");return o(),_(O,null,[i(w,{visible:r.value,"onUpdate:visible":C[0]||(C[0]=u=>r.value=u),header:l.title,closable:!0,modal:!0},{default:m(()=>[e.value?(o(),y(ne,{key:0,supplierId:l.supplierId,referenceId:l.referenceId,referenceSupplier:e.value,onSubmit:M},null,8,["supplierId","referenceId","referenceSupplier"])):t("",!0)]),_:1},8,["visible","header"]),f("div",null,[l.supplierReferences?(o(),y(L,{key:0,value:l.supplierReferences,tableStyle:"min-width: 100%",onRowClick:s},{header:m(()=>[Q(l.$slots,"header",{},()=>[f("div",pe,[f("span",ue,V(l.title),1),f("div",null,[l.formActionMode===d(g).EDIT?(o(),y(P,{key:0,icon:d(F).PLUS,rounded:"",onClick:D},null,8,["icon"])):t("",!0)])])])]),default:m(()=>[l.supplierId?(o(),y(b,{key:0,header:"Referència",field:"referenceId",style:{width:"25%"}},{body:m(u=>[N(V(d(a).getFullNameById(u.data.referenceId)),1)]),_:1})):t("",!0),l.referenceId?(o(),y(b,{key:1,header:"Proveïdor",field:"supplierId",style:{width:"25%"}},{body:m(u=>[N(V(d(p).getName(u.data.supplierId)),1)]),_:1})):t("",!0),i(b,{header:"Codi proveïdor",field:"supplierCode",style:{width:"20%"}}),i(b,{header:"Descripció",field:"supplierDescription",style:{width:"25%"}}),i(b,{header:"Preu",field:"supplierPrice",style:{width:"20%"}},{body:m(u=>[N(V(d(Y)(u.data.supplierPrice)),1)]),_:1}),i(b,{header:"Dies submin.",field:"supplyDays",style:{width:"20%"}}),i(b,null,{body:m(u=>[f("i",{class:$([d(F).TIMES,"grid_delete_column_button"]),onClick:z=>j(z,u.data)},null,10,de)]),_:1})]),_:3},8,["value"])):t("",!0)])],64)}}});export{ye as _};
