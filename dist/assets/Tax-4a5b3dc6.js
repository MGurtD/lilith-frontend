import{d as _,j as g,r as k,h as x,c as C,e as i,i as m,n as V,z as y,k as v,l as E,a as I,s as T,F as d,u as w,v as B,g as h,C as F,o as N,m as $,P as R}from"./index-abfce291.js";import{u as M}from"./tax-aa602bc0.js";import{c as U,a as q,d as A,b as D,F as z}from"./form-validator-012be6a9.js";const P={key:0},S={class:"two-columns"},j=i("label",{class:"block text-900 mb-2"},"Desactivada",-1),G={class:"mt-2"},L=_({__name:"FormTax",props:{tax:{}},emits:["submit","cancel"],setup(f,{emit:n}){const c=f,u=g(),p=U().shape({name:q().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),percentatge:A().required("La freqüència és obligatoria"),disabled:D().required("El camp deshabilitat és obligatori")}),t=k({result:!1,errors:{}}),l=()=>{const e=new z(p);t.value=e.validate(c.tax)},b=async()=>{if(l(),t.value.result)n("submit",c.tax);else{let e="";Object.entries(t.value.errors).forEach(s=>{e+=`${s[1].map(a=>a)}.   `}),u.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,s)=>{const a=x("Checkbox"),r=x("Button");return e.tax?(I(),C("form",P,[i("div",S,[m(y,{class:V(["mb-2",{"p-invalid":t.value.errors.name}]),label:"Nom",id:"name",modelValue:e.tax.name,"onUpdate:modelValue":s[0]||(s[0]=o=>e.tax.name=o)},null,8,["modelValue","class"]),m(y,{type:v(T).NUMERIC,label:"Percentatge",id:"percentatge",modelValue:e.tax.percentatge,"onUpdate:modelValue":s[1]||(s[1]=o=>e.tax.percentatge=o),class:V({"p-invalid":t.value.errors.percentatge})},null,8,["type","modelValue","class"])]),i("div",null,[i("div",null,[j,m(a,{modelValue:e.tax.disabled,"onUpdate:modelValue":s[2]||(s[2]=o=>e.tax.disabled=o),class:"w-full",binary:!0},null,8,["modelValue"])])]),i("div",G,[m(r,{label:"Guardar",onClick:b})])])):E("",!0)}}}),K=_({__name:"Tax",setup(f){const n=k(d.EDIT),c=w(),u=B(),p=h(),t=M(),{tax:l}=F(t),b=async()=>{await t.fetchOne(u.params.id);let a="";l.value?(n.value=d.EDIT,a=`Impost ${l.value.name}`):(n.value=d.CREATE,t.setNew(u.params.id),a="Alta d'impost"),c.setMenuItem({icon:R.BUILDING,backButtonVisible:!0,title:a})};N(async()=>{await b()});const e=g(),s=async()=>{const a=l.value;let r=!1,o="";n.value===d.CREATE?(r=await t.create(a),o="Impost creat correctament"):(r=await t.update(a.id,a),o="Impost actualizat correctament"),r&&(e.add({severity:"success",summary:o,life:5e3}),p.back())};return(a,r)=>v(l)?(I(),$(L,{key:0,tax:v(l),onSubmit:s},null,8,["tax"])):E("",!0)}});export{K as default};
