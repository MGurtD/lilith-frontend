import{u as H,_ as ee}from"./productionpart-ec8bd222.js";import{_ as te}from"./DropdownReference.vue_vue_type_script_setup_true_lang-83dec806.js";import{c as re,d as Q,a as j,F as oe}from"./form-validator-f8953ae6.js";import{d as q,j as z,r as B,h as _,c as R,e as o,i as t,y as F,k as p,n as O,l as C,a as V,s as A,E as G,x as ae,w as s,P as W,C as g,D,m as $,G as J,K as se,v as le,g as de,u as ne,z as ie,o as ue,p as ce,b as me,f as pe}from"./index-69c3f293.js";import{u as L}from"./lifecycle-6e6aec73.js";import{_ as fe,a as ke}from"./FormWorkorderPhase.vue_vue_type_script_setup_true_lang-b4fd5b70.js";import{g as K,d as we,f as be,c as ye}from"./functions-4d7ada1d.js";import{u as x}from"./plantmodel-1b7fccc4.js";import{u as _e}from"./reference-4ad8a4b8.js";import{u as he}from"./workorder-5a328198.js";import"./index-b0fd6b10.js";import"./base.service-330045d1.js";import"./_commonjsHelpers-725317a4.js";import"./index-ce241625.js";import"./reference.service-7103735d.js";import"./v4-a960c1f4.js";const ve={key:0},Ie=o("br",null,null,-1),ge={class:"four-columns"},Pe=o("label",{class:"block text-900 mb-2"},"Data Prevista",-1),Te={class:"four-columns"},Ve=o("label",{class:"block text-900 mb-2"},"Data Inici",-1),De=o("label",{class:"block text-900 mb-2"},"Data Fi",-1),Se=o("label",{class:"block text-900 mb-2"},"Comentari Fabricació",-1),Oe=q({__name:"FormWorkorder",props:{workorder:{}},emits:["submit","cancel"],setup(P,{emit:T}){const v=P;L();const h=z(),b=re().shape({plannedQuantity:Q().min(1,"La quantitat ha de ser superior a 0").required("La quanitat és obligatoria"),referenceId:j().required("La referència és obligatoria"),order:Q().required("L'ordre és obligatori"),plannedDate:j().required("La data prevista és obligatoria")}),l=B({result:!1,errors:{}}),y=()=>{const e=new oe(b);l.value=e.validate(v.workorder)},n=async()=>{if(y(),l.value.result)T("submit",v.workorder);else{let e="";Object.entries(l.value.errors).forEach(r=>{e+=`${r[1].map(f=>f)}.   `}),h.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,r)=>{const f=_("Button"),k=_("Calendar"),I=_("Textarea");return e.workorder?(V(),R("form",ve,[o("div",null,[t(f,{label:"Guardar",class:"grid_add_row_button",size:"small",onClick:n}),Ie]),o("section",ge,[o("div",null,[t(F,{label:"Codi",modelValue:e.workorder.code,"onUpdate:modelValue":r[0]||(r[0]=a=>e.workorder.code=a),disabled:""},null,8,["modelValue"])]),o("div",null,[t(te,{label:"Referència",modelValue:e.workorder.referenceId,"onUpdate:modelValue":r[1]||(r[1]=a=>e.workorder.referenceId=a),fullName:!0,disabled:""},null,8,["modelValue"])]),o("div",null,[t(F,{type:p(A).NUMERIC,label:"Quantitat",modelValue:e.workorder.plannedQuantity,"onUpdate:modelValue":r[2]||(r[2]=a=>e.workorder.plannedQuantity=a),class:O({"p-invalid":l.value.errors.plannedQuantity})},null,8,["type","modelValue","class"])]),o("div",null,[Pe,t(k,{modelValue:e.workorder.plannedDate,"onUpdate:modelValue":r[3]||(r[3]=a=>e.workorder.plannedDate=a),dateFormat:"dd/mm/yy",class:O(["mt-2",{"p-invalid":l.value.errors.plannedDate}])},null,8,["modelValue","class"])])]),o("section",Te,[o("div",null,[t(fe,{label:"Estat",modelValue:e.workorder.statusId,"onUpdate:modelValue":r[4]||(r[4]=a=>e.workorder.statusId=a),class:O({"p-invalid":l.value.errors.statusId})},null,8,["modelValue","class"])]),o("div",null,[Ve,t(k,{modelValue:e.workorder.startTime,"onUpdate:modelValue":r[5]||(r[5]=a=>e.workorder.startTime=a),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),o("div",null,[De,t(k,{modelValue:e.workorder.endTime,"onUpdate:modelValue":r[6]||(r[6]=a=>e.workorder.endTime=a),dateFormat:"dd/mm/yy",class:"mt-2"},null,8,["modelValue"])]),o("div",null,[t(F,{type:p(A).NUMERIC,label:"Ordre",modelValue:e.workorder.order,"onUpdate:modelValue":r[7]||(r[7]=a=>e.workorder.order=a),class:O({"p-invalid":l.value.errors.plannedorderQuantity})},null,8,["type","modelValue","class"])])]),o("div",null,[Se,t(I,{class:"w-full",modelValue:e.workorder.comment,"onUpdate:modelValue":r[8]||(r[8]=a=>e.workorder.comment=a)},null,8,["modelValue"])])])):C("",!0)}}}),Ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},$e=o("span",{class:"text-xl text-900 font-bold"},"Fases",-1),Be=["onClick"],We=q({__name:"TableWorkorderPhases",props:{workorder:{},workorderPhases:{}},emits:["add","edit","delete"],setup(P,{emit:T}){const v=P,h=G({visible:!1,title:"Nova fase",closable:!0,position:"center",modal:!0}),b=ae(),l=x(),y=L(),n=d=>{var c;if(!l.workcenterTypes)return"";const i=(c=l.workcenterTypes)==null?void 0:c.find(u=>d===u.id);return i?i.name:""},e=d=>{var c;if(!l.workcenters)return"";const i=(c=l.workcenters)==null?void 0:c.find(u=>d===u.id);return i?i.name:""},r=d=>{var c;if(!l.operatorTypes)return"";const i=(c=l.operatorTypes)==null?void 0:c.find(u=>d===u.id);return i?i.name:""},f=d=>{var c;if(!y.lifecycle||!y.lifecycle.statuses)return"";const i=(c=y.lifecycle.statuses)==null?void 0:c.find(u=>d===u.id);return i?i.name:""},k=B({}),I=()=>{k.value={id:K(),workOrderId:v.workorder.id,disabled:!1,code:((v.workorder.phases.length+1)*10).toString(),description:"",operatorTypeId:null,workcenterTypeId:null,preferredWorkcenterId:null,isExternalWork:!1,externalWorkCost:0,statusId:"",startTime:null,endTime:null,workOrderPhaseDetails:[],workOrderPhaseBillOfMaterials:[]},h.visible=!0},a=d=>{h.visible=!1,T("add",d)},N=d=>{d.originalEvent.target.className.includes("grid_delete_column_button")||T("edit",d.data)},E=(d,i)=>{b.require({target:d.currentTarget,message:"Está segur que vol eliminar la fase?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{T("delete",i)}})};return(d,i)=>{const c=_("Button"),u=_("Column"),U=_("BooleanColumn"),m=_("DataTable"),S=_("Dialog");return V(),R(J,null,[t(m,{onRowClick:N,value:d.workorderPhases,tableStyle:"min-width: 100%"},{header:s(()=>[o("div",Ce,[$e,t(c,{icon:p(W).PLUS,rounded:"",raised:"",onClick:I},null,8,["icon"])])]),default:s(()=>[t(u,{field:"code",header:"Codi",style:{width:"10%"}}),t(u,{field:"description",header:"Descripció",style:{width:"15%"}}),t(u,{header:"Tipus de màquina",style:{width:"15%"}},{body:s(w=>[g(D(n(w.data.workcenterTypeId)),1)]),_:1}),t(u,{header:"Màquina preferida",style:{width:"15%"}},{body:s(w=>[g(D(e(w.data.preferredWorkcenterId)),1)]),_:1}),t(u,{header:"Tipus d'operari",style:{width:"15%"}},{body:s(w=>[g(D(r(w.data.operatorTypeId)),1)]),_:1}),t(u,{header:"Estat",style:{width:"15%"}},{body:s(w=>[g(D(f(w.data.statusId)),1)]),_:1}),t(u,{header:"Extern",style:{width:"5%"}},{body:s(w=>[t(U,{value:w.data.isExternalWork},null,8,["value"])]),_:1}),t(u,{style:{width:"5%"}},{body:s(w=>[o("i",{class:O([p(W).TIMES,"grid_delete_column_button"]),onClick:M=>E(M,w.data)},null,10,Be)]),_:1})]),_:1},8,["value"]),t(S,{visible:h.visible,"onUpdate:visible":i[0]||(i[0]=w=>h.visible=w),header:h.title,closable:h.closable,modal:h.modal},{default:s(()=>[k.value?(V(),$(ke,{key:0,workorder:d.workorder,phase:k.value,onSubmit:a},null,8,["workorder","phase"])):C("",!0)]),_:1},8,["visible","header","closable","modal"])],64)}}}),qe=q({__name:"TableProductionParts",setup(P){const T=H(),v=x(),h=b=>{if(!b)return"";if(b.workOrderPhase&&b.workOrderPhaseDetail){const l=v.getMachineStatusNameById(b.workOrderPhaseDetail.machineStatusId);return`(${b.workOrderPhase.code}) ${b.workOrderPhase.description} - ${l}`}};return(b,l)=>{const y=_("Column"),n=_("DataTable");return V(),$(n,{value:p(T).productionParts,class:"p-datatable-sm",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"40vh"},{header:s(()=>[se(b.$slots,"header")]),empty:s(()=>[g(" No s'han trobat tiquets. ")]),loading:s(()=>[g(" Carregant tiquets. Si us plau espera. ")]),default:s(()=>[t(y,{field:"operatorId",header:"Operari",style:{width:"15%"}},{body:s(e=>[g(D(p(v).getOperatorNameById(e.data.operatorId)),1)]),_:1}),t(y,{field:"workcenterId",header:"Màquina",style:{width:"20%"}},{body:s(e=>[g(D(p(v).getWorkcenterNameById(e.data.workcenterId)),1)]),_:1}),t(y,{field:"workOrderPhaseId",header:"Fase/Estat",style:{width:"20%"}},{body:s(e=>[g(D(h(e.data)),1)]),_:1}),t(y,{field:"date",header:"Data",style:{width:"15%"}},{body:s(e=>[g(D(p(we)(e.data.date)),1)]),_:1}),t(y,{field:"quantity",header:"Quantitat",style:{width:"15%"}}),t(y,{field:"time",header:"Temps",style:{width:"15%"}})]),_:3},8,["value"])}}}),Ne=P=>(ce("data-v-7fa8b38c"),P=P(),me(),P),Ee={class:"main"},Ue={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Me=Ne(()=>o("span",{class:"text-xl text-900 font-bold"},"Hores",-1)),Fe=q({__name:"Workorder",setup(P){const T=le(),v=de(),h=ne(),b=z(),l=L(),y=_e(),n=he(),e=x(),r=H(),{workorder:f}=ie(n),k=B(""),I=G({visible:!1,title:"Crear tíquet de producció",closable:!0,position:"center",modal:!0});ue(async()=>{k.value=T.params.id,await a();let m="";m="Ordre de fabricació",f.value&&(m=`${m} ${f.value.code}`),h.setMenuItem({icon:W.BUILDING,backButtonVisible:!0,title:m})});const a=async()=>{await y.fetchReferencesByModule("sales"),await n.fetchOne(k.value),e.fetchActiveModel(),l.fetchOneByName("WorkOrder"),r.fetchByWorkOrderId(k.value),n.workorder&&(n.workorder.plannedDate=be(n.workorder.plannedDate))},N=async m=>{n.workorder&&(n.workorder.plannedDate=ye(n.workorder.plannedDate)),await n.update(k.value,m)&&await a()},E=async m=>{await n.createPhase(m)?v.push({path:`/workorder/${k.value}/phase/${m.id}`}):b.add({severity:"error",summary:"Error al crear la fase",detail:"Revisi el log per a més informació"})},d=m=>{v.push({path:`/workorder/${k.value}/phase/${m.id}`})},i=async m=>{await n.deletePhase(m.id)},c=B({}),u=()=>{c.value={id:K(),workOrderId:k.value,workOrderPhaseId:"",workOrderPhaseDetailId:"",operatorId:"",workCenterId:"",time:0,quantity:0,date:new Date},f.value&&n.fetchByWorkOrderId(f.value.id),I.visible=!0},U=async()=>{I.visible=!1,await r.create(c.value)&&r.fetchByWorkOrderId(k.value)};return(m,S)=>{const w=_("TabPanel"),M=_("Button"),X=_("TabView"),Y=_("Dialog");return V(),R(J,null,[o("header",null,[p(f)?(V(),$(Oe,{key:0,workorder:p(f),onSubmit:N},null,8,["workorder"])):C("",!0)]),o("main",Ee,[t(X,null,{default:s(()=>[t(w,{header:"Fases"},{default:s(()=>[p(f)&&p(f).phases?(V(),$(We,{key:0,workorder:p(f),workorderPhases:p(f).phases,onAdd:E,onEdit:d,onDelete:i},null,8,["workorder","workorderPhases"])):C("",!0)]),_:1}),t(w,{header:"Hores"},{default:s(()=>[p(r).productionParts?(V(),$(qe,{key:0,productionParts:p(r).productionParts},{header:s(()=>[o("div",Ue,[Me,t(M,{icon:p(W).PLUS,rounded:"",raised:"",onClick:u},null,8,["icon"])])]),_:1},8,["productionParts"])):C("",!0)]),_:1})]),_:1})]),t(Y,{visible:I.visible,"onUpdate:visible":S[0]||(S[0]=Z=>I.visible=Z),header:I.title,closable:I.closable,modal:I.modal},{default:s(()=>[t(ee,{productionPart:c.value,onSubmit:U},null,8,["productionPart"])]),_:1},8,["visible","header","closable","modal"])],64)}}});const rt=pe(Fe,[["__scopeId","data-v-7fa8b38c"]]);export{rt as default};
