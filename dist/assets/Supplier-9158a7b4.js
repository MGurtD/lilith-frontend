import{d as x,M as j,C as $,j as q,o as P,r as R,h as C,k as a,a as g,c as F,e as s,i as t,n as v,l as k,x as z,F as N,m as S,P as I,w as h,G as O,H as M,L as H,y as J,v as K,u as Q}from"./index-6eb74133.js";import{u as B}from"./suppliers-ddadd900.js";import{c as A,a as y,F as L,b as D}from"./form-validator-f3848ee5.js";import{u as W}from"./paymentMethod-4a3000bd.js";import{u as X}from"./reference-4118162e.js";import{_ as Y}from"./TableSupplierReferences.vue_vue_type_script_setup_true_lang-7145a4f1.js";import"./suppliers.service-c8170604.js";import"./DropdownReference.vue_vue_type_script_setup_true_lang-b6e78c49.js";const Z={key:0},ee={class:"three-columns"},ae={class:"three-columns mb-2"},le=s("label",{class:"block text-900 mb-2"},"País",-1),oe=s("label",{class:"block text-900 mb-2"},"Província",-1),te=s("label",{class:"block text-900 mb-2"},"Municipi",-1),se={class:"three-columns mb-2"},ne={class:"three-columns"},re=s("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),ie=s("label",{class:"block text-900 mb-2"},"Tipus Proveïdor",-1),ue=s("label",{class:"block text-900 mb-2"},"Observacions",-1),ce={class:"mt-2"},de=x({__name:"FormSupplier",emits:["submit"],setup(U,{emit:V}){const E=j(),T=B(),u=W(),{supplier:e}=$(T),f=q();P(async()=>{await u.fetchAll()});const w=A().shape({comercialName:y().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),vatNumber:y().required("El CIF és obligatori").max(15,"El CIF no pot superar els 15 carácters"),taxName:y().required("El nom fiscal és obligatori"),region:y().required("La província és obligatoria"),city:y().required("El municipi és obligatori"),postalCode:y().required("El codi postal és obligatori"),address:y().required("La direcció és obligatoria"),phone:y().required("El telèfon és obligatori"),accountNumber:y().required("El número de compte és obligatori").max(35,"El número de compte no pot superar el 35 dígits"),supplierTypeId:y().required("El tipus de proveïdor és obligatori"),paymentMethodId:y().required("La forma de pagament és obligatoria")}),n=R({result:!1,errors:{}}),r=()=>{e.value.address=""},m=()=>{const _=new L(w);n.value=_.validate(e.value)},c=async()=>{if(m(),n.value.result)V("submit",e.value);else{let _="";Object.entries(n.value.errors).forEach(o=>{_+=`${o[1].map(b=>b)}.   `}),f.add({severity:"warn",summary:"Formulari inválid",detail:_,life:5e3})}};return(_,o)=>{const b=C("BaseInput"),d=C("Dropdown"),i=C("Textarea"),p=C("Button");return a(e)?(g(),F("form",Z,[s("section",ee,[t(b,{name:"comercialName",class:v(["mb-2",{"p-invalid":n.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:a(e).comercialName,"onUpdate:modelValue":o[0]||(o[0]=l=>a(e).comercialName=l)},null,8,["modelValue","class"]),t(b,{class:v(["mb-2",{"p-invalid":n.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:a(e).taxName,"onUpdate:modelValue":o[1]||(o[1]=l=>a(e).taxName=l)},null,8,["modelValue","class"]),t(b,{label:"CIF",id:"vatNumber",modelValue:a(e).vatNumber,"onUpdate:modelValue":o[2]||(o[2]=l=>a(e).vatNumber=l),class:v({"p-invalid":n.value.errors.vatNumber})},null,8,["modelValue","class"])]),s("section",ae,[s("div",null,[le,t(d,{modelValue:a(e).country,"onUpdate:modelValue":o[3]||(o[3]=l=>a(e).country=l),editable:"",options:["Espanya"],class:v(["w-full",{"p-invalid":n.value.errors.country}])},null,8,["modelValue","class"])]),s("div",null,[oe,t(d,{modelValue:a(e).region,"onUpdate:modelValue":o[4]||(o[4]=l=>a(e).region=l),editable:"",options:a(E).regions,optionValue:"nm",optionLabel:"nm",onChange:r,class:v(["w-full",{"p-invalid":n.value.errors.region}])},null,8,["modelValue","options","class"])]),s("div",null,[te,t(d,{modelValue:a(e).city,"onUpdate:modelValue":o[5]||(o[5]=l=>a(e).city=l),editable:"",options:a(E).getTownsByRegionName(a(e).region),optionValue:"nm",optionLabel:"nm",class:v(["w-full",{"p-invalid":n.value.errors.city}])},null,8,["modelValue","options","class"])])]),s("section",se,[t(b,{label:"Codi Postal",id:"postalCode",modelValue:a(e).postalCode,"onUpdate:modelValue":o[6]||(o[6]=l=>a(e).postalCode=l),class:v({"p-invalid":n.value.errors.postalCode})},null,8,["modelValue","class"]),t(b,{label:"Direcció",id:"address",modelValue:a(e).address,"onUpdate:modelValue":o[7]||(o[7]=l=>a(e).address=l),class:v({"p-invalid":n.value.errors.address})},null,8,["modelValue","class"]),t(b,{label:"Telèfon",id:"phone",modelValue:a(e).phone,"onUpdate:modelValue":o[8]||(o[8]=l=>a(e).phone=l),class:v({"p-invalid":n.value.errors.phone})},null,8,["modelValue","class"])]),s("section",ne,[s("div",null,[re,t(d,{modelValue:a(e).paymentMethodId,"onUpdate:modelValue":o[9]||(o[9]=l=>a(e).paymentMethodId=l),editable:"",options:a(u).paymentMethods,optionValue:"id",optionLabel:"name",class:v(["w-full",{"p-invalid":n.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])]),t(b,{label:"Número de compte",id:"accountNumber",modelValue:a(e).accountNumber,"onUpdate:modelValue":o[10]||(o[10]=l=>a(e).accountNumber=l),class:v({"p-invalid":n.value.errors.accountNumber})},null,8,["modelValue","class"]),s("div",null,[ie,t(d,{modelValue:a(e).supplierTypeId,"onUpdate:modelValue":o[11]||(o[11]=l=>a(e).supplierTypeId=l),editable:"",options:a(T).supplierTypes,optionValue:"id",optionLabel:"name",class:v(["w-full",{"p-invalid":n.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),s("div",null,[ue,t(i,{modelValue:a(e).observations,"onUpdate:modelValue":o[12]||(o[12]=l=>a(e).observations=l),class:"w-full"},null,8,["modelValue"])]),s("div",ce,[t(p,{label:"Guardar",class:"mr-2",onClick:c})])])):k("",!0)}}}),me={key:0},pe={class:"three-columns"},ve={class:"three-columns"},be=s("label",{class:"block text-900 mb-2"},"Predeterminat",-1),fe=s("label",{class:"block text-900 mb-2"},"Observacions",-1),ye={class:"mt-2"},Ve=x({__name:"FormSupplierContact",props:{contact:{}},emits:["submit","cancel"],setup(U,{emit:V}){const E=U,T=q(),u=A().shape({firstName:y().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:y().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:y(),email:y().required("El correu és obligatori").email("Correu electrònic invàlid"),phone:y().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),phoneExtension:y(),observations:y(),disabled:D().required(),default:D().required()}),e=R({result:!1,errors:{}}),f=()=>{const r=new L(u);e.value=r.validate(E.contact)},w=async()=>{if(f(),e.value.result)V("submit",E.contact);else{let r="";Object.entries(e.value.errors).forEach(m=>{r+=`${m[1].map(c=>c)}.   `}),T.add({severity:"warn",summary:"Formulari inválid",detail:r,life:5e3})}},n=()=>{V("cancel")};return(r,m)=>{const c=C("BaseInput"),_=C("Checkbox"),o=C("Textarea"),b=C("Button");return r.contact?(g(),F("form",me,[s("section",pe,[t(c,{label:"Nom",id:"firstName",modelValue:r.contact.firstName,"onUpdate:modelValue":m[0]||(m[0]=d=>r.contact.firstName=d),class:v(["mb-2",{"p-invalid":e.value.errors.firstName}])},null,8,["modelValue","class"]),t(c,{label:"Cognoms",id:"lastName",modelValue:r.contact.lastName,"onUpdate:modelValue":m[1]||(m[1]=d=>r.contact.lastName=d),class:v(["mb-2",{"p-invalid":e.value.errors.lastName}])},null,8,["modelValue","class"]),t(c,{label:"Càrrec",id:"charge",modelValue:r.contact.charge,"onUpdate:modelValue":m[2]||(m[2]=d=>r.contact.charge=d),class:v(["mb-2",{"p-invalid":e.value.errors.charge}])},null,8,["modelValue","class"])]),s("section",ve,[t(c,{class:v(["mb-2",{"p-invalid":e.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:r.contact.email,"onUpdate:modelValue":m[3]||(m[3]=d=>r.contact.email=d)},null,8,["modelValue","class"]),t(c,{class:v(["mb-2",{"p-invalid":e.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:r.contact.phone,"onUpdate:modelValue":m[4]||(m[4]=d=>r.contact.phone=d)},null,8,["modelValue","class"]),s("div",null,[be,t(_,{modelValue:r.contact.default,"onUpdate:modelValue":m[5]||(m[5]=d=>r.contact.default=d),class:"w-full",binary:!0},null,8,["modelValue"])])]),s("div",null,[fe,t(o,{modelValue:r.contact.observations,"onUpdate:modelValue":m[6]||(m[6]=d=>r.contact.observations=d),class:"w-full"},null,8,["modelValue"])]),s("div",ye,[t(b,{label:"Guardar",class:"mr-2",onClick:w}),t(b,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:n})])])):k("",!0)}}}),_e={key:2},Ce=["onClick"],ge=x({__name:"TableSupplierContacts",emits:["create","update","delete"],setup(U,{emit:V}){const E=z(),T=B(),{supplier:u}=$(T),e=R(N.CREATE),f=R(void 0),w=()=>{var c;f.value={supplierId:(c=u.value)==null?void 0:c.id,id:J(),firstName:"",lastName:"",email:"",phone:"",phoneExtension:"",charge:"",disabled:!1,default:!1,observations:""},e.value=N.CREATE},n=c=>{c.originalEvent.target.className.includes("grid_delete_column_button")||(f.value=c.data,e.value=N.EDIT)},r=()=>{const c=f.value;e.value===N.CREATE?V("create",c):V("update",c),f.value=void 0},m=(c,_)=>{E.require({target:c.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{V("delete",_)}})};return(c,_)=>{var i;const o=C("Button"),b=C("Column"),d=C("DataTable");return g(),F(H,null,[f.value?k("",!0):(g(),S(o,{key:0,icon:a(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:w},null,8,["icon"])),f.value?(g(),S(Ve,{key:1,contact:f.value,onSubmit:r,onCancel:_[0]||(_[0]=()=>f.value=void 0)},null,8,["contact"])):(g(),F("div",_e,[(i=a(u))!=null&&i.contacts?(g(),S(d,{key:0,value:a(u).contacts,tableStyle:"min-width: 100%",onRowClick:n},{default:h(()=>[t(b,{header:"Nom",style:{width:"25%"}},{body:h(p=>[O(M(p.data.firstName)+" "+M(p.data.lastName),1)]),_:1}),t(b,{header:"Càrrec",field:"charge",style:{width:"25%"}}),t(b,{header:"Correu",field:"email",style:{width:"25%"}}),t(b,{header:"Telèfon",field:"phone",style:{width:"25%"}}),t(b,null,{body:h(p=>[s("i",{class:v([a(I).TIMES,"grid_delete_column_button"]),onClick:l=>m(l,p.data)},null,10,Ce)]),_:1})]),_:1},8,["value"])):k("",!0)]))],64)}}}),he=s("span",null,"Proveïdor",-1),Ne=s("span",null,"Referencies",-1),Ee=s("span",null,"Contactes",-1),xe=x({__name:"Supplier",setup(U){const V=R(N.EDIT),E=K(),T=Q(),u=B(),e=X(),{supplier:f}=$(u),w=async()=>{const i=E.params.id;await u.fetchSupplier(i),u.fetchSupplierTypes(),u.fetchSupplierReferences(i),e.fetchReferencesByModule("purchase");let p="";f.value?(V.value=N.EDIT,p=`Proveïdor ${f.value.comercialName}`):(V.value=N.CREATE,u.setNewSupplier(i),p="Alta de proveïdor"),T.setMenuItem({icon:I.BUILDING,title:p,backButtonVisible:!0})};P(async()=>{await w()});const n=q(),r=async()=>{const i=f.value;let p=!1,l="";V.value===N.CREATE?(p=await u.createSupplier(i),l="Proveïdor creat correctament"):(p=await u.updateSupplier(i.id,i),l="Proveïdor actualizat correctament"),p&&(n.add({severity:"success",summary:l,life:5e3}),await w())},m=async i=>{await u.addContactToSupplier(i)&&n.add({severity:"success",summary:"Contacte afegit",life:5e3})},c=async i=>{await u.updateContactFromSupplier(i)&&n.add({severity:"success",summary:"Contacte actualizat",life:5e3})},_=async i=>{await u.removeContactFromSupplier(i)&&n.add({severity:"success",summary:"Contacte eliminat",life:5e3})},o=async i=>{await u.addReferenceToSupplier(i)&&n.add({severity:"success",summary:"Referència afegida",life:5e3})},b=async i=>{await u.updateReferenceFromSupplier(i)&&n.add({severity:"success",summary:"Referència actualizada",life:5e3})},d=async i=>{await u.removeReferenceFromSupplier(i)&&n.add({severity:"success",summary:"Referència eliminada",life:5e3})};return(i,p)=>{const l=C("TabPanel"),G=C("TabView");return g(),S(G,null,{default:h(()=>[t(l,null,{header:h(()=>[s("i",{class:v([a(I).BUILDING,"mr-2"])},null,2),he]),default:h(()=>[t(de,{onSubmit:r})]),_:1}),V.value===a(N).EDIT?(g(),S(l,{key:0},{header:h(()=>[s("i",{class:v([a(I).TAG,"mr-2"])},null,2),Ne]),default:h(()=>[a(f)&&a(u).supplierReferences?(g(),S(Y,{key:0,title:"Referències",formActionMode:V.value,"supplier-id":a(f).id,"supplier-references":a(u).supplierReferences,onCreate:o,onUpdate:b,onDelete:d},null,8,["formActionMode","supplier-id","supplier-references"])):k("",!0)]),_:1})):k("",!0),V.value===a(N).EDIT?(g(),S(l,{key:1},{header:h(()=>[s("i",{class:v([a(I).USERS,"mr-2"])},null,2),Ee]),default:h(()=>[t(ge,{onCreate:m,onUpdate:c,onDelete:_})]),_:1})):k("",!0)]),_:1})}}});export{xe as default};
