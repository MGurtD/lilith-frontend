import{d as B,E as F,k as S,r as U,h as v,l as t,a as _,c as A,e as l,i as o,n as m,t as x,L as H,m as $,O as J,D as R,z as G,F as N,q as T,P as I,w,N as j,C as z,I as K,x as Q,u as X,o as Y}from"./index-f6af8c81.js";import{u as L}from"./customers-bf96fe43.js";import{c as P,a as y,F as O,b as D}from"./form-validator-ec7c2535.js";import{u as W}from"./masterData-85d8bfb5.js";const Z={key:0},ee={class:"three-columns"},ae=l("label",{class:"block text-900 mb-2"},"Tipus Client",-1),se={class:"three-columns mb-2"},oe={class:"block text-900 mb-2"},le={class:"three-columns mb-2"},te=l("label",{class:"block text-900 mb-2"},"Forma de pagament",-1),ne=l("label",{class:"block text-900 mb-2"},"Observacions",-1),re=l("label",{class:"block text-900 mb-2"},"Notes de factura",-1),ie={class:"mt-2"},de=B({__name:"FormCustomer",emits:["submit"],setup(q,{emit:b}){const V=L(),E=W(),{customer:n}=F(V),i=S(),r=P().shape({comercialName:y().required("El nom comercial és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),taxName:y().required("El nom fiscal és obligatori"),vatNumber:y().required("El CIF és obligatori"),accountNumber:y().required("El número de compte es obligatori")}),p=U({result:!1,errors:{}}),C=()=>{const s=new O(r);p.value=s.validate(n.value)},u=async()=>{if(C(),p.value.result)b("submit",n.value);else{let s="";Object.entries(p.value.errors).forEach(e=>{s+=`${e[1].map(c=>c)}.   `}),i.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,e)=>{const c=v("BaseInput"),g=v("Dropdown"),d=v("Textarea"),k=v("Button");return t(n)?(_(),A("form",Z,[l("section",ee,[o(c,{name:"comercialName",class:m(["mb-2",{"p-invalid":p.value.errors.comercialName}]),label:"Nom Comercial",id:"comercialName",modelValue:t(n).comercialName,"onUpdate:modelValue":e[0]||(e[0]=a=>t(n).comercialName=a)},null,8,["modelValue","class"]),o(c,{class:m(["mb-2",{"p-invalid":p.value.errors.taxName}]),label:"Nom Fiscal",id:"taxName",modelValue:t(n).taxName,"onUpdate:modelValue":e[1]||(e[1]=a=>t(n).taxName=a)},null,8,["modelValue","class"]),l("div",null,[ae,o(g,{modelValue:t(n).customerTypeId,"onUpdate:modelValue":e[2]||(e[2]=a=>t(n).customerTypeId=a),editable:"",options:t(V).customerTypes,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.supplierTypeId}])},null,8,["modelValue","options","class"])])]),l("section",se,[o(c,{name:"vatNumber",class:m(["mb-2",{"p-invalid":p.value.errors.vatNumber}]),label:"CIF",id:"vatNumber",modelValue:t(n).vatNumber,"onUpdate:modelValue":e[3]||(e[3]=a=>t(n).vatNumber=a)},null,8,["modelValue","class"]),o(c,{name:"web",class:m(["mb-2",{"p-invalid":p.value.errors.web}]),label:"Web",id:"web",modelValue:t(n).web,"onUpdate:modelValue":e[4]||(e[4]=a=>t(n).web=a)},null,8,["modelValue","class"]),l("div",null,[l("label",oe,x(s.$t("forms.user.languageLabel")),1),o(H,{modelValue:t(n).preferredLanguage,"onUpdate:modelValue":e[5]||(e[5]=a=>t(n).preferredLanguage=a),changeAppLanguage:!1},null,8,["modelValue"])])]),l("section",le,[o(c,{name:"accountNumber",class:m(["mb-2",{"p-invalid":p.value.errors.accountNumber}]),label:"Número de compte",id:"accountNumber",modelValue:t(n).accountNumber,"onUpdate:modelValue":e[6]||(e[6]=a=>t(n).accountNumber=a)},null,8,["modelValue","class"]),l("div",null,[te,o(g,{modelValue:t(n).paymentMethodId,"onUpdate:modelValue":e[7]||(e[7]=a=>t(n).paymentMethodId=a),editable:"",options:t(E).paymentMethods,optionValue:"id",optionLabel:"name",class:m(["w-full",{"p-invalid":p.value.errors.paymentMethodId}])},null,8,["modelValue","options","class"])])]),l("div",null,[ne,o(d,{modelValue:t(n).observations,"onUpdate:modelValue":e[8]||(e[8]=a=>t(n).observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",null,[re,o(d,{modelValue:t(n).invoiceNotes,"onUpdate:modelValue":e[9]||(e[9]=a=>t(n).invoiceNotes=a),class:"w-full"},null,8,["modelValue"])]),l("div",ie,[o(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),ue={key:0},ce={class:"three-columns"},me=l("label",{class:"block text-900 mb-2"},"Principal",-1),pe=l("label",{class:"block text-900 mb-2"},"Desactivada",-1),be={class:"three-columns mb-2"},ve=l("label",{class:"block text-900 mb-2"},"País",-1),fe=l("label",{class:"block text-900 mb-2"},"Província",-1),Ce=l("label",{class:"block text-900 mb-2"},"Municipi",-1),Ve={class:"three-columns mb-2"},ye=l("label",{class:"block text-900 mb-2"},"Observacions",-1),_e={class:"mt-2"},ge=B({__name:"FormCustomerAddress",props:{address:{}},emits:["submit","cancel"],setup(q,{emit:b}){const V=q,E=J(),n=S(),i=P().shape({name:y().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),country:y().required("El país és obligatori"),region:y().required("La província és obligatoria"),city:y().required("El municipi és obligatori"),postalCode:y().required("El codi postal és obligatori"),address:y().required("La direcció és obligatoria"),main:D().required(),disabled:D().required()}),r=U({result:!1,errors:{}}),p=()=>{const s=V.address;s.address=""},C=()=>{const s=new O(i);r.value=s.validate(V.address)},u=async()=>{if(C(),r.value.result)b("submit",V.address);else{let s="";Object.entries(r.value.errors).forEach(e=>{s+=`${e[1].map(c=>c)}.   `}),n.add({severity:"warn",summary:"Formulari inválid",detail:s,life:5e3})}};return(s,e)=>{const c=v("Checkbox"),g=v("Dropdown"),d=v("Textarea"),k=v("Button");return s.address?(_(),A("form",ue,[l("section",ce,[o(R,{id:"name",class:m(["mb-2",{"p-invalid":r.value.errors.name}]),label:"Nom",modelValue:s.address.name,"onUpdate:modelValue":e[0]||(e[0]=a=>s.address.name=a)},null,8,["modelValue","class"]),l("div",null,[me,o(c,{modelValue:s.address.main,"onUpdate:modelValue":e[1]||(e[1]=a=>s.address.main=a),class:"w-full",binary:!0},null,8,["modelValue"])]),l("div",null,[pe,o(c,{modelValue:s.address.disabled,"onUpdate:modelValue":e[2]||(e[2]=a=>s.address.disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("section",be,[l("div",null,[ve,o(g,{modelValue:s.address.country,"onUpdate:modelValue":e[3]||(e[3]=a=>s.address.country=a),editable:"",options:["Espanya"],class:m(["w-full",{"p-invalid":r.value.errors.country}])},null,8,["modelValue","class"])]),l("div",null,[fe,o(g,{modelValue:s.address.region,"onUpdate:modelValue":e[4]||(e[4]=a=>s.address.region=a),editable:"",options:t(E).regions,optionValue:"nm",optionLabel:"nm",onChange:p,class:m(["w-full",{"p-invalid":r.value.errors.region}])},null,8,["modelValue","options","class"])]),l("div",null,[Ce,o(g,{modelValue:s.address.city,"onUpdate:modelValue":e[5]||(e[5]=a=>s.address.city=a),editable:"",options:t(E).getTownsByRegionName(s.address.region),optionValue:"nm",optionLabel:"nm",class:m(["w-full",{"p-invalid":r.value.errors.city}])},null,8,["modelValue","options","class"])])]),l("section",Ve,[o(R,{label:"Codi Postal",id:"postalCode",modelValue:s.address.postalCode,"onUpdate:modelValue":e[6]||(e[6]=a=>s.address.postalCode=a),class:m({"p-invalid":r.value.errors.postalCode})},null,8,["modelValue","class"]),o(R,{label:"Direcció",id:"address",modelValue:s.address.address,"onUpdate:modelValue":e[7]||(e[7]=a=>s.address.address=a),class:m({"p-invalid":r.value.errors.address})},null,8,["modelValue","class"])]),l("div",null,[ye,o(d,{modelValue:s.address.observations,"onUpdate:modelValue":e[8]||(e[8]=a=>s.address.observations=a),class:"w-full"},null,8,["modelValue"])]),l("div",_e,[o(k,{label:"Guardar",class:"mr-2",onClick:u})])])):$("",!0)}}}),Ne={key:2},he=["onClick"],we=B({__name:"TableCustomerAddresses",emits:["create","update","delete"],setup(q,{emit:b}){const V=G(),E=L(),{customer:n}=F(E),i=U(N.CREATE),r=U(void 0),p=()=>{var e;r.value={customerId:(e=n.value)==null?void 0:e.id,id:z(),name:"",country:"",region:"",city:"",postalCode:"",address:"",main:!1,disabled:!1,observations:""},i.value=N.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(r.value=e.data,i.value=N.EDIT)},u=()=>{const e=r.value;i.value===N.CREATE?b("create",e):b("update",e),r.value=void 0},s=(e,c)=>{V.require({target:e.currentTarget,message:"Está segur que vol eliminar l'adreça?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var f;const g=v("Button"),d=v("Column"),k=v("BooleanColumn"),a=v("DataTable");return _(),A(j,null,[r.value?$("",!0):(_(),T(g,{key:0,icon:t(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),r.value?(_(),T(ge,{key:1,address:r.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>r.value=void 0)},null,8,["address"])):(_(),A("div",Ne,[(f=t(n))!=null&&f.address?(_(),T(a,{key:0,value:t(n).address,tableStyle:"min-width: 100%",onRowClick:C},{default:w(()=>[o(d,{header:"Nom",field:"name",style:{width:"25%"}}),o(d,{header:"Província",field:"region",style:{width:"25%"}}),o(d,{header:"Municipi",field:"city",style:{width:"25%"}}),o(d,{header:"Codi Postal",field:"postalCode",style:{width:"25%"}}),o(d,{header:"Principal"},{body:w(h=>[o(k,{value:h.data.main,"show-color":!1},null,8,["value"])]),_:1}),o(d,null,{body:w(h=>[l("i",{class:m([t(I).TIMES,"grid_delete_column_button"]),onClick:M=>s(M,h.data)},null,10,he)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),Ee={key:0},ke={class:"three-columns"},Te={class:"four-columns"},$e=l("label",{class:"block text-900 mb-2"},"Predeterminat",-1),Ie={class:"mt-2"},Ue=B({__name:"FormCustomerContact",props:{contact:{}},emits:["submit","cancel"],setup(q,{emit:b}){const V=q,E=S(),n=P().shape({firstName:y().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),lastName:y().required("Els cognoms són obligatoris").max(250,"Els cognoms no poden superar els 250 carácters"),charge:y(),email:y().required("El correu és obligatori").email("Correu electrònic invàlid"),phoneNumber:y().required("El telèfon és obligatori").max(15,"Ha superat la longitud màxima del telèfon"),extension:y().required("L'extensió del telèfon és obligatoria"),disabled:D().required(),main:D().required()}),i=U({result:!1,errors:{}}),r=()=>{const u=new O(n);i.value=u.validate(V.contact)},p=async()=>{if(r(),i.value.result)b("submit",V.contact);else{let u="";Object.entries(i.value.errors).forEach(s=>{u+=`${s[1].map(e=>e)}.   `}),E.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}},C=()=>{b("cancel")};return(u,s)=>{const e=v("BaseInput"),c=v("Checkbox"),g=v("Button");return u.contact?(_(),A("form",Ee,[l("section",ke,[o(e,{label:"Nom",id:"firstName",modelValue:u.contact.firstName,"onUpdate:modelValue":s[0]||(s[0]=d=>u.contact.firstName=d),class:m(["mb-2",{"p-invalid":i.value.errors.firstName}])},null,8,["modelValue","class"]),o(e,{label:"Cognoms",id:"lastName",modelValue:u.contact.lastName,"onUpdate:modelValue":s[1]||(s[1]=d=>u.contact.lastName=d),class:m(["mb-2",{"p-invalid":i.value.errors.lastName}])},null,8,["modelValue","class"]),o(e,{label:"Càrrec",id:"charge",modelValue:u.contact.charge,"onUpdate:modelValue":s[2]||(s[2]=d=>u.contact.charge=d),class:m(["mb-2",{"p-invalid":i.value.errors.charge}])},null,8,["modelValue","class"])]),l("section",Te,[o(e,{class:m(["mb-2",{"p-invalid":i.value.errors.email}]),label:"Correu electrònic",id:"email",modelValue:u.contact.email,"onUpdate:modelValue":s[3]||(s[3]=d=>u.contact.email=d)},null,8,["modelValue","class"]),o(e,{class:m(["mb-2",{"p-invalid":i.value.errors.extension}]),label:"Extensió",id:"extension",modelValue:u.contact.extension,"onUpdate:modelValue":s[4]||(s[4]=d=>u.contact.extension=d)},null,8,["modelValue","class"]),o(e,{class:m(["mb-2",{"p-invalid":i.value.errors.phone}]),label:"Telèfon",id:"phone",modelValue:u.contact.phoneNumber,"onUpdate:modelValue":s[5]||(s[5]=d=>u.contact.phoneNumber=d)},null,8,["modelValue","class"]),l("div",null,[$e,o(c,{modelValue:u.contact.main,"onUpdate:modelValue":s[6]||(s[6]=d=>u.contact.main=d),class:"w-full",binary:!0},null,8,["modelValue"])])]),l("div",Ie,[o(g,{label:"Guardar",class:"mr-2",onClick:p}),o(g,{label:"Cancelar",severity:"secondary",class:"mr-2",onClick:C})])])):$("",!0)}}}),qe={key:2},Ae=["onClick"],Be=B({__name:"TableCustomerContacts",emits:["create","update","delete"],setup(q,{emit:b}){const V=G(),E=L(),{customer:n}=F(E),i=U(N.CREATE),r=U(void 0),p=()=>{var e;r.value={customerId:(e=n.value)==null?void 0:e.id,id:z(),charge:"",email:"",firstName:"",lastName:"",disabled:!1,main:!1,phoneNumber:""},i.value=N.CREATE},C=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||(r.value=e.data,i.value=N.EDIT)},u=()=>{const e=r.value;i.value===N.CREATE?b("create",e):b("update",e),r.value=void 0},s=(e,c)=>{V.require({target:e.currentTarget,message:"Está segur que vol eliminar el contacte?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:()=>{b("delete",c)}})};return(e,c)=>{var a;const g=v("Button"),d=v("Column"),k=v("DataTable");return _(),A(j,null,[r.value?$("",!0):(_(),T(g,{key:0,icon:t(I).PLUS,class:"grid_add_row_button",rounded:"",onClick:p},null,8,["icon"])),r.value?(_(),T(Ue,{key:1,contact:r.value,onSubmit:u,onCancel:c[0]||(c[0]=()=>r.value=void 0)},null,8,["contact"])):(_(),A("div",qe,[(a=t(n))!=null&&a.contacts?(_(),T(k,{key:0,value:t(n).contacts,tableStyle:"min-width: 100%",onRowClick:C},{default:w(()=>[o(d,{header:"Nom",style:{width:"25%"}},{body:w(f=>[K(x(f.data.firstName)+" "+x(f.data.lastName),1)]),_:1}),o(d,{header:"Càrrec",field:"charge",style:{width:"25%"}}),o(d,{header:"Correu",field:"email",style:{width:"25%"}}),o(d,{header:"Ext.",field:"extension",style:{width:"5%"}}),o(d,{header:"Telèfon",field:"phoneNumber",style:{width:"20%"}}),o(d,null,{body:w(f=>[l("i",{class:m([t(I).TIMES,"grid_delete_column_button"]),onClick:h=>s(h,f.data)},null,10,Ae)]),_:1})]),_:1},8,["value"])):$("",!0)]))],64)}}}),De=l("span",null,"Client",-1),Fe=l("span",null,"Contactes",-1),Se=l("span",null,"Adreces",-1),Pe=B({__name:"Customer",setup(q){const b=U(N.EDIT),V=Q(),E=X(),n=W(),i=L(),{customer:r}=F(i),p=async()=>{await i.fetchCustomer(V.params.id),i.fetchCustomerTypes(),n.fetchMasterData();let a="";r.value?(b.value=N.EDIT,a=`Client ${r.value.comercialName}`):(b.value=N.CREATE,i.setNewCustomer(V.params.id),a="Alta de client"),E.setMenuItem({icon:I.BUILDING,title:a,backButtonVisible:!0})};Y(async()=>{await p()});const C=S(),u=async()=>{const a=r.value;let f=!1,h="";b.value===N.CREATE?(f=await i.createCustomer(a),h="Client creat correctament"):(f=await i.updateCustomer(a.id,a),h="Client actualizat correctament"),f&&(C.add({severity:"success",summary:h,life:5e3}),await p())},s=async a=>{await i.addContactToCustomer(a)&&C.add({severity:"success",summary:"Contacte afegit",life:5e3})},e=async a=>{await i.updateContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte actualizat",life:5e3})},c=async a=>{await i.removeContactFromCustomer(a)&&C.add({severity:"success",summary:"Contacte eliminat",life:5e3})},g=async a=>{await i.addAddressToCustomer(a)&&C.add({severity:"success",summary:"Adreça afegida",life:5e3})},d=async a=>{await i.updateAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça actualizada",life:5e3})},k=async a=>{await i.removeAddressFromCustomer(a)&&C.add({severity:"success",summary:"Adreça eliminada",life:5e3})};return(a,f)=>{const h=v("TabPanel"),M=v("TabView");return _(),T(M,null,{default:w(()=>[o(h,null,{header:w(()=>[l("i",{class:m([t(I).WALLET,"mr-2"])},null,2),De]),default:w(()=>[o(de,{onSubmit:u})]),_:1}),b.value===t(N).EDIT?(_(),T(h,{key:0},{header:w(()=>[l("i",{class:m([t(I).USERS,"mr-2"])},null,2),Fe]),default:w(()=>[o(Be,{onCreate:s,onUpdate:e,onDelete:c})]),_:1})):$("",!0),b.value===t(N).EDIT?(_(),T(h,{key:1},{header:w(()=>[l("i",{class:m([t(I).ENVELOPE,"mr-2"])},null,2),Se]),default:w(()=>[o(we,{onCreate:g,onUpdate:d,onDelete:k})]),_:1})):$("",!0)]),_:1})}}});export{Pe as default};
