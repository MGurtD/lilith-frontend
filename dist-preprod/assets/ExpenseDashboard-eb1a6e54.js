import{_ as M}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-ee3a833e.js";import{d as O,h as m,a as g,m as E,w as u,i as o,e as t,H as S,k as p,I as G,u as U,r as c,o as j,P as b,T as W,c as z,n as w,G as K,L as Q,O as I,ad as Y,p as Z,b as q,ae as A,l as B,f as J}from"./index-feaddf7a.js";import{u as X}from"./masterData-4a7f43d3.js";import{E as L}from"./index-993788c8.js";import"./suppliers.service-4bc8fb02.js";const ee=O({__name:"TableConsolidatedExpenses",props:{expenses:{}},setup(h){const _=h;return(x,D)=>{const a=m("Column"),C=m("DataTable");return g(),E(C,{value:_.expenses,tableStyle:"min-width: 100%"},{default:u(()=>[o(a,{field:"type",header:"Tipus de despesa",style:{width:"10%"}}),o(a,{field:"typeDetail",header:"Detall",style:{width:"15%"}}),o(a,{field:"paymentDate",header:"Data pagament",sortable:"",style:{width:"10%"}},{body:u(n=>[t("span",null,S(p(G)(n.data.paymentDate)),1)]),_:1}),o(a,{field:"amount",header:"Import",style:{width:"10%"}},{body:u(n=>[t("span",null,S(n.data.amount)+" €",1)]),_:1}),o(a,{field:"description",header:"Descripció",style:{width:"30%"}})]),_:1},8,["value"])}}}),y=h=>(Z("data-v-7078b6f8"),h=h(),q(),h),te={class:"dashboard-filter"},ae={class:"dashboard-filter-field"},se={class:"dashboard-filter-field"},oe=y(()=>t("label",null,"Tipus",-1)),le={class:"dashboard-filter-field"},ne=y(()=>t("label",null,"Detall",-1)),re={class:"dashboard-filter-field"},de={class:"block text-900"},ie=y(()=>t("span",null,"Gràfics",-1)),ce={class:"dashboard-container"},pe={class:"dashboard-item"},ue=y(()=>t("header",{class:"dashboard-item-header"}," Agrupat despeses mensual ",-1)),_e={class:"dashboard-item-chart"},he={class:"dashboard-item"},me=y(()=>t("header",{class:"dashboard-item-header"}," Gràfic de despeses per tipologia ",-1)),ye={class:"dashboard-item-chart"},ve=y(()=>t("span",null,"Llistat",-1)),be=O({__name:"ExpenseDashboard",setup(h){const _=U(),x=X(),D=c(0),a=c({dates:void 0,type:"",typeDetail:""}),C=c(void 0),n=c([]),R=()=>{_.cleanExercisePicker(),a.value.type="",a.value.typeDetail=""};j(async()=>{_.setMenuItem({icon:b.MONEY_BILL,title:"Dashboard despeses"}),await x.fetchMasterData(),C.value=await L.ExpenseType.getAll()});const f=c(void 0),F=c({plugins:{legend:{labels:{usePointStyle:!0}}}}),T=c(void 0),N=c({scales:{y:{beginAtZero:!0}}}),$=W(()=>{let d=0;return n.value.length>0&&n.value.forEach(e=>d+=e.amount),d}),V=async d=>{if(_.exercisePicker.dates){const e=I(_.exercisePicker.dates[0]),s=I(_.exercisePicker.dates[1]);d&&(a.value.typeDetail="");const l=await L.Expense.getConsolidated(e,s,a.value.type,a.value.typeDetail);l&&(n.value=l),T.value=k(n.value,"monthPaymentKey"),f.value=k(n.value,"typeDetail")}},k=(d,e)=>{const s={},l=Y.groupBy(d,e);s.labels=Object.keys(l);const i=H(s.labels.length);return s.datasets=[{label:"Despeses",data:[],backgroundColor:i,borderColor:i,borderWidth:1}],Object.keys(l).forEach(P=>{let v=0;l[P].forEach(r=>{v+=r.amount}),s.datasets[0].data.push(v)}),s},H=d=>{const e=getComputedStyle(document.body),s=[e.getPropertyValue("--blue-400"),e.getPropertyValue("--green-400"),e.getPropertyValue("--yellow-400"),e.getPropertyValue("--cyan-400"),e.getPropertyValue("--pink-400"),e.getPropertyValue("--indigo-400"),e.getPropertyValue("--orange-400"),e.getPropertyValue("--purple-400"),e.getPropertyValue("--red-400")],l=[];for(;l.length<d;)for(let i=0;i<s.length;i++)l.push(s[i]);return l};return(d,e)=>{var v;const s=m("Dropdown"),l=m("Button"),i=m("TabPanel"),P=m("TabView");return g(),z(Q,null,[t("div",te,[t("div",ae,[o(M,{exercises:p(x).exercises,onRangeSelected:e[0]||(e[0]=r=>V(!1))},null,8,["exercises"])]),t("div",se,[oe,o(s,{options:["Despesa","Compra"],modelValue:a.value.type,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.type=r),onChange:e[2]||(e[2]=r=>V(!0))},null,8,["modelValue"])]),t("div",le,[ne,o(s,{options:(v=f.value)==null?void 0:v.labels,modelValue:a.value.typeDetail,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.typeDetail=r),onChange:e[4]||(e[4]=r=>V(!1))},null,8,["options","modelValue"])]),t("div",re,[t("label",de,[t("i",{class:w(p(b).WALLET)},null,2),K("   Total despesa "),t("b",null,S($.value.toFixed(2))+" € ",1)])]),o(l,{class:"grid_add_row_button",icon:p(b).FILTER_SLASH,onClick:R},null,8,["icon"])]),o(P,{activeIndex:D.value,"onUpdate:activeIndex":e[5]||(e[5]=r=>D.value=r)},{default:u(()=>[o(i,null,{header:u(()=>[t("i",{class:w([p(b).CHART_BAR,"mr-2"])},null,2),ie]),default:u(()=>[t("div",ce,[t("section",pe,[ue,t("div",_e,[T.value?(g(),E(p(A),{key:0,type:"bar",data:T.value,options:N.value},null,8,["data","options"])):B("",!0)])]),t("section",he,[me,t("div",ye,[f.value?(g(),E(p(A),{key:0,type:"pie",data:f.value,options:F.value},null,8,["data","options"])):B("",!0)])])])]),_:1}),o(i,null,{header:u(()=>[t("i",{class:w([p(b).LIST,"mr-2"])},null,2),ve]),default:u(()=>[o(ee,{scrollable:"",scrollHeight:"80vh",expenses:n.value},null,8,["expenses"])]),_:1})]),_:1},8,["activeIndex"])],64)}}});const Te=J(be,[["__scopeId","data-v-7078b6f8"]]);export{Te as default};
