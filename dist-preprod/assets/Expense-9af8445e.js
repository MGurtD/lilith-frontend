import{d as g,o as C,E as I,r as E,k as h,h as p,l as a,c as S,e as s,i as d,n as b,D as w,m as B,a as U,v as q,G as T,F as _,x as M,u as N,q as $,P,Z as z}from"./index-f6af8c81.js";import{u as F}from"./expense-bbc87d5c.js";import{c as G,a as x,F as O}from"./form-validator-ec7c2535.js";import"./index-d3847f4f.js";import"./suppliers.service-f3c59018.js";const j={key:0},J={class:"four-columns"},W={class:"mt-2"},Y=s("label",{class:"block text-900 mb-2"},"Tipus",-1),Z={class:"mt-2"},H=s("label",{class:"block text-900 mb-2"},"Data Alta",-1),K={class:"mt-2"},Q=s("label",{class:"block text-900 mb-2"},"Data Pagament",-1),X={class:"mt-2"},ee={class:"four-columns"},ae={class:"mt-2"},te=s("label",{class:"block text-900 mb-2"},"Recurrent",-1),se={class:"mt-2"},oe=s("label",{class:"block text-900 mb-2"},"Freqüència",-1),le={class:"mt-2"},ne={class:"mt-2"},ie=s("label",{class:"block text-900 mb-2"},"Data fi",-1),re=s("label",{class:"block text-900 mb-2"},"Descripció",-1),de={class:"mt-2"},ue=g({__name:"FormExpense",props:{expense:{}},emits:["submit","cancel"],setup(k,{emit:m}){const n=k;C(()=>{});const v=F(),{expense:e}=I(v),l=E([{id:1,name:"Mensual"},{id:2,name:"Bimensual"},{id:3,name:"Trimestral"},{id:6,name:"Semestral"},{id:12,name:"Anual"}]),y=G().shape({expenseTypeId:x().required("El tipus de despesa es obligatoria"),creationDate:x().required("La data de creació es obligatoria"),paymentDate:x().required("La data de pagament es obligatoria"),amount:x().required("L'import es obligatori")}),i=E({result:!1,errors:{}}),V=()=>{const u=new O(y);i.value=u.validate(n.expense)},r=h(),c=async()=>{if(V(),i.value.result)n.expense.creationDate=T(n.expense.creationDate),n.expense.endDate=T(n.expense.endDate),n.expense.paymentDate=T(n.expense.paymentDate),m("submit",e.value);else{let u="";Object.entries(i.value.errors).forEach(t=>{u+=`${t[1].map(D=>D)}.   `}),r.add({severity:"warn",summary:"Formulari inválid",detail:u,life:5e3})}};return(u,t)=>{const D=p("Dropdown"),f=p("Calendar"),A=p("Checkbox"),L=p("Textarea"),R=p("Button");return a(e)?(U(),S("form",j,[s("section",J,[s("div",W,[Y,d(D,{modelValue:a(e).expenseTypeId,"onUpdate:modelValue":t[0]||(t[0]=o=>a(e).expenseTypeId=o),editable:"",options:a(v).expenseTypes,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":i.value.errors.expenseTypeId}])},null,8,["modelValue","options","class"])]),s("div",Z,[H,d(f,{id:"creationDate",modelValue:a(e).creationDate,"onUpdate:modelValue":t[1]||(t[1]=o=>a(e).creationDate=o),class:b({"p-invalid":i.value.errors.creationDate})},null,8,["modelValue","class"])]),s("div",K,[Q,d(f,{id:"paymentDate",modelValue:a(e).paymentDate,"onUpdate:modelValue":t[2]||(t[2]=o=>a(e).paymentDate=o),class:b({"p-invalid":i.value.errors.paymentDate})},null,8,["modelValue","class"])]),s("div",X,[d(w,{label:"Import",id:"amount",modelValue:a(e).amount,"onUpdate:modelValue":t[3]||(t[3]=o=>a(e).amount=o),type:a(q).CURRENCY,class:b({"p-invalid":i.value.errors.amount})},null,8,["modelValue","type","class"])])]),s("section",ee,[s("div",ae,[te,d(A,{modelValue:a(e).recurring,"onUpdate:modelValue":t[4]||(t[4]=o=>a(e).recurring=o),class:"w-full",binary:!0},null,8,["modelValue"])]),s("div",se,[oe,d(D,{modelValue:a(e).frecuency,"onUpdate:modelValue":t[5]||(t[5]=o=>a(e).frecuency=o),disabled:!a(e).recurring,editable:"",options:l.value,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":i.value.errors.expenseTypeId}])},null,8,["modelValue","disabled","options","class"])]),s("div",le,[d(w,{label:"Dia de pagament",id:"paymentDay",modelValue:a(e).paymentDay,"onUpdate:modelValue":t[6]||(t[6]=o=>a(e).paymentDay=o),disabled:!a(e).recurring},null,8,["modelValue","disabled"])]),s("div",ne,[ie,d(f,{id:"endDate",modelValue:a(e).endDate,"onUpdate:modelValue":t[7]||(t[7]=o=>a(e).endDate=o),disabled:!a(e).recurring},null,8,["modelValue","disabled"])])]),s("div",null,[re,d(L,{modelValue:a(e).description,"onUpdate:modelValue":t[8]||(t[8]=o=>a(e).description=o),class:"w-full"},null,8,["modelValue"])]),s("div",de,[d(R,{label:"Guardar",class:"mr-2",onClick:c})])])):B("",!0)}}}),De=g({__name:"Expense",setup(k){const m=E(_.EDIT),n=M(),v=N(),e=F(),{expense:l}=I(e),y=async()=>{await e.fetchExpense(n.params.id);let r="";l.value?(m.value=_.EDIT,r="Modificació de despeses",l.value.creationDate=new Date(l.value.creationDate),l.value.endDate=new Date(l.value.endDate),l.value.paymentDate=new Date(l.value.paymentDate)):(m.value=_.CREATE,e.setNewExpense(n.params.id),r="Alta de despeses"),v.setMenuItem({icon:P.WALLET,backButtonVisible:!0,title:r})};C(async()=>{await y()});const i=h(),V=async()=>{const r=l.value;let c=!1,u="";m.value===_.CREATE?(c=await e.createExpense(r),u="Despesa registrada correctament"):(c=await e.updateExpense(r.id,r),u="Despesa actualizada correctament"),c&&(i.add({severity:"success",summary:u,life:5e3}),z.back())};return(r,c)=>a(l)?(U(),$(ue,{key:0,expense:a(l),onSubmit:V},null,8,["expense"])):B("",!0)}});export{De as default};
