import{d as S,o as U,k as _,O as B,E as x,r as N,h as C,l as e,c as F,e as t,i,n as r,D as d,m as h,a as I,F as g,x as D,u as q,q as M,P as R,Z as A}from"./index-f6af8c81.js";import{u as L}from"./plantmodel-2dcc063a.js";import{c as $,a as b,F as G}from"./form-validator-ec7c2535.js";import"./index-5443ddc0.js";const z={key:0},O={class:"three-columns mb-2"},j={class:"three-columns mb-2"},W=t("label",{class:"block text-900 mb-2"},"País",-1),Z=t("label",{class:"block text-900 mb-2"},"Província",-1),H=t("label",{class:"block text-900 mb-2"},"Municipi",-1),J={class:"three-columns mb-2"},K={class:"three-columns mb-2"},Q={class:"three-columns mb-2"},X=t("label",{class:"block text-900 mb-2"},"Empresa",-1),Y=t("label",{class:"block text-900 mb-2"},"Desactivat",-1),ee=S({__name:"FormSite",props:{site:{}},emits:["submit","cancel"],setup(k,{emit:v}){const V=k;U(async()=>{await m.fetchEnterprises()});const y=_(),u=B(),m=L(),{site:l}=x(m),w=$().shape({name:b().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:b().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),email:b().email("El correu electrònic no és vàlid").required("El correu electrònic és obligatori"),emailSales:b().email("El correu electrònic de ventes no és vàlid").required("El correu electrònic de ventes és obligatori"),emailPurchase:b().email("El correu electrònic de compres no és vàlid").required("El correu electrònic de compres és obligatori"),enterpriseId:b().required("L'empresa es obligatoria")}),o=N({result:!1,errors:{}}),n=()=>{const E=new G(w);o.value=E.validate(V.site)},c=()=>{l.value.address=""},f=async()=>{if(n(),o.value.result)v("submit",V.site);else{let E="";Object.entries(o.value.errors).forEach(s=>{E+=`${s[1].map(p=>p)}.   `}),y.add({severity:"warn",summary:"Formulari inválid",detail:E,life:5e3})}};return(E,s)=>{const p=C("Dropdown"),P=C("Checkbox"),T=C("Button");return e(l)?(I(),F("form",z,[t("section",O,[i(d,{label:"Nom",id:"name",modelValue:e(l).name,"onUpdate:modelValue":s[0]||(s[0]=a=>e(l).name=a),class:r({"p-invalid":o.value.errors.name})},null,8,["modelValue","class"]),i(d,{label:"Descripció",id:"description",modelValue:e(l).description,"onUpdate:modelValue":s[1]||(s[1]=a=>e(l).description=a),class:r({"p-invalid":o.value.errors.description})},null,8,["modelValue","class"]),i(d,{label:"CIF",id:"vatNumber",modelValue:e(l).vatNumber,"onUpdate:modelValue":s[2]||(s[2]=a=>e(l).vatNumber=a),class:r({"p-invalid":o.value.errors.vatNumber})},null,8,["modelValue","class"])]),t("section",j,[t("div",null,[W,i(p,{modelValue:e(l).country,"onUpdate:modelValue":s[3]||(s[3]=a=>e(l).country=a),editable:"",options:["Espanya"],class:r(["w-full",{"p-invalid":o.value.errors.country}])},null,8,["modelValue","class"])]),t("div",null,[Z,i(p,{modelValue:e(l).region,"onUpdate:modelValue":s[4]||(s[4]=a=>e(l).region=a),editable:"",options:e(u).regions,optionValue:"nm",optionLabel:"nm",onChange:c,class:r(["w-full",{"p-invalid":o.value.errors.region}])},null,8,["modelValue","options","class"])]),t("div",null,[H,i(p,{modelValue:e(l).city,"onUpdate:modelValue":s[5]||(s[5]=a=>e(l).city=a),editable:"",options:e(u).getTownsByRegionName(e(l).region),optionValue:"nm",optionLabel:"nm",class:r(["w-full",{"p-invalid":o.value.errors.city}])},null,8,["modelValue","options","class"])])]),t("section",J,[i(d,{label:"Codi Postal",id:"postalCode",modelValue:e(l).postalCode,"onUpdate:modelValue":s[6]||(s[6]=a=>e(l).postalCode=a),class:r({"p-invalid":o.value.errors.postalCode})},null,8,["modelValue","class"]),i(d,{label:"Direcció",id:"address",modelValue:e(l).address,"onUpdate:modelValue":s[7]||(s[7]=a=>e(l).address=a),class:r({"p-invalid":o.value.errors.address})},null,8,["modelValue","class"]),i(d,{label:"Telèfon",id:"phone",modelValue:e(l).phoneNumber,"onUpdate:modelValue":s[8]||(s[8]=a=>e(l).phoneNumber=a),class:r({"p-invalid":o.value.errors.phone})},null,8,["modelValue","class"])]),t("section",K,[i(d,{label:"Email general",id:"email",modelValue:e(l).email,"onUpdate:modelValue":s[9]||(s[9]=a=>e(l).email=a),class:r({"p-invalid":o.value.errors.email})},null,8,["modelValue","class"]),i(d,{label:"Email compres",id:"email",modelValue:e(l).emailPurchase,"onUpdate:modelValue":s[10]||(s[10]=a=>e(l).emailPurchase=a),class:r({"p-invalid":o.value.errors.emailPurchase})},null,8,["modelValue","class"]),i(d,{label:"Email ventes",id:"email",modelValue:e(l).emailSales,"onUpdate:modelValue":s[11]||(s[11]=a=>e(l).emailSales=a),class:r({"p-invalid":o.value.errors.emailSales})},null,8,["modelValue","class"])]),t("section",Q,[t("div",null,[X,i(p,{modelValue:e(l).enterpriseId,"onUpdate:modelValue":s[12]||(s[12]=a=>e(l).enterpriseId=a),editable:"",options:e(m).enterprises,optionValue:"id",optionLabel:"name",class:r(["w-full",{"p-invalid":o.value.errors.enterpriseId}])},null,8,["modelValue","options","class"])]),t("div",null,[Y,i(P,{modelValue:e(l).disabled,"onUpdate:modelValue":s[13]||(s[13]=a=>e(l).disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),t("div",null,[i(T,{label:"Guardar",class:"mr-2",onClick:f})])])):h("",!0)}}}),te=S({__name:"Site",setup(k){const v=N(g.EDIT),V=D(),y=q(),u=L(),{site:m}=x(u),l=async()=>{await u.fetchSite(V.params.id);let n="";m.value?(v.value=g.EDIT,n="Modificació de locals"):(v.value=g.CREATE,u.setNewSite(V.params.id),n="Alta de locals"),y.setMenuItem({icon:R.WALLET,backButtonVisible:!0,title:n})};U(async()=>{await l()});const w=_(),o=async()=>{const n=m.value;let c=!1,f="";v.value===g.CREATE?(c=await u.createSite(n),f="Local registrat correctament"):(c=await u.updateSite(n.id,n),f="Local actualitzat correctament"),c&&(w.add({severity:"success",summary:f,life:5e3}),A.back())};return(n,c)=>e(m)?(I(),M(ee,{key:0,site:e(m),onSubmit:o},null,8,["site"])):h("",!0)}});export{te as default};
