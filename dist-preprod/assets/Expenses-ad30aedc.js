import{d as N,g as U,u as q,H as A,a4 as M,k as H,z as Y,r as $,Y as j,o as z,P as m,a5 as W,T as k,h as x,q as G,w as c,l as o,a as J,e as l,i as a,t as y,W as v,I as h,J as Q,n as K,C as O}from"./index-f6af8c81.js";import{u as X}from"./expense-bbc87d5c.js";import{_ as Z}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-71eec8fe.js";import"./index-d3847f4f.js";import"./suppliers.service-f3c59018.js";const ee={class:"flex flex-wrap align-items-center justify-content-between gap-2"},te={class:"datatable-filter"},se={class:"filter-field"},ae={class:"filter-field"},ne=l("label",{class:"block text-900 mb-2"},"Tipus",-1),oe={class:"datatable-buttons"},ie=["onClick"],re={class:"flex-right"},xe=N({__name:"Expenses",setup(ce){const T=U(),s=q(),f=A(),i=X(),b=M(),w=H(),g=Y(),p=$({expenseTypeId:void 0}),E=j(()=>{let e=0;return i.expenses&&i.expenses.forEach(t=>e+=t.amount),e}),C=()=>{const e=b.getFilter("Expenses","");e&&(p.value.expenseTypeId=e.expenseTypeId,e.exercisePicker&&(s.exercisePicker.exercise=e.exercisePicker.exercise,s.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))};z(async()=>{s.setMenuItem({icon:m.WALLET,title:"Gestió de despeses"}),await i.fetchExpenseTypes(),f.exercises||await f.fetchActive(),I(),C(),_()}),W(()=>{const e={expenseTypeId:p.value.expenseTypeId,exercisePicker:s.exercisePicker};b.addFilter("Expenses","",e)});const _=async()=>{if(s.exercisePicker.dates){const e=k(s.exercisePicker.dates[0]),t=k(s.exercisePicker.dates[1]);await i.fetchExpenses(e,t,p.value.expenseTypeId)}},I=()=>{var r;const e=new Date().getFullYear().toString(),t=(r=f.exercises)==null?void 0:r.find(d=>d.name===e);t&&(s.exercisePicker.exercise=t,s.exercisePicker.dates=[new Date(s.exercisePicker.exercise.startDate),new Date(s.exercisePicker.exercise.endDate)])},P=async()=>{p.value.expenseTypeId="",s.cleanExercisePicker()},D=()=>{T.push({path:`/expense/${O()}`})},S=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||T.push({path:`/expense/${e.data.id}`})},F=(e,t)=>{g.require({target:e.currentTarget,message:"Està segur que vol eliminar la despesa?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await i.deleteExpense(t.id)&&(w.add({severity:"success",summary:"Eliminat",life:3e3}),await _())}})},B=e=>{var r;const t=(r=i.expenseTypes)==null?void 0:r.find(d=>d.id===e);return t?t.name:""};return(e,t)=>{const r=x("Dropdown"),d=x("Button"),u=x("Column"),L=x("BooleanColumn"),V=x("DataTable");return J(),G(V,{value:o(i).expenses,class:"p-datatable-sm small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",onRowClick:S},{header:c(()=>[l("div",ee,[l("div",te,[l("div",se,[a(Z,{exercises:o(f).exercises,onRangeSelected:_},null,8,["exercises"])]),l("div",ae,[ne,a(r,{modelValue:p.value.expenseTypeId,"onUpdate:modelValue":t[0]||(t[0]=n=>p.value.expenseTypeId=n),editable:"",options:o(i).expenseTypes,optionValue:"id",optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])])]),l("div",oe,[a(d,{class:"datatable-button mr-2",icon:o(m).FILTER,rounded:"",raised:"",onClick:_},null,8,["icon"]),a(d,{class:"datatable-button mr-2",icon:o(m).FILTER_SLASH,rounded:"",raised:"",onClick:P},null,8,["icon"]),a(d,{icon:o(m).PLUS,rounded:"",raised:"",onClick:D},null,8,["icon"])])])]),footer:c(()=>[l("div",re," Total "+y(o(v)(E.value)),1)]),default:c(()=>[a(u,{header:"Tipus",style:{width:"15%"}},{body:c(n=>[h(y(B(n.data.expenseTypeId)),1)]),_:1}),a(u,{field:"description",header:"Descripció",style:{width:"40%"},sortable:""}),a(u,{field:"paymentDate",header:"Data pagament",style:{width:"20%"},sortable:""},{body:c(n=>[h(y(o(Q)(n.data.paymentDate)),1)]),_:1}),a(u,{field:"amount",header:"Import",style:{width:"15%"}},{body:c(n=>[h(y(o(v)(n.data.amount)),1)]),_:1}),a(u,{header:"Recurrent",style:{width:"10%"}},{body:c(n=>[a(L,{value:n.data.recurring,showColor:!1},null,8,["value"])]),_:1}),a(u,null,{body:c(n=>[l("i",{class:K([o(m).TIMES,"grid_delete_column_button"]),onClick:R=>F(R,n.data)},null,10,ie)]),_:1})]),_:1},8,["value"])}}});export{xe as default};
