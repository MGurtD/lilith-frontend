import{_ as Y}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-71eec8fe.js";import{_ as G}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-749b01fd.js";import{_ as J}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-0951f83c.js";import{d as K,g as Q,k as W,z as X,u as Z,a4 as ee,r as C,M as te,o as se,P as f,a5 as ae,T as N,h as y,c as P,i as a,w as n,l as c,N as re,a as F,e as u,I as b,t as p,J as E,n as ie,m as oe,K as ce}from"./index-f6af8c81.js";import{u as le}from"./reference-75fb097d.js";import{u as ne}from"./customers-bf96fe43.js";import{u as de}from"./lifecycle-b04b6c31.js";import{u as ue}from"./deliveryNote-744866f1.js";import{u as me}from"./masterData-85d8bfb5.js";import"./form-validator-ec7c2535.js";import"./index-a7d21bd0.js";const fe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ve={class:"datatable-filter"},_e={class:"filter-field"},ye={class:"filter-field"},be=u("label",null,"Client",-1),pe={class:"datatable-buttons"},he=["onClick"],Re=K({__name:"DeliveryNotes",setup(xe){const D=Q(),g=W(),R=X(),o=Z(),k=ee(),h=me(),m=ue(),T=le(),w=ne(),x=de(),l=C({customerId:void 0,referenceId:void 0}),d=te({visible:!1,title:"Crear albarà",closable:!0,position:"center",modal:!0});se(async()=>{x.fetchOneByName("DeliveryNote"),T.fetchReferences(),w.fetchCustomers(),await h.fetchMasterData(),q(),B(),await _(),o.setMenuItem({icon:f.APPLE,title:"Albarans d'entrega"})}),ae(()=>{const e={referenceId:l.value.referenceId,customerId:l.value.customerId,exercisePicker:o.exercisePicker};k.addFilter("DeliveryNotes","",e),m.deliveryNotes=void 0});const B=()=>{const e=k.getFilter("DeliveryNotes","");e&&(l.value.referenceId=e.referenceId,l.value.customerId=e.customerId,e.exercisePicker&&(o.exercisePicker.exercise=e.exercisePicker.exercise,o.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},q=()=>{var r;const e=new Date().getFullYear().toString(),t=(r=h.exercises)==null?void 0:r.find(i=>i.name===e);t&&(o.exercisePicker.exercise=t,o.exercisePicker.dates=[new Date(o.exercisePicker.exercise.startDate),new Date(o.exercisePicker.exercise.endDate)])},U=()=>{o.cleanExercisePicker(),l.value.customerId=void 0},v=C({}),V=()=>({id:ce(),customerId:"",exerciseId:"",date:new Date}),L=()=>{v.value=V(),d.visible=!0},_=async()=>{if(o.exercisePicker.dates){const e=N(o.exercisePicker.dates[0]),t=N(o.exercisePicker.dates[1]);await m.GetFiltered(e,t,l.value.customerId)}else g.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},M=e=>{var r,i;const t=(i=(r=x.lifecycle)==null?void 0:r.statuses)==null?void 0:i.find(I=>I.id===e);return t?t.name:""},$=e=>{var r;const t=(r=w.customers)==null?void 0:r.find(i=>i.id===e);return t?t.comercialName:""},O=async()=>{d.visible=!1,await m.Create(v.value)&&D.push({path:`/deliverynote/${v.value.id}`})},A=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||D.push({path:`/deliverynote/${e.data.id}`})},j=(e,t)=>{R.require({message:"Està segur que vol eliminar l'albarà?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await m.Delete(t.id)&&(g.add({severity:"success",summary:"Eliminada",life:3e3}),await _())}})};return(e,t)=>{const r=y("Button"),i=y("Column"),I=y("DataTable"),z=y("Dialog");return F(),P(re,null,[a(I,{value:c(m).deliveryNotes,class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"single",paginator:"",rows:12,onRowClick:A},{header:n(()=>[u("div",fe,[u("div",ve,[u("div",_e,[a(Y,{exercises:c(h).exercises,onRangeSelected:_},null,8,["exercises"])]),u("div",ye,[be,a(J,{label:"",modelValue:l.value.customerId,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.customerId=s)},null,8,["modelValue"])])]),u("div",pe,[a(r,{class:"datatable-button mr-2",icon:c(f).FILTER,rounded:"",raised:"",onClick:_},null,8,["icon"]),a(r,{class:"datatable-button mr-2",icon:c(f).FILTER_SLASH,rounded:"",raised:"",onClick:U},null,8,["icon"]),a(r,{icon:c(f).PLUS,rounded:"",raised:"",onClick:L},null,8,["icon"])])])]),default:n(()=>[a(i,{field:"number",header:"Número",sortable:"",style:{width:"15%"}}),a(i,{field:"createdOn",header:"Data Creació",sortable:"",style:{width:"15%"}},{body:n(s=>[b(p(c(E)(s.data.createdOn)),1)]),_:1}),a(i,{header:"Data Entrega",style:{width:"15%"}},{body:n(s=>[b(p(s.data.deliveryDate?c(E)(s.data.deliveryDate):""),1)]),_:1}),a(i,{header:"Client",style:{width:"30%"}},{body:n(s=>[b(p($(s.data.customerId)),1)]),_:1}),a(i,{header:"Estat",style:{width:"30%"}},{body:n(s=>[b(p(M(s.data.statusId)),1)]),_:1}),a(i,{style:{width:"5%"}},{body:n(s=>{var S;return[s.data.statusId===((S=c(x).lifecycle)==null?void 0:S.initialStatusId)?(F(),P("i",{key:0,class:ie([c(f).TIMES,"grid_delete_column_button"]),onClick:H=>j(H,s.data)},null,10,he)):oe("",!0)]}),_:1})]),_:1},8,["value"]),a(z,{visible:d.visible,"onUpdate:visible":t[1]||(t[1]=s=>d.visible=s),header:d.title,closable:d.closable,modal:d.modal},{default:n(()=>[a(G,{"create-request":v.value,onSubmit:O},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Re as default};
