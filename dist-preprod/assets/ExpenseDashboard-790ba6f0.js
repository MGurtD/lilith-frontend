import{_ as H}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-71eec8fe.js";import{d as N,h as m,a as g,q as E,w as u,i as o,e as t,t as S,l as c,J as U,u as W,r as p,o as j,P as f,Y as G,c as Y,n as w,I as q,N as z,T as I,ah as J,p as K,b as Q,W as Z,ai as A,m as B,f as X}from"./index-f6af8c81.js";import{u as ee}from"./masterData-85d8bfb5.js";import{E as L}from"./index-d3847f4f.js";import"./suppliers.service-f3c59018.js";const te=N({__name:"TableConsolidatedExpenses",props:{expenses:{}},setup(h){const _=h;return(D,x)=>{const a=m("Column"),C=m("DataTable");return g(),E(C,{value:_.expenses,tableStyle:"min-width: 100%"},{default:u(()=>[o(a,{field:"type",header:"Tipus de despesa",style:{width:"10%"}}),o(a,{field:"typeDetail",header:"Detall",style:{width:"15%"}}),o(a,{field:"paymentDate",header:"Data pagament",sortable:"",style:{width:"10%"}},{body:u(n=>[t("span",null,S(c(U)(n.data.paymentDate)),1)]),_:1}),o(a,{field:"amount",header:"Import",style:{width:"10%"}},{body:u(n=>[t("span",null,S(n.data.amount)+" €",1)]),_:1}),o(a,{field:"description",header:"Descripció",style:{width:"30%"}})]),_:1},8,["value"])}}}),y=h=>(K("data-v-2fac00e4"),h=h(),Q(),h),ae={class:"dashboard-filter"},se={class:"dashboard-filter-field"},oe={class:"dashboard-filter-field"},le=y(()=>t("label",null,"Tipus",-1)),ne={class:"dashboard-filter-field"},re=y(()=>t("label",null,"Detall",-1)),de={class:"dashboard-filter-field"},ie={class:"block text-900"},ce=y(()=>t("span",null,"Gràfics",-1)),pe={class:"dashboard-container"},ue={class:"dashboard-item"},_e=y(()=>t("header",{class:"dashboard-item-header"}," Agrupat despeses mensual ",-1)),he={class:"dashboard-item-chart"},me={class:"dashboard-item"},ye=y(()=>t("header",{class:"dashboard-item-header"}," Gràfic de despeses per tipologia ",-1)),ve={class:"dashboard-item-chart"},fe=y(()=>t("span",null,"Llistat",-1)),be=N({__name:"ExpenseDashboard",setup(h){const _=W(),D=ee(),x=p(0),a=p({dates:void 0,type:"",typeDetail:""}),C=p(void 0),n=p([]),O=()=>{_.cleanExercisePicker(),a.value.type="",a.value.typeDetail=""};j(async()=>{_.setMenuItem({icon:f.MONEY_BILL,title:"Dashboard despeses"}),await D.fetchMasterData(),C.value=await L.ExpenseType.getAll()});const b=p(void 0),R=p({plugins:{legend:{labels:{usePointStyle:!0}}}}),T=p(void 0),$=p({scales:{y:{beginAtZero:!0}}}),F=G(()=>{let d=0;return n.value.length>0&&n.value.forEach(e=>d+=e.amount),d}),V=async d=>{if(_.exercisePicker.dates){const e=I(_.exercisePicker.dates[0]),s=I(_.exercisePicker.dates[1]);d&&(a.value.typeDetail="");const l=await L.Expense.getConsolidated(e,s,a.value.type,a.value.typeDetail);l&&(n.value=l),T.value=k(n.value,"monthPaymentKey"),b.value=k(n.value,"typeDetail")}},k=(d,e)=>{const s={},l=J.groupBy(d,e);s.labels=Object.keys(l);const i=M(s.labels.length);return s.datasets=[{label:"Despeses",data:[],backgroundColor:i,borderColor:i,borderWidth:1}],Object.keys(l).forEach(P=>{let v=0;l[P].forEach(r=>{v+=r.amount}),s.datasets[0].data.push(v)}),s},M=d=>{const e=getComputedStyle(document.body),s=[e.getPropertyValue("--blue-400"),e.getPropertyValue("--green-400"),e.getPropertyValue("--yellow-400"),e.getPropertyValue("--cyan-400"),e.getPropertyValue("--pink-400"),e.getPropertyValue("--indigo-400"),e.getPropertyValue("--orange-400"),e.getPropertyValue("--purple-400"),e.getPropertyValue("--red-400")],l=[];for(;l.length<d;)for(let i=0;i<s.length;i++)l.push(s[i]);return l};return(d,e)=>{var v;const s=m("Dropdown"),l=m("Button"),i=m("TabPanel"),P=m("TabView");return g(),Y(z,null,[t("div",ae,[t("div",se,[o(H,{exercises:c(D).exercises,onRangeSelected:e[0]||(e[0]=r=>V(!1))},null,8,["exercises"])]),t("div",oe,[le,o(s,{options:["Despesa","Compra"],modelValue:a.value.type,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.type=r),onChange:e[2]||(e[2]=r=>V(!0))},null,8,["modelValue"])]),t("div",ne,[re,o(s,{options:(v=b.value)==null?void 0:v.labels,modelValue:a.value.typeDetail,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.typeDetail=r),onChange:e[4]||(e[4]=r=>V(!1))},null,8,["options","modelValue"])]),t("div",de,[t("label",ie,[t("i",{class:w(c(f).WALLET)},null,2),q("   Total despesa "),t("b",null,S(c(Z)(F.value)),1)])]),o(l,{class:"grid_add_row_button",icon:c(f).FILTER_SLASH,onClick:O},null,8,["icon"])]),o(P,{activeIndex:x.value,"onUpdate:activeIndex":e[5]||(e[5]=r=>x.value=r)},{default:u(()=>[o(i,null,{header:u(()=>[t("i",{class:w([c(f).CHART_BAR,"mr-2"])},null,2),ce]),default:u(()=>[t("div",pe,[t("section",ue,[_e,t("div",he,[T.value?(g(),E(c(A),{key:0,type:"bar",data:T.value,options:$.value},null,8,["data","options"])):B("",!0)])]),t("section",me,[ye,t("div",ve,[b.value?(g(),E(c(A),{key:0,type:"pie",data:b.value,options:R.value},null,8,["data","options"])):B("",!0)])])])]),_:1}),o(i,null,{header:u(()=>[t("i",{class:w([c(f).LIST,"mr-2"])},null,2),fe]),default:u(()=>[o(te,{scrollable:"",scrollHeight:"80vh",expenses:n.value},null,8,["expenses"])]),_:1})]),_:1},8,["activeIndex"])],64)}}});const Ve=X(be,[["__scopeId","data-v-2fac00e4"]]);export{Ve as default};
