import{d as E,k as _,r as g,h as x,c as T,e as i,i as m,n as V,D as y,l as v,m as k,a as I,v as w,F as d,u as B,x as C,g as h,E as F,o as N,q as $,P as R}from"./index-f6af8c81.js";import{u as q}from"./tax-320212e0.js";import{c as D,a as M,d as U,b as A,F as P}from"./form-validator-ec7c2535.js";const S={key:0},z={class:"two-columns"},G=i("label",{class:"block text-900 mb-2"},"Desactivada",-1),L={class:"mt-2"},O=E({__name:"FormTax",props:{tax:{}},emits:["submit","cancel"],setup(f,{emit:n}){const c=f,u=_(),p=D().shape({name:M().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),percentatge:U().required("La freqüència és obligatoria"),disabled:A().required("El camp deshabilitat és obligatori")}),t=g({result:!1,errors:{}}),l=()=>{const e=new P(p);t.value=e.validate(c.tax)},b=async()=>{if(l(),t.value.result)n("submit",c.tax);else{let e="";Object.entries(t.value.errors).forEach(s=>{e+=`${s[1].map(a=>a)}.   `}),u.add({severity:"warn",summary:"Formulari inválid",detail:e,life:5e3})}};return(e,s)=>{const a=x("Checkbox"),r=x("Button");return e.tax?(I(),T("form",S,[i("div",z,[m(y,{class:V(["mb-2",{"p-invalid":t.value.errors.name}]),label:"Nom",id:"name",modelValue:e.tax.name,"onUpdate:modelValue":s[0]||(s[0]=o=>e.tax.name=o)},null,8,["modelValue","class"]),m(y,{type:v(w).NUMERIC,label:"Percentatge",id:"percentatge",modelValue:e.tax.percentatge,"onUpdate:modelValue":s[1]||(s[1]=o=>e.tax.percentatge=o),class:V({"p-invalid":t.value.errors.percentatge})},null,8,["type","modelValue","class"])]),i("div",null,[i("div",null,[G,m(a,{modelValue:e.tax.disabled,"onUpdate:modelValue":s[2]||(s[2]=o=>e.tax.disabled=o),class:"w-full",binary:!0},null,8,["modelValue"])])]),i("div",L,[m(r,{label:"Guardar",onClick:b})])])):k("",!0)}}}),K=E({__name:"Tax",setup(f){const n=g(d.EDIT),c=B(),u=C(),p=h(),t=q(),{tax:l}=F(t),b=async()=>{await t.fetchOne(u.params.id);let a="";l.value?(n.value=d.EDIT,a=`Impost ${l.value.name}`):(n.value=d.CREATE,t.setNew(u.params.id),a="Alta d'impost"),c.setMenuItem({icon:R.BUILDING,backButtonVisible:!0,title:a})};N(async()=>{await b()});const e=_(),s=async()=>{const a=l.value;let r=!1,o="";n.value===d.CREATE?(r=await t.create(a),o="Impost creat correctament"):(r=await t.update(a.id,a),o="Impost actualizat correctament"),r&&(e.add({severity:"success",summary:o,life:5e3}),p.back())};return(a,r)=>v(l)?(I(),$(O,{key:0,tax:v(l),onSubmit:s},null,8,["tax"])):k("",!0)}});export{K as default};
