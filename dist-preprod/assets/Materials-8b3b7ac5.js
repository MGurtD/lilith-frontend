import{a as W,_ as Y}from"./DropdownReferenceType.vue_vue_type_script_setup_true_lang-b802c504.js";import{d as B,a4 as G,o as L,a5 as J,Y as b,h as F,q as d,w as l,a as f,e as s,i as c,D as Q,l as u,P as k,I as R,t as h,W as E,m as g,n as X,p as Z,b as ee,f as N,g as te,u as re,z as ae,k as oe,r as se,K as ne}from"./index-f6af8c81.js";import{u as $}from"./reference-75fb097d.js";import{R as M}from"./index-7cbe1881.js";import{u as U}from"./referenceType-942d6c6d.js";import{u as le}from"./plantmodel-2dcc063a.js";import{u as ie}from"./tax-320212e0.js";import"./index-5443ddc0.js";const A=p=>(Z("data-v-cd302e4c"),p=p(),ee(),p),ce={class:"flex flex-wrap align-items-center justify-content-between gap-2"},de={class:"datatable-filter-3"},fe={class:"filter-field"},ue=A(()=>s("label",null,"Categoria",-1)),pe={class:"filter-field"},me=A(()=>s("label",null,"Codi",-1)),ye={class:"filter-field"},_e=A(()=>s("label",null,"Tipus",-1)),he={class:"datatable-buttons"},ge=["onClick"],Te=B({__name:"TableMaterials",props:{references:{},filter:{}},emits:["add","edit","delete"],setup(p,{emit:m}){const r=p,y=G(),w=U(),S=$(),T=le();L(()=>{const e=y.getFilter("Materials","");e&&(r.filter.code=e.code,r.filter.referenceTypeId=e.referenceTypeId,r.filter.referenceCategory=e.referenceCategory),T.areas||T.fetchAreas()}),J(()=>{y.addFilter("Materials","",r.filter)});const C=()=>{r.filter.code="",r.filter.referenceTypeId=""},_=b(()=>r.references?r.filter.referenceCategory===""?[]:S.references.filter(e=>e.categoryName===r.filter.referenceCategory):[]),V=b(()=>{if(!_.value)return[];let e=_.value;return r.filter.referenceTypeId&&r.filter.referenceTypeId.length>0&&(e=e.filter(t=>t.referenceTypeId===r.filter.referenceTypeId)),r.filter.code.length>0&&(e=e.filter(t=>t.code.toLowerCase().includes(r.filter.code.toLowerCase()))),e}),v=b(()=>r.filter.referenceCategory===M.MATERIAL),D=b(()=>r.filter.referenceCategory===M.TOOL),n=b(()=>r.filter.referenceCategory===M.SERVICE),I=()=>{m("add")},x=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||m("edit",e.data)},P=(e,t)=>{m("delete",t)},q=e=>{const t=w.getReferenceTypeById(e);return t?t.density:0},j=e=>{var i;const t=(i=S.referenceFormats)==null?void 0:i.find(o=>o.id===e);return t?t.description:""},z=e=>{const t=w.getReferenceTypeById(e);return t?t.description:""},H=e=>{var i;const t=(i=T.areas)==null?void 0:i.find(o=>o.id===e);return t?t.name:""};return(e,t)=>{const i=F("Button"),o=F("Column"),K=F("DataTable");return f(),d(K,{value:V.value,tableStyle:"min-width: 100%",class:"p-datatable-sm",scrollable:"",scrollHeight:"80vh",paginator:"",rows:19,onRowClick:x},{header:l(()=>[s("div",ce,[s("div",de,[s("div",fe,[ue,c(W,{label:"",modelValue:e.filter.referenceCategory,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filter.referenceCategory=a)},null,8,["modelValue"])]),s("div",pe,[me,c(Q,{modelValue:e.filter.code,"onUpdate:modelValue":t[1]||(t[1]=a=>e.filter.code=a)},null,8,["modelValue"])]),s("div",ye,[_e,c(Y,{label:"",modelValue:e.filter.referenceTypeId,"onUpdate:modelValue":t[2]||(t[2]=a=>e.filter.referenceTypeId=a),disabled:e.filter.referenceCategory!==u(M).MATERIAL,onChange:C},null,8,["modelValue","disabled"])])]),s("div",he,[c(i,{class:"datatable-button mr-2",icon:u(k).FILTER_SLASH,rounded:"",raised:"",onClick:C},null,8,["icon"]),c(i,{class:"datatable-button mr-2",icon:u(k).PLUS,rounded:"",raised:"",onClick:I},null,8,["icon"])])])]),default:l(()=>[c(o,{field:"code",header:"Codi",style:{width:"15%"}}),c(o,{field:"description",header:"Descripció",style:{width:"25%"}}),n.value?(f(),d(o,{key:0,header:"Preu",style:{width:"10%"}},{body:l(a=>[R(h(u(E)(a.data.price)),1)]),_:1})):g("",!0),n.value?(f(),d(o,{key:1,header:"Transport",style:{width:"10%"}},{body:l(a=>[R(h(u(E)(a.data.transportAmount)),1)]),_:1})):g("",!0),v.value?(f(),d(o,{key:2,field:"referenceTypeId",header:"Tipus",style:{width:"30%"}},{body:l(a=>[s("span",null,h(z(a.data.referenceTypeId)),1)]),_:1})):g("",!0),v.value?(f(),d(o,{key:3,field:"referenceFormatId",header:"Format",style:{width:"10%"}},{body:l(a=>[s("span",null,h(j(a.data.referenceFormatId)),1)]),_:1})):g("",!0),v.value?(f(),d(o,{key:4,header:"Densitat (mm)",style:{width:"10%"}},{body:l(a=>[R(h(q(a.data.referenceTypeId)),1)]),_:1})):g("",!0),D.value?(f(),d(o,{key:5,header:"Àrea",style:{width:"10%"}},{body:l(a=>[R(h(H(a.data.areaId)),1)]),_:1})):g("",!0),c(o,{style:{width:"10%"}},{body:l(a=>[s("i",{class:X([u(k).TIMES,"grid_delete_column_button"]),onClick:O=>P(O,a.data)},null,10,ge)]),_:1})]),_:1},8,["value"])}}});const Ce=N(Te,[["__scopeId","data-v-cd302e4c"]]),ve=B({__name:"Materials",setup(p){const m=te(),r=re(),y=$(),w=ie(),S=U(),T=ae(),C=oe(),_=se({code:"",referenceTypeId:"",referenceCategory:""});L(async()=>{let n="Referències de compra";r.setMenuItem({icon:k.TICKET,title:n}),await y.fetchReferencesByModule("purchase"),w.fetchAll(),S.fetchAll()});const V=()=>{m.push({path:`/material/${ne()}/${_.value.referenceCategory}`})},v=n=>{m.push({path:`/material/${n.id}/${_.value.referenceCategory}`})},D=n=>{T.require({message:`Está segur que vol eliminar el material ${n.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const I=await y.deleteReference(n.id);I.result?C.add({severity:"success",summary:"Material eliminat correctament",life:5e3}):C.add({severity:"warn",summary:I.errors[0],life:5e3,closable:!0})}})};return(n,I)=>(f(),d(Ce,{references:u(y).references,filter:_.value,onAdd:V,onEdit:v,onDelete:D},null,8,["references","filter"]))}});const De=N(ve,[["__scopeId","data-v-7c74384c"]]);export{De as default};
