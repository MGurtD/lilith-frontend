import{F as D}from"./FileEntityPicker-6ebb7fcb.js";import{d as T,k as x,E as h,r as F,h as y,l as e,c as q,e as s,i as d,n as b,D as I,m as M,a as g,v as U,F as k,x as N,u as P,o as S,q as L,N as W,P as $,Z as A}from"./index-f6af8c81.js";import{c as R,a as f,F as z}from"./form-validator-ec7c2535.js";import{u as B}from"./plantmodel-2dcc063a.js";import{u as G}from"./shift-c7af583d.js";import"./index-5443ddc0.js";const j={key:0},O={class:"grid_add_row_button"},Z={class:"four-columns mb-2"},H=s("label",{class:"block text-900 mb-2"},"Desactivat",-1),J={class:"three-columns"},K=s("label",{class:"block text-900 mb-2"},"Tipus",-1),Q=s("label",{class:"block text-900 mb-2"},"Area",-1),X=s("label",{class:"block text-900 mb-2"},"Torn",-1),Y=T({__name:"FormWorkcenter",props:{workcenter:{}},emits:["submit","cancel"],setup(E,{emit:p}){const u=E,v=x(),n=B(),c=G(),{workcenter:t}=h(n),V=R().shape({name:f().required("El nom és obligatori").max(250,"El nom no pot superar els 250 carácters"),description:f().required("La descripció és obligatori").max(250,"La descripció pot superar els 250 carácters"),workcenterTypeId:f().required("El tipus es obligatori"),areaId:f().required("L'area es obligatoria"),shiftId:f().required("El torn es obligatori")}),l=F({result:!1,errors:{}}),r=()=>{const i=new z(V);l.value=i.validate(u.workcenter)},m=async()=>{if(r(),l.value.result)p("submit",u.workcenter);else{let i="";Object.entries(l.value.errors).forEach(o=>{i+=`${o[1].map(w=>w)}.   `}),v.add({severity:"warn",summary:"Formulari inválid",detail:i,life:5e3})}};return(i,o)=>{const w=y("Button"),C=y("Checkbox"),_=y("Dropdown");return e(t)?(g(),q("form",j,[s("div",O,[d(w,{label:"Guardar",style:{float:"right"},onClick:m})]),s("section",Z,[d(I,{label:"Nom",id:"name",modelValue:e(t).name,"onUpdate:modelValue":o[0]||(o[0]=a=>e(t).name=a),class:b({"p-invalid":l.value.errors.name})},null,8,["modelValue","class"]),d(I,{label:"Descripció",id:"description",modelValue:e(t).description,"onUpdate:modelValue":o[1]||(o[1]=a=>e(t).description=a),class:b({"p-invalid":l.value.errors.description})},null,8,["modelValue","class"]),d(I,{type:e(U).NUMERIC,minFractionDigits:2,class:"mb-2",label:"Marge de benefici",id:"profitPercentage",modelValue:e(t).profitPercentage,"onUpdate:modelValue":o[2]||(o[2]=a=>e(t).profitPercentage=a),suffix:"%"},null,8,["type","modelValue"]),s("div",null,[H,d(C,{modelValue:e(t).disabled,"onUpdate:modelValue":o[3]||(o[3]=a=>e(t).disabled=a),class:"w-full",binary:!0},null,8,["modelValue"])])]),s("section",J,[s("div",null,[K,d(_,{modelValue:e(t).workcenterTypeId,"onUpdate:modelValue":o[4]||(o[4]=a=>e(t).workcenterTypeId=a),editable:"",options:e(n).workcenterTypes,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":l.value.errors.workcenterTypeId}])},null,8,["modelValue","options","class"])]),s("div",null,[Q,d(_,{modelValue:e(t).areaId,"onUpdate:modelValue":o[5]||(o[5]=a=>e(t).areaId=a),editable:"",options:e(n).areas,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":l.value.errors.areaId}])},null,8,["modelValue","options","class"])]),s("div",null,[X,d(_,{modelValue:e(t).shiftId,"onUpdate:modelValue":o[6]||(o[6]=a=>e(t).shiftId=a),editable:"",options:e(c).shifts,optionValue:"id",optionLabel:"name",class:b(["w-full",{"p-invalid":l.value.errors.shiftId}])},null,8,["modelValue","options","class"])])])])):M("",!0)}}}),ee={class:"mt-4"},ne=T({__name:"Workcenter",setup(E){const p=F(k.EDIT),u=N(),v=P(),n=B(),{workcenter:c}=h(n),t=async()=>{await n.fetchWorkcenter(u.params.id);let r="";c.value?(p.value=k.EDIT,r=`Màquina: ${c.value.name}`):(p.value=k.CREATE,n.setNewWorkcenter(u.params.id),r="Alta de màquina"),v.setMenuItem({icon:$.BUILDING,backButtonVisible:!0,title:r})};S(async()=>{await t()});const V=x(),l=async()=>{const r=c.value;let m=!1,i="";p.value===k.CREATE?(m=await n.createWorkcenter(r),i="Màquina creada correctament"):(m=await n.updateWorkcenter(r.id,r),i="Màquina actualizada correctament"),m&&(V.add({severity:"success",summary:i,life:5e3}),A.back())};return(r,m)=>(g(),q(W,null,[e(c)?(g(),L(Y,{key:0,workcenter:e(c),onSubmit:l},null,8,["workcenter"])):M("",!0),s("section",ee,[d(D,{title:"Imatge de la màquina",entity:"WorkcenterPicture","max-files":1,id:e(u).params.id},null,8,["id"])])],64))}});export{ne as default};
