import{d as z,k as G,u as U,r as S,o as L,P as I,a5 as O,h as p,c as P,i as o,w as r,l as u,a as $,e as d,I as g,t as y,n as x,J as D,W as A,T as N,p as R,b as H,f as W}from"./index-f6af8c81.js";import{u as j}from"./invoice-2a899c66.js";import{u as q}from"./lifecycle-b04b6c31.js";import{u as J}from"./customers-bf96fe43.js";import"./index-a7d21bd0.js";const B=b=>(R("data-v-eba43525"),b=b(),H(),b),K={class:"flex flex-wrap align-items-center justify-content-between gap-2"},Q={class:"datatable-filter"},X={class:"filter-field"},Y=B(()=>d("label",{class:"block text-900 mb-2"},"Període",-1)),Z={class:"filter-field"},ee=B(()=>d("label",{class:"block text-900 mb-2 mr-3"},"Gestionades",-1)),te={class:"flex flex-wrap gap-3"},ae={class:"flex align-items-center"},se={class:"datatable-buttons"},oe=["onClick"],ne="SalesInvoice",le=z({__name:"SalesInvoicesByDates",setup(b){const h=G(),M=U(),w=J(),f=q(),m=j(),c=S({dates:void 0,showManaged:!1}),v=S([]);L(async()=>{m.invoices=[],w.customers||w.fetchCustomers(),f.fetchOneByName(ne),M.setMenuItem({icon:I.SERVER,title:"Comptabilització de factures de venta"})}),O(()=>{m.invoices=void 0});const k=e=>{var s,n;const t=(n=(s=f.lifecycle)==null?void 0:s.statuses)==null?void 0:n.find(i=>i.id===e);return t?t.name:""},T=e=>e.salesInvoiceDueDates?e.salesInvoiceDueDates.length===0?D(e.invoiceDate):D(e.salesInvoiceDueDates[e.salesInvoiceDueDates.length-1].dueDate):"",V=e=>{var s,n;const t=(n=(s=f.lifecycle)==null?void 0:s.statuses)==null?void 0:n.find(i=>i.name==="Gestionada");return t&&t.id===e},C=async()=>{var e,t;if(c.value.dates){let s;c.value.showManaged||(s=(t=(e=f.lifecycle)==null?void 0:e.statuses)==null?void 0:t.find(_=>_.name==="Gestionada"));const n=N(c.value.dates[0]),i=N(c.value.dates[1]),l=s?s.id:void 0;await m.GetFiltered(n,i,void 0,void 0,l)}else h.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},E=async()=>{var t,s;const e=(s=(t=f.lifecycle)==null?void 0:t.statuses)==null?void 0:s.find(n=>n.name==="Gestionada");if(e){const i={ids:v.value.map(_=>_.id),statusToId:e.id};await m.UpdateInvoicesStatuses(i)&&(h.add({severity:"success",summary:"Comptabilització de factures de venta",detail:`Factures comptabilitzades: ${v.value.length}`,life:5e3}),await C())}},F=async e=>{console.log("Download invoice",e),await m.PrintInvoice(e.id,e.invoiceNumber)?h.add({severity:"success",summary:"Comptabilització de factures de venta",detail:`Factura ${e.invoiceNumber} descarregada`,life:5e3}):h.add({severity:"error",summary:"Comptabilització de factures de venta",detail:`Error al descarregar la factura ${e.invoiceNumber}`,life:5e3})};return(e,t)=>{const s=p("Calendar"),n=p("Checkbox"),i=p("Button"),l=p("Column"),_=p("DataTable");return $(),P("div",null,[o(_,{class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",value:u(m).invoices,selection:v.value,"onUpdate:selection":t[2]||(t[2]=a=>v.value=a)},{header:r(()=>[d("div",K,[d("div",Q,[d("div",X,[Y,o(s,{modelValue:c.value.dates,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value.dates=a),numberOfMonths:2,selectionMode:"range",dateFormat:"dd/mm/yy"},null,8,["modelValue"])]),d("div",Z,[ee,d("div",te,[d("div",ae,[o(n,{modelValue:c.value.showManaged,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value.showManaged=a),binary:!0,onChange:C},null,8,["modelValue"])])])])]),d("div",se,[o(i,{class:"datatable-button",icon:u(I).FILTER,rounded:"",raised:"",onClick:C},null,8,["icon"]),o(i,{icon:u(I).CHECK,disabled:v.value.length===0,rounded:"",raised:"",severity:"success",onClick:E},null,8,["icon","disabled"])])])]),default:r(()=>[o(l,{selectionMode:"multiple",style:{width:"2%"}}),o(l,{field:"invoiceNumber",header:"Número",sortable:"",style:{width:"10%"}}),o(l,{header:"Client",style:{width:"15%"}},{body:r(a=>[g(y(u(w).getCustomerNameById(a.data.customerId)),1)]),_:1}),o(l,{header:"Estat",style:{width:"15%"}},{body:r(a=>[d("span",{class:x({"managed-status":V(a.data.statusId)})},y(k(a.data.statusId)),3)]),_:1}),o(l,{header:"Data",field:"invoiceDate",sortable:"",style:{width:"15%"}},{body:r(a=>[g(y(u(D)(a.data.invoiceDate)),1)]),_:1}),o(l,{header:"Venciment",style:{width:"15%"}},{body:r(a=>[g(y(T(a.data)),1)]),_:1}),o(l,{field:"baseAmount",header:"Import Base",style:{width:"15%"}},{body:r(a=>[g(y(u(A)(a.data.baseAmount)),1)]),_:1}),o(l,{style:{width:"2%"}},{body:r(a=>[d("i",{class:x([u(I).DOWNLOAD,"download_column"]),onClick:de=>F(a.data)},null,10,oe)]),_:1})]),_:1},8,["value","selection"])])}}});const fe=W(le,[["__scopeId","data-v-eba43525"]]);export{fe as default};
