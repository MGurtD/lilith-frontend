import{_ as V}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-71eec8fe.js";import{u as I}from"./warehouse-48423be3.js";import{d as S,o as L,Y as $,h as w,a as u,c as p,t as c,m as k,i as o,w as d,e as l,a9 as R,k as F,u as M,H as B,r as N,P as x,l as m,I as D,an as E,T as P}from"./index-f6af8c81.js";import{u as W}from"./stockMovement-ea18222e.js";import{u as A}from"./reference-75fb097d.js";const H={class:"mb-2"},G={key:0,class:"block text-900 mb-2"},Y={key:0,class:"flex align-items-center"},z={key:1},O={class:"flex align-items-center"},Q=l("i",{class:"pi pi-warehouse mr-2",style:{color:"#6366f1"}},null,-1),U={class:"font-semibold"},j={key:0,class:"flex align-items-center pl-4"},q=l("i",{class:"pi pi-map-marker mr-2",style:{color:"#64748b"}},null,-1),J=S({__name:"DropdownWarehousesWithLocations",props:{label:{},modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(T,{emit:g}){const a=I();L(()=>{a.warehousesHaveLocations||a.fetchWarehousesWithLocations()});const _=$(()=>a.warehouses?a.warehouses.filter(e=>!e.disabled).map(e=>{var s,n;return{label:e.name,code:e.id,items:((n=(s=e.locations)==null?void 0:s.filter(t=>!t.disabled))==null?void 0:n.map(t=>({label:t.description,value:t.id,warehouseId:e.id,warehouseName:e.name})))||[]}}).filter(e=>e.items.length>0):[]),v=e=>{if(!a.warehouses||!e)return"";for(const s of a.warehouses)if(s.locations){const n=s.locations.find(t=>t.id===e);if(n)return`${s.name} - ${n.description}`}return e};return(e,s)=>{const n=w("Dropdown");return u(),p("div",H,[e.label&&e.label.length>0?(u(),p("label",G,c(e.label),1)):k("",!0),o(n,R({showClear:"",filter:"",options:_.value,placeholder:e.placeholder||"Selecciona una ubicació",optionLabel:"label",optionValue:"value",optionGroupLabel:"label",optionGroupChildren:"items",class:"w-full"},e.$attrs,{"model-value":e.modelValue,onChange:s[0]||(s[0]=t=>g("update:modelValue",t.value))}),{value:d(t=>[t.value?(u(),p("div",Y,[l("span",null,c(v(t.value)),1)])):(u(),p("span",z,c(e.placeholder||"Selecciona una ubicació"),1))]),optiongroup:d(t=>[l("div",O,[Q,l("div",U,c(t.option.label),1)])]),option:d(t=>[t.option?(u(),p("div",j,[q,l("div",null,c(t.option.label),1)])):k("",!0)]),_:1},16,["options","placeholder","model-value"])])}}}),K={class:"flex flex-wrap align-items-center justify-content-between gap-2"},X={class:"datatable-filter flex flex-wrap gap-4 flex-1"},Z={class:"filter-field"},ee={class:"filter-field flex gap-2"},te=l("label",null,"Ubicació",-1),ae={class:"datatable-buttons flex gap-2 flex-shrink-0"},re=S({__name:"StockMovements",setup(T){const g=F(),a=M(),_=W(),v=A(),e=B(),s=N({exercise:void 0,locationId:void 0});L(async()=>{a.setMenuItem({icon:x.MAP,title:"Moviments de magatzem"}),await e.fetchAll(),await v.fetchReferences(),n()});const n=()=>{var f;const b=new Date().getFullYear().toString(),r=(f=e.exercises)==null?void 0:f.find(i=>i.name===b);r&&(a.exercisePicker.exercise=r,a.exercisePicker.dates=[new Date(a.exercisePicker.exercise.startDate),new Date(a.exercisePicker.exercise.endDate)])},t=()=>{a.cleanExercisePicker(),s.value.locationId=void 0},y=async()=>{if(a.exercisePicker.dates){const b=P(a.exercisePicker.dates[0]),r=P(a.exercisePicker.dates[1]);await _.getBetweenDates(b,r,s.value.locationId)}else g.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})};return(b,r)=>{const f=w("Button"),i=w("Column"),C=w("DataTable");return u(),p("div",null,[o(C,{class:"p-datatable-sm",tableStyle:"min-width:100%",scrollable:"",scrollHeight:"75vh",sortField:"movementDate",sortOrder:1,value:m(_).stockMovements,paginator:"",rows:20,rowsPerPageOptions:[20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"{first} a {last} de {totalRecords} entrades"},{header:d(()=>[l("div",K,[l("div",X,[l("div",Z,[o(V,{exercises:m(e).exercises,onRangeSelected:y},null,8,["exercises"])]),l("div",ee,[te,o(J,{label:"",modelValue:s.value.locationId,"onUpdate:modelValue":r[0]||(r[0]=h=>s.value.locationId=h)},null,8,["modelValue"])])]),l("div",ae,[o(f,{class:"datatable-button",icon:m(x).FILTER,rounded:"",raised:"",onClick:y},null,8,["icon"]),o(f,{class:"datatable-button",icon:m(x).FILTER_SLASH,rounded:"",raised:"",onClick:t},null,8,["icon"])])])]),default:d(()=>[o(i,{header:"Data",field:"movementDate",sortable:"",style:{width:"15%"}},{body:d(h=>[D(c(m(E)(h.data.movementDate)),1)]),_:1}),o(i,{header:"Referència",style:{width:"20%"}},{body:d(h=>[D(c(m(v).getFullNameById(h.data.referenceId)),1)]),_:1}),o(i,{field:"width",header:"Ample (x) mm",style:{width:"5%"}}),o(i,{field:"length",header:"Llarg (y) mm",style:{width:"5%"}}),o(i,{field:"height",header:"Alt (z) mm",style:{width:"5%"}}),o(i,{field:"diameter",header:"Diámetre mm",style:{width:"5%"}}),o(i,{field:"thickness",header:"Gruix mm",style:{width:"5%"}}),o(i,{field:"description",header:"Descripció",style:{width:"25%"}}),o(i,{field:"movementType",header:"Tipus de moviment",style:{width:"10%"}}),o(i,{field:"quantity",header:"Quantitat",style:{width:"10%"}})]),_:1},8,["value"])])}}});export{re as default};
