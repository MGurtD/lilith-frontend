import{d as C,k as V,r as _,h as T,c as k,i as d,n as f,e as w,m as E,a as B,F as i,g as F,x as I,u as N,E as g,o as h,l as v,q as R,P as $}from"./index-f6af8c81.js";import{u as A}from"./customers-bf96fe43.js";import{c as D,a as b,F as M}from"./form-validator-ec7c2535.js";const S={key:0},q={class:"mt-2"},L=C({__name:"FormCustomerType",props:{customerType:{}},emits:["submit","cancel"],setup(y,{emit:n}){const l=y,u=V(),m=D().shape({name:b().required("El nom és obligatori").max(250,"El nom comercial no pot superar els 250 carácters"),description:b().required("La descripció és obligatori").max(250,"La descripció no pot superar els 250 carácters")}),e=_({result:!1,errors:{}}),c=()=>{const t=new M(m);e.value=t.validate(l.customerType)},p=async()=>{if(c(),e.value.result)n("submit",l.customerType);else{let t="";Object.entries(e.value.errors).forEach(a=>{t+=`${a[1].map(s=>s)}.   `}),u.add({severity:"warn",summary:"Formulari inválid",detail:t,life:5e3})}};return(t,a)=>{const s=T("BaseInput"),r=T("Button");return t.customerType?(B(),k("form",S,[d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.name}]),label:"Nom",id:"name",modelValue:t.customerType.name,"onUpdate:modelValue":a[0]||(a[0]=o=>t.customerType.name=o)},null,8,["modelValue","class"]),d(s,{class:f(["mb-2",{"p-invalid":e.value.errors.description}]),label:"Descripció",id:"description",modelValue:t.customerType.description,"onUpdate:modelValue":a[1]||(a[1]=o=>t.customerType.description=o)},null,8,["modelValue","class"]),w("div",q,[d(r,{label:"Guardar",class:"mr-2",onClick:p})])])):E("",!0)}}}),P=C({__name:"CustomerType",setup(y){const n=_(i.EDIT),l=F(),u=I(),m=N(),e=A(),{customerType:c}=g(e),p=async()=>{await e.fetchCustomerType(u.params.id);let s="";c.value?(n.value=i.EDIT,s=`Tipus de client ${c.value.name}`):(n.value=i.CREATE,e.setNewCustomerType(u.params.id),s="Alta de tipus de client"),m.setMenuItem({icon:$.BUILDING,backButtonVisible:!0,title:s})};h(async()=>{await p()});const t=V(),a=async()=>{const s=c.value;let r=!1,o="";n.value===i.CREATE?(r=await e.createCustomerType(s),o="Tipus de client creat correctament"):(r=await e.updateCustomerType(s.id,s),o="Tipus de client actualizat correctament"),r&&(t.add({severity:"success",summary:o,life:5e3}),l.back())};return(s,r)=>v(e).customerType?(B(),R(L,{key:0,customerType:v(e).customerType,onSubmit:a},null,8,["customerType"])):E("",!0)}});export{P as default};
