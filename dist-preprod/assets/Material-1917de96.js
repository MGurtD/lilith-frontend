import{_ as k}from"./TableSupplierReferences.vue_vue_type_script_setup_true_lang-8a0de7f0.js";import{d as I,r as p,F as i,x as T,g as A,u as C,E as h,o as B,P as N,k as $,c as v,l as s,i as b,m as y,e as x,q as V,N as D,a as m}from"./index-f6af8c81.js";import{u as F}from"./reference-75fb097d.js";import{u as P}from"./suppliers-473d1949.js";import{_ as z}from"./FormMaterial.vue_vue_type_script_setup_true_lang-69ac9085.js";import"./DropdownReference.vue_vue_type_script_setup_true_lang-b6b545e0.js";import"./form-validator-ec7c2535.js";import"./suppliers.service-f3c59018.js";import"./DropdownReferenceType.vue_vue_type_script_setup_true_lang-b802c504.js";import"./referenceType-942d6c6d.js";import"./tax-320212e0.js";import"./index-d3847f4f.js";import"./plantmodel-2dcc063a.js";import"./index-5443ddc0.js";import"./index-7cbe1881.js";const U={key:0},j={class:"mt-4"},se=I({__name:"Material",setup(q){const o=p(i.EDIT),f=T(),_=A(),S=C(),R=P(),t=F(),{reference:a}=h(t),c=p(""),n=p({});B(async()=>{c.value=f.params.id,n.value=t.referenceCategories.find(e=>e.code===f.params.category),await d()});const d=async()=>{R.fetchSuppliers(),t.fetchReferenceSuppliers(c.value),await t.fetchReference(c.value);let e="";a.value?(o.value=i.EDIT,e=`${n.value.description} ${a.value.code} - ${a.value.description}`):(o.value=i.CREATE,t.setNewReference(c.value,n.value.code),e=`Alta ${n.value.description}`),S.setMenuItem({icon:N.BUILDING,backButtonVisible:!0,title:e})},l=$(),E=async()=>{const e=a.value;let r=!1,u="";o.value===i.CREATE?(r=await t.createReference(e),r?u="Material creat correctament":u="El material ja existeix"):(r=await t.updateReference(e.id,e),u="Material actualizada correctament"),l.add({severity:r?"success":"warn",summary:u,life:5e3}),r&&(o.value===i.CREATE?d():_.back())},w=async e=>{await t.addSupplier(e)&&l.add({severity:"success",summary:"Referència afegida",life:5e3})},M=async e=>{await t.updateSupplier(e)&&l.add({severity:"success",summary:"Referència actualizada",life:5e3})},g=async e=>{await t.deleteSupplier(e)&&l.add({severity:"success",summary:"Referència eliminada",life:5e3})};return(e,r)=>(m(),v(D,null,[s(a)?(m(),v("section",U,[b(z,{reference:s(a),onSubmit:E},null,8,["reference"])])):y("",!0),x("section",j,[s(a)&&s(t).referenceSuppliers?(m(),V(k,{key:0,title:"Proveïdors",referenceId:s(a).id,"supplier-references":s(t).referenceSuppliers,formActionMode:o.value,onCreate:w,onUpdate:M,onDelete:g},null,8,["referenceId","supplier-references","formActionMode"])):y("",!0)])],64))}});export{se as default};
