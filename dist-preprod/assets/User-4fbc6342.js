import{d as A,j as _,u as M,r as f,k as F,h as U,c as I,e as t,i as o,n as N,t as P,l as k,L as z,m as R,q as C,s as E,p as T,b as j,a as g,v as q,f as G,g as W,x as H,o as J,P as K,R as Q,U as X,A as Y}from"./index-f6af8c81.js";import{c as Z,a as B,b as x,F as ee}from"./form-validator-ec7c2535.js";const se=c=>(T("data-v-3f381162"),c=c(),j(),c),ae=["onSubmit"],le={class:"two-columns"},oe={class:"block text-900 mb-2"},re={class:"three-columns"},te={class:"block text-900 mb-2"},ne={key:0,class:"form-user-changepassword"},ue=se(()=>t("label",{class:"block mb-2",style:{color:"#fff"}},"...",-1)),ie={class:"mt-2"},de=A({__name:"FormUser",props:{roles:{},user:{}},emits:["submit","change-password"],setup(c,{emit:V}){const p=c,{t:l}=_(),n=M(),b=f(!1),u=f(""),i=f(""),$=F(),w=Z().shape({username:B().required(l("forms.user.validation.usernameRequired")).max(250,l("forms.user.validation.usernameMax")),firstName:B().required(l("forms.user.validation.firstNameRequired")).max(250,l("forms.user.validation.firstNameMax")),lastName:B().required(l("forms.user.validation.lastNameRequired")).max(250,l("forms.user.validation.lastNameMax")),disabled:x().required()}),r=f({result:!1,errors:{}}),S=()=>{const e=new ee(w);r.value=e.validate(p.user)},d=e=>{const s=p.user;s.disabled=e,v()},v=async()=>{if(S(),r.value.result)V("submit",p.user);else{let e="";Object.entries(r.value.errors).forEach(s=>{e+=`${s[1].map(m=>m)}.   `}),$.add({severity:"warn",summary:l("forms.user.validation.invalidForm"),detail:e,life:5e3})}},h=()=>{b.value=!0},D=()=>{var s;if(!(u.value.length>4==i.value.length>4&&u.value===i.value)){$.add({severity:"warn",summary:l("forms.user.validation.invalidPassword"),detail:l("forms.user.validation.invalidPasswordDetail")});return}V("change-password",{username:(s=p.user)==null?void 0:s.username,password:u.value})};return(e,s)=>{var L;const m=U("BaseInput"),O=U("Dropdown"),y=U("Button");return e.user?(g(),I("form",{key:0,onSubmit:E(v,["prevent"])},[t("section",le,[o(m,{id:"username",class:N(["mb-2",{"p-invalid":r.value.errors.email}]),label:e.$t("forms.user.usernameLabel"),modelValue:e.user.username,"onUpdate:modelValue":s[0]||(s[0]=a=>e.user.username=a),disabled:"true"},null,8,["label","modelValue","class"]),t("div",null,[t("label",oe,P(e.$t("forms.user.roleLabel")),1),o(O,{modelValue:e.user.roleId,"onUpdate:modelValue":s[1]||(s[1]=a=>e.user.roleId=a),editable:"",options:e.roles,optionValue:"id",optionLabel:"name",class:N(["w-full",{"p-invalid":r.value.errors.city}])},null,8,["modelValue","options","class"])])]),t("section",re,[o(m,{id:"firstName",class:N(["mb-2",{"p-invalid":r.value.errors.firstName}]),label:e.$t("forms.user.firstNameLabel"),modelValue:e.user.firstName,"onUpdate:modelValue":s[2]||(s[2]=a=>e.user.firstName=a)},null,8,["label","modelValue","class"]),o(m,{id:"lastName",class:N(["mb-2",{"p-invalid":r.value.errors.lastName}]),label:e.$t("forms.user.lastNameLabel"),modelValue:e.user.lastName,"onUpdate:modelValue":s[3]||(s[3]=a=>e.user.lastName=a)},null,8,["label","modelValue","class"]),t("div",null,[t("label",te,P(e.$t("forms.user.languageLabel")),1),o(z,{modelValue:e.user.preferredLanguage,"onUpdate:modelValue":s[4]||(s[4]=a=>e.user.preferredLanguage=a),changeAppLanguage:((L=k(n).user)==null?void 0:L.id)===e.user.id},null,8,["modelValue","changeAppLanguage"])])]),b.value===!0?(g(),I("section",ne,[o(m,{type:k(q).PASSWORD,id:"passwordOne",class:"mb-2 w-full",label:e.$t("forms.user.passwordLabel"),modelValue:u.value,"onUpdate:modelValue":s[5]||(s[5]=a=>u.value=a)},null,8,["type","label","modelValue"]),o(m,{type:k(q).PASSWORD,id:"passwordTwo",class:"mb-2",label:e.$t("forms.user.passwordRepeatLabel"),modelValue:i.value,"onUpdate:modelValue":s[6]||(s[6]=a=>i.value=a)},null,8,["type","label","modelValue"]),t("div",null,[ue,o(y,{label:e.$t("forms.user.modifyButton"),class:"mr-2",onClick:D},null,8,["label"])])])):R("",!0),t("div",ie,[o(y,{type:"submit",label:e.$t("forms.user.saveButton"),class:"mr-2"},null,8,["label"]),e.user.disabled?(g(),C(y,{key:0,severity:"success",label:e.$t("forms.user.activateButton"),class:"mr-2",onClick:s[7]||(s[7]=a=>d(!1))},null,8,["label"])):(g(),C(y,{key:1,label:e.$t("forms.user.deactivateButton"),severity:"danger",class:"mr-2",onClick:s[8]||(s[8]=a=>d(!0))},null,8,["label"])),o(y,{severity:"secondary",label:e.$t("forms.user.changePasswordButton"),class:"mr-2",onClick:h},null,8,["label"])])],40,ae)):R("",!0)}}});const me=G(de,[["__scopeId","data-v-3f381162"]]),ve=A({__name:"User",setup(c){const V=W(),p=H(),l=M(),n=f(void 0),b=f(),u=new Q,i=new X,$=async()=>{n.value=await i.GetById(p.params.id),b.value=await u.GetAll(),n.value&&l.setMenuItem({icon:K.USER,title:`Usuari ${n.value.username}`,backButtonVisible:!0})};J(async()=>{await $()});const w=F(),r=async()=>{const d=n.value;let v="Usuari actualizat correctament";await i.Update(d)&&(w.add({severity:"success",summary:v,life:5e3}),V.back())},S=async d=>{await new Y().ChangePassword(d)?w.add({severity:"success",summary:"Canvi de contrasenya",detail:"Contrasenya actualitzada",life:1e4}):w.add({severity:"error",summary:"Canvi de contrasenya",detail:"Error al actualitzar contrasenya",life:1e4})};return(d,v)=>(g(),C(me,{roles:b.value,user:n.value,onChangePassword:S,onSubmit:r},null,8,["roles","user"]))}});export{ve as default};
