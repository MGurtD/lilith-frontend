import{_ as $}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-71eec8fe.js";import{d as q,k as O,z as Y,g as j,u as z,a4 as A,r as H,o as J,P as h,a5 as G,T as k,h as I,c as w,i as a,w as l,l as n,a as S,e as u,I as f,t as v,J as D,n as K,m as Q,C as W}from"./index-f6af8c81.js";import{u as X,a as Z}from"./purchaseInvoices-47991771.js";import{u as ee}from"./lifecycle-b04b6c31.js";import"./index-d3847f4f.js";import"./suppliers.service-f3c59018.js";const te={class:"flex flex-wrap align-items-center justify-content-between gap-2"},se={class:"datatable-filter"},ae={class:"filter-field"},re={class:"filter-field"},ie=u("label",{class:"block text-900 mb-2"},"Proveïdor",-1),ce={class:"datatable-buttons"},oe=["onClick"],ne="PurchaseInvoice",le="temges.purchaseinvoice.filter",_e=q({__name:"PurchaseInvoices",setup(de){const y=O(),C=Y(),x=j(),r=z(),b=A(),g=ee(),p=X(),m=Z(),d=H({supplierId:void 0,exercise:void 0});J(async()=>{r.setMenuItem({icon:h.MONEY_BILL,title:"Factures de compra"}),await g.fetchOneByName(ne),await p.fetchMasterData(),F(),N(),await _()}),G(()=>{const e={...d.value,exercisePicker:r.exercisePicker};b.addFilter("PurchaseInvoices","",e)});const N=()=>{const e=b.getFilter("PurchaseInvoices","");e&&(d.value.supplierId=e.supplierId,e.exercisePicker&&(r.exercisePicker.exercise=e.exercisePicker.exercise,r.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},F=()=>{var i;const e=new Date().getFullYear().toString(),t=(i=p.masterData.exercises)==null?void 0:i.find(c=>c.name===e);t&&(r.exercisePicker.exercise=t,r.exercisePicker.dates=[new Date(r.exercisePicker.exercise.startDate),new Date(r.exercisePicker.exercise.endDate)])},E=()=>{r.cleanExercisePicker(),d.value.supplierId=void 0},_=async()=>{if(r.exercisePicker.dates){const e=k(r.exercisePicker.dates[0]),t=k(r.exercisePicker.dates[1]);await m.GetFiltered(e,t,void 0,void 0,d.value.supplierId),localStorage.setItem(le,JSON.stringify(d.value))}else y.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},T=e=>{var i;const t=(i=p.masterData.suppliers)==null?void 0:i.find(c=>c.id===e);return t?t.comercialName:""},P=e=>{var i,c;const t=(c=(i=g.lifecycle)==null?void 0:i.statuses)==null?void 0:c.find(o=>o.id===e);return t?t.name:""},B=e=>e.purchaseInvoiceDueDates?e.purchaseInvoiceDueDates.length===0?D(e.purchaseInvoiceDate):D(e.purchaseInvoiceDueDates[e.purchaseInvoiceDueDates.length-1].dueDate):"",L=()=>{x.push({path:`/purchaseInvoice/${W()}`})},V=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||x.push({path:`/purchaseinvoice/${e.data.id}`})},M=(e,t)=>{C.require({target:e.currentTarget,message:`Està segur que vol eliminar la factura ${t.number}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await m.Delete(t.id)&&(y.add({severity:"success",summary:"Eliminada",life:3e3}),await _())}})};return(e,t)=>{const i=I("Dropdown"),c=I("Button"),o=I("Column"),R=I("DataTable");return S(),w("div",null,[a(R,{class:"p-datatable-sm small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:n(m).purchaseInvoices&&n(m).purchaseInvoices.length>20,rows:20,sortMode:"multiple",value:n(m).purchaseInvoices,onRowClick:V},{header:l(()=>[u("div",te,[u("div",se,[u("div",ae,[a($,{exercises:n(p).masterData.exercises,onRangeSelected:_},null,8,["exercises"])]),u("div",re,[ie,a(i,{modelValue:d.value.supplierId,"onUpdate:modelValue":t[0]||(t[0]=s=>d.value.supplierId=s),editable:"",options:n(p).masterData.suppliers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),u("div",ce,[a(c,{class:"datatable-button mr-2",icon:n(h).FILTER,rounded:"",raised:"",onClick:_},null,8,["icon"]),a(c,{class:"datatable-button mr-2",icon:n(h).FILTER_SLASH,rounded:"",raised:"",onClick:E},null,8,["icon"]),a(c,{icon:n(h).PLUS,rounded:"",raised:"",onClick:L},null,8,["icon"])])])]),default:l(()=>[a(o,{field:"number",header:"Número",sortable:!0,style:{width:"10%"}}),a(o,{header:"Data",field:"purchaseInvoiceDate",sortable:"",style:{width:"10%"}},{body:l(s=>[f(v(n(D)(s.data.purchaseInvoiceDate)),1)]),_:1}),a(o,{header:"Proveïdor",style:{width:"15%"}},{body:l(s=>[f(v(T(s.data.supplierId)),1)]),_:1}),a(o,{header:"Núm. Fra. Proveïdor",style:{width:"15%"},field:"supplierNumber"}),a(o,{header:"Estat",style:{width:"15%"}},{body:l(s=>[f(v(P(s.data.statusId)),1)]),_:1}),a(o,{header:"Venciment",style:{width:"10%"}},{body:l(s=>[f(v(B(s.data)),1)]),_:1}),a(o,{header:"Import",style:{width:"10%"}},{body:l(s=>[f(v(s.data.netAmount)+" € ",1)]),_:1}),a(o,{style:{width:"5%"}},{body:l(s=>[P(s.data.statusId)==="Nova"?(S(),w("i",{key:0,class:K([n(h).TIMES,"grid_delete_column_button"]),onClick:U=>M(U,s.data)},null,10,oe)):Q("",!0)]),_:1})]),_:1},8,["paginator","value"])])}}});export{_e as default};
