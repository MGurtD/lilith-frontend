import{d as V,g as F,u as N,E as A,j as M,x as j,r as q,T as H,o as $,P as u,O as T,h as m,m as G,w as r,k as n,a as U,e as l,i as s,H as y,R as v,G as h,I as Y,n as z,y as O}from"./index-948abaa8.js";import{u as Q}from"./expense-eac994e0.js";import{_ as W}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-8d150f3a.js";import"./index-76940908.js";import"./suppliers.service-0e59a7bd.js";const J={class:"flex flex-wrap align-items-center justify-content-between gap-2"},K={class:"datatable-filter"},X={class:"filter-field"},Z={class:"filter-field"},ee=l("label",{class:"block text-900 mb-2"},"Tipus",-1),te={class:"datatable-buttons"},se=["onClick"],ae={class:"flex-right"},de=V({__name:"Expenses",setup(ne){const b=F(),o=N(),x=A(),i=Q(),w=M(),E=j(),_=q({expenseTypeId:void 0}),g=H(()=>{let e=0;return i.expenses&&i.expenses.forEach(t=>e+=t.amount),e});$(async()=>{o.setMenuItem({icon:u.WALLET,title:"Gestió de despeses"}),await i.fetchExpenseTypes(),x.exercises||await x.fetchActive(),k(),f()});const f=async()=>{if(o.exercisePicker.dates){const e=T(o.exercisePicker.dates[0]),t=T(o.exercisePicker.dates[1]);await i.fetchExpenses(e,t,_.value.expenseTypeId)}},k=()=>{var c;const e=new Date().getFullYear().toString(),t=(c=x.exercises)==null?void 0:c.find(d=>d.name===e);t&&(o.exercisePicker.exercise=t,o.exercisePicker.dates=[new Date(o.exercisePicker.exercise.startDate),new Date(o.exercisePicker.exercise.endDate)])},C=async()=>{_.value.expenseTypeId="",o.cleanExercisePicker()},D=()=>{b.push({path:`/expense/${O()}`})},I=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||b.push({path:`/expense/${e.data.id}`})},S=(e,t)=>{E.require({target:e.currentTarget,message:"Està segur que vol eliminar la despesa?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await i.deleteExpense(t.id)&&(w.add({severity:"success",summary:"Eliminat",life:3e3}),await f())}})},P=e=>{var c;const t=(c=i.expenseTypes)==null?void 0:c.find(d=>d.id===e);return t?t.name:""};return(e,t)=>{const c=m("Dropdown"),d=m("Button"),p=m("Column"),B=m("BooleanColumn"),L=m("DataTable");return U(),G(L,{value:n(i).expenses,class:"p-datatable-sm small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"multiple",onRowClick:I},{header:r(()=>[l("div",J,[l("div",K,[l("div",X,[s(W,{exercises:n(x).exercises,onRangeSelected:f},null,8,["exercises"])]),l("div",Z,[ee,s(c,{modelValue:_.value.expenseTypeId,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value.expenseTypeId=a),editable:"",options:n(i).expenseTypes,optionValue:"id",optionLabel:"name",class:"w-full"},null,8,["modelValue","options"])])]),l("div",te,[s(d,{class:"datatable-button mr-2",icon:n(u).FILTER,rounded:"",raised:"",onClick:f},null,8,["icon"]),s(d,{class:"datatable-button mr-2",icon:n(u).FILTER_SLASH,rounded:"",raised:"",onClick:C},null,8,["icon"]),s(d,{icon:n(u).PLUS,rounded:"",raised:"",onClick:D},null,8,["icon"])])])]),footer:r(()=>[l("div",ae," Total "+y(n(v)(g.value)),1)]),default:r(()=>[s(p,{header:"Tipus",style:{width:"15%"}},{body:r(a=>[h(y(P(a.data.expenseTypeId)),1)]),_:1}),s(p,{field:"description",header:"Descripció",style:{width:"40%"},sortable:""}),s(p,{field:"paymentDate",header:"Data pagament",style:{width:"20%"},sortable:""},{body:r(a=>[h(y(n(Y)(a.data.paymentDate)),1)]),_:1}),s(p,{field:"amount",header:"Import",style:{width:"15%"}},{body:r(a=>[h(y(n(v)(a.data.amount)),1)]),_:1}),s(p,{header:"Recurrent",style:{width:"10%"}},{body:r(a=>[s(B,{value:a.data.recurring,showColor:!1},null,8,["value"])]),_:1}),s(p,null,{body:r(a=>[l("i",{class:z([n(u).TIMES,"grid_delete_column_button"]),onClick:R=>S(R,a.data)},null,10,se)]),_:1})]),_:1},8,["value"])}}});export{de as default};
