import{_ as k}from"./TableSupplierReferences.vue_vue_type_script_setup_true_lang-c4db351f.js";import{d as C,r as p,F as c,v as I,g as T,u as A,C as h,o as B,P as $,j as b,c as v,k as s,i as N,l as y,e as V,m as x,L as D,a as f}from"./index-948abaa8.js";import{u as F}from"./reference-1627cbd8.js";import{u as P}from"./suppliers-88f14793.js";import{_ as j}from"./FormMaterial.vue_vue_type_script_setup_true_lang-517415af.js";import"./DropdownReference.vue_vue_type_script_setup_true_lang-5372ed8c.js";import"./form-validator-ae6c613c.js";import"./suppliers.service-0e59a7bd.js";import"./DropdownReferenceType.vue_vue_type_script_setup_true_lang-81f6ea9c.js";import"./referenceType-c49cdfdc.js";import"./tax-635ce292.js";import"./index-7cbe1881.js";const z={key:0},L={class:"mt-4"},te=C({__name:"Material",setup(U){const o=p(c.EDIT),m=I(),_=T(),S=A(),R=P(),t=F(),{reference:r}=h(t),i=p(""),n=p({});B(async()=>{i.value=m.params.id,n.value=t.referenceCategories.find(e=>e.code===m.params.category),await d()});const d=async()=>{R.fetchSuppliers(),t.fetchReferenceSuppliers(i.value),await t.fetchReference(i.value);let e="";r.value?(o.value=c.EDIT,e=`${n.value.description} ${r.value.code} - ${r.value.description}`):(o.value=c.CREATE,t.setNewReference(i.value,n.value.code),e=`Alta ${n.value.description}`),S.setMenuItem({icon:$.BUILDING,backButtonVisible:!0,title:e})},l=b(),w=async()=>{const e=r.value;let a=!1,u="";o.value===c.CREATE?(a=await t.createReference(e),a?u="Material creat correctament":u="El material ja existeix"):(a=await t.updateReference(e.id,e),u="Material actualizada correctament"),l.add({severity:a?"success":"warn",summary:u,life:5e3}),a&&(o.value===c.CREATE?d():_.back())},E=async e=>{await t.addSupplier(e)&&l.add({severity:"success",summary:"Referència afegida",life:5e3})},M=async e=>{await t.updateSupplier(e)&&l.add({severity:"success",summary:"Referència actualizada",life:5e3})},g=async e=>{await t.deleteSupplier(e)&&l.add({severity:"success",summary:"Referència eliminada",life:5e3})};return(e,a)=>(f(),v(D,null,[s(r)?(f(),v("section",z,[N(j,{reference:s(r),onSubmit:w},null,8,["reference"])])):y("",!0),V("section",L,[s(r)&&s(t).referenceSuppliers?(f(),x(k,{key:0,title:"Proveïdors",referenceId:s(r).id,"supplier-references":s(t).referenceSuppliers,formActionMode:o.value,onCreate:E,onUpdate:M,onDelete:g},null,8,["referenceId","supplier-references","formActionMode"])):y("",!0)])],64))}});export{te as default};
