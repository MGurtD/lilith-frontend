import{_ as z}from"./ExerciseDatePicker.vue_vue_type_script_setup_true_lang-ee3a833e.js";import{_ as J}from"./FormCreateOrderOrInvoice.vue_vue_type_script_setup_true_lang-85d4d11b.js";import{d as K,g as Q,j as Z,x as W,u as X,Y as ee,r as C,K as te,o as se,P as f,Z as ae,O as N,h as v,c as P,i as a,w as d,k as c,L as re,a as F,e as m,G as y,H as x,I as E,n as ie,l as oe,J as ce}from"./index-feaddf7a.js";import{u as ne}from"./reference-df7bd263.js";import{u as le}from"./customers-ea915896.js";import{u as de}from"./lifecycle-81a129dd.js";import{u as ue}from"./deliveryNote-71cca67e.js";import{u as me}from"./masterData-4a7f43d3.js";import"./form-validator-06627164.js";import"./index-c017e3e4.js";const fe={class:"flex flex-wrap align-items-center justify-content-between gap-2"},ve={class:"datatable-filter"},_e={class:"filter-field"},pe={class:"filter-field"},be=m("label",{class:"block text-900 mb-2"},"Client",-1),ye={class:"datatable-buttons"},xe=["onClick"],Ee=K({__name:"DeliveryNotes",setup(he){const w=Q(),k=Z(),R=W(),r=X(),g=ee(),h=me(),_=ue(),B=ne(),D=le(),I=de(),n=C({customerId:void 0,referenceId:void 0}),u=te({visible:!1,title:"Crear albarà",closable:!0,position:"center",modal:!0});se(async()=>{I.fetchOneByName("DeliveryNote"),B.fetchReferences(),D.fetchCustomers(),await h.fetchMasterData(),L(),T(),await b(),r.setMenuItem({icon:f.APPLE,title:"Albarans d'entrega"})}),ae(()=>{const e={referenceId:n.value.referenceId,customerId:n.value.customerId,exercisePicker:r.exercisePicker};g.addFilter("DeliveryNotes","",e)});const T=()=>{const e=g.getFilter("DeliveryNotes","");e&&(n.value.referenceId=e.referenceId,n.value.customerId=e.customerId,e.exercisePicker&&(r.exercisePicker.exercise=e.exercisePicker.exercise,r.exercisePicker.dates=[new Date(e.exercisePicker.dates[0]),new Date(e.exercisePicker.dates[1])]))},L=()=>{var i;const e=new Date().getFullYear().toString(),t=(i=h.exercises)==null?void 0:i.find(o=>o.name===e);t&&(r.exercisePicker.exercise=t,r.exercisePicker.dates=[new Date(r.exercisePicker.exercise.startDate),new Date(r.exercisePicker.exercise.endDate)])},V=()=>{r.cleanExercisePicker(),n.value.customerId=void 0},p=C({}),q=()=>({id:ce(),customerId:"",exerciseId:"",date:new Date}),U=()=>{p.value=q(),u.visible=!0},b=async()=>{if(r.exercisePicker.dates){const e=N(r.exercisePicker.dates[0]),t=N(r.exercisePicker.dates[1]);await _.GetFiltered(e,t,n.value.customerId)}else k.add({severity:"info",summary:"Filtre invàlid",detail:"Seleccioni un període",life:5e3})},M=e=>{var i,o;const t=(o=(i=I.lifecycle)==null?void 0:i.statuses)==null?void 0:o.find(l=>l.id===e);return t?t.name:""},O=e=>{var i;const t=(i=D.customers)==null?void 0:i.find(o=>o.id===e);return t?t.comercialName:""},$=async()=>{u.visible=!1,await _.Create(p.value)&&w.push({path:`/deliverynote/${p.value.id}`})},j=e=>{e.originalEvent.target.className.includes("grid_delete_column_button")||w.push({path:`/deliverynote/${e.data.id}`})},A=(e,t)=>{R.require({message:"Està segur que vol eliminar l'albarà?",icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{await _.Delete(t.id)&&(k.add({severity:"success",summary:"Eliminada",life:3e3}),await b())}})};return(e,t)=>{const i=v("Dropdown"),o=v("Button"),l=v("Column"),H=v("DataTable"),Y=v("Dialog");return F(),P(re,null,[a(H,{value:c(_).deliveryNotes,class:"small-datatable",tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",sortMode:"single",sortField:"number","sort-order":1,paginator:"",rows:12,onRowClick:j},{header:d(()=>[m("div",fe,[m("div",ve,[m("div",_e,[a(z,{exercises:c(h).exercises,onRangeSelected:b},null,8,["exercises"])]),m("div",pe,[be,a(i,{modelValue:n.value.customerId,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.customerId=s),editable:"",options:c(D).customers,optionValue:"id",optionLabel:"comercialName",class:"w-full"},null,8,["modelValue","options"])])]),m("div",ye,[a(o,{class:"datatable-button mr-2",icon:c(f).FILTER,rounded:"",raised:"",onClick:b},null,8,["icon"]),a(o,{class:"datatable-button mr-2",icon:c(f).FILTER_SLASH,rounded:"",raised:"",onClick:V},null,8,["icon"]),a(o,{icon:c(f).PLUS,rounded:"",raised:"",onClick:U},null,8,["icon"])])])]),default:d(()=>[a(l,{field:"number",header:"Número",sortable:"",style:{width:"15%"}}),a(l,{field:"createdOn",header:"Data Creació",sortable:"",style:{width:"15%"}},{body:d(s=>[y(x(c(E)(s.data.createdOn)),1)]),_:1}),a(l,{header:"Data Entrega",style:{width:"15%"}},{body:d(s=>[y(x(s.data.deliveryDate?c(E)(s.data.deliveryDate):""),1)]),_:1}),a(l,{header:"Client",style:{width:"30%"}},{body:d(s=>[y(x(O(s.data.customerId)),1)]),_:1}),a(l,{header:"Estat",style:{width:"30%"}},{body:d(s=>[y(x(M(s.data.statusId)),1)]),_:1}),a(l,{style:{width:"5%"}},{body:d(s=>{var S;return[s.data.statusId===((S=c(I).lifecycle)==null?void 0:S.initialStatusId)?(F(),P("i",{key:0,class:ie([c(f).TIMES,"grid_delete_column_button"]),onClick:G=>A(G,s.data)},null,10,xe)):oe("",!0)]}),_:1})]),_:1},8,["value"]),a(Y,{visible:u.visible,"onUpdate:visible":t[1]||(t[1]=s=>u.visible=s),header:u.title,closable:u.closable,modal:u.modal},{default:d(()=>[a(J,{"create-request":p.value,onSubmit:$},null,8,["create-request"])]),_:1},8,["visible","header","closable","modal"])],64)}}});export{Ee as default};
