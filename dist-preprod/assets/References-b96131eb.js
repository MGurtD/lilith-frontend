import{d as k,a4 as M,r as $,o as B,a5 as T,Y as q,h as v,q as x,w as d,a as D,e as n,i as a,D as g,l as f,P as h,t as w,I as S,W as V,n as P,p as j,b as z,f as F,g as A,u as H,z as K,k as W,K as Y}from"./index-f6af8c81.js";import{u as G}from"./reference-75fb097d.js";import{_ as J}from"./DropdownCustomers.vue_vue_type_script_setup_true_lang-0951f83c.js";import{u as O}from"./customers-bf96fe43.js";const R=i=>(j("data-v-61c02954"),i=i(),z(),i),Q={class:"flex flex-wrap align-items-center justify-content-between gap-2"},X={class:"datatable-filter-3"},Z={class:"filter-field"},ee=R(()=>n("label",null,"Codi",-1)),te={class:"filter-field"},se=R(()=>n("label",null,"Descripció",-1)),oe={class:"filter-field"},ae=R(()=>n("label",null,"Client",-1)),ne={class:"datatable-buttons"},le=["onClick"],re=k({__name:"TableReferences",props:{references:{}},emits:["add","edit","delete"],setup(i,{emit:u}){const p=i,c=M(),y=O(),e=$({code:"",description:"",customerId:""});B(()=>{const t=c.getFilter("References","");t&&(t.code&&(e.value.code=t.code),t.customerId&&(e.value.customerId=t.customerId))}),T(async()=>{await c.addFilter("References","",e.value)});const C=()=>{e.value.code="",e.value.customerId=""},b=q(()=>{if(!p.references)return[];let t=p.references;return e.value.customerId&&e.value.customerId.length>0&&(t=t.filter(s=>s.customerId===e.value.customerId)),e.value.code&&e.value.code.length>0&&(t=t.filter(s=>s.code.toLowerCase().includes(e.value.code.toLowerCase()))),e.value.description&&e.value.description.length>0&&(t=t.filter(s=>s.description.toLowerCase().includes(e.value.description.toLowerCase()))),t}),I=()=>{u("add")},r=t=>{t.originalEvent.target.className.includes("grid_delete_column_button")||u("edit",t.data)},_=(t,s)=>{u("delete",s)},L=t=>{var m;const s=(m=y.customers)==null?void 0:m.find(l=>l.id===t);return s?s.comercialName:""};return(t,s)=>{const m=v("Button"),l=v("Column"),U=v("BooleanColumn"),E=v("DataTable");return D(),x(E,{value:b.value,tableStyle:"min-width: 100%",scrollable:"",scrollHeight:"80vh",paginator:"",rows:12,onRowClick:r},{header:d(()=>[n("div",Q,[n("div",X,[n("div",Z,[ee,a(g,{modelValue:e.value.code,"onUpdate:modelValue":s[0]||(s[0]=o=>e.value.code=o)},null,8,["modelValue"])]),n("div",te,[se,a(g,{modelValue:e.value.description,"onUpdate:modelValue":s[1]||(s[1]=o=>e.value.description=o)},null,8,["modelValue"])]),n("div",oe,[ae,a(J,{label:"",modelValue:e.value.customerId,"onUpdate:modelValue":s[2]||(s[2]=o=>e.value.customerId=o)},null,8,["modelValue"])])]),n("div",ne,[a(m,{class:"datatable-button mr-2",icon:f(h).FILTER_SLASH,rounded:"",raised:"",onClick:C},null,8,["icon"]),a(m,{class:"datatable-button mr-2",icon:f(h).PLUS,rounded:"",raised:"",onClick:I},null,8,["icon"])])])]),default:d(()=>[a(l,{field:"code",header:"Codi",style:{width:"15%"}}),a(l,{field:"description",header:"Descripció",style:{width:"35%"}}),a(l,{field:"version",header:"Versió",style:{width:"10%"}}),a(l,{field:"customerId",header:"Client",style:{width:"20%"}},{body:d(o=>[n("span",null,w(L(o.data.customerId)),1)]),_:1}),a(l,{field:"price",header:"Preu",style:{width:"10%"}},{body:d(o=>[S(w(f(V)(o.data.price)),1)]),_:1}),a(l,{field:"cost",header:"Cost",style:{width:"10%"}},{body:d(o=>[S(w(f(V)(o.data.workMasterCost)),1)]),_:1}),a(l,{header:"Servei",style:{width:"10%"}},{body:d(o=>[a(U,{value:o.data.isService},null,8,["value"])]),_:1}),a(l,{style:{width:"10%"}},{body:d(o=>[n("i",{class:P([f(h).TIMES,"grid_delete_column_button"]),onClick:N=>_(N,o.data)},null,10,le)]),_:1})]),_:1},8,["value"])}}});const ce=F(re,[["__scopeId","data-v-61c02954"]]),de=k({__name:"References",setup(i){const u=A(),p=H(),c=G(),y=K(),e=W();B(async()=>{let r="Referencies de venta";p.setMenuItem({icon:h.TICKET,title:r}),await c.fetchReferencesByModule("sales")}),T(()=>{c.references=void 0});const C=()=>{u.push({path:`/sales/reference/${Y()}`})},b=r=>{u.push({path:`/sales/reference/${r.id}`})},I=r=>{y.require({message:`Está segur que vol eliminar la refèrencia ${r.description}?`,icon:"pi pi-question-circle",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times",accept:async()=>{const _=await c.deleteReference(r.id);_.result?e.add({severity:"success",summary:"Referencia eliminada correctament",life:5e3}):e.add({severity:"warn",summary:_.errors[0],life:5e3,closable:!0})}})};return(r,_)=>(D(),x(ce,{references:f(c).references,onAdd:C,onEdit:b,onDelete:I},null,8,["references"]))}});const me=F(de,[["__scopeId","data-v-13735ff7"]]);export{me as default};
