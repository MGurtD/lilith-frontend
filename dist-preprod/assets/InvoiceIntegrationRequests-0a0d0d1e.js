import{a8 as M,aa as Q,a as g,c as y,q as j,a9 as h,aC as z,m as V,V as F,e as n,t as l,d as G,j as J,k as O,u as Y,P as A,E as H,r as k,Y as N,$ as W,o as X,h as S,i as r,w as u,l as m,aG as B,aI as Z,I as R,J as P,aJ as T,p as ee,b as te,f as ae}from"./index-f6af8c81.js";import{u as se}from"./verifactu-fb627a8b.js";var oe={root:function(p){var d=p.props;return["p-tag p-component",{"p-tag-info":d.severity==="info","p-tag-success":d.severity==="success","p-tag-warning":d.severity==="warning","p-tag-danger":d.severity==="danger","p-tag-secondary":d.severity==="secondary","p-tag-contrast":d.severity==="contrast","p-tag-rounded":d.rounded}]},icon:"p-tag-icon",value:"p-tag-value"},ne=M.extend({name:"tag",classes:oe}),re={name:"BaseTag",extends:Q,props:{value:null,severity:null,rounded:Boolean,icon:String},style:ne,provide:function(){return{$parentInstance:this}}},x={name:"Tag",extends:re,inheritAttrs:!1};function le(o,p,d,$,b,C){return g(),y("span",h({class:o.cx("root")},o.ptmi("root")),[o.$slots.icon?(g(),j(z(o.$slots.icon),h({key:0,class:o.cx("icon")},o.ptm("icon")),null,16,["class"])):o.icon?(g(),y("span",h({key:1,class:[o.cx("icon"),o.icon]},o.ptm("icon")),null,16)):V("",!0),o.value||o.$slots.default?F(o.$slots,"default",{key:2},function(){return[n("span",h({class:o.cx("value")},o.ptm("value")),l(o.value),17)]}):V("",!0)],16)}x.render=le;const ie=o=>(ee("data-v-2ada44d8"),o=o(),te(),o),ce={class:"verifactu-integration-requests"},ue={class:"flex flex-wrap align-items-center justify-content-between gap-1"},de={class:"datatable-filter flex gap-3 flex-wrap"},me={class:"flex align-items-center gap-2"},pe={class:"auto-width-label"},fe={class:"flex align-items-center gap-2"},ge={class:"auto-width-label"},ye={class:"datatable-buttons"},he={class:"p-input-icon-left"},be={class:"font-semibold"},ve={class:"flex items-center gap-2"},qe=["title"],_e={class:"flex items-center gap-2"},Re=["title"],$e=["src","onClick"],Ce={key:1},Ie={class:"text-center p-4"},De=ie(()=>n("i",{class:"pi pi-inbox text-4xl text-gray-400 mb-3"},null,-1)),we={class:"text-gray-500"},Ve=G({__name:"InvoiceIntegrationRequests",setup(o){const{t:p}=J(),d=O(),$=Y(),b=se();$.setMenuItem({title:p("verifactu.integrationRequests.title"),icon:A.HISTORY});const{integrationsBetweenDates:C,loading:U}=H(b),i=k({fromDate:null,toDate:null}),v=k(""),I=N(()=>(C.value||[]).flatMap(e=>((e==null?void 0:e.verifactuRequests)||(e==null?void 0:e.VerifactuRequests)||(e==null?void 0:e.salesInvoiceVerifactuRequests)||(e==null?void 0:e.SalesInvoiceVerifactuRequests)||[]).map((s,a)=>({rowKey:`${(e==null?void 0:e.id)||(e==null?void 0:e.invoiceId)||"inv"}-${(s==null?void 0:s.id)||a}`,invoiceId:(e==null?void 0:e.id)||(e==null?void 0:e.invoiceId),invoiceNumber:e==null?void 0:e.invoiceNumber,customerComercialName:(e==null?void 0:e.customerComercialName)||(e==null?void 0:e.customerTaxName)||"",timestampResponse:s==null?void 0:s.timestampResponse,request:s==null?void 0:s.request,success:s==null?void 0:s.success,status:s==null?void 0:s.status,response:s==null?void 0:s.response,qrCodeUrl:s==null?void 0:s.qrCodeUrl,qrCodeBase64:s==null?void 0:s.qrCodeBase64})))),E=N(()=>{const t=(v.value||"").toLowerCase().trim();return t?I.value.filter(e=>{const c=(e.invoiceNumber||"").toString().toLowerCase(),s=(e.customerComercialName||"").toString().toLowerCase();return c.includes(t)||s.includes(t)}):I.value}),q=()=>{const{fromDate:t,toDate:e}=i.value;return!!t&&!!e&&t<=e},_=async()=>{if(q())try{await b.GetIntegrationsBetweenDates(i.value.fromDate,i.value.toDate)}catch(t){console.error("Error loading integration requests:",t),d.add({severity:"error",summary:p("common.error"),detail:p("verifactu.integrationRequests.messages.loadError"),life:5e3})}},D=()=>{q()&&_()};W(()=>[i.value.fromDate,i.value.toDate],()=>{q()&&_()}),X(()=>{const t=new Date,e=new Date;e.setDate(t.getDate()-7),i.value.fromDate=e,i.value.toDate=t,_()});const K=t=>{t&&window.open(t,"_blank","noopener,noreferrer")};function w(t){var e;t&&((e=navigator.clipboard)==null||e.writeText(t).catch(()=>{}))}return(t,e)=>{const c=S("Column"),s=S("DataTable");return g(),y("div",ce,[r(s,{value:E.value,loading:m(U),dataKey:"rowKey",responsiveLayout:"scroll"},{header:u(()=>[n("div",ue,[n("div",de,[n("div",me,[n("label",pe,l(t.$t("verifactu.integrationRequests.filters.fromDate")),1),r(m(B),{modelValue:i.value.fromDate,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value.fromDate=a),dateFormat:"dd/mm/yy",showIcon:"",onDateSelect:D,inputId:"fromDate"},null,8,["modelValue"])]),n("div",fe,[n("label",ge,l(t.$t("verifactu.integrationRequests.filters.toDate")),1),r(m(B),{modelValue:i.value.toDate,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value.toDate=a),dateFormat:"dd/mm/yy",showIcon:"",onDateSelect:D,inputId:"toDate"},null,8,["modelValue"])])]),n("div",ye,[n("span",he,[r(m(Z),{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),placeholder:t.$t("common.search")+" â€¦",class:"w-18rem"},null,8,["modelValue","placeholder"])])])])]),empty:u(()=>[n("div",Ie,[De,n("p",we,l(t.$t("verifactu.integrationRequests.table.empty")),1)])]),default:u(()=>[r(c,{field:"invoiceNumber",header:t.$t("verifactu.integrationRequests.table.columns.invoiceNumber"),sortable:""},{body:u(a=>[n("span",be,l(a.data.invoiceNumber),1)]),_:1},8,["header"]),r(c,{field:"customerComercialName",header:t.$t("verifactu.integrationRequests.table.columns.customer"),sortable:""},{body:u(a=>[R(l(a.data.customerComercialName),1)]),_:1},8,["header"]),r(c,{field:"timestampResponse",header:t.$t("verifactu.integrationRequests.table.columns.date"),sortable:""},{body:u(a=>[R(l(m(P)(a.data.timestampResponse)),1)]),_:1},8,["header"]),r(c,{field:"request",header:t.$t("verifactu.integrationRequests.table.columns.request")},{body:u(a=>{var f;return[n("div",ve,[n("span",{class:"font-mono text-sm truncate max-w-72",title:a.data.request},l((a.data.request??"").substring(0,60))+l((((f=a.data.request)==null?void 0:f.length)||0)>60?"...":""),9,qe),r(m(T),{icon:"pi pi-copy",size:"small",text:"",rounded:"","aria-label":t.$t("verifactu.invoiceIntegration.tableInvoiceRequests.actions.copy"),onClick:L=>w(a.data.request)},null,8,["aria-label","onClick"])])]}),_:1},8,["header"]),r(c,{field:"success",header:t.$t("verifactu.integrationRequests.table.columns.success")},{body:u(a=>[r(m(x),{value:a.data.success?"OK":"ERR",severity:a.data.success?"success":"danger"},null,8,["value","severity"])]),_:1},8,["header"]),r(c,{field:"status",header:t.$t("verifactu.integrationRequests.table.columns.statusCode")},{body:u(a=>[R(l(a.data.status),1)]),_:1},8,["header"]),r(c,{field:"response",header:t.$t("verifactu.integrationRequests.table.columns.response")},{body:u(a=>{var f;return[n("div",_e,[n("span",{class:"font-mono text-sm truncate max-w-72",title:a.data.response},l((a.data.response??"").substring(0,60))+l((((f=a.data.response)==null?void 0:f.length)||0)>60?"...":""),9,Re),r(m(T),{icon:"pi pi-copy",size:"small",text:"",rounded:"","aria-label":t.$t("verifactu.invoiceIntegration.tableInvoiceRequests.actions.copy"),onClick:L=>w(a.data.response)},null,8,["aria-label","onClick"])])]}),_:1},8,["header"]),r(c,{header:t.$t("verifactu.integrationRequests.table.columns.qrCode")},{body:u(a=>[a.data.qrCodeBase64?(g(),y("img",{key:0,class:"cursor-pointer",src:a.data.qrCodeBase64,alt:"QR",style:{height:"45px"},onClick:f=>K(a.data.qrCodeUrl)},null,8,$e)):(g(),y("span",Ce,"-"))]),_:1},8,["header"])]),_:1},8,["value","loading"])])}}});const Se=ae(Ve,[["__scopeId","data-v-2ada44d8"]]);export{Se as default};
