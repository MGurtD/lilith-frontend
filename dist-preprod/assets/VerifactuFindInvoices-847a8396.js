import{d as F,h as v,q as S,w as n,a as w,e as a,V as L,i as o,t as d,l as r,W as y,I as g,an as k,p as C,b as M,f as N,k as R,u as $,a4 as A,r as B,o as E,P as f}from"./index-f6af8c81.js";import{u as U}from"./verifactu-fb627a8b.js";const H=u=>(C("data-v-63f5c799"),u=u(),M(),u),O={class:"flex justify-content-between align-items-center"},Y={class:"font-semibold"},j={class:"font-semibold"},J=["title"],q=H(()=>a("div",{class:"text-center py-4"},[a("p",null,"No s'han trobat factures per al període seleccionat")],-1)),G=F({__name:"TableVerifactuInvoices",props:{invoices:{},loading:{type:Boolean,default:!1}},setup(u){return(i,_)=>{const l=v("Column"),c=v("DataTable");return w(),S(c,{value:i.invoices,paginator:!0,rows:10,loading:i.loading,dataKey:"numSerieFactura",paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Mostrant {first} a {last} de {totalRecords} factures",responsiveLayout:"scroll",class:"p-datatable-sm"},{header:n(()=>[a("div",O,[L(i.$slots,"filter",{},void 0,!0)])]),empty:n(()=>[q]),default:n(()=>[o(l,{field:"numSerieFactura",header:"Número",sortable:""},{body:n(({data:e})=>[a("span",Y,d(e.numSerieFactura),1)]),_:1}),o(l,{field:"fechaExpedicionFactura",header:"Data expedició",sortable:""}),o(l,{field:"tipoFactura",header:"Tipus",sortable:""}),o(l,{field:"importeTotal",header:"Import total",sortable:""},{body:n(({data:e})=>[a("span",j,d(r(y)(e.importeTotal)),1)]),_:1}),o(l,{field:"cuotaTotal",header:"IVA",sortable:""},{body:n(({data:e})=>[g(d(r(y)(e.cuotaTotal)),1)]),_:1}),o(l,{field:"fechaHoraUsoRegistro",header:"Data registre",sortable:""},{body:n(({data:e})=>[g(d(r(k)(e.fechaHoraUsoRegistro)),1)]),_:1}),o(l,{header:"Huella",style:{width:"250px"}},{body:n(({data:e})=>{var p;return[a("div",{class:"text-overflow-ellipsis",title:e.huella},d((p=e.huella)==null?void 0:p.substring(0,30))+"... ",9,J)]}),_:1})]),_:3},8,["value","loading"])}}});const K=N(G,[["__scopeId","data-v-63f5c799"]]),W={class:"flex flex-wrap align-items-center justify-content-between gap-1"},z={class:"datatable-filter"},Q={class:"filter-field m-1"},X=a("label",{class:"block text-900"},"Any",-1),Z={class:"filter-field m-1"},ee=a("label",{class:"block text-900"},"Mes",-1),ae={class:"datatable-buttons",style:{"margin-left":"auto"}},le=F({__name:"VerifactuFindInvoices",setup(u){const i=R(),_=$(),l=A(),c=U(),e=B({year:void 0,month:void 0}),p=new Date().getFullYear(),V=Array.from({length:p-2023},(t,s)=>({value:2024+s,label:(2024+s).toString()})),I=[{value:1,label:"Gener"},{value:2,label:"Febrer"},{value:3,label:"Març"},{value:4,label:"Abril"},{value:5,label:"Maig"},{value:6,label:"Juny"},{value:7,label:"Juliol"},{value:8,label:"Agost"},{value:9,label:"Setembre"},{value:10,label:"Octubre"},{value:11,label:"Novembre"},{value:12,label:"Desembre"}];E(async()=>{x(),T(),_.setMenuItem({icon:f.SHIELD,title:"Verifactu - Consulta de factures enviades"})});const T=()=>{const t=l.getFilter("VerifactuInvoices","");t&&(e.value.year=t.year,e.value.month=t.month)},x=()=>{const t=new Date;e.value.year=t.getFullYear(),e.value.month=t.getMonth()+1},P=()=>{e.value.year=void 0,e.value.month=void 0,c.invoices=[]},D=async()=>{if(!e.value.year||!e.value.month){i.add({severity:"warn",summary:"Filtre incomplet",detail:"Si us plau, selecciona any i mes",life:3e3});return}try{const t=await c.FindInvoices(e.value.month,e.value.year);t&&t.invoices.length===0&&i.add({severity:"info",summary:"Sense resultats",detail:"No s'han trobat factures per al període seleccionat",life:3e3});const s={year:e.value.year,month:e.value.month};l.addFilter("VerifactuInvoices","",s)}catch{i.add({severity:"error",summary:"Error",detail:"Error en la cerca de factures",life:5e3})}};return(t,s)=>{const b=v("Dropdown"),h=v("Button");return w(),S(K,{invoices:r(c).invoices,loading:r(c).loading},{filter:n(()=>[a("div",W,[a("div",z,[a("div",Q,[X,o(b,{modelValue:e.value.year,"onUpdate:modelValue":s[0]||(s[0]=m=>e.value.year=m),options:r(V),optionValue:"value",optionLabel:"label",class:"w-full ml-2",placeholder:"Selecciona un any"},null,8,["modelValue","options"])]),a("div",Z,[ee,o(b,{modelValue:e.value.month,"onUpdate:modelValue":s[1]||(s[1]=m=>e.value.month=m),options:I,optionValue:"value",optionLabel:"label",class:"w-full ml-1",placeholder:"Selecciona un mes"},null,8,["modelValue"])])])]),a("div",ae,[o(h,{class:"datatable-button mr-2",icon:r(f).FILTER,rounded:"",raised:"",onClick:D,disabled:!e.value.year||!e.value.month},null,8,["icon","disabled"]),o(h,{class:"datatable-button mr-2",icon:r(f).FILTER_SLASH,rounded:"",raised:"",onClick:P},null,8,["icon"])])]),_:1},8,["invoices","loading"])}}});export{le as default};
